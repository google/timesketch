# Config file for the tagger analyzer.
#
# Please refer to docs/guides/analyzers/tagger.md for
# instructions on how to edit this file.

gcs_bucket_creation_tagger:
  query_string: 'serviceName: "storage.googleapis.com" AND methodName: "storage.buckets.create"'
  tags: ['gcs-bucket-create']
  emojis: ['BUCKET', 'SPARKLES']
  save_search: true
  search_name: 'Bucket creation'

gcs_bucket_permission_added_tagger:
  query_string:  'serviceName: "storage.googleapis.com" AND methodName: "storage.setIamPermissions" AND policyDelta:*ADD*'
  tags: ['gcs-bucket-add']
  emojis: ['BUCKET', 'PERSON_STANDING']
  save_search: true
  search_name: 'Bucket permission - Add'

gcs_bucket_permission_remove_tagger:
  query_string:  'serviceName: "storage.googleapis.com" AND methodName: "storage.setIamPermissions" AND policyDelta:*REMOVE*'
  tags: ['gcs-bucket-remove']
  emojis: ['BUCKET', 'WASTEBASKET']
  save_search: true
  search_name: 'Bucket permission - Remove'

gcs_bucket_permission_world_added_tagger:
  query_string:  'serviceName: "storage.googleapis.com" AND methodName: "storage.setIamPermissions" AND policyDelta:*ADD allUsers* OR policyDelta:*ADD allAuthenticatedUsers*'
  tags: ['gcs-bucket-world-add']
  emojis: ['BUCKET', 'GLOBE']
  save_search: true
  search_name: 'Bucket permission - World Readable'

yara_match_tagger:
  query_string: '_exists_:yara_match AND NOT yara_match.keyword:"-"'
  tags: ['yara', '$yara_match']
  modifiers: ['split']
  save_search: true
  search_name: 'Yara rule matches'

aws_cloudtrail_readonly_true:
  query_string: 'data_type:"aws:cloudtrail:entry" AND cloud_trail_event:"*readOnly\":true*"'
  tags: ['readOnly_true']
  emojis: ['MAGNIFYING_GLASS']
  save_search: true
  search_name: 'readOnly_true'

aws_cloudtrail_readonly_false:
  query_string: 'data_type:"aws:cloudtrail:entry" AND cloud_trail_event:"*readOnly\":false*"'
  tags: ['readOnly_false']
  emojis: ['SPARKLES']
  save_search: true
  search_name: 'readOnly_false'

aws_cloudtrail_unauthorized_api_call:
  query_string: 'data_type:"aws:cloudtrail:entry" AND (cloud_trail_event:"*errorCode\":\"AccessDenied*" OR cloud_trail_event:"*errorCode\":\"UnauthorizedOperation*")'
  tags: ['UnauthorizedAPICall']
  save_search: true
  search_name: 'UnauthorizedAPICall'

aws_cloudtrail_failed_login_non_existent_iam_user:
  query_string: 'data_type:"aws:cloudtrail:entry" AND cloud_trail_event:"*userIdentity\":\"HIDDEN_DUE_TO_SECURITY_REASONS*" AND cloud_trail_event:"*errorMessage\":\"No username found in supplied account*"'
  tags: ['FailedLoginNonExistentIAMUser']
  save_search: true
  search_name: 'FailedLoginNonExistentIAMUser'

aws_cloudtrail_security_group:
  query_string: 'data_type:"aws:cloudtrail:entry" AND (event_name:"AuthorizeSecurityGroupEgress" OR event_name:"AuthorizeSecurityGroupIngress" OR event_name:"CreateSecurityGroup" OR event_name:"DeleteSecurityGroup" OR event_name:"ModifySecurityGroupRules" OR event_name:"RevokeSecurityGroupEgress" OR event_name:"RevokeSecurityGroupIngress")'
  tags: ['NetworkChanged', 'SG']
  save_search: true
  search_name: 'NetworkChanged SecurityGroup'

aws_cloudtrail_network_acl:
  query_string: 'data_type:"aws:cloudtrail:entry" AND (event_name:"CreateNetworkAcl" OR event_name:"CreateNetworkAclEntry" OR event_name:"DeleteNetworkAcl" OR event_name:"DeleteNetworkAclEntry" OR event_name:"ReplaceNetworkAclAssociation" OR event_name:"ReplaceNetworkAclEntry")'
  tags: ['NetworkChanged', 'NACL']
  save_search: true
  search_name: 'NetworkChanged NetworkACl'

aws_cloudtrail_gateway:
  query_string: 'data_type:"aws:cloudtrail:entry" AND (event_name:Accept* OR event_name:Associate* OR event_name:Attach* OR event_name:Create* OR event_name:Delete* OR event_name:Replace*) AND event_name:*Gateway'
  tags: ['NetworkChanged', 'GW']
  save_search: true
  search_name: 'NetworkChanged GateWay'

aws_cloudtrail_routetable:
  query_string: 'data_type:"aws:cloudtrail:entry" AND (event_name:"CreateRoute" OR event_name:"CreateRouteTable" OR event_name:"DeleteRoute" OR event_name:"DeleteRouteTable" OR event_name:"DisassociateRouteTable" OR event_name:"ReplaceRoute" OR event_name:"ReplaceRouteTableAssociation")'
  tags: ['NetworkChanged', 'RouteTable']
  save_search: true
  search_name: 'NetworkChanged RouteTable'

aws_cloudtrail_vpc:
  query_string: 'data_type:"aws:cloudtrail:entry" AND (event_name:"AcceptVpcPeeringConnection" OR event_name:"AttachClassicLinkVpc" OR event_name:"CreateVpc" OR event_name:"CreateVpcPeeringConnection" OR event_name:"DeleteVpc" OR event_name:"DeleteVpcPeeringConnection" OR event_name:"DetachClassicLinkVpc" OR event_name:"DisableVpcClassicLink" OR event_name:"EnableVpcClassicLink" OR event_name:"ModifyVpcAttribute" OR event_name:"RejectVpcPeeringConnection")'
  tags: ['NetworkChanged', 'VPC']
  save_search: true
  search_name: 'NetworkChanged VPC'

aws_cloudtrail_suspicous_iam_activity:
  query_string: 'data_type:"aws:cloudtrail:entry" AND (event_name:"AddRoleToInstanceProfile" OR event_name:"AddUserToGroup" OR event_name:"AssumeRole" OR event_name:"AttachGroupPolicy" OR event_name:"AttachRolePolicy" OR event_name:"AttachUserPolicy" OR event_name:"CreateAccessKey" OR event_name:"CreateLoginProfile" OR event_name:"CreatePolicyVersion" OR event_name:"CreateRole" OR event_name:"PassRole" OR event_name:"PutGroupPolicy" OR event_name:"PutRolePolicy" OR event_name:"PutUserPolicy" OR event_name:"SetDefaultPolicyVersion" OR event_name:"UpdateAccessKey" OR event_name:"UpdateLoginProfile")'
  tags: ['SuspicousIAMActivity']
  save_search: true
  search_name: 'SuspicousIAMActivity'

aws_cloudtrail_console_login:
  query_string: 'data_type:"aws:cloudtrail:entry" AND event_name:"ConsoleLogin"'
  tags: ['ConsoleLogin']
  save_search: true
  search_name: 'ConsoleLogin'

aws_cloudtrail_get_caller_identity:
  query_string: 'data_type:"aws:cloudtrail:entry" AND event_name:"GetCallerIdentity"'
  tags: ['GetCallerIdentity']
  save_search: true
  search_name: 'GetCallerIdentity'
