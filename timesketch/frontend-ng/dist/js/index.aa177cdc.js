(function(){var e={550:function(e,t,s){"use strict";s.r(t),t["default"]={name:"formatTimestamp",filter:function(e){if("number"===typeof e&&!Number.isInteger(e))return Math.round(1e3*e);let t=parseInt(e).toString().length;return 13===t?e:(15===t||16===t?e/=1e3:10===t&&(e*=1e3),parseInt(e))}}},712:function(e,t,s){"use strict";var i=s(5471),a=function(){var e=this,t=e._self._c;return t("v-app",{attrs:{id:"app"}},[t("v-snackbar",{attrs:{timeout:e.snackbar.timeout,color:e.snackbar.color,top:""},scopedSlots:e._u([{key:"action",fn:function({attrs:s}){return[t("v-btn",e._b({attrs:{text:""},on:{click:function(t){e.snackbar.active=!1}}},"v-btn",s,!1),[e._v(" Close ")])]}}]),model:{value:e.snackbar.active,callback:function(t){e.$set(e.snackbar,"active",t)},expression:"snackbar.active"}},[e._v(" "+e._s(e.snackbar.message)+" ")]),t("router-view")],1)},n=[];const r=new i["default"];var l=r,o={name:"app",data(){return{}},computed:{snackbar(){return this.$store.state.snackbar}},methods:{setErrorSnackBar:function(e){const t={message:e,color:"error",timeout:7e3};this.$store.dispatch("setSnackBar",t)},setWarningSnackBar:function(e){const t={message:e,color:"warning",timeout:5e3};this.$store.dispatch("setSnackBar",t)}},mounted(){l.$on("errorSnackBar",this.setErrorSnackBar),l.$on("warningSnackBar",this.setWarningSnackBar);const e=localStorage.getItem("isDarkTheme");e&&(this.$vuetify.theme.dark="true"===e);let t=document.body;t.dataset.theme=this.$vuetify.theme.dark?"dark":"light"},beforeDestroy(){l.$off("errorSnackBar"),l.$off("warningSnackBar")}},c=o,d=s(1656),u=(0,d.A)(c,a,n,!1,null,null,null),h=u.exports,m=s(173),p=function(){var e=this,t=e._self._c;return t("div",[t("v-toolbar",{attrs:{flat:"",color:"transparent"}},[t("v-avatar",{staticClass:"mt-2 ml-n3"},[t("router-link",{attrs:{to:"/"}},[t("v-img",{attrs:{src:"/dist/timesketch-color.png","max-height":"25","max-width":"25",contain:""}})],1)],1),t("span",{staticStyle:{"font-size":"1.2em"}},[e._v("timesketch")]),t("v-spacer"),t("v-avatar",{staticClass:"ml-3",attrs:{color:"grey lighten-1",size:"25"}},[t("span",{staticClass:"white--text"},[e._v(e._s(e._f("initialLetter")(e.currentUser)))])]),t("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-avatar",[t("v-btn",e._g(e._b({attrs:{small:"",icon:""}},"v-btn",i,!1),s),[t("v-icon",{attrs:{title:"Timesketch Options"}},[e._v("mdi-dots-vertical")])],1)],1)]}}])},[t("v-card",[t("v-list",[t("v-list-item-group",{attrs:{color:"primary"}},[t("v-list-item",{on:{click:e.toggleTheme}},[t("v-list-item-icon",[t("v-icon",[e._v("mdi-brightness-6")])],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Toggle theme")])],1)],1),t("v-list-item",{on:{click:e.switchUI}},[t("v-list-item-icon",[t("v-icon",[e._v("mdi-view-dashboard-outline")])],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Use the old UI")])],1)],1),t("v-list-item",{on:{click:function(t){e.showSettingsDialog=!0}}},[t("v-list-item-icon",[t("v-icon",[e._v("mdi-cog-outline")])],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Settings")])],1)],1),t("a",{staticStyle:{"text-decoration":"none",color:"inherit"},attrs:{href:"/logout/"}},[t("v-list-item",[t("v-list-item-icon",[t("v-icon",[e._v("mdi-logout")])],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Logout")])],1)],1)],1)],1)],1)],1)],1)],1),t("v-main",{staticClass:"notransition"},[t("v-container",{attrs:{fluid:"","pa-0":""}},[t("v-sheet",{staticClass:"pa-5",attrs:{color:e.$vuetify.theme.dark?"grey darken-4":"grey lighten-3","min-height":"200"}},[t("h2",[e._v("Start new investigation")]),t("v-row",{staticClass:"mt-5",attrs:{"no-gutters":""}},[t("v-dialog",{attrs:{width:"500"},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-btn",e._g(e._b({staticClass:"mr-5",attrs:{depressed:"",small:"",color:"primary"}},"v-btn",i,!1),s),[e._v(" Blank sketch ")])]}}]),model:{value:e.createSketchDialog,callback:function(t){e.createSketchDialog=t},expression:"createSketchDialog"}},[t("v-card",{staticClass:"pa-4"},[t("h3",[e._v("New sketch")]),t("br"),t("v-form",{on:{submit:function(t){return t.preventDefault(),e.createSketch()}}},[t("v-text-field",{attrs:{outlined:"",dense:"",placeholder:"Name your sketch",autofocus:"",clearable:"",rules:e.sketchNameRules},model:{value:e.sketchForm.name,callback:function(t){e.$set(e.sketchForm,"name",t)},expression:"sketchForm.name"}}),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:""},on:{click:function(t){e.createSketchDialog=!1}}},[e._v(" Cancel ")]),t("v-btn",{attrs:{disabled:!e.sketchForm.name||e.sketchForm.name.length>255,color:"primary",text:""},on:{click:function(t){return e.createSketch()}}},[e._v(" Create ")])],1)],1)],1)],1)],1)],1),t("div",{staticClass:"pa-5"},[t("h2",[e._v("Your recent work")]),t("ts-sketch-list")],1)],1),t("v-dialog",{attrs:{width:"700px"},model:{value:e.showSettingsDialog,callback:function(t){e.showSettingsDialog=t},expression:"showSettingsDialog"}},[t("ts-settings-dialog")],1)],1)],1)},v=[],g=(s(4114),s(4335));const f=g.A.create({baseURL:"/api/v1",headers:{common:{"X-CSRFToken":document.getElementsByTagName("meta")[0]["content"]}}}),y=g.A.create({baseURL:"/api/v1",responseType:"blob",headers:{common:{"X-CSRFToken":document.getElementsByTagName("meta")[0]["content"]}}});f.interceptors.response.use(function(e){return e},function(e){const t=e.response?e.response.status:null,s=e.config&&e.config.url?e.config.url:"",i=e.response&&e.response.data?e.response.data.message||e.response.data:"Unknown error";return s.includes("/llm/")?(l.$emit("warningSnackBar",i),Promise.reject(e)):(500===t?l.$emit("errorSnackBar","Server side error. Please contact your server administrator for troubleshooting."):l.$emit("errorSnackBar",i),Promise.reject(e))});var _={getSketchList(e,t,s,i){let a={params:{scope:e,page:t,per_page:s,search_query:i}};return f.get("/sketches/",a)},getSketch(e){return f.get("/sketches/"+e+"/")},createSketch(e){return f.post("/sketches/",e)},deleteSketch(e){return f.delete("/sketches/"+e+"/")},archiveSketch(e){let t={action:"archive"};return f.post("/sketches/"+e+"/archive/",t)},unArchiveSketch(e){let t={action:"unarchive"};return f.post("/sketches/"+e+"/archive/",t)},exportSketch(e){let t={action:"export"};return y.post("/sketches/"+e+"/archive/",t)},getSketchAttributes(e){return f.get("/sketches/"+e+"/attribute/")},addSketchAttribute(e,t,s,i){let a={name:t,values:[s],ontology:i,action:"post"};return f.post("/sketches/"+e+"/attribute/",a)},getSketchTimeline(e,t){return f.get("/sketches/"+e+"/timelines/"+t+"/")},getSketchTimelineAnalysis(e,t){return f.get("/sketches/"+e+"/timelines/"+t+"/analysis/")},getTimelineFields(e,t){return f.get("/sketches/"+e+"/timelines/"+t+"/fields/")},saveSketchTimeline(e,t,s,i,a){let n={name:s,description:i,color:a};return f.post("/sketches/"+e+"/timelines/"+t+"/",n)},saveSketchSummary(e,t,s){let i={name:t,description:s};return f.post("/sketches/"+e+"/",i)},deleteSketchTimeline(e,t){return f.delete("/sketches/"+e+"/timelines/"+t+"/")},createEvent(e,t,s,i,a,n){let r={date_string:t,message:s,timestamp_desc:i,attributes:a};return f.post("/sketches/"+e+"/event/create/",r,n)},getEvent(e,t,s,i){let a={params:{searchindex_id:t,event_id:s,include_processing_timelines:i}};return f.get("/sketches/"+e+"/event/",a)},countSketchEvents(e){return f.get("/sketches/"+e+"/count/")},saveEventAnnotation(e,t,s,i,a,n=!1,r=null){let l={annotation:s,annotation_type:t,events:i,current_search_node_id:a?a.id:void 0,remove:n,conclusion_id:r};return f.post("/sketches/"+e+"/event/annotate/",l)},tagEvents(e,t,s){let i={tag_string:JSON.stringify(s),events:t,verbose:!1};return f.post("/sketches/"+e+"/event/tagging/",i)},untagEvents(e,t,s){let i={tags_to_remove:s,events:t};return f.post("/sketches/"+e+"/event/untag/",i)},updateEventAnnotation(e,t,s,i,a){let n={annotation:s,annotation_type:t,events:i,current_search_node_id:a.id};return f.put("/sketches/"+e+"/event/annotate/",n)},deleteEventAnnotation(e,t,s,i,a){let n={params:{annotation_id:s,annotation_type:t,event_id:i._id,searchindex_id:i._index,current_search_node_id:a.id}};return f.delete("/sketches/"+e+"/event/annotate/",n)},getStoryList(e){return f.get("sketches/"+e+"/stories/")},getStory(e,t){return f.get("/sketches/"+e+"/stories/"+t+"/")},createStory(e,t,s){let i={title:e,content:t};return f.post("/sketches/"+s+"/stories/",i)},updateStory(e,t,s,i){let a={title:e,content:t};return f.post("/sketches/"+s+"/stories/"+i+"/",a)},deleteStory(e,t){return f.delete("/sketches/"+e+"/stories/"+t+"/")},getView(e,t){return f.get("/sketches/"+e+"/views/"+t+"/")},createView(e,t,s,i){let a={name:t,query:s,filter:i,dsl:""};return f.post("/sketches/"+e+"/views/",a)},updateView(e,t,s,i){let a={query:s,filter:i};return f.post("/sketches/"+e+"/views/"+t+"/",a)},deleteView(e,t){return f.delete("/sketches/"+e+"/views/"+t+"/")},getSearchTemplates(){return f.get("/searchtemplates/")},parseSearchTemplate(e,t){return f.post("/searchtemplates/"+e+"/parse/",t)},search(e,t){return f.post("/sketches/"+e+"/explore/",t)},exportSearchResult(e,t){return y.post("/sketches/"+e+"/explore/",t)},getSearchHistory(e,t=null,s=null){let i={params:{}};return t&&(i.params.limit=t),s&&(i.params.question=s),f.get("/sketches/"+e+"/searchhistory/",i)},getSearchHistoryTree(e){return f.get("/sketches/"+e+"/searchhistorytree/")},getAggregations(e){return f.get("/sketches/"+e+"/aggregation/")},getAggregationById(e,t){return f.get("/sketches/"+e+"/aggregation/"+t+"/")},deleteAggregationById(e,t){return f.delete("/sketches/"+e+"/aggregation/"+t+"/")},getAggregationGroups(e){return f.get("/sketches/"+e+"/aggregation/group/")},runAggregator(e,t){return f.post("/sketches/"+e+"/aggregation/explore/",t)},runAggregatorGroup(e,t){return f.get("/sketches/"+e+"/aggregation/group/"+t+"/")},saveAggregation(e,t,s,i){let a={name:s,description:t.description,agg_type:t.name,chart_type:i["supported_charts"]||i["aggregator_parameters"]["chart_type"],parameters:i};return f.post("/sketches/"+e+"/aggregation/",a)},getUsers(){return f.get("/users/")},getGroups(){return f.get("/groups/")},grantSketchAccess(e,t,s){let i={users:t,groups:s};return f.post("/sketches/"+e+"/collaborators/",i)},revokeSketchAccess(e,t,s){let i={remove_users:t,remove_groups:s};return f.post("/sketches/"+e+"/collaborators/",i)},setSketchPublicAccess(e,t){let s={public:t};return f.post("/sketches/"+e+"/collaborators/",s)},getAnalyzers(e){return f.get("/sketches/"+e+"/analyzer/")},runAnalyzers(e,t,s,i=!1){let a={timeline_ids:t,analyzer_names:s,analyzer_force_run:i};return f.post("/sketches/"+e+"/analyzer/",a)},getAnalyzerSession(e,t){return f.get("/sketches/"+e+"/analyzer/sessions/"+t+"/")},getActiveAnalyzerSessions(e){let t={params:{include_details:"true"}};return f.get("/sketches/"+e+"/analyzer/sessions/active/",t)},generateGraphFromPlugin(e,t,s,i,a){let n={plugin:t,config:{filter:{indices:s,timelineIds:i}},refresh:a};return i.length&&(n["timeline_ids"]=i),f.post("/sketches/"+e+"/graph/",n)},getGraphPluginList(){return f.get("/graphs/")},saveGraph(e,t,s){let i={name:t,elements:s};return f.post("/sketches/"+e+"/graphs/",i)},getSavedGraphList(e){return f.get("/sketches/"+e+"/graphs/")},getSavedGraph(e,t){let s={params:{format:"cytoscape"}};return f.get("/sketches/"+e+"/graphs/"+t+"/",s)},getSigmaRuleList(){return f.get("/sigmarules/")},getSigmaRuleResource(e){return f.get("/sigmarules/"+e+"/")},getSigmaRuleByText(e){let t={content:e};return f.post("/sigmarules/text/",t)},deleteSigmaRule(e){return f.delete("/sigmarules/"+e+"/")},createSigmaRule(e){let t={rule_yaml:e};return f.post("/sigmarules/",t)},updateSigmaRule(e,t){let s={id:e,rule_yaml:t};return f.put("/sigmarules/"+e+"/",s)},getScenarioTemplates(){return f.get("/scenarios/")},getSketchScenarios(e,t=null){let s={};return t&&(s.params={status:t}),f.get("/sketches/"+e+"/scenarios/",s)},addScenario(e,t,s){let i={scenario_id:t,display_name:s};return f.post("/sketches/"+e+"/scenarios/",i)},renameScenario(e,t,s){let i={scenario_name:s};return f.post("/sketches/"+e+"/scenarios/"+t+"/",i)},setScenarioStatus(e,t,s){let i={status:s};return f.post("/sketches/"+e+"/scenarios/"+t+"/status/",i)},getFacets(e,t){return f.get("/sketches/"+e+"/scenarios/"+t+"/facets/")},getQuestionTemplates(){return f.get("/questions/")},getOrphanQuestions(e){return f.get("/sketches/"+e+"/questions/")},getScenarioQuestions(e,t){return f.get("/sketches/"+e+"/scenarios/"+t+"/questions/")},getFacetQuestions(e,t,s){return f.get("/sketches/"+e+"/scenarios/"+t+"/facets/"+s+"/questions/")},getQuestion(e,t){return f.get("/sketches/"+e+"/questions/"+t+"/")},createQuestion(e,t,s,i,a){let n={scenario_id:t,facet_id:s,question_text:i,template_id:a};return f.post("/sketches/"+e+"/questions/",n)},createQuestionConclusion(e,t,s){let i={conclusionText:s};return f.post("/sketches/"+e+"/questions/"+t+"/conclusions/",i)},editQuestionConclusion(e,t,s,i){let a={conclusionText:i};return f.put("/sketches/"+e+"/questions/"+t+"/conclusions/"+s+"/",a)},deleteQuestionConclusion(e,t,s){return f.delete("/sketches/"+e+"/questions/"+t+"/conclusions/"+s+"/")},getTagMetadata(){return f.get("/intelligence/tagmetadata/")},uploadTimeline(e,t){return f.post("/upload/",e,t)},getSessions(e,t){return f.get("/sketches/"+e+"/explore/sessions/"+t+"/")},getLoggedInUser(){return f.get("/users/me/")},getContextLinkConfig(){return f.get("/contextlinks/")},getUnfurlGraph(e){let t={url:e};return f.post("/unfurl/",t)},getSystemSettings(){return f.get("/settings/")},getUserSettings(){return f.get("/users/me/settings/")},saveUserSettings(e){let t={settings:e};return f.post("/users/me/settings/",t)},llmRequest(e,t,s){return s=s||{},s.feature=t,f.post(`/sketches/${e}/llm/`,s)}},b=function(){var e=this,t=e._self._c;return t("div",[t("v-row",{staticClass:"mt-5",attrs:{"no-gutters":""}},[t("v-col",{attrs:{cols:"9"}},[t("v-btn-toggle",{attrs:{dense:"",group:""},model:{value:e.toggleStateButton,callback:function(t){e.toggleStateButton=t},expression:"toggleStateButton"}},[t("v-btn",{staticStyle:{"border-radius":"6px"},on:{click:function(t){return e.switchScope("recent")}}},[e._v(" Recent ")]),t("v-btn",{staticStyle:{"border-radius":"6px"},on:{click:function(t){return e.switchScope("user")}}},[e._v(" My sketches ")]),t("v-btn",{staticStyle:{"border-radius":"6px"},on:{click:function(t){return e.switchScope("shared")}}},[e._v(" Shared with me ")]),t("v-btn",{staticStyle:{"border-radius":"6px"},on:{click:function(t){return e.switchScope("archived")}}},[e._v(" Archived ")])],1)],1),t("v-col",{attrs:{cols:"3"}},[t("v-text-field",{attrs:{outlined:"",flat:"",dense:"","hide-details":"","single-line":"",label:"Search","prepend-inner-icon":"mdi-magnify"},on:{change:e.search}})],1)],1),t("br"),t("v-data-table",{attrs:{headers:e.headers,items:e.sketches,"items-per-page":15,options:e.options,"server-items-length":e.numSketches,"footer-props":{"items-per-page-options":[15,30,40,50,100]},"disable-filtering":"","disable-sort":"",loading:e.loading},on:{"update:options":function(t){e.options=t}},scopedSlots:e._u([{key:"item.name",fn:function({item:s}){return[t("router-link",{staticStyle:{"text-decoration":"none"},attrs:{to:{name:"Overview",params:{sketchId:s.id}}}},[e._v(e._s(s.name))])]}},{key:"item.created_at",fn:function({item:s}){return[e._v(" "+e._s(e._f("shortDateTime")(s.created_at))+" "),t("small",[e._v("("+e._s(e._f("timeSince")(s.created_at))+")")])]}},{key:"item.last_activity",fn:function({item:t}){return[e._v(" "+e._s(e._f("timeSince")(t.last_activity))+" ")]}}])})],1)},S=[],k={data(){return{headers:[{text:"Name",align:"start",value:"name"},{text:"Creator",value:"user"},{text:"Created at",value:"created_at"},{text:"Last active",value:"last_activity"}],sketches:[],numSketches:0,options:{},loading:!1,toggleStateButton:0,scope:"recent",searchQuery:null}},watch:{options:{handler(){this.getSketches()},deep:!0}},methods:{search:function(e){this.scope="search",this.searchQuery=e,this.getSketches()},switchScope:function(e){this.scope=e,this.getSketches()},getSketches:function(){this.loading=!0,_.getSketchList(this.scope,this.options.page,this.options.itemsPerPage,this.searchQuery).then(e=>{this.sketches=e.data.objects,this.numSketches=e.data.meta.total_items,this.loading=!1}).catch(e=>{this.loading=!1,console.error(e)})}}},w=k,x=(0,d.A)(w,b,S,!1,null,"b903a6fe",null),T=x.exports,C=function(){var e=this,t=e._self._c;return t("v-card",{staticClass:"pa-4",attrs:{"min-height":"800px"}},[t("v-card-title",[e._v("Settings")]),e.settings?t("v-list",{staticClass:"px-3",attrs:{"two-line":"",subheader:"",flat:""}},[t("v-subheader",[e._v("Layout")]),t("v-list-item",[t("v-list-item-action",[t("v-switch",{attrs:{color:"primary"},on:{change:function(t){return e.saveSettings()}},model:{value:e.settings.showLeftPanel,callback:function(t){e.$set(e.settings,"showLeftPanel",t)},expression:"settings.showLeftPanel"}})],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Show side panel")]),t("v-list-item-subtitle",[e._v("Select if the side panel should be expanded or collapsed by default")])],1)],1),t("v-list-item",[t("v-list-item-action",[t("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("div",e._g(e._b({},"div",i,!1),e.isAnyFeatureAvailable?{}:s),[t("v-switch",{attrs:{color:"primary",disabled:!e.isAnyFeatureAvailable},on:{change:e.updateAiFeatures},model:{value:e.settings.aiPoweredFeaturesMain,callback:function(t){e.$set(e.settings,"aiPoweredFeaturesMain",t)},expression:"settings.aiPoweredFeaturesMain"}})],1)]}}],null,!1,170210909)},[t("span",[e._v("This feature requires an LLM provider to be configured. Please contact your administrator.")])])],1),t("v-list-item-content",[t("v-list-item-title",[e._v("AI powered features (experimental)")]),t("v-list-item-subtitle",[e._v("Main switch to enable or disable all experimental AI features")])],1)],1),t("v-list-item",[t("v-list-item-action",{staticClass:"ml-8"},[t("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("div",e._g(e._b({},"div",i,!1),e.isFeatureAvailable("llm_summarize")?{}:s),[t("v-switch",{attrs:{color:"primary",disabled:!e.settings.aiPoweredFeaturesMain||!e.isFeatureAvailable("llm_summarize")},on:{change:function(t){return e.saveSettings()}},model:{value:e.settings.eventSummarization,callback:function(t){e.$set(e.settings,"eventSummarization",t)},expression:"settings.eventSummarization"}})],1)]}}],null,!1,670183324)},[t("span",[e._v("Event summarization requires an LLM provider to be configured. Please contact your administrator.")])])],1),t("v-list-item-content",{staticClass:"ml-8"},[t("v-list-item-title",[e._v("Event summarization")]),t("v-list-item-subtitle",[e._v("Enable AI powered summarization of events")])],1)],1),t("v-list-item",[t("v-list-item-action",{staticClass:"ml-8"},[t("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("div",e._g(e._b({},"div",i,!1),e.isFeatureAvailable("nl2q")?{}:s),[t("v-switch",{attrs:{color:"primary",disabled:!e.settings.aiPoweredFeaturesMain||!e.isFeatureAvailable("nl2q")},on:{change:function(t){return e.saveSettings()}},model:{value:e.settings.generateQuery,callback:function(t){e.$set(e.settings,"generateQuery",t)},expression:"settings.generateQuery"}})],1)]}}],null,!1,3920075210)},[t("span",[e._v("AI query generation requires an LLM provider to be configured. Please contact your administrator.")])])],1),t("v-list-item-content",{staticClass:"ml-8"},[t("v-list-item-title",[e._v("AI generated queries")]),t("v-list-item-subtitle",[e._v("Enable experimental AI query suggestions for DFIQ questions")])],1)],1),e.systemSettings.SEARCH_PROCESSING_TIMELINES?t("v-list-item",[t("v-list-item-action",[t("v-switch",{attrs:{color:"primary"},on:{change:function(t){return e.saveSettings()}},model:{value:e.settings.showProcessingTimelineEvents,callback:function(t){e.$set(e.settings,"showProcessingTimelineEvents",t)},expression:"settings.showProcessingTimelineEvents"}})],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Include Processing Events")]),t("v-list-item-subtitle",[e._v("Allows queries to include events from timelines still being "),t("strong",[e._v("processed")]),e._v(".")])],1)],1):e._e()],1):e._e()],1)},A=[];s(8111),s(3579);const D={showLeftPanel:!0,aiPoweredFeaturesMain:!1,eventSummarization:!1,generateQuery:!1,showProcessingTimelineEvents:!1};var $={data(){return{settings:{showLeftPanel:!0,aiPoweredFeaturesMain:!1,eventSummarization:!1,generateQuery:!1,showProcessingTimelineEvents:!1}}},computed:{sketch(){return this.$store.state.sketch},systemSettings(){return this.$store.state.systemSettings},userSettings(){return this.$store.state.settings},llmFeatures(){return this.systemSettings.LLM_FEATURES_AVAILABLE||{}},isAnyFeatureAvailable(){return Object.values(this.llmFeatures).some(e=>!0===e)}},methods:{saveSettings(){_.saveUserSettings(this.settings).then(()=>this.$store.dispatch("updateUserSettings")).then(()=>{this.settings={...this.userSettings}}).catch(e=>{console.log(e)})},updateAiFeatures(){this.settings.aiPoweredFeaturesMain||(this.settings.eventSummarization=!1,this.settings.generateQuery=!1),this.saveSettings()},isFeatureAvailable(e){return!0===this.llmFeatures[e]}},mounted(){this.settings={...D,...this.userSettings},this.saveSettings()}},L=$,I=(0,d.A)(L,C,A,!1,null,null,null),E=I.exports,N={components:{TsSketchList:T,TsSettingsDialog:E},data(){return{sketchForm:{name:""},createSketchDialog:!1,scenarioTemplates:[],showSettingsDialog:!1,sketchNameRules:[e=>!!e||"Sketch name is required.",e=>e&&e.length<=255||"Sketch name is too long."]}},computed:{currentUser(){return this.$store.state.currentUser},userSettings(){return this.$store.state.settings},systemSettings(){return this.$store.state.systemSettings}},mounted(){this.$store.dispatch("updateSystemSettings"),this.$store.dispatch("updateUserSettings")},methods:{toggleTheme:function(){this.$vuetify.theme.dark=!this.$vuetify.theme.dark,localStorage.setItem("isDarkTheme",this.$vuetify.theme.dark.toString())},switchUI:function(){window.location.href="/legacy/"},clearFormData:function(){this.sketchForm.name=""},createSketch:function(){_.createSketch(this.sketchForm).then(e=>{let t=e.data.objects[0].id;this.clearFormData(),this.$router.push({name:"Overview",params:{sketchId:t}})}).catch(e=>{})}},created:function(){this.$store.dispatch("resetState"),document.title="Timesketch",_.getScenarioTemplates().then(e=>{this.scenarioTemplates=e.data["objects"]}).catch(e=>{})}},z=N,F=(0,d.A)(z,p,v,!1,null,null,null),R=F.exports,P=function(){var e=this,t=e._self._c;return t("div",[t("div",{directives:[{name:"show",rawName:"v-show",value:"Explore"===e.currentRouteName,expression:"currentRouteName === 'Explore'"}]},[t("explore",{attrs:{"sketch-id":e.sketchId}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:"Intelligence"===e.currentRouteName,expression:"currentRouteName === 'Intelligence'"}]},[t("threat-intel",{attrs:{"sketch-id":e.sketchId}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:"SigmaNewRule"===e.currentRouteName,expression:"currentRouteName === 'SigmaNewRule'"}]},[t("sigma",{attrs:{"sketch-id":e.sketchId}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:"SigmaEditRule"===e.currentRouteName,expression:"currentRouteName === 'SigmaEditRule'"}]},[t("sigma",{attrs:{"sketch-id":e.sketchId,"rule-id":e.ruleId}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:"Graph"===e.currentRouteName,expression:"currentRouteName === 'Graph'"}]},[t("graph")],1),t("div",{directives:[{name:"show",rawName:"v-show",value:"Story"===e.currentRouteName,expression:"currentRouteName === 'Story'"}]},[t("story",{attrs:{"sketch-id":e.sketchId,"story-id":e.storyId}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:"Analyze"===e.currentRouteName,expression:"currentRouteName === 'Analyze'"}]},[t("analyze",{attrs:{"sketch-id":e.sketchId,"analyzer-timeline-id":e.analyzerTimelineId}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:"VisualizationNew"===e.currentRouteName,expression:"currentRouteName === 'VisualizationNew'"}]},[t("visualization")],1),t("div",{directives:[{name:"show",rawName:"v-show",value:"VisualizationView"===e.currentRouteName,expression:"currentRouteName === 'VisualizationView'"}]},[t("visualization",{attrs:{"aggregation-id":e.aggregationId}})],1)])},O=[],Q=function(){var e=this,t=e._self._c;return t("v-container",{attrs:{fluid:""}},[t("v-card",{staticClass:"pa-3 pt-0 mt-n3",attrs:{flat:"",color:"transparent"}},[t("v-card",{staticClass:"d-flex align-start mb-1",attrs:{outlined:""}},[t("v-sheet",{staticClass:"mt-2"},[t("ts-search-history-buttons",{on:{toggleSearchHistory:function(t){return e.toggleSearchHistory()}}})],1),t("v-menu",{attrs:{"offset-y":"",attach:"","close-on-content-click":!1,"close-on-click":!0},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-text-field",e._g(e._b({ref:"searchInput",staticClass:"pa-2",attrs:{"hide-details":"",label:"Search",placeholder:"Search","single-line":"",dense:"",flat:"",solo:"",id:"tsSearchInput"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search()},click:function(t){e.showSearchDropdown=!0}},scopedSlots:e._u([{key:"append",fn:function(){return[t("v-icon",{staticClass:"mr-3",attrs:{title:"Run search"},on:{click:function(t){return e.search()}}},[e._v("mdi-magnify")]),t("v-icon",{attrs:{title:"Show search examples"},on:{click:function(t){e.showSearchHelp=!0}}},[e._v("mdi-help-circle-outline")])]},proxy:!0}],null,!0),model:{value:e.currentQueryString,callback:function(t){e.currentQueryString=t},expression:"currentQueryString"}},"v-text-field",i,!1),s))]}}]),model:{value:e.showSearchDropdown,callback:function(t){e.showSearchDropdown=t},expression:"showSearchDropdown"}},[t("ts-search-dropdown",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.onClickOutside,expression:"onClickOutside"}],attrs:{"selected-labels":e.selectedLabels,"query-string":e.currentQueryString},on:{setActiveView:e.searchView,addChip:e.addChip,updateLabelChips:function(t){return e.updateLabelChips()},"close-on-click":function(t){e.showSearchDropdown=!1},"node-click":e.jumpInHistory,setQueryAndFilter:e.setQueryAndFilter}})],1)],1),t("div",{staticClass:"mt-4"},[t("v-card",{directives:[{name:"show",rawName:"v-show",value:e.showSearchHistory,expression:"showSearchHistory"}],attrs:{outlined:""}},[t("v-toolbar",{attrs:{dense:"",flat:""}},[t("v-toolbar-title",[e._v("Search history")]),t("v-spacer"),t("v-slider",{staticClass:"mt-6",attrs:{"thumb-label":"",ticks:"","append-icon":"mdi-magnify-plus-outline","prepend-icon":"mdi-magnify-minus-outline",min:"0.1",max:"1",step:"0.1"},scopedSlots:e._u([{key:"thumb-label",fn:function({value:t}){return[e._v(" "+e._s(100*t)+"% ")]}}]),model:{value:e.zoomLevel,callback:function(t){e.zoomLevel=t},expression:"zoomLevel"}}),t("v-btn",{staticClass:"ml-4",attrs:{icon:""},on:{click:function(t){e.showSearchHistory=!1}}},[t("v-icon",{attrs:{title:"Close search history"}},[e._v("mdi-close")])],1)],1),t("v-divider"),t("div",{directives:[{name:"dragscroll",rawName:"v-dragscroll"}],staticClass:"pa-md-4 no-scrollbars",staticStyle:{overflow:"scroll","white-space":"nowrap","max-height":"500px","min-height":"100px"}},[t("ts-search-history-tree",{staticStyle:{"transform-origin":"top left"},style:{transform:"scale("+e.zoomLevel+")"},attrs:{"show-history":e.showSearchHistory},on:{"node-click":e.jumpInHistory}})],1)],1)],1),t("v-dialog",{attrs:{"max-width":"1800",scrollable:""},model:{value:e.showSearchHelp,callback:function(t){e.showSearchHelp=t},expression:"showSearchHelp"}},[t("ts-search-help-card",{attrs:{flat:!0},on:{"close-dialog":function(t){e.showSearchHelp=!1}}})],1),t("div",[t("v-toolbar",{staticClass:"mt-n3",staticStyle:{"background-color":"transparent"},attrs:{flat:"",dense:""}},[t("v-btn",{attrs:{small:"",icon:""},on:{click:function(t){e.showTimelines=!e.showTimelines}}},[e.showTimelines?t("v-icon",{attrs:{title:"Hide Timelines"}},[e._v("mdi-chevron-up")]):t("v-icon",{attrs:{title:"Show Timelines"}},[e._v("mdi-chevron-down")])],1),t("span",{staticClass:"timeline-header"},[t("ts-upload-timeline-form-button",{attrs:{"btn-type":"small"}}),t("v-dialog",{attrs:{width:"600"},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-btn",e._g(e._b({attrs:{small:"",text:"",rounded:"",color:"primary"}},"v-btn",i,!1),s),[t("v-icon",{attrs:{left:"",small:""}},[e._v(" mdi-plus ")]),e._v(" Add manual event ")],1)]}}]),model:{value:e.addManualEvent,callback:function(t){e.addManualEvent=t},expression:"addManualEvent"}},[t("ts-add-manual-event",{attrs:{app:"",datetimeProp:e.datetimeManualEvent},on:{cancel:function(t){e.addManualEvent=!1}}})],1),t("v-btn",{attrs:{small:"",text:"",rounded:"",color:"primary"},on:{click:function(t){return t.stopPropagation(),e.enableAllTimelines()}}},[t("v-icon",{attrs:{left:"",small:""}},[e._v("mdi-eye")]),t("span",[e._v("Select all")])],1),t("v-btn",{attrs:{small:"",text:"",rounded:"",color:"primary"},on:{click:function(t){return t.stopPropagation(),e.disableAllTimelines()}}},[t("v-icon",{attrs:{left:"",small:""}},[e._v("mdi-eye-off")]),t("span",[e._v("Unselect all")])],1)],1)],1),t("v-expand-transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.showTimelines,expression:"showTimelines"}]},[t("ts-timeline-picker",{attrs:{"current-query-filter":e.currentQueryFilter,"count-per-index":e.countPerIndex,"count-per-timeline":e.countPerTimeline}})],1)])],1),t("div",[e._l(e.timeFilterChips,function(s,i){return t("span",{key:i+s.value},[t("v-menu",{attrs:{"offset-y":"","content-class":"menu-with-gap"},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("v-chip",e._g({attrs:{outlined:""}},i),[t("v-icon",{attrs:{left:"",small:""}},[e._v(" mdi-clock-outline ")]),t("span",{style:[s.active?"":{"text-decoration":"line-through",opacity:"50%"}]},[t("span",[e._v(e._s(s.value.split(",")[0]))]),"datetime_range"===s.type&&s.value.split(",")[0]!==s.value.split(",")[1]?t("span",[e._v(" â†’ "+e._s(s.value.split(",")[1]))]):e._e()])],1)]}}],null,!0)},[t("v-card",[t("v-list",[t("v-menu",{staticStyle:{overflow:"visible"},attrs:{"offset-y":"","close-on-content-click":!1,"close-on-click":!0,"nudge-top":"70","content-class":"menu-with-gap","allow-overflow":""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-list-item",e._g(e._b({},"v-list-item",i,!1),s),[t("v-list-item-action",[t("v-icon",[e._v("mdi-square-edit-outline")])],1),t("v-list-item-subtitle",[e._v("Edit filter")])],1)]}}],null,!0)},[t("ts-filter-menu",{attrs:{app:"","selected-chip":s},on:{updateChip:function(t){return e.updateChip(t,s)}}})],1),t("v-list-item",{on:{click:function(t){return e.copyFilterChip(s)}}},[t("v-list-item-action",[t("v-icon",[e._v("mdi-content-copy")])],1),t("v-list-item-subtitle",[e._v("Copy filter")])],1),t("v-list-item",{on:{click:function(t){return e.toggleChip(s)}}},[t("v-list-item-action",[s.active?t("v-icon",[e._v("mdi-eye-off")]):t("v-icon",[e._v("mdi-eye")])],1),t("v-list-item-subtitle",[s.active?t("span",[e._v("Temporarily disable")]):t("span",[e._v("Re-enable")])])],1),t("v-list-item",{on:{click:function(t){return e.removeChip(s)}}},[t("v-list-item-action",[t("v-icon",[e._v("mdi-delete")])],1),t("v-list-item-subtitle",[e._v("Remove filter")])],1)],1)],1)],1),i+1<e.timeFilterChips.length?t("v-btn",{staticClass:"mr-2",staticStyle:{"margin-top":"2px"},attrs:{icon:"",small:""}},[e._v("OR")]):e._e()],1)}),t("span",[t("v-menu",{staticStyle:{overflow:"visible"},attrs:{"offset-y":"","close-on-content-click":!1,"close-on-click":!0,"content-class":"menu-with-gap","allow-overflow":""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-btn",e._g(e._b({attrs:{small:"",text:"",rounded:"",color:"primary"}},"v-btn",i,!1),s),[t("v-icon",{attrs:{left:"",small:""}},[e._v(" mdi-clock-plus-outline ")]),e._v(" Add timefilter ")],1)]}}]),model:{value:e.timeFilterMenu,callback:function(t){e.timeFilterMenu=t},expression:"timeFilterMenu"}},[t("ts-filter-menu",{attrs:{app:""},on:{cancel:function(t){e.timeFilterMenu=!1},addChip:e.addChip}})],1)],1)],2),e.filterChips.length?t("div",{staticClass:"mt-1"},[t("v-chip-group",{attrs:{column:""}},e._l(e.filterChips,function(s,i){return t("span",{key:i+s.value},[t("v-tooltip",{attrs:{top:"",disabled:s.value.length<33,"open-delay":"300"},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:a}){return[t("v-chip",e._g(e._b({attrs:{outlined:"",close:"","close-icon":"mdi-close"},on:{"click:close":function(t){return e.removeChip(s)},click:function(t){return e.copyFilterChip(s)}}},"v-chip",a,!1),i),["__ts_star"===s.value?t("v-icon",{attrs:{left:"",small:"",color:"amber"}},[e._v("mdi-star")]):e._e(),"__ts_comment"===s.value?t("v-icon",{attrs:{left:"",small:""}},[e._v("mdi-comment-multiple-outline")]):e._e(),e.getQuickTag(s.value)?t("v-icon",{attrs:{left:"",small:"",color:e.getQuickTag(s.value).color}},[e._v(e._s(e.getQuickTag(s.value).label))]):e._e(),"must_not"===s.operator?t("span",{staticClass:"filter-chip-truncate"},[t("span",{staticStyle:{color:"red"}},[e._v("NOT ")]),e._v(" "+e._s(e._f("formatLabelText")(s.field?`${s.field} : ${s.value}`:s.value))+" ")]):t("span",{staticClass:"filter-chip-truncate"},[e._v(" "+e._s(e._f("formatLabelText")(s.field?`${s.field} : ${s.value}`:s.value))+" ")])],1)]}}],null,!0)},[t("span",[e._v(e._s(s.value))])]),i+1<e.timeFilterChips.length?t("v-btn",{staticClass:"mr-2",staticStyle:{"margin-top":"2px"},attrs:{icon:"",small:""}},[e._v("AND")]):e._e()],1)}),0)],1):e._e()],1),t("v-card",{staticClass:"mt-5 mx-3",attrs:{flat:"",color:"transparent"}},[t("ts-event-list",{attrs:{"query-request":e.activeQueryRequest},on:{countPerIndex:function(t){return e.updateCountPerIndex(t)},countPerTimeline:function(t){return e.updateCountPerTimeline(t)}}})],1)],1)},M=[],q=(s(2489),s(116),s(7588),s(1701),s(5915)),B=function(){var e=this,t=e._self._c;return Object.keys(e.treeData).length>0?t("ul",{staticClass:"tree"},[t("tree-node",{attrs:{node:e.treeData,"handle-click":e.handleClick,"selected-node":e.selectedNode}})],1):e._e()},V=[],H=function(){var e=this,t=e._self._c;return t("li",[t("span",{class:[{active:e.isSelected},{star:e.hasStar&&!e.isSelected},{dimmed:0===e.count&&!e.isSelected}],staticStyle:{"min-width":"280px"},attrs:{id:e.node.id},on:{click:function(t){return e.handleClick(e.node)}}},[e.hasStar?t("v-icon",{staticClass:"mr-1",staticStyle:{float:"left"},attrs:{title:"Added a Star to an event",color:"amber darken-2"}},[e._v("mdi-star")]):e._e(),e.hasComment?t("v-icon",{staticClass:"mr-1",staticStyle:{float:"left"},attrs:{title:"Added a Comment to an event"}},[e._v("mdi-comment-outline")]):e._e(),e.hasLabel?t("v-icon",{staticStyle:{float:"left","margin-right":"10px"},attrs:{title:"Added a Label to an event"}},[e._v("mdi-label")]):e._e(),t("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("div",e._g(e._b({staticClass:"query-string",class:[{"query-string-active":e.isSelected}],staticStyle:{float:"left"}},"div",i,!1),s),[e._v(" "+e._s(e.node.query_string)+" ")])]}}])},[t("span",[e._v(e._s(e.node.query_string)+" "+e._s(e.node))])]),t("div",{staticClass:"tag is-light",staticStyle:{"margin-left":"5px",float:"right"}},[t("small",[e._v(e._s(e._f("compactNumber")(e.count)))])])],1),e.node.children&&e.node.children.length?t("ul",e._l(e.node.children,function(s){return t("node",{key:s.id,attrs:{node:s,"handle-click":e.handleClick,"selected-node":e.selectedNode}})}),1):e._e()])},G=[],U={name:"node",props:{node:Object,handleClick:Function,selectedNode:Object},computed:{hasStar(){return this.node.labels.includes("__ts_star")},hasLabel(){return this.node.labels.includes("__ts_label")},hasComment(){return this.node.labels.includes("__ts_comment")},isSelected(){return this.selectedNode.id===this.node.id},count(){return this.node.query_result_count||0}}},W=U,j=(0,d.A)(W,H,G,!1,null,"a080baf6",null),Y=j.exports;function X(e,t,s){if(e.hasOwnProperty(t)&&!0===s(t,e[t]))return e;for(let i=0;i<Object.keys(e).length;i++){let a=e[Object.keys(e)[i]];if("object"===typeof a&&null!=a){let e=X(a,t,s);if(null!=e)return e}}return null}var J={components:{TreeNode:Y},data(){return{treeData:{},selectedNode:null,initialNode:null}},computed:{sketch(){return this.$store.state.sketch}},methods:{handleClick(e){this.$emit("node-click",e),this.selectedNode=e},handleClickFromDropdown(e){let t;t="number"===typeof e?e:e.id;let s=X(this.treeData,"id",(e,s)=>s===t);this.$emit("node-click",s),this.selectedNode=s},createBranch(e){if(this.selectedNode){if(this.selectedNode.id===e.id)return;return this.selectedNode.children.push(e),void(this.selectedNode=e)}this.fetchHistory();let t=X(this.treeData,"id",(t,s)=>s===e.parent);if(t){if(t.children.some(t=>t.id===e.id))return;return t.children.push(e),void(this.selectedNode=e)}let s=X(this.treeData,"id",(t,s)=>s===e.id);s&&(this.selectedNode=s)},annotateNode(e){e.searchNode.labels.includes(e.type)||e.searchNode.labels.push(e.type)},scrollTo(){this.$nextTick(function(){document.getElementById(this.selectedNode.id.toString()).scrollIntoView({behavior:"smooth",block:"center",inline:"center"})})},fetchHistory(){_.getSearchHistoryTree(this.sketch.id).then(e=>{if(this.treeData=e.data.objects[0],!this.selectedNode){let t=e.data.meta["last_node_id"];this.selectedNode=X(this.treeData,"id",(e,s)=>s===t)}}).catch(e=>{})}},beforeDestroy(){l.$off("createBranch"),l.$off("eventAnnotated"),l.$off("triggerScrollTo"),l.$off("selected-node-from-dropdown")},created:function(){l.$on("createBranch",this.createBranch),l.$on("eventAnnotated",this.annotateNode),l.$on("triggerScrollTo",this.scrollTo),l.$on("selected-node-from-dropdown",this.handleClickFromDropdown),this.fetchHistory()},watch:{selectedNode:function(){this.$store.dispatch("updateSearchNode",this.selectedNode),this.scrollTo()}}},K=J,Z=(0,d.A)(K,B,V,!1,null,null,null),ee=Z.exports,te=function(){var e=this,t=e._self._c;return t("span",[t("v-btn",{attrs:{icon:"",disabled:!e.hasParent},on:{click:e.searchHistoryBack}},[t("v-icon",{attrs:{title:"Go back to your last search"}},[e._v("mdi-arrow-left")])],1),t("v-btn",{attrs:{icon:"",disabled:!e.hasChild},on:{click:e.searchHistoryForward}},[t("v-icon",{attrs:{title:"Go to your next search"}},[e._v("mdi-arrow-right")])],1),t("v-btn",{attrs:{icon:""},on:{click:function(t){return e.$emit("toggleSearchHistory")}}},[t("v-icon",{attrs:{title:"Open your search history"}},[e._v("mdi-history")])],1)],1)},se=[],ie={computed:{currentSearchNode(){return this.$store.state.currentSearchNode},hasParent(){return!!this.currentSearchNode&&"number"===typeof this.currentSearchNode.parent},hasChild(){return!!this.currentSearchNode&&this.currentSearchNode.children.length}},methods:{searchHistoryBack:function(){l.$emit("selected-node-from-dropdown",this.currentSearchNode.parent)},searchHistoryForward:function(){if(!this.currentSearchNode.children.length)return;let e=this.currentSearchNode.children.slice(-1).pop();l.$emit("selected-node-from-dropdown",e)}}},ae=ie,ne=(0,d.A)(ae,te,se,!1,null,"5fd1791a",null),re=ne.exports,le=function(){var e=this,t=e._self._c;return t("v-card",{staticStyle:{overflow:"hidden"},attrs:{outlined:"","min-height":"550"}},[t("v-row",[e.matches.savedSearches.length?t("v-col",{attrs:{cols:"3"}},[t("h5",{staticClass:"mt-3 ml-4"},[e._v("Saved searches")]),t("v-list",{staticClass:"overflow-y-auto",class:e.scrollbarTheme,staticStyle:{height:"500px"},attrs:{dense:""}},e._l(e.matches.savedSearches,function(s){return t("v-list-item",{key:s.id,staticStyle:{"font-size":"0.9em"},on:{click:function(t){return e.$emit("setActiveView",s)}}},[t("v-list-item-content",[e._v(" "+e._s(s.name)+" ")])],1)}),1)],1):e._e(),t("v-divider",{attrs:{vertical:""}}),e.matches.timeFilters.length?t("v-col",{attrs:{cols:"3"}},[t("h5",{staticClass:"mt-3 ml-4"},[e._v("Last time filters")]),t("v-list",{staticClass:"overflow-y-auto",class:e.scrollbarTheme,staticStyle:{height:"500px"},attrs:{dense:""}},[e._l(e.matches.timeFilters.slice(0,e.MAX_TIMELINE_ELEMENTS),function(s){return[t("v-list-item",{key:s.value,staticStyle:{"font-size":"0.9em"},on:{click:function(t){return e.setTimeFilter(s)}}},[t("v-list-item-content",[e._v(" "+e._s(s.value.split(",")[0])+" - "+e._s(s.value.split(",")[1])+" ")])],1)]})],2)],1):e._e(),t("v-divider",{attrs:{vertical:""}}),t("v-col",{attrs:{cols:"3"}},[t("h5",{staticClass:"mt-3 ml-4"},[e._v("Data types")]),t("v-list",{staticClass:"overflow-y-auto",class:e.scrollbarTheme,staticStyle:{height:"500px"},attrs:{dense:""}},e._l(e.matches.dataTypes,function(s){return t("v-list-item",{key:s.data_type,staticStyle:{"font-size":"0.9em"},on:{click:function(t){return e.searchForDataType(s.data_type)}}},[t("v-list-item-content",[t("span",[e._v(e._s(s.data_type)+" "),t("span",{staticClass:"font-weight-bold",staticStyle:{"font-size":"0.8em"}},[e._v("("+e._s(e._f("compactNumber")(s.count))+")")])])])],1)}),1)],1),t("v-divider",{attrs:{vertical:""}}),e.matches.labels.length||e.matches.tags.length?t("v-col",{attrs:{cols:"3"}},[t("h5",{staticClass:"mt-3 ml-5"},[e._v("Tags")]),t("ts-tags-list")],1):e._e()],1)],1)},oe=[],ce=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("v-data-iterator",{attrs:{items:e.allTagsAndLabels,"items-per-page":e.itemsPerPage,search:e.search,"hide-default-footer":e.allTagsAndLabels.length<=e.itemsPerPage},on:{"update:itemsPerPage":function(t){e.itemsPerPage=t},"update:items-per-page":function(t){e.itemsPerPage=t}},scopedSlots:e._u([e.allTagsAndLabels.length>e.itemsPerPage?{key:"header",fn:function(){return[t("v-toolbar",{attrs:{flat:""}},[t("v-text-field",{attrs:{clearable:"","hide-details":"",outlined:"",dense:"","prepend-inner-icon":"mdi-magnify",label:"Search for tags ..."},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)]},proxy:!0}:null,{key:"default",fn:function(s){return e._l(s.items,function(s){return t("div",{key:s.tag||s.label,staticStyle:{cursor:"pointer","font-size":"0.9em"},on:{click:function(t){return e.applyFilterChip(s.tag||s.label,s.tag?"tag":"",s.tag?"term":"label")}}},[t("v-row",{staticClass:"pa-2 pl-5",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",attrs:{"no-gutters":""}},["__ts_star"===s.label?t("v-icon",{attrs:{left:"",small:"",color:"amber"}},[e._v("mdi-star")]):e._e(),"__ts_comment"===s.label?t("v-icon",{attrs:{left:"",small:""}},[e._v("mdi-comment-multiple-outline")]):e._e(),e.getQuickTag(s.tag)?t("v-icon",{attrs:{small:"",left:"",color:e.getQuickTag(s.tag).color}},[e._v(e._s(e.getQuickTag(s.tag).label))]):e._e(),t("span",[e._v(" "+e._s(e._f("formatLabelText")(s.tag||s.label))+" ("),t("small",[t("strong",[e._v(e._s(e._f("compactNumber")(s.count)))])]),e._v(") ")])],1)],1)})}}],null,!0)})],1)])},de=[],ue={props:[],data:function(){return{quickTags:[{tag:"bad",color:"red",textColor:"white",label:"mdi-alert-circle-outline"},{tag:"suspicious",color:"orange",textColor:"white",label:"mdi-help-circle-outline"},{tag:"good",color:"green",textColor:"white",label:"mdi-check-circle-outline"}],itemsPerPage:10,search:""}},computed:{meta(){return this.$store.state.meta},tags(){return this.$store.state.tags},labels(){return this.meta.filter_labels},customTags(){return this.tags.filter(e=>!this.getQuickTag(e.tag))},assignedQuickTags(){return this.tags.filter(e=>this.getQuickTag(e.tag))},allTagsAndLabels(){const e=["__ts_star","__ts_comment","bad","suspicious","good"];return[...this.labels,...this.assignedQuickTags,...this.customTags].filter(e=>e.tag||e.label).filter(e=>!(e.label&&e.label.startsWith("__ts_fact"))).sort((t,s)=>{const i=t.tag||t.label,a=s.tag||s.label,n=!!t.label,r=!!s.label;if(n&&!r)return-1;if(!n&&r)return 1;const l=e.indexOf(i),o=e.indexOf(a);return l>-1&&o>-1?l-o:l>-1?-1:o>-1?1:i.localeCompare(a)})}},methods:{getQuickTag(e){return this.quickTags.find(t=>t.tag===e)},applyFilterChip(e,t="",s="label"){let i={doSearch:!0,queryString:"*"},a={field:t,value:e,type:s,operator:"must",active:!0};i.chip=a,l.$emit("setQueryAndFilter",i)}}},he=ue,me=(0,d.A)(he,ce,de,!1,null,null,null),pe=me.exports,ve={components:{TsTagsList:pe},props:["selectedLabels","queryString"],computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},searchHistory(){return this.$store.state.searchHistory},tags(){return this.$store.state.tags},dataTypes(){return this.$store.state.dataTypes},filteredMetaLabels(){return this.meta.filter_labels.filter(e=>!e.label.startsWith("__ts_fact"))},all(){return{fields:this.meta.mappings,tags:this.tags,labels:this.filteredMetaLabels,dataTypes:this.dataTypes,savedSearches:this.meta.views,timeFilters:this.timeFilters}},timeFilters(){return this.$store.state.timeFilters},scrollbarTheme(){return this.$vuetify.theme.dark?"dark":"light"},matches(){let e={};return this.queryString?(e.fields=this.meta.mappings.filter(e=>e.field.toLowerCase().includes(this.queryString.toLowerCase())),e.tags=this.tags.filter(e=>e.tag.toLowerCase().includes(this.queryString.toLowerCase())),e.labels=this.filteredMetaLabels.filter(e=>e.label.toLowerCase().includes(this.queryString.toLowerCase())),e.dataTypes=this.dataTypes.filter(e=>e.data_type.toLowerCase().includes(this.queryString.toLowerCase())),e.savedSearches=this.meta.views.filter(e=>e.name.toLowerCase().includes(this.queryString.toLowerCase())),Object.values(e).filter(e=>e.length).length?e:this.all):this.all}},methods:{searchForDataType(e){let t={doSearch:!0};t.queryString='data_type:"'+e+'"',this.$emit("setQueryAndFilter",t)},searchForField(e){let t={},s="";""!==this.queryString&&(s=this.queryString+" "),this.queryString.includes(" ")||(s=""),t.doSearch=!1,t.queryString=s+e+":",this.$emit("setQueryAndFilter",t)},setTimeFilter(e){this.$emit("addChip",e)},fetchTimeFilters(){this.$store.dispatch("updateTimeFilters")}},created:function(){this.fetchTimeFilters()},setup:function(){return{MAX_TIMELINE_ELEMENTS:10}}},ge=ve,fe=(0,d.A)(ge,le,oe,!1,null,"e0284ffc",null),ye=fe.exports,_e=function(){var e=this,t=e._self._c;return t("span",[e._l(e.allTimelines,function(s){return t("ts-timeline-chip",{key:s.id+s.name,staticClass:"mr-2 mb-3 timeline-chip",attrs:{timeline:s,"is-selected":e.isSelected(s),"is-empty-state":e.isEmptyState,"events-count":e.getCount(s)},on:{remove:e.remove,save:e.save,toggle:e.toggleTimeline,disableAllOtherTimelines:e.disableAllOtherTimelines}})}),e.sketch.timelines.length>20?t("v-btn",{staticClass:"mt-n3 mr-5",attrs:{small:"",text:"",rounded:"",color:"primary"},on:{click:function(t){e.showAll=!e.showAll}}},[e.showAll?t("span",[e._v(" show less ")]):t("span",[e._v(" "+e._s(e.sketch.timelines.length-20)+" more.. ")])]):e._e(),t("br")],2)},be=[],Se=function(){var e=this,t=e._self._c;return t("ts-timeline-component",{attrs:{timeline:e.timeline,eventsCount:e.eventsCount,isSelected:e.isSelected,isEmptyState:e.isEmptyState},on:{toggle:function(t){return e.$emit("toggle",...arguments)},disableAllOtherTimelines:function(t){return e.$emit("disableAllOtherTimelines",...arguments)},save:function(t){return e.$emit("save",...arguments)},remove:function(t){return e.$emit("remove",...arguments)}},scopedSlots:e._u([{key:"processing",fn:function(s){return[t("v-chip",e._g({style:e.timelineStyle(s.timelineStatus)},s.events.on),[t("span",{staticClass:"timeline-name-ellipsis"},[e._v(e._s(e.timeline.name))]),t("span",{staticClass:"ml-1"},[t("v-progress-circular",{attrs:{small:"",indeterminate:"",color:"grey",size:20,width:1}})],1)])]}},{key:"processed",fn:function(s){return[t("v-chip",{staticClass:"pr-1 timeline-chip",class:[{failed:s.timelineFailed},e.$vuetify.theme.dark?"dark-highlight":"light-highlight"],style:e.timelineStyle(s.timelineStatus),attrs:{ripple:!s.timelineFailed},on:{click:s.events.toggleTimeline}},[t("div",{staticClass:"chip-content"},[s.timelineFailed?t("v-icon",{attrs:{title:"Import failed; click for details",left:"",color:"red",size:"x-large"},on:{click:s.events.openDialog}},[e._v(" mdi-alert-circle-outline ")]):e._e(),s.timelineFailed?e._e():t("v-icon",{staticClass:"ml-n2",attrs:{title:"Toggle visibility",left:"",color:s.timelineChipColor,size:"26"}},[e._v(" mdi-circle ")]),t("v-tooltip",{attrs:{bottom:"",disabled:e.timeline.name.length<30,"open-delay":"200"},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:a}){return[t("span",e._g(e._b({staticClass:"timeline-name-ellipsis",class:{disabled:!e.isSelected&&("processing"===s.timelineStatus||"ready"===s.timelineStatus)}},"span",a,!1),i),[e._v(e._s(e.timeline.name))])]}}],null,!0)},[t("span",[e._v(e._s(e.timeline.name))])]),t("span",{staticClass:"right"},["processing"===s.timelineStatus?t("span",{staticClass:"ml-3"},[t("v-progress-circular",{attrs:{small:"",indeterminate:"",color:"grey",size:20,width:2}})],1):e._e(),s.timelineFailed?e._e():t("span",{staticClass:"events-count",attrs:{"x-small":""}},[e._v(" "+e._s(e._f("compactNumber")(e.eventsCount))+" ")]),t("v-btn",e._g({staticClass:"ma-1",attrs:{"x-small":"",icon:""}},s.events.menuOn),[t("v-icon",{attrs:{title:"Manage Timeline"}},[e._v(" mdi-dots-vertical ")])],1)],1)],1)])]}}])})},ke=[],we=function(){var e=this,t=e._self._c;return t("span",[e.timelineAvailable?t("v-menu",{ref:"timelineChipMenuRef",attrs:{"offset-y":"","max-width":"385","close-on-content-click":!1,"content-class":"menu-with-gap"},scopedSlots:e._u([{key:"activator",fn:function({on:t}){return[e._t("processed",null,{timelineFailed:e.timelineFailed,timelineChipColor:e.timelineChipColor,timelineStatus:e.timelineStatus,events:{toggleTimeline:e.toggleTimeline,openDialog:e.openDialog,menuOn:t}})]}}],null,!0)},[t("v-sheet",{attrs:{flat:""}},[t("v-list",{attrs:{dense:""}},[t("v-dialog",{attrs:{width:"600"},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-list-item",e._g(e._b({},"v-list-item",i,!1),s),[t("v-list-item-action",[t("v-icon",[e._v("mdi-square-edit-outline")])],1),t("v-list-item-subtitle",[e._v("Rename")])],1)]}}]),model:{value:e.dialogRename,callback:function(t){e.dialogRename=t},expression:"dialogRename"}},[t("v-card",{staticClass:"pa-4"},[t("v-form",{on:{submit:function(t){return t.preventDefault(),e.rename()}}},[t("h3",[e._v("Rename timeline")]),t("br"),t("v-text-field",{attrs:{clearable:"",outlined:"",dense:"",autofocus:"",rules:e.timelineNameRules},on:{focus:function(e){return e.target.select()}},model:{value:e.newTimelineName,callback:function(t){e.newTimelineName=t},expression:"newTimelineName"}}),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:""},on:{click:function(t){e.dialogRename=!1}}},[e._v(" Cancel ")]),t("v-btn",{attrs:{disabled:!e.newTimelineName||e.newTimelineName.length>255,color:"primary",text:""},on:{click:function(t){return e.rename()}}},[e._v(" Save ")])],1)],1)],1)],1),e.timelineAvailable?t("v-list-item",{on:{click:function(t){return e.$emit("toggle",e.timeline)}}},[t("v-list-item-action",[e.isSelected?t("v-icon",[e._v("mdi-eye-off")]):t("v-icon",[e._v("mdi-eye")])],1),e.isSelected?t("v-list-item-subtitle",[e._v("Temporarily disabled")]):t("v-list-item-subtitle",[e._v("Re-enable")])],1):e._e(),e.timelineAvailable?t("v-list-item",{on:{click:function(t){return e.$emit("disableAllOtherTimelines",e.timeline)}}},[t("v-list-item-action",[t("v-icon",[e._v("mdi-checkbox-marked-circle-minus-outline")])],1),t("v-list-item-subtitle",[e._v("Unselect other timelines")])],1):e._e(),t("v-dialog",{attrs:{width:"800"},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-list-item",e._g(e._b({},"v-list-item",i,!1),s),[t("v-list-item-action",[t("v-icon",{attrs:{color:"mdi-alert-circle-outline"===e.iconStatus?"red":""}},[e._v(e._s(e.iconStatus))])],1),t("v-list-item-subtitle",[e._v("Data sources ("+e._s(e.datasources.length)+")")])],1)]}}]),model:{value:e.dialogStatus,callback:function(t){e.dialogStatus=t},expression:"dialogStatus"}},[t("v-card",[t("div",{staticClass:"pa-4"},[t("ul",{staticStyle:{"list-style-type":"none"}},[t("li",[t("strong",[e._v("Timeline name: ")]),e._v(e._s(e.timeline.name))]),t("li",[t("strong",[e._v("Opensearch index: ")]),e._v(e._s(e.timeline.searchindex.index_name))]),"processing"===e.timelineStatus||"ready"===e.timelineStatus?t("li",[t("strong",[e._v("Number of events: ")]),e._v(" "+e._s(e._f("compactNumber")(e.allIndexedEvents))+" ")]):e._e(),t("li",[t("strong",[e._v("Created by: ")]),e._v(e._s(e.timeline.user.username))]),t("li",[t("strong",[e._v("Created at: ")]),e._v(e._s(e._f("shortDateTime")(e.timeline.created_at))+" "),t("small",[e._v("("+e._s(e._f("timeSince")(e.timeline.created_at))+")")])]),t("li",[t("strong",[e._v("Number of datasources: ")]),e._v(e._s(e.datasources.length))])]),e._l(e.datasources,function(s){return t("v-alert",{key:s.id,staticClass:"ma-5",attrs:{outlined:"",text:"",color:e.datasourceStatusColors(s)}},[t("ul",{staticStyle:{"list-style-type":"none"}},[t("li",[t("strong",[e._v("Original filename:")]),e._v(" "+e._s(s.original_filename))]),t("li",[t("strong",[e._v("File on disk:")]),e._v(" "+e._s(s.file_on_disk))]),t("li",[t("strong",[e._v("File size:")]),e._v(" "+e._s(e._f("compactBytes")(s.file_size)))]),t("li",[t("strong",[e._v("Uploaded by:")]),e._v(" "+e._s(s.user.username))]),t("li",[t("strong",[e._v("Provider:")]),e._v(" "+e._s(s.provider))]),t("li",[t("strong",[e._v("Context:")]),e._v(" "+e._s(s.context))]),s.data_label?t("li",[t("strong",[e._v("Data label:")]),e._v(" "+e._s(s.data_label))]):e._e(),t("li",[t("strong",[e._v("Status:")]),e._v(" "+e._s(e.dataSourceStatus(s)))]),t("li",[t("strong",[e._v("Total File Events: ")]),e._v(e._s(e._f("compactNumber")(e.totalEventsDatasource(s.file_on_disk)))+" ")]),s.error_message?t("li",[t("strong",[e._v("Error message:")]),t("code",[e._v(" "+e._s(s.error_message))])]):e._e()])])})],2),t("v-divider"),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{color:"primary",text:""},on:{click:function(t){e.dialogStatus=!1}}},[e._v(" Close ")])],1)],1)],1),"ready"===e.timelineStatus?t("v-list-item",{staticStyle:{cursor:"pointer"},attrs:{to:{name:"Analyze",params:{sketchId:e.sketch.id,analyzerTimelineId:e.timeline.id}}},on:{click:function(t){e.$refs.timelineChipMenuRef.isActive=!1}}},[t("v-list-item-action",[t("v-icon",[e._v("mdi-auto-fix")])],1),t("v-list-item-subtitle",[e._v("Run Analyzers")])],1):e._e(),e.timelineAvailable?t("v-list-item",{staticStyle:{cursor:"pointer"},on:{click:function(t){e.deleteConfirmation=!0}}},[t("v-list-item-action",[t("v-icon",[e._v("mdi-trash-can-outline")])],1),t("v-list-item-subtitle",[e._v("Delete")])],1):e._e(),t("v-dialog",{attrs:{"max-width":"500"},model:{value:e.deleteConfirmation,callback:function(t){e.deleteConfirmation=t},expression:"deleteConfirmation"}},[t("v-card",[t("v-card-title",[t("v-icon",{staticClass:"mr-2 ml-n3",attrs:{color:"red"}},[e._v("mdi-alert-octagon-outline")]),e._v(" Delete Timeline? ")],1),t("v-card-text",[t("ul",{staticStyle:{"list-style-type":"none"}},[t("li",[t("strong",[e._v("Name: ")]),e._v(e._s(e.timeline.name))]),t("li",[t("strong",[e._v("Status: ")]),e._v(e._s(e.timelineStatus))]),t("li",[t("strong",[e._v("Opensearch index: ")]),e._v(e._s(e.timeline.searchindex.index_name))]),"processing"===e.timelineStatus||"ready"===e.timelineStatus?t("li",[t("strong",[e._v("Number of events: ")]),e._v(" "+e._s(e._f("compactNumber")(e.allIndexedEvents))+" ")]):e._e(),t("strong",[e._v("Number of events: ")]),e._v(" "+e._s(e._f("compactNumber")(e.allIndexedEvents))+" "),t("li",[t("strong",[e._v("Created by: ")]),e._v(e._s(e.timeline.user.username))]),t("li",[t("strong",[e._v("Created at: ")]),e._v(e._s(e._f("shortDateTime")(e.timeline.created_at))+" "),t("small",[e._v("("+e._s(e._f("timeSince")(e.timeline.created_at))+")")])])])]),t("v-card-actions",[t("v-btn",{attrs:{color:"primary",text:""},on:{click:function(t){e.deleteConfirmation=!1}}},[e._v(" cancel ")]),t("v-spacer"),t("v-btn",{attrs:{color:"primary",text:""},on:{click:function(t){return e.remove()}}},[e._v(" delete ")])],1)],1)],1)],1),e.timelineFailed?e._e():t("div",{staticClass:"px-4"},[t("v-color-picker",{attrs:{value:e.timeline.color,"show-swatches":!e.showCustomColorPicker,swatches:e.colorPickerSwatches,"hide-canvas":!e.showCustomColorPicker,"hide-sliders":!e.showCustomColorPicker,"hide-inputs":"",mode:"hexa","dot-size":"15"},on:{"update:color":e.updateColor}}),t("v-btn",{staticClass:"mt-2",attrs:{text:"","x-small":""},on:{click:function(t){e.showCustomColorPicker=!e.showCustomColorPicker}}},[e.showCustomColorPicker?t("span",[e._v("Palette")]):t("span",[e._v("Custom color")])])],1),t("br")],1)],1):t("v-dialog",{attrs:{width:"600"},scopedSlots:e._u([{key:"activator",fn:function({on:t,attrs:s}){return[e._t("processing",null,{timelineStatus:e.timelineStatus,events:{on:t}})]}}],null,!0),model:{value:e.dialogStatus,callback:function(t){e.dialogStatus=t},expression:"dialogStatus"}},[t("v-card",[t("v-app-bar",{attrs:{flat:"",dense:""}},[e._v('Importing events to timeline "'+e._s(e.timeline.name)+'"')]),t("div",{staticClass:"pa-5"},[t("ul",[t("li",[t("strong",[e._v("Opensearch index: ")]),e._v(e._s(e.timeline.searchindex.index_name))]),"processing"===e.timelineStatus||"ready"===e.timelineStatus?t("li",[t("strong",[e._v("Number of events: ")]),e._v(" "+e._s(e._f("compactNumber")(e.allIndexedEvents))+" ")]):e._e(),t("li",[t("strong",[e._v("Created by: ")]),e._v(e._s(e.timeline.user.username))]),t("li",[t("strong",[e._v("Created at: ")]),e._v(e._s(e._f("shortDateTime")(e.timeline.created_at))+" "),t("small",[e._v("("+e._s(e._f("timeSince")(e.timeline.created_at))+")")])])]),t("br"),t("div",{staticClass:"mb-3"},[e._v(e._s(e.datasourcesProcessing.length)+" datasource(s) in progress..")]),e._l(e.datasourcesProcessing,function(s){return t("v-alert",{key:s.id,attrs:{"colored-border":"",border:"left",elevation:"1",color:e.datasourceStatusColors(s)}},[t("ul",[t("li",[t("strong",[e._v("Original filename:")]),e._v(" "+e._s(s.original_filename))]),t("li",[t("strong",[e._v("File on disk:")]),e._v(" "+e._s(s.file_on_disk))]),t("li",[t("strong",[e._v("File size:")]),e._v(" "+e._s(e._f("compactBytes")(s.file_size)))]),t("li",[t("strong",[e._v("Uploaded by:")]),e._v(" "+e._s(s.user.username))]),t("li",[t("strong",[e._v("Provider:")]),e._v(" "+e._s(s.provider))]),t("li",[t("strong",[e._v("Context:")]),e._v(" "+e._s(s.context))]),s.data_label?t("li",[t("strong",[e._v("Data label:")]),e._v(" "+e._s(s.data_label))]):e._e(),t("li",[t("strong",[e._v("Status:")]),e._v(" "+e._s(e.dataSourceStatus(s)))]),t("li",[t("strong",[e._v("Total File Events:")]),e._v(e._s(e._f("compactNumber")(e.totalEventsDatasource(s.file_on_disk)))+" ")]),s.error_message?t("li",[t("strong",[e._v("Error message:")]),t("code",[e._v(" "+e._s(s.error_message))])]):e._e()]),t("br")])}),e.percentComplete>.1?t("v-card",{attrs:{outlined:""}},[t("v-card-title",[e._v(e._s(e.eventsPerSecond.slice(-1)[0])+" events/s")]),t("v-sparkline",{attrs:{value:e.eventsPerSecond,gradient:e.sparkline.gradient,smooth:e.sparkline.radius||!1,padding:e.sparkline.padding,"line-width":e.sparkline.width,"stroke-linecap":e.sparkline.lineCap,"gradient-direction":e.sparkline.gradientDirection,fill:e.sparkline.fill,type:e.sparkline.type,"auto-line-width":e.sparkline.autoLineWidth,"auto-draw":""}}),t("v-sheet",{staticClass:"py-4 px-3"},[t("v-progress-linear",{attrs:{color:"light-blue",height:"25",value:e.percentComplete,rounded:""}},[e._v(" "+e._s(e.percentComplete)+"% (complete "+e._s(e.processingETA())+") ")])],1)],1):t("v-card",{staticClass:"pa-3",attrs:{outlined:""}},[e._v(" Waiting for processing to begin.. ")])],2),t("v-divider"),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{color:"primary",text:""},on:{click:function(t){e.dialogStatus=!1}}},[e._v(" Close ")])],1)],1)],1)],1)},xe=[],Te=(s(8237),s(2543)),Ce=s.n(Te),Ae=s(1101);const De=[["#222"],["#42b3f4"],["red","orange","yellow"],["purple","violet"],["#00c6ff","#F0F","#FF0"],["#f72047","#ffd200","#1feaea"]];var $e={props:["timeline","eventsCount","isSelected","isEmptyState"],data(){return{autoRefresh:!1,allIndexedEvents:0,totalEvents:null,dialogStatus:!1,dialogRename:!1,datasources:[],timelineStatus:null,eventsPerSecond:[],newTimelineName:[...this.timeline.name],sparkline:{width:2,radius:10,padding:8,lineCap:"round",gradient:De[5],gradientDirection:"bottom",gradients:De,fill:!1,type:"trend",autoDrawDuration:4e3,autoLineWidth:!1},showCustomColorPicker:!1,colorPickerSwatches:[["#5E75C2","#BB77C4","#FD7EAC"],["#FF9987","#FFC66A","#F9F871"],["#FFB5BC","#97D788","#9BC1AF"],["#FFC7A0","#FFDF79","#FFEAEF"],["#DEBBFF","#9AB0FB","#CFFBE2"]],deleteConfirmation:!1,timelineNameRules:[e=>!!e||"Timeline name is required.",e=>e&&e.length<=255||"Timeline name is too long."]}},computed:{meta(){return this.$store.state.meta},datasourceErrors(){return this.timeline.datasources.filter(e=>e.error_message)},datasourcesProcessing(){return this.datasources.filter(e=>"processing"===this.dataSourceStatus(e)||"queueing"===this.dataSourceStatus(e))},sketch(){return this.$store.state.sketch},totalEventsToIndex(){return this.datasources.filter(e=>"processing"===this.dataSourceStatus(e)).map(e=>e.total_file_events).reduce((e,t)=>e+t,0)},secondsToComplete(){return this.totalEventsToIndex/this.avarageEventsPerSecond()},percentComplete(){return Math.floor(this.secondsSinceStart()/this.secondsToComplete*100)||0},iconStatus(){return"ready"===this.timelineStatus?"mdi-information-outline":"processing"===this.timelineStatus?"mdi-circle-slice-7":"mdi-alert-circle-outline"},timelineFailed(){return"fail"===this.timelineStatus},timelineAvailable(){return"ready"===this.timelineStatus||"fail"===this.timelineStatus||this.settings.showProcessingTimelineEvents&&"processing"===this.timelineStatus},timelineChipColor(){return this.timeline.color.startsWith("#")?this.timeline.color:"#"+this.timeline.color},settings(){return this.$store.state.settings}},methods:{openDialog(){this.dialogStatus=!0},rename(){this.dialogRename=!1,this.$emit("save",this.timeline,this.newTimelineName)},remove(){this.$emit("remove",this.timeline),this.deleteConfirmation=!1,this.successSnackBar("Timeline deleted")},secondsSinceStart(){if(!this.datasourcesProcessing.length)return 0;let e=Ae.A.utc(this.datasourcesProcessing[0].updated_at),t=Ae.A.utc(),s=t.diff(e,"second");return s},avarageEventsPerSecond(){const e=this.eventsPerSecond.reduce((e,t)=>e+t,0),t=e/this.eventsPerSecond.length||0;return Math.floor(t)},processingETA(){let e=this.secondsToComplete-this.secondsSinceStart(),t=(0,Ae.A)().add(e,"second").fromNow();return t},toggleTimeline(){this.timelineFailed||this.$emit("toggle",this.timeline)},updateColor:Ce().debounce(function(e){i["default"].set(this.timeline,"color",e.hex.substring(1)),this.$emit("save",this.timeline)},300),fetchData(){_.getSketchTimeline(this.sketch.id,this.timeline.id).then(e=>{this.timelineStatus=e.data.objects[0].status[0].status,this.datasources=e.data.objects[0].datasources;let t=this.allIndexedEvents;this.allIndexedEvents=e.data.meta.lines_indexed;let s=this.allIndexedEvents-t;s<1e4&&s>0&&this.eventsPerSecond.push(Math.floor(s/5)),"ready"!==this.timelineStatus&&"fail"!==this.timelineStatus?this.autoRefresh=!0:(this.autoRefresh=!1,this.$store.dispatch("updateSketch",this.sketch.id).then(()=>{"ready"!==this.timelineStatus||this.$store.state.enabledTimelines.includes(this.timeline.id)||this.settings.showProcessingTimelineEvents||this.$emit("toggle",e.data.objects[0])}))}).catch(e=>{console.log(e)})},dataSourceStatus(e){return e.status[0]?e.status[0].status:"ready"},datasourceStatusColors(e){return e.status[0]?"ready"===e.status[0].status||e.status===[]?"success":"processing"===e.status[0].status?"info":"queueing"===e.status[0].status?"warning":"error":"ready"},totalEventsDatasource(e){return this.datasources.find(t=>t.file_on_disk===e).total_file_events}},created(){this.timelineStatus=this.timeline.status[0].status,this.datasources=this.timeline.datasources;let e=this.meta.stats_per_timeline[this.timeline.id];"processing"===this.timelineStatus?this.autoRefresh=!0:(this.autoRefresh=!1,e&&(this.allIndexedEvents=e["count"])),this.newTimelineName=this.timeline.name},beforeDestroy(){clearInterval(this.t),this.t=!1},watch:{autoRefresh(e){e&&!this.t?this.t=setInterval(function(){this.fetchData()}.bind(this),5e3):(clearInterval(this.t),this.t=!1)},timeline(){this.timeline.datasources.length>this.datasources.length&&this.fetchData()}}},Le=$e,Ie=(0,d.A)(Le,we,xe,!1,null,"3bd653ac",null),Ee=Ie.exports,Ne={props:["timeline","eventsCount","isSelected","isEmptyState"],components:{TsTimelineComponent:Ee},methods:{timelineStyle(e){const t=("processing"===e||"ready"===e)&&!this.isSelected;return{opacity:t?"50%":"100%",backgroundColor:this.$vuetify.theme.dark?"#303030":"#f5f5f5"}}}},ze=Ne,Fe=(0,d.A)(ze,Se,ke,!1,null,"1bcea98a",null),Re=Fe.exports,Pe={components:{TsTimelineChip:Re},props:["currentQueryFilter","countPerIndex","countPerTimeline"],computed:{sketch(){return this.$store.state.sketch},allTimelines(){let e=[...this.sketch.timelines];return e=e.sort(function(e,t){return e.name.localeCompare(t.name)}),this.showAll||(e=e.slice(0,20)),e},activeTimelines(){let e=[...this.sketch.active_timelines];return e.sort(function(e,t){return e.name.localeCompare(t.name)})},isEmptyState(){return void 0===this.countPerTimeline}},data(){return{isDarkTheme:!1,isLoading:!1,showAll:!1}},methods:{isSelected(e){return this.$store.state.enabledTimelines.includes(e.id)},getCount(e){if(this.countPerTimeline){const t=this.countPerTimeline[e.id];if("number"===typeof t)return t}return 0},remove(e){this.isLoading=!0,_.deleteSketchTimeline(this.sketch.id,e.id).then(()=>{this.$store.dispatch("updateSketch",this.sketch.id).then(()=>{this.syncSelectedTimelines(),this.isLoading=!1})}).catch(e=>{console.error(e),this.isLoading=!1})},save(e,t=!1){t&&(this.isLoading=!0),_.saveSketchTimeline(this.sketch.id,e.id,t||e.name,e.description,e.color).then(()=>{this.$store.dispatch("updateSketch",this.sketch.id).then(()=>{this.syncSelectedTimelines(),this.isLoading=!1})}).catch(e=>{console.error(e),this.isLoading=!1})},disableAllOtherTimelines(e){this.$store.dispatch("updateEnabledTimelines",[e.id])},toggleTimeline(e){this.$store.dispatch("toggleEnabledTimeline",e.id)},toggleTheme(){this.isDarkTheme=!this.isDarkTheme},syncSelectedTimelines(){if(this.currentQueryFilter.indices.includes("_all"))return void this.updateEnabledTimelinesIfChanged(this.activeTimelines.map(e=>e.id));let e=[];this.currentQueryFilter.indices.forEach(t=>{if("string"===typeof t){let s=this.activeTimelines.find(e=>e.searchindex.index_name===t);e.push(s)}else if("number"===typeof t){let s=this.activeTimelines.find(e=>e.id===t);e.push(s)}}),this.updateEnabledTimelinesIfChanged(e.map(e=>e.id))},updateEnabledTimelinesIfChanged(e){Ce().isEqual(e,this.$store.state.enabledTimelines)||this.$store.dispatch("updateEnabledTimelines",e)}},created(){l.$on("isDarkTheme",this.toggleTheme)},watch:{"currentQueryFilter.indices"(e){this.syncSelectedTimelines()},deep:!0}},Oe=Pe,Qe=(0,d.A)(Oe,_e,be,!1,null,"3e509ce6",null),Me=Qe.exports,qe=function(){var e=this,t=e._self._c;return t("v-card",{staticStyle:{overflow:"visible"},attrs:{width:"700"}},[t("v-container",{staticClass:"px-8"},[t("br"),t("v-row",[t("v-col",{attrs:{cols:"12"}},[t("v-btn",{staticClass:"mr-2",attrs:{small:"",depressed:""},on:{click:function(t){return e.getDateRange(0,"days")}}},[e._v("Today")]),t("v-btn",{staticClass:"mr-2",attrs:{small:"",depressed:""},on:{click:function(t){return e.getDateRange(7,"days")}}},[e._v("Last 7 days")]),t("v-btn",{staticClass:"mr-2",attrs:{small:"",depressed:""},on:{click:function(t){return e.getDateRange(30,"days")}}},[e._v("Last 30 days")]),t("v-btn",{staticClass:"mr-2",attrs:{small:"",depressed:""},on:{click:function(t){return e.getDateRange(90,"days")}}},[e._v("Last 90 days")]),t("v-btn",{staticClass:"mr-2",attrs:{small:"",depressed:""},on:{click:function(t){return e.getDateRange(1,"year")}}},[e._v("Last 1 year")])],1)],1),t("v-row",[t("v-col",{attrs:{cols:"6"}},[t("v-text-field",{attrs:{value:e.formatStartTime,label:"From",outlined:"","hide-details":""},on:{click:function(t){e.showPicker=!0},change:e.setStartTime}})],1),t("v-col",{attrs:{cols:"6"}},[t("v-text-field",{attrs:{value:e.formatEndTime,label:"To (optional)",outlined:"","hide-details":"","append-outer-icon":e.showPicker?"mdi-calendar-remove":"mdi-calendar"},on:{click:function(t){e.showPicker=!0},change:e.setEndTime,"click:append-outer":function(t){e.showPicker=!e.showPicker}}})],1)],1),e.showPicker?t("v-row",[t("v-col",{attrs:{cols:"12"}},[t("date-picker",{ref:"picker",attrs:{mode:"dateTime",timezone:"UTC","is-dark":e.$vuetify.theme.dark,is24hr:"","is-range":"","is-expanded":""},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}})],1)],1):e._e(),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:""},on:{click:e.clearAndCancel}},[e._v(" Cancel ")]),t("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){return e.submit()}}},[e._v(" Add filter ")])],1)],1)],1)},Be=[],Ve=s(7642),He=s.n(Ve),Ge={props:["selectedChip"],components:{DatePicker:He()},data(){return{range:{start:"",end:""},filterTab:null,showPicker:!1}},computed:{dateRange:{set(e){e&&e.start&&e.end?(this.range.start=Ae.A.utc(e.start).millisecond(0).toISOString(),this.range.end=Ae.A.utc(e.end).millisecond(0).toISOString()):(this.range.start="",this.range.end="")},get(){let e={start:this.range.start,end:this.range.end};return e}},formatStartTime:function(){return this.range.start},formatEndTime:function(){return this.range.start!==this.range.end&&this.range.start?this.range.end:""}},created(){this.selectedChip&&(this.range.start=this.selectedChip.value.split(",")[0],this.range.end=this.selectedChip.value.split(",")[1])},methods:{getDateRange:function(e,t){let s=Ae.A.utc(),i=s.subtract(e,t),a="datetime_range",n=i.format("YYYY-MM-DD")+","+s.format("YYYY-MM-DD"),r={field:"",type:a,value:n,operator:"must",active:!0};return this.addChip(r),this.$emit("cancel"),{start:s,end:i}},setStartTime:function(e){e?(this.range.start=Ae.A.utc(e).toISOString(),this.range.end||this.range.start&&(this.range.end=this.range.start||""),this.$refs.picker.focusDate(this.range.start)):this.range.start=""},setEndTime:function(e){e?(this.range.end=Ae.A.utc(e).toISOString(),this.$refs.picker.focusDate(this.range.start)):this.range.end=""},addDateTimeChip:function(e){const t="datetime_range";let s={field:"",type:t,value:e,operator:"must",active:!0};this.addChip(s),this.range={start:null,end:null}},clearAndCancel:function(){this.range={start:"",end:""},this.$emit("cancel")},addChip:function(e){this.selectedChip?this.$emit("updateChip",e):this.$emit("addChip",e)},submit:function(){if(this.range.start){if(this.range.start===this.range.end){let e=this.range.start.split("T"),t=e[0],s=t+","+t;this.addDateTimeChip(s)}if(this.range.start,this.range.end,this.range.start!==this.range.end){let e="datetime_range",t=this.range.start+","+this.range.end,s={field:"",type:e,value:t,operator:"must",active:!0};this.addChip(s),this.range={start:"",end:""}}this.$emit("cancel")}}}},Ue=Ge,We=(0,d.A)(Ue,qe,Be,!1,null,"be4e6400",null),je=We.exports,Ye=function(){var e=this,t=e._self._c;return t("ts-upload-timeline-form",{scopedSlots:e._u([{key:"default",fn:function(s){return["small"===e.btnType?t("v-btn",e._g(e._b({attrs:{small:"",text:"",rounded:"",color:"primary"}},"v-btn",s.attrs,!1),s.on),[t("v-icon",{attrs:{left:"",small:""}},[e._v(" mdi-plus ")]),e._v(" Add Timeline ")],1):t("v-btn",e._g(e._b({attrs:{rounded:"",depressed:"",color:"primary"}},"v-btn",s.attrs,!1),s.on),[t("v-icon",{attrs:{left:""}},[e._v(" mdi-plus ")]),e._v(" Add Timeline ")],1)]}}])})},Xe=[],Je=function(){var e=this,t=e._self._c;return t("span",[t("v-dialog",{attrs:{persistent:"",width:"700"},model:{value:e.percentageFlag,callback:function(t){e.percentageFlag=t},expression:"percentageFlag"}},[t("v-card",{staticClass:"pa-5",attrs:{flat:""}},[e._v(" Uploading.. "),t("br"),t("br"),t("v-progress-linear",{attrs:{color:"light-blue",height:"25",value:e.percentCompleted}},[e._v(e._s(e.percentCompleted)+"%")]),t("v-divider")],1)],1),t("v-dialog",{attrs:{"max-width":"1000"},scopedSlots:e._u([{key:"activator",fn:function({on:t,attrs:s}){return[e._t("default",null,{attrs:s,on:t})]}}],null,!0),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[t("v-card",[t("v-container",{staticClass:"pa-4"},[t("h3",[e._v(e._s(e.title))]),t("br"),e.error.length>0?t("div",e._l(e.error,function(s,i){return t("v-alert",{key:i,attrs:{outlined:"",type:"error"}},[e._v(" "+e._s(s)+" "),t("br"),t("br"),["csv","jsonl","json"].includes(e.extension)?t("div",[e.headers.length>0?t("v-simple-table",{scopedSlots:e._u([{key:"default",fn:function(){return[t("thead",[t("tr",e._l(e.headersTable,function(s){return t("th",{key:s.name,staticClass:"text-left",style:s.color},[e.missingHeaders.includes(s.name)?t("div",[t("v-select",{attrs:{items:e.listHeadersSelectMenu,label:s.name,multiple:"",chips:"",hint:"Mapped to","persistent-hint":""},on:{change:function(t){return e.changeHeaderMapping(t,s.name)}},model:{value:e.mandatoryHeaders.find(e=>e.name===s.name).columnsSelected,callback:function(t){e.$set(e.mandatoryHeaders.find(e=>e.name===s.name),"columnsSelected",t)},expression:"mandatoryHeaders.find((h) => h.name === mandatoryHeader.name).columnsSelected"}})],1):t("div",[t("span",{staticClass:"tag is-large",style:s.color},[t("label",[e._v(e._s(s.name))])])])])}),0)]),t("br"),t("strong",[e._v("Preview")]),t("tbody",e._l(e.numberRows,function(s){return t("tr",{key:s},e._l(e.headersTable,function(i){return t("td",{key:i.name},[e._v(" "+e._s(i.values[s-1])+" ")])}),0)}),0)]},proxy:!0}],null,!0)}):e._e()],1):e._e()])}),1):e._e(),e.fileName?t("div",[t("v-text-field",{attrs:{label:"Timeline Name",outlined:"",clearable:"",rules:e.timelineNameRules},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}}),"csv"===e.extension?t("v-radio-group",{scopedSlots:e._u([{key:"label",fn:function(){return[t("div",[e._v("Choose "),t("strong",[e._v("CSV delimiter")])])]},proxy:!0}],null,!1,3646347247),model:{value:e.CSVDelimiter,callback:function(t){e.CSVDelimiter=t},expression:"CSVDelimiter"}},e._l(e.delimitersList,function(s,i){return t("v-radio",{key:i,attrs:{value:s},on:{change:function(t){return e.changeCSVDelimiter(s)}},scopedSlots:e._u([{key:"label",fn:function(){return[t("div",[e._v(e._s(i)+" ("+e._s(s)+")")])]},proxy:!0}],null,!0)})}),1):e._e(),e.percentageFlag?e._e():t("v-list",[e._v(" File info "),t("v-simple-table",{attrs:{height:"100px"},scopedSlots:e._u([{key:"default",fn:function(){return[t("thead",[t("tr",e._l(e.fileMetaData,function(s,i){return t("th",{key:i,staticClass:"text-left"},[e._v(" "+e._s(i)+" ")])}),0)]),t("tbody",[t("tr",e._l(e.fileMetaData,function(s,i){return t("td",{key:i,staticClass:"text-left"},[e._v(" "+e._s(s)+" ")])}),0)])]},proxy:!0}],null,!1,3687523482)})],1)],1):t("div",[t("v-file-input",{attrs:{label:"Select file (Plaso/JSONL/CSV)",outlined:"",dense:"",clearable:"",multiple:"","show-size":"","truncate-length":"15",id:"datafile"},on:{change:function(t){return e.setFile(t)},"click:clear":e.clearFormData},model:{value:e.uploadedFiles,callback:function(t){e.uploadedFiles=t},expression:"uploadedFiles"}})],1)]),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:""},on:{click:function(t){e.dialog=!1}}},[e._v(" Cancel ")]),e.fileName?t("v-btn",{attrs:{text:""},on:{click:function(t){return e.clearFormData()}}},[e._v(" Select another file ")]):e._e(),e.error.length>0||!e.fileName?e._e():t("v-btn",{attrs:{color:"primary",text:"",disabled:!e.form.name||e.form.name.length>255},on:{click:function(t){return e.submitForm()}}},[e._v(" Submit ")])],1)],1)],1)],1)},Ke=[],Ze=(s(1613),s(8004),s(3853),s(5876),s(2475),s(5024),s(1698),{data(){return{headersString:"",valuesString:[],title:"Upload Plaso/JSONL/CSV file",headersMapping:[],mandatoryHeaders:[{name:"datetime",columnsSelected:[]},{name:"message",columnsSelected:[]},{name:"timestamp_desc",columnsSelected:[]}],form:{name:"",file:""},fileName:"",timelineNameRules:[e=>!!e||"Timeline name is required.",e=>e&&e.length<=255||"Timeline name is too long."],fileMetaData:{},error:[],percentCompleted:0,uploadedFiles:[],CSVDelimiter:",",infoMessage:"",delimitersList:{Comma:",",Semicolon:";",Pipe:"|"},showHelperFlag:!1,showPreviewFlag:!1,showAddColumnFlag:!1,checkedHeaders:[],staticNumberRows:3,dialog:!1,colors:[{name:"red",value:"background-color: #FEECF0; color:#CC0F35"},{name:"blue",value:"background-color: #EEF6FC; color:#1D72AA"},{name:"green",value:"background-color: #EFFAF3; color:#257942"}]}},computed:{headers(){let e=[];return"csv"===this.extension?e=this.headersString.split(this.CSVDelimiter):["json","jsonl"].includes(this.extension)&&(e=Object.keys(this.headersString)),e},missingHeaders(){return this.mandatoryHeaders.filter(e=>this.headers.indexOf(e.name)<0).map(e=>e.name)},listHeadersSelectMenu(){let e=new Set(this.mandatoryHeaders.map(e=>e.name)),t=this.headers.filter(t=>!e.has(t));return t.unshift("Create New Header"),t},extension(){let e=this.fileName.split(".");return e.length>1?e[e.length-1].toLowerCase():null},numberRows(){if("csv"===this.extension){let e=this.valuesString.indexOf("");return e<0?this.staticNumberRows:e}return["json","jsonl"].includes(this.extension)?this.valuesString.length:0},percentageFlag(){return this.percentCompleted>0},sketch(){return this.$store.state.sketch},headersTable(){let e={};if("csv"===this.extension){let t=this.valuesString.map(e=>e.split(this.CSVDelimiter));for(let s=0;s<this.headers.length;s++){let i=[];for(let e=0;e<t.length;e++)i.push(t[e][s]);e[this.headers[s]]=i}}else if(["json","jsonl"].includes(this.extension))for(let s=0;s<this.valuesString.length;s++)for(let t in this.valuesString[s])t in e?e[t].push(this.valuesString[s][t]):e[t]=[this.valuesString[s][t]];else console.error(this.extension+" file extension not supported for this feature");let t=this.checkedHeaders;return t.sort().map(t=>{let s="",i=[];if(this.headers.includes(t))i=e[t],s=this.colors.find(e=>"blue"===e.name).value;else{let a=this.headersMapping.find(e=>e.target===t);if(a){if(a.source)if(1===a.source.length)i=e[a.source[0]];else{let t=a.source;for(let s=0;s<this.numberRows;s++){let a="";t.forEach(t=>{a+=t+": ",a+=JSON.stringify(e[t][s])+" | "}),i.push(a)}}else i=Array(this.numberRows).fill(a.default_value);s=this.colors.find(e=>"green"===e.name).value}else i=Array(this.numberRows).fill("Header not mapped"),s=this.colors.find(e=>"red"===e.name).value}return{name:t,values:i,color:s}})}},methods:{showHelper(){this.showPreviewFlag=!1,this.showAddColumnFlag=!1,this.showHelperFlag=!this.showHelperFlag},showPreview(){this.showHelperFlag=!1,this.showPreviewFlag=!this.showPreviewFlag,this.showPreviewFlag||(this.showAddColumnFlag=!1)},showAddColumn(){this.showAddColumnFlag=!this.showAddColumnFlag},getDefaultValue:function(e){let t=this.headersMapping.find(t=>t["target"]===e);return t?t["default_value"]:null},changeCSVDelimiter:function(e){this.CSVDelimiter=e;for(let t=0;t<this.mandatoryHeaders.length;t++)this.mandatoryHeaders[t]["columnsSelected"]=[];this.headersMapping=[],this.validateFile()},changeHeaderMapping:function(e,t){let s=e[e.length-1],i=this.mandatoryHeaders.findIndex(e=>e.name===t);this.mandatoryHeaders[i].columnsSelected="Create New Header"===s?["Create New Header"]:this.mandatoryHeaders[i].columnsSelected.filter(e=>"Create New Header"!==e);let a=[],n=null;if("Create New Header"===s){a=null;do{n=prompt("Insert the default value for this header"),n.includes(this.CSVDelimiter)&&(alert(`New header value cannot contain CSV separator (found ${this.CSVDelimiter})`),n=null)}while(!n)}else a=this.mandatoryHeaders[i].columnsSelected;this.headersMapping=this.headersMapping.filter(e=>e["target"]!==t),(null===a||a.length>0)&&this.headersMapping.push({target:t,source:a,default_value:n}),this.validateFile()},clearFormData:function(){this.fileMetaData={},this.form.name="",this.form.file="",this.fileName="",this.headersMapping=[],this.infoMessage="",this.headersString="",this.valuesString=[],this.uploadedFiles=[],this.title="Upload Plaso/JSONL/CSV file",this.error=[],this.percentCompleted=0;for(let e=0;e<this.mandatoryHeaders.length;e++)this.mandatoryHeaders[e]["columnsSelected"]=[]},submitForm:function(){if(!this.validateFile())return;let e=new FormData;if(e.append("file",this.form.file),e.append("name",this.form.name),e.append("provider","WebUpload"),e.append("context",this.fileName),e.append("total_file_size",this.form.file.size),e.append("sketch_id",this.sketch.id),["csv","jsonl","json"].includes(this.extension)){let t=JSON.stringify(this.headersMapping);e.append("headersMapping",t),e.append("delimiter",this.CSVDelimiter)}let t={headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){this.percentCompleted=Math.round(100*e.loaded/e.total)}.bind(this)};this.dialog=!1,_.uploadTimeline(e,t).then(()=>{this.clearFormData(),this.percentCompleted=0,this.$store.dispatch("updateSketch",this.sketch.id)}).catch(e=>{})},validateFile:function(){this.error=[],this.form.file.size<=0&&this.error.push("Please select a non empty file");let e=["csv","json","jsonl","plaso"];if(e.includes(this.extension)||this.error.push("Please select a file with a valid extension: "+e.toString()),["csv","jsonl","json"].includes(this.extension)){this.headersMapping.length!==this.missingHeaders.length&&this.error.push("Missing headers: "+this.missingHeaders.toString());let e=this.headersMapping.filter(e=>e["source"]).map(e=>e.source);e=e.filter(e=>1===e.length).map(e=>e[0]),e.length>new Set(e).size&&this.error.push(`New headers mapping contains duplicates (${e})`)}return 0===this.error.length?this.title="Select file to upload":this.title="Almost there... Map the "+this.missingHeaders.length+" missing headers.",0===this.error.length},setFile:function(e){if(!e[0])return;const t=e=>e/1048576;this.fileMetaData={Name:e[0].name,Size:t(e[0].size)+" MB"};let s=e[0].name;this.headersMapping=[],this.headersString="",this.valuesString=[],this.form.file=e[0],this.form.name=s.split(".").slice(0,-1).join("."),this.fileName=s,"csv"===this.extension?this.extractCSVHeader():["json","jsonl"].includes(this.extension)?this.extractJSONLHeader():this.validateFile(),this.checkedHeaders=this.mandatoryHeaders.map(e=>e.name)},extractCSVHeader:function(){let e=new FileReader,t=document.getElementById("datafile").files[0],s=this;e.readAsText(t.slice(0,1e4)),e.onloadend=function(e){if(e.target.readyState===FileReader.DONE){let t=e.target.result;s.headersString=t.split("\n")[0].replaceAll('"',"").trim(),s.valuesString=t.split("\n").slice(1,s.staticNumberRows+1),s.validateFile()}}},extractJSONLHeader:function(){let e=new FileReader,t=document.getElementById("datafile").files[0],s=this;e.readAsText(t.slice(0,1e4)),e.onloadend=function(e){if(e.target.readyState===FileReader.DONE){let i=e.target.result,a=i.split("\n").filter(e=>""!==e),n=Math.min(s.staticNumberRows,a.length);try{s.headersString=JSON.parse(a[0]),s.valuesString=a.slice(0,n).map(e=>JSON.parse(e)),s.validateFile()}catch(t){let e=t.message;e+=". Your first lines of JSON: ",e+=a[0],e+=". Be sure to upload a JSON file in a JSONL format.",s.title="Cannot parse the JSON file",s.error.push(e)}}}}}}),et=Ze,tt=(0,d.A)(et,Je,Ke,!1,null,null,null),st=tt.exports,it={props:["btnType"],components:{TsUploadTimelineForm:st}},at=it,nt=(0,d.A)(at,Ye,Xe,!1,null,null,null),rt=nt.exports,lt=function(){var e=this,t=e._self._c;return t("v-card",{staticStyle:{overflow:"visible"},attrs:{width:"700"}},[t("v-container",{staticClass:"px-8"},[t("br"),t("v-row",[t("v-col",{attrs:{cols:"12"}},[t("v-text-field",{attrs:{value:e.datetime,label:"Datetime",outlined:"","hide-details":""},on:{click:function(t){e.showPicker=!0}},model:{value:e.datetime,callback:function(t){e.datetime=t},expression:"datetime"}})],1)],1),e.showPicker?t("v-row",[t("v-col",{attrs:{cols:"12"}},[t("date-picker",{ref:"picker",attrs:{mode:"dateTime",timezone:"UTC","is-dark":e.$vuetify.theme.dark,is24hr:"","is-date":"","is-expanded":""},model:{value:e.dateFromPicker,callback:function(t){e.dateFromPicker=t},expression:"dateFromPicker"}})],1)],1):e._e(),t("v-row",[t("v-col",{attrs:{cols:"12"}},[t("v-text-field",{attrs:{value:e.message,label:"Message",outlined:"","hide-details":""},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}})],1)],1),t("v-row",[t("v-col",{attrs:{cols:"12"}},[t("v-text-field",{attrs:{value:e.timestampDesc,label:"Timestamp Description",outlined:"","hide-details":""},model:{value:e.timestampDesc,callback:function(t){e.timestampDesc=t},expression:"timestampDesc"}})],1)],1),e._l(e.attributes,function(s,i){return t("v-row",{key:i},[t("v-col",{attrs:{cols:"6"}},[t("v-text-field",{attrs:{label:"Attribute Name",outlined:"","hide-details":""},model:{value:e.attributes[i].name,callback:function(t){e.$set(e.attributes[i],"name",t)},expression:"attributes[index].name"}})],1),t("v-col",{attrs:{cols:"6"}},[t("v-text-field",{attrs:{label:"Attribute Value",outlined:"","hide-details":""},model:{value:e.attributes[i].value,callback:function(t){e.$set(e.attributes[i],"value",t)},expression:"attributes[index].value"}})],1)],1)}),t("v-card-actions",[t("v-btn",{attrs:{text:"",color:"primary",disabled:e.isDisabled},on:{click:function(t){return e.attributes.push({name:"",value:""})}}},[t("v-icon",[e._v("mdi-plus")]),e._v(" Add Attribute ")],1),t("v-spacer"),t("v-btn",{attrs:{text:""},on:{click:function(t){return e.clearAndCancel()}}},[e._v(" Cancel ")]),t("v-btn",{attrs:{text:"",color:"primary"},on:{click:e.submit}},[e._v(" Save ")])],1)],2)],1)},ot=[],ct={props:["datetimeProp"],components:{DatePicker:He()},data(){return{message:null,timestampDesc:null,filterTab:null,showPicker:!1,attributes:[],datetime:this.datetimeProp}},watch:{datetimeProp:function(e){this.datetime=e}},computed:{dateFromPicker:{set(e){null!==e&&(this.datetime=Ae.A.utc(e).millisecond(0).toISOString())},get(){return this.datetime}},isDisabled(){return this.attributes.some(e=>""===e.name||""===e.value)}},methods:{clearAndCancel:function(){this.datetime=null,this.message=null,this.timestampDesc=null,this.attributes=[],this.$emit("cancel")},submit:function(){if(null===this.datetime||null===this.message||null===this.timestampDesc)return;let e=this.$store.state.sketch.id,t={headers:{"Content-Type":"application/json"}},s={};this.attributes.filter(e=>!(""===e.name||""===e.value)).reduce((e,t)=>{s[t.name]=t.value},s),_.createEvent(e,this.datetime,this.message,this.timestampDesc,s,t).then(e=>{this.clearAndCancel()}).catch(e=>{})}}},dt=ct,ut=(0,d.A)(dt,lt,ot,!1,null,"5d3fffad",null),ht=ut.exports,mt=function(){var e=this,t=e._self._c;return t("div",[t("v-alert",{attrs:{dense:"",dismissible:"",type:"info"},model:{value:e.showBanner,callback:function(t){e.showBanner=t},expression:"showBanner"}},[e._v(" Data may be incomplete. Some timelines are still loading. ")]),t("v-dialog",{attrs:{width:"700"},model:{value:e.exportDialog,callback:function(t){e.exportDialog=t},expression:"exportDialog"}},[t("v-card",{staticClass:"pa-5",attrs:{flat:""}},[t("v-progress-circular",{attrs:{indeterminate:"",size:"20",width:"1"}}),t("span",{staticClass:"ml-5"},[e._v("Exporting "+e._s(e.totalHits)+" events")])],1)],1),e.disableSaveSearch?e._e():t("v-dialog",{attrs:{width:"500"},model:{value:e.saveSearchMenu,callback:function(t){e.saveSearchMenu=t},expression:"saveSearchMenu"}},[t("v-card",{staticClass:"pa-4"},[t("h3",[e._v("Save Search")]),t("br"),t("v-text-field",{attrs:{clearable:"",required:"",placeholder:"Name your saved search",outlined:"",dense:"",autofocus:"",rules:e.saveSearchNameRules},on:{focus:function(e){return e.target.select()}},model:{value:e.saveSearchFormName,callback:function(t){e.saveSearchFormName=t},expression:"saveSearchFormName"}}),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:""},on:{click:function(t){e.saveSearchMenu=!1}}},[e._v(" Cancel ")]),t("v-btn",{attrs:{text:"",color:"primary",disabled:!e.saveSearchFormName||e.saveSearchFormName.length>255},on:{click:e.saveSearch}},[e._v(" Save ")])],1)],1)],1),e.eventList.objects.length||e.searchInProgress||e.currentQueryString?e._e():t("div",[t("ts-explore-welcome-card")],1),e.eventList.objects.length||e.searchInProgress||!e.currentQueryString?e._e():t("div",{staticClass:"ml-3"},[t("ts-search-not-found-card",{attrs:{currentQueryString:e.currentQueryString,filterChips:e.filterChips,disableSaveSearch:e.disableSaveSearch},on:{"save-search-clicked":function(t){e.saveSearchMenu=!0}}})],1),e.highlightEvent?t("div",{staticClass:"mt-4"},[t("strong",[e._v("Showing context for event:")]),t("v-sheet",{staticClass:"d-flex flex-wrap mt-1 mb-5"},[t("v-sheet",{staticClass:"flex-1-0"},[t("span",{staticClass:"datetime-table-cell pa-2",staticStyle:{width:"200px"},style:e.getTimelineColor(e.highlightEvent)},[e._v(" "+e._s(e._f("toISO8601")(e._f("formatTimestamp")(e.highlightEvent._source.timestamp)))+" ")])]),t("v-sheet",{},[t("span",{staticClass:"datetime-table-cell pa-2"},[e._v(" "+e._s(e.highlightEvent._source.message)+" ")])])],1)],1):e._e(),t("div",{staticClass:"ts-event-list-container"},[(e.eventList.objects.length>0||e.searchInProgress)&&e.userSettings.eventSummarization&&!e.eventList.meta.summaryError?t("v-card",{staticClass:"ts-ai-summary-card",attrs:{outlined:""}},[t("v-card-title",{staticClass:"ts-ai-summary-card-title"},[t("v-btn",{staticClass:"ts-ai-summary-fold-btn",attrs:{icon:"",small:""},on:{click:e.toggleSummary}},[t("v-icon",[e._v(e._s(e.summaryCollapsed?"mdi-chevron-down":"mdi-chevron-up"))])],1),t("v-icon",{staticClass:"ml-1 mr-2 ts-ai-summary-icon",attrs:{small:"",color:"primary"}},[e._v("mdi-shimmer")]),t("div",{staticClass:"ts-ai-summary-text-group"},[t("span",{staticClass:"ts-ai-summary-title"},[e._v("AI Summary")]),e.eventList.objects.length>0?t("span",{staticClass:"ts-ai-summary-subtitle"},[e._v(" (for "+e._s(e.eventList.objects.length)+" events in this view) ")]):e._e()]),t("v-btn",{staticClass:"ml-1 ts-ai-summary-info-btn",attrs:{icon:"",small:"",title:e.summaryInfoMessage}},[t("v-icon",{attrs:{small:""}},[e._v("mdi-information-outline")])],1)],1),t("v-card-text",{directives:[{name:"show",rawName:"v-show",value:!e.summaryCollapsed,expression:"!summaryCollapsed"}],staticClass:"ts-ai-summary-text"},[e.isSummaryLoading||!e.eventList.meta.summary?t("div",[t("div",{staticClass:"ts-summary-placeholder-line shimmer"}),t("div",{staticClass:"ts-summary-placeholder-line shimmer short"}),t("div",{staticClass:"ts-summary-placeholder-line shimmer long"})]):t("div",{domProps:{innerHTML:e._s(e.eventList.meta.summary)}})])],1):e._e()],1),e.eventList.objects.length||e.searchInProgress?t("div",[t("v-data-table",{attrs:{headers:e.headers,items:e.eventList.objects,"footer-props":{"items-per-page-options":[10,40,80,100,200,500],"show-current-page":!0},loading:e.searchInProgress,options:e.tableOptions,"server-items-length":e.totalHitsForPagination,"item-key":"_id","loading-text":"Searching... Please wait","show-select":"","disable-filtering":"","must-sort":"","sort-desc":e.sortOrderAsc,"sort-by":"_source.timestamp","hide-default-footer":e.totalHits<11||e.disablePagination,expanded:e.expandedRows,dense:e.displayOptions.isCompact,"fixed-header":""},on:{"update:options":function(t){e.tableOptions=t},"update:sortDesc":function(t){e.sortOrderAsc=t},"update:sort-desc":[function(t){e.sortOrderAsc=t},e.sortEvents]},scopedSlots:e._u([{key:"top",fn:function({pagination:s,options:i,updateOptions:a}){return[t("v-toolbar",{attrs:{dense:"",flat:"",color:"transparent"}},[e.selectedEvents.length?t("div",{staticClass:"actions"},[t("small",{staticClass:"mr-2"},[e._v("Actions:")]),t("v-btn",{attrs:{"x-small":"",outlined:""},on:{click:function(t){return e.toggleMultipleStars()}}},[t("v-icon",{attrs:{left:"",color:"amber"}},[e._v("mdi-star")]),e._v(" Toggle star ")],1),t("v-menu",{attrs:{"offset-x":"","close-on-content-click":!1},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-btn",e._g(e._b({attrs:{"x-small":"",outlined:""}},"v-btn",i,!1),s),[t("v-icon",{attrs:{left:""}},[e._v("mdi-tag-plus-outline")]),e._v(" Modify Tags ")],1)]}}],null,!0),model:{value:e.showEventTagMenu,callback:function(t){e.showEventTagMenu=t},expression:"showEventTagMenu"}},[t("ts-event-tag-dialog",{attrs:{events:e.selectedEvents},on:{close:function(t){e.showEventTagMenu=!1}}})],1)],1):t("div",[t("span",{staticStyle:{display:"inline-block","min-width":"200px"}},[t("small",[e._v(e._s(e.fromEvent)+"-"+e._s(e.toEvent)+" of "+e._s(e.totalHits)+" events ("+e._s(e.totalTime)+"s)")])]),[e.disableSaveSearch?e._e():t("v-btn",{attrs:{icon:""},on:{click:function(t){e.saveSearchMenu=!0}}},[t("v-icon",{attrs:{title:"Save current search"}},[e._v("mdi-content-save-outline")])],1)],[e.disableHistogram?e._e():t("v-btn",{attrs:{icon:""},on:{click:function(t){e.showHistogram=!e.showHistogram}}},[t("v-icon",{attrs:{title:"Toggle event histogram"}},[e._v("mdi-chart-bar")])],1)],e.disableColumns?e._e():t("v-dialog",{attrs:{"max-width":"500px",scrollable:""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-btn",e._g(e._b({attrs:{icon:""}},"v-btn",i,!1),s),[t("v-icon",{attrs:{title:"Modify columns"}},[e._v("mdi-view-column-outline")])],1)]}}],null,!0),model:{value:e.columnDialog,callback:function(t){e.columnDialog=t},expression:"columnDialog"}},[t("v-card",{attrs:{height:"50vh"}},[t("v-card-title",[e._v("Select columns")]),t("v-card-text",[t("v-text-field",{attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:e.searchColumns,callback:function(t){e.searchColumns=t},expression:"searchColumns"}}),t("br"),t("v-data-table",{attrs:{headers:e.columnHeaders,items:e.meta.mappings,search:e.searchColumns,"hide-default-footer":!0,"item-key":"field","disable-pagination":"","show-select":"",dense:""},on:{input:e.updateSelectedFields},model:{value:e.selectedFields,callback:function(t){e.selectedFields=t},expression:"selectedFields"}})],1),t("v-divider"),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:""},on:{click:function(t){e.selectedFields=[{field:"message",type:"text"}]}}},[e._v(" Reset ")]),t("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){e.columnDialog=!1}}},[e._v(" Set columns ")])],1)],1)],1),t("v-btn",{attrs:{icon:""},on:{click:function(t){return e.exportSearchResult()}}},[t("v-icon",{attrs:{title:"Download current view as CSV"}},[e._v("mdi-download")])],1),e.disableSettings?e._e():t("v-menu",{attrs:{"offset-y":"","close-on-content-click":!1},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-btn",e._g(e._b({attrs:{icon:""}},"v-btn",i,!1),s),[t("v-icon",{attrs:{title:"View settings"}},[e._v("mdi-dots-horizontal")])],1)]}}],null,!0)},[t("v-card",{staticClass:"mx-auto",attrs:{outlined:"","max-width":"475"}},[t("v-list",{attrs:{subheader:"","two-line":"",flat:"",dense:""}},[t("v-subheader",[e._v("Density")]),t("v-list-item-group",[t("v-list-item",{attrs:{ripple:!1}},[[t("v-list-item-action",[t("v-radio-group",{model:{value:e.displayOptions.isCompact,callback:function(t){e.$set(e.displayOptions,"isCompact",t)},expression:"displayOptions.isCompact"}},[t("v-radio",{attrs:{value:!1}})],1)],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Comfortable")]),t("v-list-item-subtitle",[e._v("More space between rows")])],1)]],2),t("v-list-item",{attrs:{ripple:!1}},[[t("v-list-item-action",[t("v-radio-group",{model:{value:e.displayOptions.isCompact,callback:function(t){e.$set(e.displayOptions,"isCompact",t)},expression:"displayOptions.isCompact"}},[t("v-radio",{attrs:{value:!0}})],1)],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Compact")]),t("v-list-item-subtitle",[e._v("Less space between rows")])],1)]],2)],1),t("v-divider"),t("v-list",{attrs:{subheader:"","two-line":"",flat:""}},[t("v-subheader",[e._v("Misc")]),t("v-list-item-group",[t("v-list-item",{attrs:{ripple:!1}},[t("v-list-item-action",[t("v-switch",{attrs:{dense:"",color:""},model:{value:e.displayOptions.showTags,callback:function(t){e.$set(e.displayOptions,"showTags",t)},expression:"displayOptions.showTags"}})],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Tags")]),t("v-list-item-subtitle",[e._v("Show tags")])],1)],1)],1),t("v-list-item-group",[t("v-list-item",{attrs:{ripple:!1}},[t("v-list-item-action",[t("v-switch",{attrs:{dense:""},model:{value:e.displayOptions.showEmojis,callback:function(t){e.$set(e.displayOptions,"showEmojis",t)},expression:"displayOptions.showEmojis"}})],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Emojis")]),t("v-list-item-subtitle",[e._v("Show emojis")])],1)],1)],1),t("v-list-item-group",[t("v-list-item",{attrs:{ripple:!1}},[t("v-list-item-action",[t("v-switch",{attrs:{dense:""},model:{value:e.displayOptions.showTimelineName,callback:function(t){e.$set(e.displayOptions,"showTimelineName",t)},expression:"displayOptions.showTimelineName"}})],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Timeline name")]),t("v-list-item-subtitle",[e._v("Show timeline name")])],1)],1)],1)],1)],1)],1)],1)],2),t("v-spacer"),e.totalHits>11&&!e.disablePagination?t("v-data-footer",{staticClass:"mr-n3",staticStyle:{border:"0"},attrs:{pagination:s,options:i,"show-current-page":!0,"items-per-page-options":[10,40,80,100,200,500],"items-per-page-text":"Rows per page:"},on:{"update:options":a}}):e._e()],1),e.showHistogram?t("v-card",{staticClass:"my-3",attrs:{outlined:""}},[t("v-toolbar",{attrs:{dense:"",flat:"",color:"transparent"}},[t("v-spacer"),e.timeFilterChips.length?t("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){return e.removeChips(e.timeFilterChips)}}},[e._v(" reset ")]):e._e(),t("v-btn",{attrs:{icon:""},on:{click:function(t){e.showHistogram=!1}}},[t("v-icon",{attrs:{title:"Close histogram"}},[e._v("mdi-close")])],1)],1),t("ts-bar-chart",{attrs:{"chart-data":e.eventList.meta.count_over_time},on:{addChip:function(t){return e.addChipFromHistogram(t)}}})],1):e._e()]}},{key:e.expandedItemSlot,fn:function({headers:s,item:i}){return[t("td",{attrs:{colspan:s.length}},[i.showDetails?t("v-container",{staticClass:"mt-4",attrs:{fluid:""}},[t("ts-event-detail",{attrs:{event:i}})],1):e._e(),i.showDetails&&i.deltaDays?t("v-divider"):e._e(),i.deltaDays>0?t("div",{staticClass:"ml-7"},[t("div",{staticClass:"ts-time-bubble-vertical-line ts-time-bubble-vertical-line-color",style:e.getTimeBubbleColor(i)}),t("div",{staticClass:"ts-time-bubble ts-time-bubble-color",style:e.getTimeBubbleColor(i)},[t("div",{staticClass:"ts-time-bubble-text"},[t("b",[e._v(e._s(e._f("compactNumber")(i.deltaDays)))]),e._v(" days ")])]),t("div",{staticClass:"ts-time-bubble-vertical-line ts-time-bubble-vertical-line-color",style:e.getTimeBubbleColor(i)})]):e._e()],1)]}},{key:e.itemActionsSlot,fn:function({item:s}){return[t("v-btn",{attrs:{small:"",icon:""},on:{click:function(t){return e.toggleStar(s)}}},[s._source.label.includes("__ts_star")?t("v-icon",{attrs:{title:"Toggle star status",color:"amber"}},[e._v("mdi-star")]):t("v-icon",{attrs:{title:"Toggle star status"}},[e._v("mdi-star-outline")])],1),t("ts-event-tag-menu",{attrs:{event:s}}),t("ts-event-action-menu",{attrs:{event:s},on:{showContextWindow:function(t){return e.showContextWindow(t)}}})]}},{key:e.itemTimestampSlot,fn:function({item:s}){return[t("v-tooltip",{attrs:{right:"","open-delay":"700"},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:a}){return[t("div",e._g(e._b({staticClass:"datetime-table-cell",style:e.getTimelineColor(s)},"div",a,!1),i),[e._v(" "+e._s(e._f("toISO8601")(e._f("formatTimestamp")(s._source.timestamp)))+" ")])]}}],null,!0)},[t("span",[e._v(e._s(e.getTimeline(s).name))])])]}},e._l(e.headers,function(s,i){return{key:e.getFieldName(s.text),fn:function({item:a}){return[t("div",{key:s.text,staticClass:"ts-event-field-container",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.toggleDetailedEvent(a)}}},[t("span",{class:{"ts-event-field-ellipsis":"message"===s.text,"ts-event-field-highlight":a._id===e.highlightEventId}},[e.displayOptions.showTags&&3===i&&"tag"in a._source&&a._source.tag.length>0?t("span",[t("ts-event-tags",{attrs:{item:a,tagConfig:e.tagConfig,showDetails:a.showDetails}})],1):e._e(),e.displayOptions.showEmojis&&3===i?t("span",e._l(a._source.__ts_emojis,function(s){return t("span",{key:s,staticClass:"mr-2",attrs:{title:e.meta.emojis[s]},domProps:{innerHTML:e._s(s+";")}})}),0):e._e(),t("span",[e._v(e._s(a._source[s.text]))])])])]}}}),{key:e.itemTimelineNameSlot,fn:function({item:s}){return[t("v-chip",{staticStyle:{"margin-top":"1px","margin-bottom":"1px","font-size":"0.8em"},attrs:{label:""}},[t("span",{staticClass:"timeline-name-ellipsis",staticStyle:{width:"130px","text-align":"center"}},[e._v(e._s(e.getTimeline(s).name))])])]}},{key:e.itemCommentSlot,fn:function({item:s}){return[t("div",{staticClass:"d-inline-block"},[s._source.comment.length?t("v-btn",{attrs:{icon:"",small:""},on:{click:function(t){return e.toggleDetailedEvent(s)}}},[t("v-badge",{attrs:{"offset-y":10,"offset-x":10,bordered:"",content:s._source.comment.length}},[t("v-icon",{attrs:{title:s["showDetails"]?"Close event & comments":"Open event & comments",small:""}},[e._v(" mdi-comment-text-multiple-outline ")])],1)],1):e._e()],1),!s["showDetails"]||s._source.comment.length||s.showComments?e._e():t("div",{staticClass:"d-inline-block"},[t("v-btn",{attrs:{icon:"",small:""},on:{click:function(t){return e.newComment(s)}}},[t("v-icon",{attrs:{title:"Add a comment"}},[e._v(" mdi-comment-plus-outline ")])],1)],1),s["showDetails"]&&!s._source.comment.length&&s.showComments?t("div",{staticClass:"d-inline-block"},[t("v-btn",{attrs:{icon:"",small:""},on:{click:function(e){s.showComments=!1}}},[t("v-icon",{attrs:{title:"Close comments"}},[e._v(" mdi-comment-remove-outline ")])],1)],1):e._e()]}}],null,!0),model:{value:e.selectedEvents,callback:function(t){e.selectedEvents=t},expression:"selectedEvents"}})],1):e._e()],1)},pt=[],vt=(s(4603),s(7566),s(8721),{methods:{getTimeline(e){let t=this.$store.state.meta.indices_metadata[e._index].is_legacy;return t?this.$store.state.sketch.active_timelines.find(t=>t.searchindex.index_name===e._index):this.$store.state.sketch.active_timelines.find(t=>t.id===e._source.__ts_timeline_id)}}}),gt=function(){var e=this,t=e._self._c;return t("div",[t("apexchart",{attrs:{height:"250",options:e.options,series:e.series}})],1)},ft=[],yt=s(5207),_t=s.n(yt),bt={props:["chartData"],components:{Apexchart:_t()},data:function(){return{options:{chart:{type:"bar",zoom:{enabled:!1,type:"x",autoScaleYaxis:!0},foreColor:"#fff",animations:{enabled:!0,easing:"easeinout",speed:50,animateGradually:{enabled:!0,delay:50},dynamicAnimation:{enabled:!0,speed:50}},colors:["#4285f"],toolbar:{show:!0,tools:{download:!1,selection:!0,zoom:!0,zoomin:!0,zoomout:!0}},events:{dataPointSelection:(e,t,s)=>{this.emitFilterRequest(s)}}},tooltip:{enabled:!0,followCursor:!1,theme:"dark",x:{formatter:e=>{let t=this.getBucketDateTimeRange(e),s=this.$moment.duration(t.start.diff(t.end));return`${t.start.format("YYYY-MM-DD HH:mm:ss")} + ${s.humanize()}`}}},plotOptions:{bar:{columnWidth:"95%",borderRadius:4}},dataLabels:{enabled:!1},grid:{xaxis:{lines:{show:!1}},yaxis:{lines:{show:!1}}},xaxis:{type:"datetime",tickPlacement:"on"}}}},computed:{series(){let e={name:"Events",data:[]};return this.chartData?(e.data=Object.entries(this.chartData.data).map(e=>[parseInt(e[0]),e[1]]),[e]):[e]}},methods:{getBucketDateTimeRange(e){let t=this.$moment.utc(e),s=this.chartData.interval.split(/(\d+)/),i=s[1],a=s[2],n=this.$moment.utc(e).add(parseInt(i),a);return{start:t,end:n}},emitFilterRequest(e){let t=e.selectedDataPoints[0][0],s=e.w.config.series[0]["data"];if(1===s.length)return;let i=s[t][0],a=this.getBucketDateTimeRange(i),n={field:"",type:"datetime_range",value:a.start.toISOString()+","+a.end.toISOString(),operator:"must",active:!0};this.$emit("addChip",n)},setTheme(){"dark"===localStorage.theme?this.options={chart:{foreColor:"#fff"},tooltip:{theme:"dark"}}:this.options={chart:{foreColor:"#333"},tooltip:{theme:"light"}}}},created(){l.$on("isDarkTheme",this.setTheme)},mounted(){this.setTheme()}},St=bt,kt=(0,d.A)(St,gt,ft,!1,null,null,null),wt=kt.exports,xt=function(){var e=this,t=e._self._c;return t("div",[t("v-row",[t("v-col",{attrs:{cols:e.event.showComments?8:0}},[t("v-card",{attrs:{outlined:"",height:"100%"}},[t("v-simple-table",{attrs:{dense:""},scopedSlots:e._u([{key:"default",fn:function(){return[t("tbody",e._l(e.fullEventFiltered,function(s,i){return t("tr",{key:i,on:{mouseover:function(t){e.c_key=i},mouseleave:function(t){e.c_key=-1}}},[i==e.c_key?t("td",{staticClass:"text-right",staticStyle:{"min-width":"105px"}},[e.ignoredAggregatorFields.has(i)?e._e():t("v-btn",{staticClass:"mr-1",attrs:{icon:"","x-small":""},on:{click:function(t){return t.stopPropagation(),e.loadAggregation(i,s)}}},[t("v-icon",{attrs:{title:"Aggregation dialog"}},[e._v("mdi-chart-bar")])],1),e.ignoreFilterChips.has(i)?e._e():t("v-btn",{staticClass:"mr-1",attrs:{icon:"","x-small":""},on:{click:function(t){return t.stopPropagation(),e.applyFilterChip(i,s,"must")}}},[t("v-icon",{attrs:{title:"Filter for value"}},[e._v("mdi-filter-plus-outline")])],1),e.ignoreFilterChips.has(i)?e._e():t("v-btn",{staticClass:"mr-1",attrs:{icon:"","x-small":""},on:{click:function(t){return t.stopPropagation(),e.applyFilterChip(i,s,"must_not")}}},[t("v-icon",{attrs:{title:"Filter out value"}},[e._v("mdi-filter-minus-outline")])],1),t("v-btn",{staticClass:"pr-1",staticStyle:{cursor:"pointer"},attrs:{icon:"","x-small":""},on:{click:function(t){return e.copyToClipboard(i)}}},[t("v-icon",{attrs:{title:"Copy attribute name",small:""}},[e._v("mdi-content-copy")])],1)],1):t("td",[t("div",{staticClass:"px-12"})]),t("td",[e._v(" "+e._s(i)+" ")]),e.checkContextLinkDisplay(i,s)||i==e.c_key?t("td",{staticClass:"text-right pr-1"},[t("v-btn",{directives:[{name:"show",rawName:"v-show",value:i==e.c_key,expression:"key == c_key"}],staticStyle:{cursor:"pointer"},attrs:{icon:"","x-small":""},on:{click:function(t){return e.copyToClipboard(s)}}},[t("v-icon",{attrs:{small:"",title:"Copy attribute value"}},[e._v("mdi-content-copy")])],1),e.checkContextLinkDisplay(i,s)?t("v-menu",{attrs:{"offset-y":"",transition:"slide-y-transition"},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-btn",e._g(e._b({staticStyle:{cursor:"pointer"},attrs:{icon:"",color:"primary","x-small":""}},"v-btn",i,!1),s),[t("v-icon",{attrs:{title:"Context Lookup",small:""}},[e._v(" mdi-open-in-new ")])],1)]}}],null,!0)},[t("v-list",{attrs:{dense:""}},[t("v-dialog",{attrs:{"max-width":"515","retain-focus":!1},model:{value:e.redirectWarnDialog,callback:function(t){e.redirectWarnDialog=t},expression:"redirectWarnDialog"}},[t("ts-link-redirect-warning",{attrs:{app:"","context-value":e.contextValue,"context-url":e.contextUrl},on:{cancel:function(t){e.redirectWarnDialog=!1}}})],1),t("v-dialog",{staticClass:"asdf",attrs:{"max-width":"80%","min-width":"1000px","max-height":"80%","min-height":"600px","retain-focus":!1},model:{value:e.dfirUnfurlDialog,callback:function(t){e.dfirUnfurlDialog=t},expression:"dfirUnfurlDialog"}},[t("ts-unfurl-dialog",{attrs:{url:e.contextValue},on:{cancel:function(t){e.dfirUnfurlDialog=!1}}})],1),t("v-dialog",{model:{value:e.formatXMLString,callback:function(t){e.formatXMLString=t},expression:"formatXMLString"}},[t("ts-format-xml-string",{attrs:{xmlString:s},on:{close:function(t){e.formatXMLString=!1}}})],1),e._l(e.getContextLinkItems(i),function(a,n){return t("v-list-item",{key:n,staticStyle:{cursor:"pointer"},on:{click:function(t){return t.stopPropagation(),e.contextLinkRedirect(i,a,s)}}},[e.getContextLinkRedirectState(i,a)?t("v-list-item-title",[e._v(" "+e._s(a)+" (ext.)")]):t("v-list-item-title",[e._v(e._s(a))])],1)})],2)],1):e._e()],1):t("td",[t("div",{staticClass:"px-5"})]),t("td",{staticClass:"pl-0",attrs:{width:"100%"}},[e._v(" "+e._s(s)+" ")])])}),0)]},proxy:!0}])})],1)],1),t("v-slide-x-reverse-transition",[t("v-col",{directives:[{name:"show",rawName:"v-show",value:e.event.showComments,expression:"event.showComments"}],attrs:{cols:"4"}},[t("ts-comments",{attrs:{comments:e.comments,event:e.event,currentSearchNode:e.currentSearchNode}})],1)],1)],1),t("v-dialog",{attrs:{scrollable:""},on:{"click:outside":e=>this.aggregatorDialog=!1},model:{value:e.aggregatorDialog,callback:function(t){e.aggregatorDialog=t},expression:"aggregatorDialog"}},[t("ts-aggregate-dialog",{attrs:{eventKey:e.eventKey,eventValue:e.eventValue,eventTimestamp:e.eventTimestamp,eventTimestampDesc:e.eventTimestampDesc,reloadData:e.aggregatorDialog},on:{cancel:function(t){e.aggregatorDialog=!1}}})],1),t("br")],1)},Tt=[],Ct=function(){var e=this,t=e._self._c;return t("v-card",{staticClass:"mx-auto"},[t("v-toolbar",{attrs:{dense:"",flat:""}},[t("h3",{staticClass:"ml-6",staticStyle:{"white-space":"nowrap"}},[e._v("Event Data Analytics")]),t("div",[t("v-chip",{staticClass:"ml-2",attrs:{outlined:""}},[e._v("Field:Â "),t("span",{staticStyle:{"font-family":"monospace"}},[e._v(e._s(this.eventKey))])]),t("v-chip",{staticClass:"ml-2",attrs:{outlined:""}},[e._v("Value:Â "),t("span",{staticStyle:{"font-family":"monospace"}},[e._v(e._s(this.truncateValue(this.eventValue)))])]),t("v-chip",{staticClass:"ml-2",attrs:{outlined:""}},[e._v("Event datetime:Â "),t("span",{staticStyle:{"font-family":"monospace"}},[e._v(e._s(this.eventDateTime))])])],1),t("v-spacer"),t("v-btn",{attrs:{icon:""},on:{click:e.clearAndCancel}},[t("v-icon",[e._v("mdi-close")])],1)],1),t("v-card-text",[t("v-container",{attrs:{fluid:""}},[t("v-row",{attrs:{justify:"center"}},[t("v-col",[t("v-card",{attrs:{outlined:"",height:"146px",loading:!e.statsReady}},[t("v-card-title",[e._v(" Sketch statistics ")]),e.statsReady?t("v-simple-table",{staticClass:"px-2 mt-n4",attrs:{dense:""}},[t("tbody",[t("tr",[t("td",{attrs:{width:"200px"}},[e._v("Total number of events")]),t("td",[t("strong",[e._v(e._s(this.formatNumber(this.docCount)))])])]),t("tr",[t("td",{attrs:{width:"200px"}},[e._v("First event")]),t("td",{staticStyle:{"white-space":"nowrap"}},[t("strong",[e._v(e._s(this.fieldDateTimeMinimum))])])]),t("tr",[t("td",{attrs:{width:"200px"}},[e._v("Last event")]),t("td",[t("strong",[e._v(e._s(this.fieldDateTimeMaximum))])])])])]):e._e()],1),t("v-card",{staticClass:"mt-1",attrs:{outlined:"",height:"146px",loading:!e.statsReady}},[t("v-card-title",[e._v(" Field statistics ")]),e.statsReady?t("v-simple-table",{staticClass:"px-2 mt-n4",attrs:{dense:""}},[t("tbody",[t("tr",[t("td",{attrs:{width:"200px"}},[e._v("Field name")]),t("td",[t("span",{staticStyle:{"font-family":"monospace"}},[e._v(e._s(this.eventKey))])])]),t("tr",[t("td",{attrs:{width:"200px"}},[e._v("Total number of events")]),t("td",[t("strong",[e._v(e._s(this.fieldValueCount))])])]),t("tr",[t("td",{attrs:{width:"200px"}},[e._v("Number of unique values")]),t("td",[t("strong",[e._v(e._s(this.fieldCardinality))])])])])]):e._e()],1),t("v-card",{staticClass:"mt-1",attrs:{outlined:"",height:"180px",loading:!e.statsReady}},[t("v-card-title",[e._v(" Value statistics ")]),e.statsReady?t("v-simple-table",{staticClass:"px-2 mt-n4",attrs:{dense:""}},[t("tbody",[t("tr",[t("td",{attrs:{width:"200px"}},[e._v("Field value")]),t("td",[t("span",{staticStyle:{"font-family":"monospace"}},[e._v(e._s(this.eventValue))])])]),t("tr",[t("td",{attrs:{width:"200px"}},[e._v("Total number of events")]),t("td",[t("strong",[e._v(e._s(this.valueEventCount))])])]),t("tr",[t("td",{attrs:{width:"200px"}},[e._v("First event")]),t("td",[t("strong",[e._v(e._s(this.valueDateTimeMinimum))])])]),t("tr",[t("td",{attrs:{width:"200px"}},[e._v("Last event")]),t("td",[t("strong",[e._v(e._s(this.valueDateTimeMaximum))])])])])]):e._e()],1)],1),t("v-col",{attrs:{align:"center"}},[t("v-card",{attrs:{outlined:"",height:"480px",loading:!e.statsReady}},[t("v-card-title",[e._v(" Top "+e._s(Math.min(10,this.commonValues.length))+" Â "),t("span",{staticStyle:{"font-family":"monospace"}},[e._v(e._s(e.eventKey))]),e._v("Â  values "),t("v-spacer"),t("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t("v-icon",e._g({attrs:{color:"primary"}},s),[e._v("mdi-information-outline")])]}}])},[t("span",[e._v("The top "+e._s(Math.min(10,this.commonValues.length))+" most common Â "),t("span",{staticStyle:{"font-family":"monospace"}},[e._v(e._s(e.eventKey))]),e._v("Â  values (out of "+e._s(this.fieldCardinality)+" unique values). ")])])],1),t("v-card-text",[t("v-data-table",{attrs:{headers:e.termHeaders,items:e.commonValues,"items-per-page":10,"hide-default-footer":e.commonValues.length<=10,dense:""}})],1)],1)],1),t("v-col",{attrs:{align:"center"}},[t("v-card",{attrs:{outlined:"",height:"480px",loading:!e.statsReady}},[t("v-card-title",[e._v(" Rare Â "),t("span",{staticStyle:{"font-family":"monospace"}},[e._v(e._s(e.eventKey))]),e._v("Â  values "),t("v-spacer"),t("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t("v-icon",e._g({attrs:{color:"primary"}},s),[e._v("mdi-information-outline")])]}}])},[t("span",[e._v("Rare Â "),t("span",{staticStyle:{"font-family":"monospace"}},[e._v(e._s(e.eventKey))]),e._v("Â  events that have a maximum event count of 5 ")])])],1),t("v-card-text",[t("v-data-table",{attrs:{headers:e.termHeaders,items:e.rareValues,"items-per-page":10,"hide-default-footer":e.rareValues.length<=10,"footer-props":{disableItemsPerPage:!0},dense:""}})],1)],1)],1)],1),t("v-row",[t("v-col",{attrs:{align:"center"}},[t("v-card",{attrs:{outlined:"",height:"480px",loading:!e.statsReady}},[t("v-card-title",[e._v(" Percentage of Â "),t("span",{staticStyle:{"font-family":"monospace"}},[e._v(e._s(e.eventKey))]),e._v("Â  events "),t("v-spacer"),t("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t("v-icon",e._g({attrs:{color:"primary"}},s),[e._v("mdi-information-outline")])]}}])},[t("span",[e._v("Shows the ratio of "),t("span",{staticStyle:{"font-family":"monospace"}},[e._v(e._s(this.truncateValue(e.eventValue)))]),e._v(" events to other "),t("span",{staticStyle:{"font-family":"monospace"}},[e._v(e._s(e.eventKey))]),e._v(" events. ")])])],1),e.statsReady?t("v-card-text",[t("apexchart",{attrs:{height:"350px",options:this.donutChartOptions,series:this.donutChartSeries}})],1):e._e()],1)],1),t("v-col",{attrs:{align:"center"}},[t("v-card",{attrs:{outlined:"",height:"480px",loading:!e.eventDistributionReady}},[t("v-card-title",[e._v(" Event distribution by "+e._s(this.distributionIntervals[this.selectedDistributionIntervalIndex])+" "),t("v-spacer"),t("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t("v-icon",e._g({attrs:{color:"primary"}},s),[e._v("mdi-information-outline")])]}}])},[t("span",[e._v("Shows the distribution of "),t("span",{staticStyle:{"font-family":"monospace"}},[e._v(e._s(this.truncateValue(e.eventValue)))]),e._v(" events in the sketch based on the "+e._s(this.distributionIntervals[this.selectedDistributionIntervalIndex])+" of the datetime. ")])])],1),e.statsReady?t("v-card-text",[t("v-btn-toggle",{attrs:{mandatory:""},model:{value:e.selectedDistributionIntervalIndex,callback:function(t){e.selectedDistributionIntervalIndex=t},expression:"selectedDistributionIntervalIndex"}},e._l(this.distributionIntervals,function(s){return t("v-btn",{key:s,attrs:{small:""}},[e._v(" "+e._s(s)+" ")])}),1),t("apexchart",{attrs:{height:"350px",options:this.intervalChartOptions,series:this.intervalChartSeries}})],1):e._e()],1)],1),t("v-col",{attrs:{align:"center"}},[t("v-card",{attrs:{outlined:"",height:"480",loading:!e.dataReady}},[t("v-card-title",[e._v(" Surrounding events "),t("v-spacer"),t("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t("v-icon",e._g({attrs:{color:"primary"}},s),[e._v("mdi-information-outline")])]}}])},[t("span",[e._v("Shows the distribution of "),t("span",{staticStyle:{"font-family":"monospace"}},[e._v(e._s(this.truncateValue(e.eventValue)))]),e._v(" events that are "+e._s(this.recentIntervals[this.selectedRecentEventsIndex])+" of "),t("span",{staticStyle:{"font-family":"monospace"}},[e._v(e._s(e.eventDateTime))])])])],1),e.dataReady?t("v-card-text",[t("v-btn-toggle",{attrs:{mandatory:""},model:{value:e.selectedRecentEventsIndex,callback:function(t){e.selectedRecentEventsIndex=t},expression:"selectedRecentEventsIndex"}},e._l(this.recentIntervals,function(s){return t("v-btn",{key:s,attrs:{small:""}},[e._v(" "+e._s(s)+" ")])}),1),t("apexchart",{attrs:{height:"350px",options:this.recentHistogramOptions,series:this.recentHistogramSeries}})],1):e._e()],1)],1)],1)],1)],1)],1)},At=[],Dt={components:{Apexchart:_t()},props:["eventKey","eventValue","eventTimestamp","eventTimestampDesc","reloadData"],data(){return{distributionIntervals:["Year","Month","Day","Hour","Hour-Day"],recentIntervals:["Â± 5 years","Â± 6 months","Â± 7 days","Â± 6 hours"],recentHistogramLabels:[],recentHistogramSeries:[],selectedDistributionIntervalIndex:0,selectedRecentEventsIndex:2,dataReady:!1,data:[],monthsOfYear:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],daysOfWeek:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],hoursOfDay:["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],stats:void 0,statsReady:!1,eventDistributionReady:!1,eventDistributionData:void 0,termHeaders:[{text:"Term",sortable:!0,value:"key"},{text:"Count",sortable:!0,value:"doc_count"}]}},computed:{settings(){return this.$store.state.settings},sketch(){return this.$store.state.sketch},eventDateTime(){return new Date(this.eventTimestamp/1e3).toISOString()},selectedDistributionInterval(){return this.distributionIntervals[this.selectedDistributionIntervalIndex]},selectedRecentEvents(){return this.recentIntervals[this.selectedRecentEventsIndex]},intervalChartOptions(){if(void 0===this.eventDistributionData||!this.eventDistributionReady)return{chart:{type:"bar"}};let e=[];if("Year"===this.selectedDistributionInterval){e=[];for(const t of this.eventDistributionData.year_histogram.buckets)e.push(t.key)}else if("Month"===this.selectedDistributionInterval)e=this.monthsOfYear;else if("Day"===this.selectedDistributionInterval)e=this.daysOfWeek;else if("Hour"===this.selectedDistributionInterval)e=this.hoursOfDay;else if("Hour-Day"===this.selectedDistributionInterval)return this.intervalHeatmapOptions;return{chart:{type:"bar"},xaxis:{tickAmount:12,labels:{show:!0,hideOverlappingLabels:!0},categories:e}}},intervalChartSeries(){if(void 0===this.eventDistributionData||!this.eventDistributionReady)return[];let e=[];switch(this.selectedDistributionInterval){case"Year":e=Array(this.eventDistributionData.year_histogram.length).fill(0);for(const[t,s]of this.eventDistributionData.year_histogram.buckets.entries())e[t]=s.doc_count;break;case"Month":e=Array(12).fill(0);for(const t of this.eventDistributionData.month_histogram.buckets)e[t.key-1]=t.doc_count;break;case"Day":e=Array(7).fill(0);for(const t of this.eventDistributionData.day_histogram.buckets)e[t.key]=t.doc_count;break;case"Hour":e=Array(24).fill(0);for(const t of this.eventDistributionData.hour_histogram.buckets)e[t.key]=t.doc_count;break;case"Hour-Day":return this.intervalHeatmapSeries;default:break}return[{name:"Events by "+this.selectedDistributionInterval,data:e}]},fieldCardinality(){return void 0===this.stats?null:this.stats.all_values.field_cardinality.value},docCount(){return void 0===this.stats?null:this.stats.all_values.doc_count},fieldDateTimeMinimum(){return void 0===this.stats?null:this.stats.all_values.datetime_min.value_as_string},fieldDateTimeMaximum(){return void 0===this.stats?null:this.stats.all_values.datetime_max.value_as_string},valueDateTimeMinimum(){return void 0===this.stats?null:this.stats.datetime_min.value_as_string},valueDateTimeMaximum(){return void 0===this.stats?null:this.stats.datetime_max.value_as_string},fieldValueCount(){return void 0===this.stats?null:this.stats.all_values.field_count.value},valueEventCount(){return void 0===this.stats?null:this.stats.value_count.value},commonValues(){return void 0===this.stats?[]:this.stats.all_values.top_terms.buckets},rareValues(){return void 0===this.stats?[]:this.stats.all_values.rare_terms.buckets},donutChartOptions(){return{chart:{type:"donut"},dataLabels:{enabled:!0},labels:[this.truncateValue(this.eventValue)+" ("+this.valueEventCount+")","Other "+this.eventKey+" ("+(this.fieldValueCount-this.valueEventCount)+")"],legend:{position:"bottom"}}},donutChartSeries(){return[this.valueEventCount,this.fieldValueCount-this.valueEventCount]},minEvent:function(){return this.raw_data[0]},maxEvent:function(){return this.raw_data[this.raw_data.length-1]},intervalHeatmapOptions(){return{chart:{type:"heatmap"},colors:["#008FFB"],tooltip:{enabled:!0,x:{show:!0}},xaxis:{labels:{show:!0,hideOverlappingLabels:!0},tickPlacement:"between",categories:this.hoursOfDay}}},intervalHeatmapSeries(){let e=[];if(void 0===this.eventDistributionData)return e;for(let t of Array.from({length:7}).keys()){let s=[];for(let e of Array.from({length:24}).keys()){const i=this.eventDistributionData.hour_of_week_histogram.buckets[24*t+e].doc_count;s.push({x:this.hoursOfDay[e],y:i})}e.push({name:this.daysOfWeek[t],data:s})}return e},recentHistogramOptions(){return this.dataReady?{chart:{type:"bar"},xaxis:{labels:{show:!0,hideOverlappingLabels:!0},categories:this.recentHistogramLabels}}:{chart:{type:"bar"}}}},watch:{reloadData(e,t){!0===e&&(this.loadSummaryData(),this.loadEventDistribution(),this.loadAggregationData())},selectedDistributionInterval(e,t){e!==t&&this.loadEventDistribution()},selectedRecentEvents(e,t){e!==t&&this.loadAggregationData()}},methods:{truncateValue(e){return e.length>45?e.substring(0,45).trim()+"...":e},formatNumber(e){return(new Intl.NumberFormat).format(e)},loadSummaryData:function(){this.statsReady=!1,this.stats=void 0,_.runAggregator(this.sketch.id,{aggregator_name:"field_summary",aggregator_parameters:{field:this.eventKey,field_query_string:this.eventValue},include_processing_timelines:!!this.settings.showProcessingTimelineEvents}).then(e=>{this.stats=e.data.objects[0].field_summary.buckets[0],this.statsReady=!0})},loadEventDistribution:function(){this.eventDistributionReady=!1,this.eventDistributionData=[],_.runAggregator(this.sketch.id,{aggregator_name:"datefield_summary",aggregator_parameters:{field:this.eventKey,date_interval:this.selectedDistributionInterval},include_processing_timelines:!!this.settings.showProcessingTimelineEvents}).then(e=>{this.eventDistributionData=e.data.objects[0].datefield_summary.buckets[0],this.eventDistributionReady=!0})},loadAggregationData:function(){this.dataReady=!1,this.data=[];const e=new Date(this.eventTimestamp/1e3);let t,s,i;switch(this.selectedRecentEvents){case"Â± 5 years":t=new Date(this.eventTimestamp/1e3),t.setUTCFullYear(e.getUTCFullYear()-5),s=new Date(this.eventTimestamp/1e3),s.setUTCFullYear(e.getUTCFullYear()+5),i="year";break;case"Â± 6 months":t=new Date(this.eventTimestamp/1e3),t.setUTCMonth(e.getUTCMonth()-6),s=new Date(this.eventTimestamp/1e3),s.setUTCMonth(e.getUTCMonth()+6),i="month";break;case"Â± 7 days":t=new Date(this.eventTimestamp/1e3),t.setUTCDate(e.getUTCDate()-7),s=new Date(this.eventTimestamp/1e3),s.setUTCDate(e.getUTCDate()+7),i="day";break;case"Â± 6 hours":t=new Date(this.eventTimestamp/1e3),t.setUTCHours(e.getUTCHours()-6),s=new Date(this.eventTimestamp/1e3),s.setUTCHours(e.getUTCHours()+6),i="hour";break;default:return}_.runAggregator(this.sketch.id,{aggregator_name:"date_histogram",aggregator_parameters:{field:this.eventKey,field_query_string:this.eventValue,supported_intervals:i,start_time:t.toISOString().slice(0,-1),end_time:s.toISOString().slice(0,-1)},include_processing_timelines:!!this.settings.showProcessingTimelineEvents}).then(e=>{this.data=e.data.objects[0].date_histogram.buckets[0],this.recentHistogramSeries=[{data:[],name:"Events"}],this.recentHistogramLabels=[];for(const[t,s]of e.data.objects[0].date_histogram.buckets[0].entries())this.recentHistogramSeries[0].data[t]=s.count,this.recentHistogramLabels[t]=s.datetime.slice(0,-5);this.dataReady=!0})},clearAndCancel:function(){this.$emit("cancel")}},mounted(){this.loadSummaryData(),this.loadEventDistribution(),this.loadAggregationData()}},$t=Dt,Lt=(0,d.A)($t,Ct,At,!1,null,null,null),It=Lt.exports,Et=function(){var e=this,t=e._self._c;return t("v-card",[t("div",{staticClass:"pa-8"},[t("pre",{staticStyle:{"font-size":"0.9em"},attrs:{lang:"xml"}},[e._v(e._s(e.xmlString))])]),t("v-divider"),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){return e.close()}}},[e._v(" Close ")])],1)],1)},Nt=[],zt={props:["xmlString"],methods:{close:function(){this.$emit("close")}}},Ft=zt,Rt=(0,d.A)(Ft,Et,Nt,!1,null,"25ba8c42",null),Pt=Rt.exports,Ot=function(){var e=this,t=e._self._c;return t("v-card",[t("v-card-title",[t("v-icon",{attrs:{large:"",color:"red"}},[e._v("mdi-shield-alert-outline")]),t("span",{staticClass:"text-h6 ml-2"},[e._v("External redirect warning!")])],1),t("v-card-text",[e.contextValue?t("div",{staticClass:"mb-2"},[e._v(" This action will open the link below in a new tab! Do you really want to send the following value to this external service? ")]):t("div",{staticClass:"mb-2"},[e._v(" This action will open the link below in a new tab! Do you really want to visit this external website? ")]),e.contextValue?t("div",[t("b",[e._v("Value:")]),t("br"),t("code",{staticClass:"code"},[e._v(" "+e._s(e.getContextValue)+" ")])]):e._e(),t("div",[t("b",[e._v("External website:")]),t("br"),t("code",{staticClass:"code"},[e._v(" "+e._s(e.getContextUrl)+" ")])])]),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{color:"primary",text:""},on:{click:e.clearAndCancel}},[e._v(" cancel ")]),t("v-btn",{attrs:{color:"primary",text:"",href:e.contextUrl,target:"_blank"},on:{click:e.clearAndCancel}},[e._v(" continue ")])],1)],1)},Qt=[],Mt=s(9418),qt={props:["contextValue","contextUrl"],methods:{clearAndCancel:function(){this.$emit("cancel")}},computed:{getContextValue(){return Mt.A.sanitize(this.contextValue)},getContextUrl(){return Mt.A.sanitize(this.contextUrl)}}},Bt=qt,Vt=(0,d.A)(Bt,Ot,Qt,!1,null,"5096e762",null),Ht=Vt.exports,Gt=function(){var e=this,t=e._self._c;return t("v-card",{attrs:{outlined:""}},[t("v-toolbar",{attrs:{dense:"",flat:""}},[t("v-toolbar-title",{staticStyle:{"font-size":"1.2em"}},[e._v("Comments")])],1),t("v-list",{attrs:{"three-line":""}},e._l(e.comments,function(s,i){return t("v-list-item",{key:s.id,on:{mouseover:function(t){return e.selectComment(s)},mouseleave:function(t){return e.unSelectComment()}}},[t("v-list-item-avatar",[t("v-avatar",{attrs:{color:"grey lighten-1"}},[t("span",{staticClass:"white--text"},[e._v(e._s(e._f("initialLetter")(s.user.username)))])])],1),t("v-list-item-content",[t("v-list-item-title",[e._v(" "+e._s(s.user.username)+" ")]),t("v-list-item-subtitle",[e._v(" "+e._s(e._f("shortDateTime")(s.created_at))+" ("+e._s(e._f("timeSince")(s.created_at))+") ")]),s.editable?t("v-card",{staticClass:"mt-5",attrs:{flat:""}},[t("v-textarea",{attrs:{"hide-details":"","auto-grow":"",filled:""},model:{value:e.comments[i].comment,callback:function(t){e.$set(e.comments[i],"comment",t)},expression:"comments[index].comment"}}),s.editable?t("v-card-actions",[t("v-spacer"),s.editable?t("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){return e.editComment(i,!1)}}},[e._v(" Cancel ")]):e._e(),t("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){return e.updateComment(s,i)}}},[e._v(" Save ")])],1):e._e()],1):t("p",{staticClass:"body-2",staticStyle:{"max-width":"90%"}},[e._v(e._s(s.comment))])],1),s===e.selectedComment&&e.meta.permissions.write&&e.currentUser==s.user.username?t("v-list-item-action",{staticStyle:{position:"absolute",right:"0"}},[t("v-chip",{staticStyle:{"margin-right":"10px"},attrs:{outlined:""}},[t("v-btn",{attrs:{icon:"",small:""},on:{click:function(t){return e.editComment(i)}}},[t("v-icon",{attrs:{title:"Edit comment",small:""}},[e._v("mdi-square-edit-outline")])],1),t("v-btn",{attrs:{icon:"",small:""},on:{click:function(t){return e.deleteComment(s.id,i)}}},[t("v-icon",{attrs:{title:"Delete comment",small:""}},[e._v("mdi-trash-can-outline")])],1)],1)],1):e._e()],1)}),1),e.meta.permissions.write?t("v-card-actions",[t("v-textarea",{staticClass:"mx-2 mb-2",attrs:{"hide-details":"","auto-grow":"",filled:"",label:"Add comment",rows:"1"},model:{value:e.comment,callback:function(t){e.comment=t},expression:"comment"}}),t("v-btn",{attrs:{icon:""},on:{click:e.postComment}},[t("v-icon",{attrs:{title:"Submit comment"}},[e._v("mdi-send")])],1)],1):e._e()],1)},Ut=[],Wt={props:["comments","event","currentSearchNode"],data(){return{comment:"",selectedComment:!1}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},currentUser(){return this.$store.state.currentUser}},methods:{postComment:function(){l.$emit("eventAnnotated",{type:"__ts_comment",event:this.event,searchNode:this.currentSearchNode}),_.saveEventAnnotation(this.sketch.id,"comment",this.comment,[this.event],this.currentSearchNode).then(e=>{this.comments.push(e.data.objects[0][0]),this.event._source.comment.push(this.comment),this.comment="",this.$store.dispatch("updateEventLabels",{label:"__ts_comment",num:1})}).catch(e=>{})},updateComment:function(e,t){_.updateEventAnnotation(this.sketch.id,"comment",e,[this.event],this.currentSearchNode).then(s=>{this.comments.splice(t,1,e),e.editable=!1}).catch(e=>{console.error(e)})},deleteComment:function(e,t){confirm("Are you sure?")&&_.deleteEventAnnotation(this.sketch.id,"comment",e,this.event,this.currentSearchNode).then(e=>{this.comments.splice(t,1),this.event._source.comment.splice(t,1),this.$store.dispatch("updateEventLabels",{label:"__ts_comment",num:-1})}).catch(e=>{console.error(e)})},editComment(e,t=!0){const s=this.comments[e];s.editable=t,this.comments.splice(e,1,s)},selectComment(e){this.selectedComment=e},unSelectComment(){this.selectedComment=!1}}},jt=Wt,Yt=(0,d.A)(jt,Gt,Ut,!1,null,null,null),Xt=Yt.exports,Jt=function(){var e=this,t=e._self._c;return t("v-card",[t("v-toolbar",{attrs:{flat:"",color:"transparent"}},[t("v-img",{staticClass:"ml-2",attrs:{position:"left",src:e.getUnfurlLogo,"max-height":"24",contain:""}})],1),t("v-card-subtitle",{staticClass:"pt-1"},[t("div",{staticClass:"mb-2"},[t("b",[e._v("Input: ")]),t("code",{staticClass:"code"},[e._v(e._s(e.url))])]),e.unfurlReady?t("div",[t("b",[e._v("Selected node info: ")]),t("code",{staticClass:"code",domProps:{innerHTML:e._s(e.sanitizeHtml(e.nodeContext))}})]):e._e()]),t("v-card-text",[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.unfurlReady,expression:"!unfurlReady"}]},[t("v-progress-linear",{attrs:{color:"primary",indeterminate:""}})],1),t("v-toolbar",{directives:[{name:"show",rawName:"v-show",value:e.unfurlReady,expression:"unfurlReady"}],staticClass:"mt-n8",attrs:{dense:"",flat:"",color:"transparent"}},[t("v-spacer"),t("div",[t("v-btn",{attrs:{icon:""},on:{click:function(t){return e.resizeCanvas()}}},[t("v-icon",{attrs:{title:"fit graph to canvas"}},[e._v("mdi-fit-to-page-outline")])],1),t("v-btn",{attrs:{icon:""},on:{click:function(t){return e.zoomGraph("plus")}}},[t("v-icon",{attrs:{title:"zoom-in"}},[e._v("mdi-plus")])],1),t("v-btn",{attrs:{icon:""},on:{click:function(t){return e.zoomGraph("minus")}}},[t("v-icon",{attrs:{title:"zoom-out"}},[e._v("mdi-minus")])],1)],1)],1),t("v-card",{directives:[{name:"show",rawName:"v-show",value:e.unfurlReady,expression:"unfurlReady"}],attrs:{outlined:""}},[t("div",{ref:"graphContainer",style:{height:e.canvasHeight,width:"100%"}},[t("div",{ref:"cy",staticClass:"pa-2",style:{"min-height":e.canvasHeight},attrs:{width:"100%"}})])]),t("small",[e._v("Powered by "),t("a",{attrs:{href:"https://github.com/obsidianforensics/unfurl",target:"_blank"}},[e._v("dfir-unfurl")])])],1),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{color:"primary",text:""},on:{click:e.clearAndCancel}},[e._v(" close ")])],1)],1)},Kt=[],Zt=s(165),es=s(5111),ts=s.n(es),ss=s(23);Zt.A.use(ts());var is={props:["url"],data(){return{unfurlReady:!1,unfurlData:{},canvasHeight:"400px",nodeContext:"",nodeContextDefault:"Select a node in the graph below to get more information.",config:{style:[{selector:"node",style:{shape:"roundrectangle",width:"data(labelWidth)",height:"data(labelHeight)",label:"data(label)","font-size":"10","text-outline-width":"0px",padding:"7px","background-color":"#e0e0e0","text-outline-color":"#e0e0e0","text-wrap":"wrap","text-max-width":"12em","text-halign":"center","text-valign":"center",color:"#000000"}},{selector:"node:selected",style:{"border-color":" #000","border-width":"2px"}},{selector:"edge",style:{width:1,"curve-style":"bezier","control-point-step-size":70,"target-arrow-shape":"triangle","font-size":11,"text-rotation":"autorotate","text-outline-width":3,"text-outline-color":"#FFFFFF",label:"data(label)"}},{selector:"edge.highlight",style:{lineColor:"grey",width:3}}],layout:{name:"dagre",animated:!1,prelayout:!1,spacingFactor:1}}}},computed:{getUnfurlLogo(){return this.$vuetify.theme.dark?"/unfurl-logo-dark.png":"/unfurl-logo.png"}},methods:{sanitizeHtml(e){return Mt.A.sanitize((0,ss.xI)(e))},clearAndCancel:function(){this.$emit("cancel")},getUnfurlData:function(e){_.getUnfurlGraph(e).then(e=>{this.unfurlData=e.data,this.unfurlReady=!0,this.buildUnfurlGraph(this.unfurlData)}).catch(e=>{console.error("getting unfurl error: ",e)})},resizeCanvasWithDelay:function(){this.resizeTimeout=setTimeout(()=>{this.resizeCanvas()},250)},resizeCanvas:function(){if(!this.$refs.graphContainer)return;let e=this.$refs.graphContainer.style.height,t=this.$refs.graphContainer.style.width,s=this.$refs.cy;s.style.minHeight=e+"px",s.style.height=e+"px",s.style.minWidth=t+"px",s.style.width=t+"px",this.cy.resize(),this.cy.fit()},zoomGraph(e){const t=this.cy.zoom();"plus"===e&&this.cy.zoom({level:t+.2}),"minus"===e&&this.cy.zoom({level:t-.2})},buildUnfurlGraph:function(e={}){this.cy.elements().remove();let t=[];e.nodes.forEach(e=>{t.push({group:"nodes",data:{id:e.id,label:e.label,labelWidth:6*e.label.length,labelHeight:13,context:e.title}})}),e.edges.forEach(e=>{t.push({group:"edges",data:{id:`e${e.from}${e.to}`,source:e.from,target:e.to,label:e.label,context:e.title}})}),this.cy.style(this.config.style),this.cy.add(t),this.cy.layout(this.config.layout).run(),this.resizeCanvasWithDelay()},nodeSelection:function(e){this.cy.edges().removeClass("highlight"),e.target.outgoers("edge").addClass("highlight"),this.nodeContext=e.target.data().context?e.target.data().context:"No context available for this node.",this.resizeCanvas()}},mounted(){window.addEventListener("resize",this.resizeCanvasWithDelay),this.unfurlReady=!1,this.nodeContext=this.nodeContextDefault,this.getUnfurlData(this.url),this.cy=(0,Zt.A)({container:this.$refs.cy,...this.config}),this.cy.on("select","node",e=>{this.nodeSelection(e)}),this.cy.on("unselect","node",e=>{this.cy.elements().removeClass("highlight"),this.nodeContext=this.nodeContextDefault})}},as=is,ns=(0,d.A)(as,Jt,Kt,!1,null,"405cbb74",null),rs=ns.exports,ls={components:{TsAggregateDialog:It,TsFormatXmlString:Pt,TsLinkRedirectWarning:Ht,TsComments:Xt,TsUnfurlDialog:rs},props:["event"],data(){return{fullEvent:{},comments:[],aggregatorDialog:!1,ignoredAggregatorFields:new Set(["datetime","message","path_spec","strings","timestamp","xml_string"]),ignoreFilterChips:new Set(["datetime","tag"]),eventKey:"",eventValue:"",eventTimestamp:0,eventTimestampDesc:"",formatXMLString:!1,redirectWarnDialog:!1,dfirUnfurlDialog:!1,contextUrl:"",contextValue:"",c_key:-1}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},currentUser(){return this.$store.state.currentUser},currentSearchNode(){return this.$store.state.currentSearchNode},fullEventFiltered(){return Object.getOwnPropertyNames(this.fullEvent).forEach(e=>{e.startsWith("__ts")&&delete this.fullEvent[e]}),this.fullEvent},contextLinkConf(){return this.$store.state.contextLinkConf},settings(){return this.$store.state.settings}},methods:{getEvent:function(){let e=this.event._index,t=this.event._id,s=!!this.settings.showProcessingTimelineEvents;_.getEvent(this.sketch.id,e,t,s).then(e=>{this.fullEvent=e.data.objects,this.comments=e.data.meta.comments,this.eventTimestamp=e.data.objects.timestamp,this.eventTimestampDesc=e.data.objects.timestamp_desc,this.comments.length>0&&(this.event.showComments=!0)}).catch(e=>{})},getContextLinkItems(e){let t=this.contextLinkConf[e.toLowerCase()]?this.contextLinkConf[e.toLowerCase()]:[],s=t.map(e=>e.short_name);return s},checkContextLinkDisplay(e,t){const s=this.contextLinkConf[e.toLowerCase()]?this.contextLinkConf[e.toLowerCase()]:[];for(const i of s){if(""!==i["validation_regex"]&&void 0!==i["validation_regex"]){let e=i["validation_regex"],s=e.slice(e.lastIndexOf("/")+1),a=e.slice(e.indexOf("/")+1,e.lastIndexOf("/")),n=new RegExp(a,s);return!!n.test(t)}return!0}return!1},contextLinkRedirect(e,t,s){const i=this.contextLinkConf[e.toLowerCase()]?this.contextLinkConf[e.toLowerCase()]:[];for(const a of i)if(a["short_name"]===t)if("hardcoded_modules"===a["type"]){if("xml_formatter"===a["module"])return this.formatXMLString=!0,void(this.contextValue=s);if("unfurl_graph"===a["module"])return this.dfirUnfurlDialog=!0,void(this.contextValue=s);if("threat_intel"===a["module"])return void l.$emit("addIndicator",s)}else a["redirect_warning"]?(this.redirectWarnDialog=!0,this.contextValue=s,this.contextUrl=a["context_link"].replace("<ATTR_VALUE>",encodeURIComponent(s))):(window.open(a["context_link"].replace("<ATTR_VALUE>",encodeURIComponent(s)),"_blank"),this.redirectWarnDialog=!1)},getContextLinkType(e,t){const s=this.contextLinkConf[e.toLowerCase()]?this.contextLinkConf[e.toLowerCase()]:[];for(const i of s)if(i["short_name"]===t)return i["type"]},getContextLinkRedirectState(e,t){const s=this.contextLinkConf[e.toLowerCase()]?this.contextLinkConf[e.toLowerCase()]:[];for(const i of s)if(i["short_name"]===t)return!!i["redirect_warning"]&&i["redirect_warning"]},loadAggregation(e,t){this.eventKey=e,this.eventValue=t,this.aggregatorDialog=!0},copyToClipboard(e){try{navigator.clipboard.writeText(e),this.infoSnackBar("copied")}catch(t){this.errorSnackBar("Failed copying to the clipboard!"),console.error(t)}},applyFilterChip(e,t,s){let i={doSearch:!0},a={field:e,value:t,type:"term",operator:s,active:!0};i.chip=a,l.$emit("setQueryAndFilter",i)}},created:function(){this.getEvent()}},os=ls,cs=(0,d.A)(os,xt,Tt,!1,null,null,null),ds=cs.exports,us=function(){var e=this,t=e._self._c;return t("v-menu",{attrs:{"offset-x":"","close-on-content-click":!1},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[e.assignedTags.length>0?t("v-icon",e._g(e._b({staticClass:"ml-1",attrs:{title:"Modify tags"}},"v-icon",i,!1),s),[e._v("mdi-tag-plus")]):t("v-icon",e._g(e._b({staticClass:"ml-1",attrs:{title:"Modify tags"}},"v-icon",i,!1),s),[e._v("mdi-tag-plus-outline")])]}}]),model:{value:e.showMenu,callback:function(t){e.showMenu=t},expression:"showMenu"}},[t("ts-event-tag-dialog",{attrs:{events:[e.event]},on:{close:function(t){e.showMenu=!1}}})],1)},hs=[],ms=function(){var e=this,t=e._self._c;return t("v-card",{staticClass:"mx-auto",attrs:{"min-width":"500px","max-width":"500px","min-height":"260px"}},[t("v-btn",{staticClass:"float-right mr-1 mt-1",attrs:{icon:""},on:{click:function(t){return e.$emit("close")}}},[t("v-icon",{attrs:{title:"Close dialog"}},[e._v("mdi-close")])],1),t("v-card-text",[t("strong",[e._v("Quick tags")]),t("v-chip-group",e._l(e.quickTags,function(s){return t("v-chip",{key:s.tag,staticClass:"text-center",attrs:{color:s.color,"text-color":s.textColor,disabled:!!e.tagsAssignedToAll.includes(s.tag),small:"",title:"Add quick tag"},on:{click:[function(t){return e.addTags(s.tag)},function(t){return t.stopPropagation(),e.$emit("close")}]}},[t("v-icon",{attrs:{small:"",left:""}},[e._v(" "+e._s(s.label)+" ")]),e._v(" "+e._s(s.tag)+" ")],1)}),1),t("strong",[e._v("Assigned tags")]),t("v-chip-group",{attrs:{column:""}},e._l(e.assignedTags,function(s){return t("v-chip",{key:s,staticClass:"text-center",attrs:{color:e.getQuickTag(s)?e.getQuickTag(s).color:"","text-color":e.getQuickTag(s)?e.getQuickTag(s).textColor:"",small:"",close:"",title:"Remove "},on:{"click:close":function(t){return e.removeTags(s)}}},[e.getQuickTag(s)?t("v-icon",{attrs:{small:"",left:""}},[e._v(e._s(e.getQuickTag(s).label))]):e._e(),e._v(" "+e._s(s)+" ")],1)}),1),t("br"),t("v-combobox",{attrs:{"hide-no-data":!e.search,items:e.customTags,"search-input":e.search,"hide-selected":"",label:"Add tags ...","small-chips":"",outlined:""},on:{"update:searchInput":function(t){e.search=t},"update:search-input":function(t){e.search=t},change:function(t){return e.addTags(e.selectedTags)}},scopedSlots:e._u([{key:"no-data",fn:function(){return[t("v-list-item",[t("span",{staticClass:"subheading"},[e._v("Create new tag: ")]),t("v-chip",{staticClass:"ml-1",attrs:{small:""}},[e._v(" "+e._s(e.search)+" ")])],1)]},proxy:!0},{key:"item",fn:function({item:s}){return[t("v-chip",{attrs:{small:""}},[e._v(" "+e._s(s)+" ")])]}}]),model:{value:e.selectedTags,callback:function(t){e.selectedTags=t},expression:"selectedTags"}})],1)],1)},ps=[],vs=(s(1148),{props:["events"],data(){return{listItems:[],selectedTags:null,quickTags:[{tag:"bad",color:"red",textColor:"white",label:"mdi-alert-circle-outline"},{tag:"suspicious",color:"orange",textColor:"white",label:"mdi-help-circle-outline"},{tag:"good",color:"green",textColor:"white",label:"mdi-check-circle-outline"}],search:null}},computed:{sketch(){return this.$store.state.sketch},tags(){return this.$store.state.tags.map(e=>e.tag)},event(){return this.events[0]},assignedTags(){let e=new Set;for(const t of this.events)t._source.tag&&t._source.tag.forEach(t=>e.add(t));return[...e]},tagsAssignedToAll(){return this.quickTags.filter(e=>this.events.every(t=>{const s=t._source.tag||[];return s.includes(e.tag)})).map(e=>e.tag)},customTags(){if(!this.events.every(e=>!e._source.tag))return[];let e=this.tags.filter(e=>!this.getQuickTag(e));return e=e.filter(e=>!this.assignedTags.includes(e)),e.sort((e,t)=>e.localeCompare(t)),e}},methods:{getQuickTag(e){return this.quickTags.find(t=>t.tag===e)},removeTags(e){_.untagEvents(this.sketch.id,this.events,[e]).then(t=>{for(let s of this.events){const t=s._source.tag.indexOf(e);-1!==t&&s._source.tag.splice(t,1)}this.$store.dispatch("updateTimelineTags",{sketchId:this.sketch.id,tag:e,num:-1})}).catch(e=>{console.error(e)})},addTags:function(e){for(let s of this.events)s._source.hasOwnProperty("tag")||this.$set(s._source,"tag",[]);const t=this.events.filter(t=>!t._source.tag.includes(e));_.tagEvents(this.sketch.id,t,[e]).then(s=>{for(let i of t)this.$set(i._source.tag,i._source.tag.length,e);this.$store.dispatch("updateTimelineTags",{sketchId:this.sketch.id,tag:e,num:1})}).catch(e=>{console.error("Cannot tag event! Error:"+e)}),this.$nextTick(()=>{this.selectedTags=null,this.search=null})}}}),gs=vs,fs=(0,d.A)(gs,ms,ps,!1,null,"1dd7136a",null),ys=fs.exports,_s={components:{TsEventTagDialog:ys},props:["event"],data(){return{showMenu:!1,selectedTags:null,quickTags:[{tag:"bad",color:"red",textColor:"white",label:"mdi-alert-circle-outline"},{tag:"suspicious",color:"orange",textColor:"white",label:"mdi-help-circle-outline"},{tag:"good",color:"green",textColor:"white",label:"mdi-check-circle-outline"}],search:null}},computed:{assignedTags(){return this.event._source.tag?this.event._source.tag:[]}}},bs=_s,Ss=(0,d.A)(bs,us,hs,!1,null,"5523dd62",null),ks=Ss.exports,ws=function(){var e=this,t=e._self._c;return t("span",[t("v-menu",{attrs:{"offset-y":"",transition:"slide-y-transition"},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-icon",e._g(e._b({staticClass:"ml-1",attrs:{title:"Event Action Menu"}},"v-icon",i,!1),s),[e._v("mdi-dots-vertical")])]}}]),model:{value:e.showMenu,callback:function(t){e.showMenu=t},expression:"showMenu"}},[t("v-list",{staticClass:"mx-auto",attrs:{dense:""}},[t("v-list-item",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.copyEventUrlToClipboard()}}},[t("v-list-item-icon",[t("v-icon",{attrs:{small:""}},[e._v("mdi-link-variant")])],1),t("v-list-item-title",[e._v("Copy link to event")])],1),t("v-list-item",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.copyEventAsJSON()}}},[t("v-list-item-icon",[t("v-icon",{attrs:{small:""}},[e._v("mdi-code-json")])],1),t("v-list-item-title",[e._v("Copy event data as JSON")])],1),t("v-list-item",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.showContextWindow()}}},[t("v-list-item-icon",[t("v-icon",{attrs:{small:""}},[e._v("mdi-magnify-plus-outline")])],1),t("v-list-item-title",[e._v("Context search")])],1),t("v-list-item",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.focusOnTimeline()}}},[t("v-list-item-icon",[t("v-icon",{attrs:{small:""}},[e._v("mdi-eye")])],1),t("v-list-item-title",[e._v("Unselect other timelines")])],1),t("v-list-item",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.filterOutTimeline()}}},[t("v-list-item-icon",[t("v-icon",{attrs:{small:""}},[e._v("mdi-eye-off")])],1),t("v-list-item-title",[e._v("Unselect this timeline")])],1)],1)],1)],1)},xs=[],Ts={props:["event"],data(){return{showMenu:!1,originalContext:!1}},mixins:[vt],computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},settings(){return this.$store.state.settings}},methods:{showContextWindow(){l.$emit("showContextWindow",this.event)},copyEventAsJSON(){_.getEvent(this.sketch.id,this.event._index,this.event._id,!!this.settings.showProcessingTimelineEvents).then(e=>{let t=e.data.objects,s=JSON.stringify(t,null,3);navigator.clipboard.writeText(s),this.infoSnackBar("Event JSON copied to clipboard")}).catch(e=>{this.errorSnackBar("Failed to load JSON into the clipboard"),console.error(e)})},copyEventUrlToClipboard(){try{let e=window.location.origin+this.$route.path+'?q=_id:"'+this.event._id+'"';navigator.clipboard.writeText(e),this.infoSnackBar("Event URL copied to clipboard")}catch(e){this.errorSnackBar("Failed to load Event URL into the clipboard"),console.error(e)}},focusOnTimeline(){const e=this.getTimeline(this.event);e&&this.$store.dispatch("updateEnabledTimelines",[e.id])},filterOutTimeline(){const e=this.getTimeline(this.event);if(!e)return;const t=this.$store.state.enabledTimelines||[],s=t.filter(t=>t!==e.id);this.$store.dispatch("updateEnabledTimelines",s)}}},Cs=Ts,As=(0,d.A)(Cs,ws,xs,!1,null,"0a95dea8",null),Ds=As.exports,$s=function(){var e=this,t=e._self._c;return t("span",[e._l(e.sortedTags,function(s){return t("span",{key:s},[t("v-chip",{staticClass:"mr-1",attrs:{small:"",color:e.tagColor(s).color,"text-color":e.tagColor(s).textColor}},[s in e.tagConfig?t("v-icon",{attrs:{left:"",small:""}},[e._v(e._s(e.tagConfig[s].label))]):e._e(),e._v(" "+e._s(s)+" ")],1)],1)}),e._l(e.item._source.label,function(s){return t("span",{key:s},[s.startsWith("__ts")?e._e():t("v-chip",{staticClass:"mr-2",attrs:{small:"",outlined:""}},[e._v(" "+e._s(s)+" ")])],1)})],2)},Ls=[],Is={props:["item","tagConfig","showDetails"],computed:{sketch(){return this.$store.state.sketch},sortedTags(){if(!this.item._source.tag)return[];let e=this.item._source.tag;return e.sort((e,t)=>"bad"===e?-1:"bad"===t?1:"suspicious"===e?-1:"suspicious"===t?1:"good"===e?-1:"good"===t?1:e.localeCompare(t)),e}},methods:{tagColor:function(e){return this.tagConfig[e]?this.tagConfig[e]:"lightgrey"}}},Es=Is,Ns=(0,d.A)(Es,$s,Ls,!1,null,null,null),zs=Ns.exports,Fs=function(){var e=this,t=e._self._c;return t("ts-search-guide-card",{attrs:{flat:e.inDialog,"show-tags":e.showTags,"show-data-types":e.showDataTypes,"show-saved-searches":e.showSavedSearches},scopedSlots:e._u([{key:"header",fn:function(){return[t("div",{staticClass:"pa-4 pb-0"},[t("v-card-title",[t("v-icon",{attrs:{large:"",left:""}},[e._v("mdi-file-search-outline")]),e._v(" Start Exploring "),t("v-spacer"),e.inDialog?t("v-btn",{attrs:{icon:"",title:"Close dialog"},on:{click:function(t){return e.$emit("close-dialog")}}},[t("v-icon",[e._v("mdi-close")])],1):e._e()],1),t("v-card-subtitle",{staticClass:"mt-1"},[e._v(" Find below some examples on how to explore your data. ")]),t("v-divider")],1)]},proxy:!0}])})},Rs=[],Ps=function(){var e=this,t=e._self._c;return t("v-card",{class:{"ma-4":!e.flat},attrs:{outlined:!e.flat}},[e._t("header"),t("v-card-text",[t("v-row",{attrs:{"no-gutters":""}},[t("v-col",{staticStyle:{"min-width":"250px","flex-basis":"25%"}},[t("div",{staticClass:"pa-2"},[t("v-simple-table",{scopedSlots:e._u([{key:"default",fn:function(){return[t("thead",[t("tr",[t("th",{staticClass:"text-left"},[e._v("Description")]),t("th",{staticClass:"text-left"},[e._v("Example Query")])])]),t("tbody",[t("tr",[t("td",[e._v("Search for all events")]),t("td",[t("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.emitSetQueryAndFilter("*")}}},[t("code",[e._v("*")])])])]),t("tr",[t("td",[e._v("Search a word in the message field")]),t("td",[t("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.emitSetQueryAndFilter("message:error")}}},[t("code",[e._v('message:"error"')])])])]),t("tr",[t("td",[e._v("Search filenames ending with "),t("code",[e._v(".exe")])]),t("td",[t("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.emitSetQueryAndFilter("filename:*.exe")}}},[t("code",[e._v("filename:*.exe")])])])]),t("tr",[t("td",[e._v(" Search on the "),t("a",{attrs:{href:"https://docs.opensearch.org/docs/2.19/field-types/supported-field-types/keyword/"}},[e._v("keyword field type")]),t("br"),e._v("(exact matches & substring search) ")]),t("td",[t("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.emitSetQueryAndFilter("filename.keyword:malicious.exe")}}},[t("code",[e._v("filename.keyword:malicious.exe")])]),t("br"),t("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.emitSetQueryAndFilter("message.keyword:*System32*")}}},[t("code",[e._v("message.keyword:*System32*")])])])]),t("tr",[t("td",[e._v("Search using regex (between "),t("code",[e._v("//")]),e._v(")")]),t("td",[t("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.emitSetQueryAndFilter("url.keyword:/.*\\/sketch\\/[1-100]\\/.*/")}}},[t("code",[e._v("url.keyword:/.*\\/sketch\\/[1-100]\\/.*/")])])])]),t("tr",[t("td",[e._v("Combine searches with AND, OR, NOT")]),t("td",[t("a",{attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.emitSetQueryAndFilter("event_identifier:(4624 OR 4625) AND LogonType:3")}}},[t("code",[e._v("event_identifier:(4624 OR 4625) AND NOT LogonType:3")])])])]),t("tr",[t("td",[e._v("Search events that have an url field")]),t("td",[t("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.emitSetQueryAndFilter("_exists_:url")}}},[t("code",[e._v("_exists_:url")])]),t("br"),t("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.emitSetQueryAndFilter("url:*")}}},[t("code",[e._v("url:*")])])])]),t("tr",[t("td",[e._v("Search for a range of numbers")]),t("td",[t("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.emitSetQueryAndFilter("http_status_code:[200 TO 204] AND bytes_transferred:>10000")}}},[t("code",[e._v("status_code:[200 TO 204] AND transferred:>10000")])])])]),t("tr",[t("td",[e._v("Filter by a specific date/time range (UTC)")]),t("td",[t("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.emitSetQueryAndFilter(`datetime:[${e.firstOfCurrentMonth} TO ${e.nowDateTimeUTC}]`)}}},[t("code",[e._v("datetime:["+e._s(e.firstOfCurrentMonth)+" TO "+e._s(e.nowDateTimeUTC)+"]")])])])]),t("tr",[t("td",[e._v("Filter for events before or after a date (UTC)")]),t("td",[t("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.emitSetQueryAndFilter(`datetime:[${e.firstOfCurrentMonth} TO *]`)}}},[t("code",[e._v("datetime:["+e._s(e.firstOfCurrentMonth)+" TO *]")])]),t("br"),t("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.emitSetQueryAndFilter(`datetime:[* TO ${e.firstOfCurrentMonth}]`)}}},[t("code",[e._v("datetime:[* TO "+e._s(e.firstOfCurrentMonth)+"]")])])])])])]},proxy:!0}])})],1)]),e.showTags?t("v-col",{staticStyle:{"border-left":"1px solid rgba(0, 0, 0, 0.12)"}},[t("div",{staticClass:"pa-4"},[t("h5",[t("v-icon",{attrs:{left:""}},[e._v("mdi-tag-multiple-outline")]),e._v(" Tags")],1),t("ts-tags-list")],1)]):e._e(),e.showDataTypes?t("v-col",{staticStyle:{"border-left":"1px solid rgba(0, 0, 0, 0.12)"}},[t("div",{staticClass:"pa-4"},[t("h5",[t("v-icon",{attrs:{left:""}},[e._v("mdi-database-outline")]),e._v(" Data Types")],1),t("ts-data-types-list")],1)]):e._e(),e.showSavedSearches?t("v-col",{staticStyle:{"border-left":"1px solid rgba(0, 0, 0, 0.12)"}},[t("div",{staticClass:"pa-4"},[t("h5",[t("v-icon",{attrs:{left:""}},[e._v("mdi-content-save-outline")]),e._v(" Saved Searches")],1),t("ts-saved-searches-list")],1)]):e._e()],1)],1),t("v-divider"),t("v-card-actions",[t("v-btn",{attrs:{text:"",color:"primary",href:"https://timesketch.org/guides/user/search-query-guide/",target:"_blank"}},[e._v(" Full Search Guide "),t("v-icon",{attrs:{right:""}},[e._v("mdi-open-in-new")])],1)],1)],2)},Os=[],Qs=function(){var e=this,t=e._self._c;return t("div",[t("v-data-iterator",{attrs:{items:e.dataTypes,"items-per-page":e.itemsPerPage,search:e.search,"hide-default-footer":e.dataTypes.length<=e.itemsPerPage},on:{"update:itemsPerPage":function(t){e.itemsPerPage=t},"update:items-per-page":function(t){e.itemsPerPage=t}},scopedSlots:e._u([e.dataTypes.length>e.itemsPerPage?{key:"header",fn:function(){return[t("v-toolbar",{attrs:{flat:""}},[t("v-text-field",{attrs:{clearable:"","hide-details":"",outlined:"",dense:"","prepend-inner-icon":"mdi-magnify",label:"Search for a data type.."},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)]},proxy:!0}:null,{key:"default",fn:function(s){return e._l(s.items,function(s){return t("div",{key:s.data_type,staticStyle:{cursor:"pointer","font-size":"0.9em"},on:{click:function(t){return e.setQueryAndFilter(s.data_type)}}},[t("v-row",{staticClass:"pa-2 pl-5",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",attrs:{"no-gutters":""}},[t("span",[e._v(e._s(s.data_type)+" ("),t("small",[t("strong",[e._v(e._s(e._f("compactNumber")(s.count)))])]),e._v(")")])])],1)})}}],null,!0)})],1)},Ms=[],qs={props:[],data:function(){return{itemsPerPage:10,search:""}},computed:{dataTypes(){return[...this.$store.state.dataTypes].sort((e,t)=>e.data_type.localeCompare(t.data_type))}},methods:{setQueryAndFilter(e){let t={doSearch:!0};t.queryString='data_type:"'+e+'"',l.$emit("setQueryAndFilter",t)}}},Bs=qs,Vs=(0,d.A)(Bs,Qs,Ms,!1,null,"9e6a7a38",null),Hs=Vs.exports,Gs=function(){var e=this,t=e._self._c;return t("div",e._l(e.meta.views,function(s,i){return t("div",{key:i,staticStyle:{"font-size":"0.9em"},on:{mouseover:function(t){e.c_key=i},mouseleave:function(t){e.c_key=-1}}},[t("v-row",{staticClass:"py-1 pl-5 pr-3",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",attrs:{"no-gutters":""}},[t("v-col",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.setView(s)}}},[t("div",{staticClass:"mt-1"},[e._v(e._s(s.name))])]),t("v-col",{attrs:{cols:"auto"}},[t("v-btn",{staticStyle:{cursor:"pointer"},attrs:{icon:"","x-small":""},on:{click:function(t){return e.copySavedSearchUrlToClipboard(s.id)}}},[t("v-icon",{directives:[{name:"show",rawName:"v-show",value:i==e.c_key,expression:"key == c_key"}],attrs:{title:"Copy link to this search",small:""}},[e._v("mdi-link-variant")])],1),t("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-btn",e._g(e._b({staticClass:"mr-1",attrs:{small:"",icon:""}},"v-btn",i,!1),s),[t("v-icon",{attrs:{title:"More actions",small:""}},[e._v("mdi-dots-vertical")])],1)]}}],null,!0)},[t("v-list",{staticClass:"mx-auto",attrs:{dense:""}},[t("v-list-item",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.copySavedSearchIdToClipboard(s.id)}}},[t("v-list-item-icon",[t("v-icon",{attrs:{small:""}},[e._v("mdi-identifier")])],1),t("v-list-item-title",[e._v("Copy saved search ID")])],1),t("v-list-item",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.copySavedSearchUrlToClipboard(s.id)}}},[t("v-list-item-icon",[t("v-icon",{attrs:{small:""}},[e._v("mdi-link-variant")])],1),t("v-list-item-title",[e._v("Copy link to this search")])],1)],1)],1)],1)],1)],1)}),0)},Us=[],Ws={props:[],data:function(){return{c_key:-1}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta}},methods:{setView:function(e){l.$emit("setActiveView",e)},copySavedSearchIdToClipboard(e){try{navigator.clipboard.writeText(e),this.infoSnackBar("Saved Search ID copied to clipboard")}catch(t){this.errorSnackBar("Failed to load Saved Search ID into the clipboard!"),console.error(t)}},copySavedSearchUrlToClipboard(e){try{let t=window.location.origin+this.$route.path+"?view="+e;navigator.clipboard.writeText(t),this.infoSnackBar("Saved Search URL copied to clipboard")}catch(t){this.errorSnackBar("Failed to load Saved Search URL into the clipboard!"),console.error(t)}}}},js=Ws,Ys=(0,d.A)(js,Gs,Us,!1,null,"3b7709bd",null),Xs=Ys.exports,Js={name:"TsSearchGuideCard",props:{flat:{type:Boolean,default:!1},showTags:{type:Boolean,default:!1},showDataTypes:{type:Boolean,default:!1},showSavedSearches:{type:Boolean,default:!1}},components:{TsTagsList:pe,TsDataTypesList:Hs,TsSavedSearchesList:Xs},computed:{firstOfCurrentMonth(){const e=new Date,t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0");return`${t}-${s}-01`},nowDateTimeUTC(){const e=new Date;return e.toISOString().slice(0,19)}},methods:{emitSetQueryAndFilter(e){let t={doSearch:!0};t.queryString=e,l.$emit("setQueryAndFilter",t),this.$emit("search-triggered")}}},Ks=Js,Zs=(0,d.A)(Ks,Ps,Os,!1,null,"fa2a8da6",null),ei=Zs.exports,ti={name:"TsExploreWelcomeCard",props:{inDialog:{type:Boolean,default:!1}},components:{TsSearchGuideCard:ei},computed:{showTags(){if(!this.$store.state.tags||!this.$store.state.meta.filter_labels)return!1;const e=this.$store.state.meta.filter_labels.filter(e=>!e.label.startsWith("__ts_fact"));return[...this.$store.state.tags,...e].length>0},showDataTypes(){return this.$store.state.dataTypes.length>0},showSavedSearches(){return this.$store.state.meta.views.length>0}}},si=ti,ii=(0,d.A)(si,Fs,Rs,!1,null,null,null),ai=ii.exports,ni=function(){var e=this,t=e._self._c;return t("ts-search-guide-card",{attrs:{flat:e.inDialog,"show-tags":e.showTags,"show-data-types":e.showDataTypes,"show-saved-searches":e.showSavedSearches},scopedSlots:e._u([{key:"header",fn:function(){return[t("div",{staticClass:"pa-4 pb-0"},[t("v-card-title",[t("v-icon",{attrs:{large:"",left:""}},[e._v("mdi-alert-circle-outline")]),e._v(" No Results Found "),t("v-spacer"),e.inDialog?t("v-btn",{attrs:{icon:"",title:"Close dialog"},on:{click:function(t){return e.$emit("close-dialog")}}},[t("v-icon",[e._v("mdi-close")])],1):e._e()],1),t("v-card-subtitle",{staticClass:"mt-1"},[t("p",[e._v(" Your search "),e.currentQueryString?t("code",[e._v("'"+e._s(e.currentQueryString)+"'")]):e._e(),e.filterChips.length?t("span",[e._v("in combination with the selected filter chips "),t("code",[e._v("'"+e._s(e.filterChips.map(e=>e.value).join(", "))+"'")])]):e._e(),e._v(" did not match any events. ")]),e.disableSaveSearch?e._e():t("p",[t("v-btn",{attrs:{small:"",depressed:"",title:"Save Search"},on:{click:function(t){return e.$emit("save-search-clicked")}}},[t("v-icon",{attrs:{left:"",small:""}},[e._v("mdi-content-save-outline")]),e._v(" Save search ")],1)],1),t("p",[e._v("Suggestions:")]),t("ul",[t("li",[e._v("Try different keywords"),e.filterChips.length?t("span",[e._v(" or filter terms")]):e._e(),e._v(".")]),t("li",[e._v("Try more general keywords.")]),t("li",[e._v("Try fewer keywords"),e.filterChips.length?t("span",[e._v(" or filter terms")]):e._e(),e._v(".")]),t("li",[e._v("Try some of the search examples below.")])])]),t("v-divider")],1)]},proxy:!0}])})},ri=[],li={name:"TsSearchNotFoundCard",props:{inDialog:{type:Boolean,default:!1},currentQueryString:{type:String,default:""},filterChips:{type:Array,default:()=>[]},disableSaveSearch:{type:Boolean,default:!1}},components:{TsSearchGuideCard:ei},computed:{showTags(){if(!this.$store.state.tags||!this.$store.state.meta.filter_labels)return!1;const e=this.$store.state.meta.filter_labels.filter(e=>!e.label.startsWith("__ts_fact"));return[...this.$store.state.tags,...e].length>0},showDataTypes(){return this.$store.state.dataTypes.length>0},showSavedSearches(){return this.$store.state.meta.views.length>0}}},oi=li,ci=(0,d.A)(oi,ni,ri,!1,null,null,null),di=ci.exports;const ui=()=>({from:0,terminate_after:40,size:40,indices:["_all"],order:"asc",chips:[]}),hi=()=>({meta:{count_per_index:{},count_per_timeline:{}},objects:[]});var mi={components:{TsBarChart:wt,TsEventDetail:ds,TsEventTagMenu:ks,TsEventTagDialog:ys,TsEventActionMenu:Ds,TsEventTags:zs,TsExploreWelcomeCard:ai,TsSearchNotFoundCard:di},mixins:[vt],props:{queryRequest:{type:Object,default:()=>{}},itemsPerPage:{type:Number,default:40},disableSaveSearch:{type:Boolean,default:!1},disableHistogram:{type:Boolean,default:!1},disableColumns:{type:Boolean,default:!1},disableSettings:{type:Boolean,default:!1},disablePagination:{type:Boolean,default:!1},highlightEvent:{type:Object,default:()=>{}}},data(){return{expandedItemSlot:"expanded-item",itemActionsSlot:"item.actions",itemTimestampSlot:"item._source.timestamp",itemTimelineNameSlot:"item.timeline_name",itemCommentSlot:"item._source.comment",showEventTagMenu:!1,columnHeaders:[{text:"",value:"field"}],tableOptions:{itemsPerPage:this.itemsPerPage},isSummaryLoading:!1,currentItemsPerPage:this.itemsPerPage,expandedRows:[],selectedFields:[{field:"message",type:"text"}],searchColumns:"",columnDialog:!1,saveSearchMenu:!1,saveSearchFormName:"",saveSearchNameRules:[e=>!!e||"Name is required.",e=>e&&e.length<=255||"Name is too long."],selectedEventTags:[],tagConfig:{good:{color:"green",textColor:"white",label:"mdi-check-circle-outline"},bad:{color:"red",textColor:"white",label:"mdi-alert-circle-outline"},suspicious:{color:"orange",textColor:"white",label:"mdi-help-circle-outline"}},searchInProgress:!1,exportDialog:!1,currentPage:1,eventList:{meta:{},objects:[]},currentQueryString:"",currentQueryFilter:ui(),selectedEvents:[],displayOptions:{isCompact:!1,showTags:!0,showEmojis:!0,showMillis:!1,showTimelineName:"true"===localStorage.getItem("showTimelineName")},showHistogram:!1,branchParent:null,sortOrderAsc:!0,summaryCollapsed:!1,showBanner:!1}},computed:{summaryInfoMessage(){const e=this.eventList.meta.summary_event_count,t=this.eventList.meta.summary_unique_event_count;return`[experimental] This summary is based on the message field on your current page (${e} rows, ${t} unique message fields).`},sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},highlightEventId(){return this.highlightEvent?this.highlightEvent._id:null},totalHits(){return this.eventList.meta.es_total_count>0&&0===this.eventList.meta.es_total_count_complete?this.eventList.meta.es_total_count:this.eventList.meta.es_total_count_complete||0},totalHitsForPagination(){return this.eventList.meta.es_total_count||0},totalTime(){return this.eventList.meta.es_time/1e3||0},fromEvent(){return this.currentQueryFilter.from||1},toEvent(){if(!(this.totalHits<this.currentQueryFilter.size))return parseInt(this.currentQueryFilter.from)+parseInt(this.currentQueryFilter.size)},timeFilterChips:function(){return this.currentQueryFilter.chips.filter(e=>e.type.startsWith("datetime"))},currentSearchNode(){return this.$store.state.currentSearchNode},userSettings(){return this.$store.state.settings},headers(){let e=[{text:"",value:"data-table-select",sortable:!1},{value:"actions",width:"105",sortable:!1},{text:"Datetime (UTC) ",align:"start",value:"_source.timestamp",width:"200",sortable:!0},{value:"_source.comment",width:"40",sortable:!1}],t=[];return this.selectedFields.forEach(e=>{let s={text:e.field,align:"start",value:"_source."+e.field,sortable:!1};"message"===e.field?(s.width="100%",t.unshift(s)):t.push(s)}),e.splice(3,0,...t),this.displayOptions.showTimelineName&&e.push({value:"timeline_name",align:"end",sortable:!1}),e},activeContext(){return this.$store.state.activeContext},settings(){return this.$store.state.settings},filterChips:function(){return this.currentQueryFilter.chips.filter(e=>"label"===e.type||"term"===e.type)}},methods:{toggleSummary(){this.summaryCollapsed=!this.summaryCollapsed,localStorage.setItem("aiSummaryCollapsed",String(this.summaryCollapsed))},sortEvents(e){this.currentQueryFilter.order=e?"asc":"desc",this.search(!0,!0,!1)},getFieldName:function(e){return"item._source."+e},toggleDetailedEvent:function(e){let t=this.expandedRows.findIndex(t=>t._id===e._id);if(this.expandedRows.some(t=>t._id===e._id)){if(!e.showDetails)return e["showDetails"]=!0,this.expandedRows.splice(t,1),void this.expandedRows.push(e);e["showDetails"]=!1,this.expandedRows.splice(t,1),this.$set(e,"showComments",!1),e.deltaDays&&(this.expandedRows.splice(t,1),this.expandedRows.push(e))}else e["showDetails"]=!0,this.expandedRows.push(e)},newComment:function(e){e.showDetails?this.$set(e,"showComments",!0):(this.$set(e,"showComments",!0),this.toggleDetailedEvent(e))},addTimeBubbles:function(){this.expandedRows=[],this.eventList.objects.forEach((e,t)=>{if(t<1)return;let s=this.eventList.objects[t-1],i=this.$options.filters.formatTimestamp(e._source.timestamp),a=this.$options.filters.formatTimestamp(s._source.timestamp),n=Math.floor(i/1e3),r=Math.floor(a/1e3),l=Math.floor(n-r);"desc"===this.order&&(l=Math.floor(r-n));let o=Math.floor(l/60/60/24);o>0&&(s["deltaDays"]=o,this.expandedRows.push(s))})},getTimelineColor(e){let t=this.getTimeline(e),s=t.color;return s.startsWith("#")||(s="#"+s),this.$vuetify.theme.dark?{"background-color":s,filter:"grayscale(25%)",color:"#333"}:{"background-color":s}},getTimeBubbleColor(){let e="#f5f5f5";return this.$vuetify.theme.dark&&(e="#333"),{"background-color":e}},getAllIndices:function(){let e=[];return this.sketch.active_timelines.forEach(t=>{let s=this.meta.indices_metadata[t.searchindex.index_name].is_legacy;s?e.push(t.searchindex.index_name):e.push(t.id)}),e},search:function(e=!0,t=!1,s=!1){if(this.isSummaryLoading=!0,this.currentQueryFilter.indices&&!this.currentQueryFilter.indices.length)return this.eventList=hi(),void(this.isSummaryLoading=!1);if("_all"!==this.currentQueryFilter.indices[0]&&"_all"!==this.currentQueryFilter.indices||(this.currentQueryFilter.indices=this.getAllIndices()),!this.currentQueryString&&!this.currentQueryDsl)return;this.searchInProgress=!0,this.selectedEvents=[],this.eventList=hi(),e&&(this.tableOptions.page=1,this.currentPage=1,this.currentItemsPerPage=this.tableOptions.itemsPerPage,this.currentQueryFilter.size=this.tableOptions.itemsPerPage,this.currentQueryFilter.from=0),this.currentQueryFilter.fields=this.selectedFields;let i={};this.currentQueryDsl&&(i.dsl=this.currentQueryDsl,i.filter=this.currentQueryFilter),this.currentQueryString&&(i.query=this.currentQueryString,i.filter=this.currentQueryFilter),t&&(i["incognito"]=!0),s&&(i["parent"]=s),s&&t&&(this.branchParent=s),this.branchParent&&(i["parent"]=this.branchParent),i["scenario"]=this.activeContext.scenarioId,i["facet"]=this.activeContext.facetId,i["question"]=this.activeContext.questionId,i["include_processing_timelines"]=this.settings.showProcessingTimelineEvents,_.search(this.sketch.id,i).then(e=>{this.eventList.objects=e.data.objects,this.eventList.meta=e.data.meta,this.updateShowBanner(),this.searchInProgress=!1,l.$emit("updateCountPerTimeline",e.data.meta.count_per_timeline),this.$emit("countPerTimeline",e.data.meta.count_per_timeline),this.$emit("countPerIndex",e.data.meta.count_per_index),this.addTimeBubbles(),t||(l.$emit("createBranch",this.eventList.meta.search_node),this.$store.dispatch("updateSearchHistory"),this.$store.dispatch("updateTimeFilters"),this.branchParent=this.eventList.meta.search_node.id),this.userSettings.eventSummarization&&this.eventList.objects.length>0&&this.fetchEventSummary()}).catch(e=>{let t='Sorry, there was a problem fetching your search results. Error: "'+e.response.data.message+'"';e.response.data.message.includes("too_many_nested_clauses")||e.response.data.message.includes("query_shard_exception")?(t='Sorry, your query is too complex. Use field-specific search (like "message:(<query terms>)") and try again.',this.warningSnackBar(t)):this.errorSnackBar(t),console.error("Error message: "+t),console.error(e)})},fetchEventSummary:function(){const e={query:this.currentQueryString,filter:this.currentQueryFilter};_.llmRequest(this.sketch.id,"llm_summarize",e).then(e=>{this.$set(this.eventList.meta,"summary",e.data.response),this.$set(this.eventList.meta,"summary_event_count",e.data.summary_event_count),this.$set(this.eventList.meta,"summary_unique_event_count",e.data.summary_unique_event_count),this.isSummaryLoading=!1}).catch(e=>{console.error("Error fetching event summary:",e),this.$set(this.eventList.meta,"summaryError",!0),this.isSummaryLoading=!1})},exportSearchResult:function(){this.exportDialog=!0;const e=new Date,t="timesketch_export_"+e.toISOString()+".zip";let s={query:this.currentQueryString,filter:this.currentQueryFilter,file_name:t};_.exportSearchResult(this.sketch.id,s).then(e=>{let s=window.URL.createObjectURL(new Blob([e.data])),i=document.createElement("a");i.href=s,i.setAttribute("download",t),document.body.appendChild(i),i.click(),this.exportDialog=!1}).catch(e=>{console.error(e),this.exportDialog=!1})},addChip:function(e){this.currentQueryFilter.chips||(this.currentQueryFilter.chips=[]),this.currentQueryFilter.chips.push(e),this.search()},removeChip:function(e,t=!0){let s=this.currentQueryFilter.chips.findIndex(t=>t.value===e.value);this.currentQueryFilter.chips.splice(s,1),t&&this.search()},removeChips:function(e,t=!0){Array.isArray(e)?(e.forEach(e=>{this.removeChip(e,!1)}),t&&this.search()):this.errorSnackBar("Not an array of chips")},addChipFromHistogram:function(e){this.currentQueryFilter.chips||(this.currentQueryFilter.chips=[]),this.currentQueryFilter.chips.forEach(e=>{"datetime_range"===e.type&&this.removeChip(e,!1)}),this.addChip(e)},paginate:function(){if(this.tableOptions.itemsPerPage!==this.currentItemsPerPage)return this.tableOptions.page=1,this.currentPage=1,this.currentItemsPerPage=this.tableOptions.itemsPerPage,this.currentQueryFilter.size=this.tableOptions.itemsPerPage,void this.search(!0,!0);this.currentPage!==this.tableOptions.page&&(this.currentQueryFilter.from=this.tableOptions.page*this.currentQueryFilter.size-this.currentQueryFilter.size,this.currentPage=this.tableOptions.page,this.search(!1,!0))},updateSelectedFields:function(e){e.forEach(e=>{!this.headers.filter(t=>t.field===e.field).length>0&&this.search(!0,!0)})},removeField:function(e){this.selectedFields.splice(e,1)},toggleStar(e){let t=0;e._source.label.includes("__ts_star")?(e._source.label.splice(e._source.label.indexOf("__ts_star"),1),t=-1):(e._source.label.push("__ts_star"),t=1),_.saveEventAnnotation(this.sketch.id,"label","__ts_star",e,this.currentSearchNode).then(e=>{this.$store.dispatch("updateEventLabels",{label:"__ts_star",num:t})}).catch(e=>{console.error(e)})},toggleMultipleStars:function(){let e=0;this.selectedEvents.forEach(t=>{t._source.label.includes("__ts_star")?(t._source.label.splice(t._source.label.indexOf("__ts_star"),1),e--):(t._source.label.push("__ts_star"),e++)}),_.saveEventAnnotation(this.sketch.id,"label","__ts_star",this.selectedEvents,this.currentSearchNode).then(t=>{this.$store.dispatch("updateEventLabels",{label:"__ts_star",num:e}),this.selectedEvents=[]}).catch(e=>{})},saveSearch:function(){_.createView(this.sketch.id,this.saveSearchFormName,this.currentQueryString,this.currentQueryFilter).then(e=>{this.saveSearchFormName="",this.saveSearchMenu=!1;let t=e.data.objects[0];this.$store.state.meta.views.push(t)}).catch(e=>{})},updateShowBanner:function(){this.showBanner=!!this.settings.showProcessingTimelineEvents&&this.sketch.active_timelines.filter(e=>this.$store.state.enabledTimelines.includes(e.id)).some(e=>e.status&&"processing"===e.status[0].status)}},watch:{tableOptions:{handler(e,t){void 0!==t.sortDesc&&e.sortDesc[0]===t.sortDesc[0]&&this.paginate()},deep:!0},queryRequest:{handler(e,t){if(e===t||!e)return;this.currentQueryString=e.queryString||"",this.currentQueryFilter=e.queryFilter||ui(),this.currentQueryDsl=e.queryDsl||null;let s=e["resetPagination"]||!1,i=e["incognito"]||!1,a=e["parent"]||!1;this.currentQueryFilter.fields&&(this.selectedFields=this.currentQueryFilter.fields),this.sortOrderAsc?this.currentQueryFilter.order="asc":this.currentQueryFilter.order="desc",this.search(s,i,a)},deep:!0},"settings.showProcessingTimelineEvents":{handler(){this.updateShowBanner()}},"displayOptions.showTimelineName":function(e){localStorage.setItem("showTimelineName",String(e))}},created(){if(Object.keys(this.queryRequest).length){this.currentQueryString=this.queryRequest.queryString,this.currentQueryFilter={...this.queryRequest.queryFilter}||ui(),this.currentQueryDsl={...this.queryRequest.queryDsl},this.currentQueryFilter.fields&&(this.selectedFields=this.currentQueryFilter.fields);const e=localStorage.getItem("aiSummaryCollapsed");"true"===e&&(this.summaryCollapsed=!0),this.search()}}},pi=mi,vi=(0,d.A)(pi,mt,pt,!1,null,null,null),gi=vi.exports,fi=function(){var e=this,t=e._self._c;return t("ts-search-guide-card",{attrs:{flat:e.flat,"show-tags":!1,"show-data-types":!1,"show-saved-searches":!1},on:{"search-triggered":function(t){return e.$emit("close-dialog")}},scopedSlots:e._u([{key:"header",fn:function(){return[t("div",{staticClass:"pa-4 pb-0"},[t("v-card-title",[t("v-icon",{attrs:{large:"",left:""}},[e._v("mdi-file-search-outline")]),e._v(" Search Examples and Query Guide "),t("v-spacer"),e.flat?t("v-btn",{attrs:{icon:"",title:"Close dialog"},on:{click:function(t){return e.$emit("close-dialog")}}},[t("v-icon",[e._v("mdi-close")])],1):e._e()],1),t("v-card-subtitle",{staticClass:"mt-1"},[e._v(" Find below some examples on how to explore your data. ")]),t("v-divider")],1)]},proxy:!0}])})},yi=[],_i={name:"TsSearchHelpCard",props:{flat:{type:Boolean,default:!1}},components:{TsSearchGuideCard:ei}},bi=_i,Si=(0,d.A)(bi,fi,yi,!1,null,null,null),ki=Si.exports;const wi=()=>({from:0,terminate_after:40,size:40,indices:"_all",order:"asc",chips:[]});var xi={directives:{dragscroll:q.S7},components:{TsSearchHistoryTree:ee,TsSearchHistoryButtons:re,TsSearchDropdown:ye,TsTimelinePicker:Me,TsFilterMenu:je,TsUploadTimelineFormButton:rt,TsAddManualEvent:ht,TsEventList:gi,TsSearchHelpCard:ki},props:["sketchId"],data(){return{countPerIndex:{},countPerTimeline:{},currentItemsPerPage:40,timeFilterMenu:!1,selectedFields:[{field:"message",type:"text"}],showRightSidePanel:!1,addManualEvent:!1,datetimeManualEvent:"",params:{},contextEvent:!1,originalContext:!1,showSearchDropdown:!1,activeQueryRequest:{},currentQueryString:"",currentQueryFilter:wi(),selectedLabels:[],showSearchHistory:!1,showSearchHelp:!1,zoomLevel:.7,zoomOrigin:{x:0,y:0},quickTags:[{tag:"bad",color:"red",textColor:"white",label:"mdi-alert-circle-outline"},{tag:"suspicious",color:"orange",textColor:"white",label:"mdi-help-circle-outline"},{tag:"good",color:"green",textColor:"white",label:"mdi-check-circle-outline"}],showTimelines:!0}},computed:{sketch(){return this.$store.state.sketch},enabledTimelines(){return this.$store.state.enabledTimelines},meta(){return this.$store.state.meta},filterChips:function(){return this.currentQueryFilter.chips.filter(e=>"label"===e.type||"term"===e.type)},timeFilterChips:function(){return this.currentQueryFilter.chips.filter(e=>e.type.startsWith("datetime"))},filteredLabels(){return this.$store.state.meta.filter_labels.filter(e=>!e.label.startsWith("__"))},currentSearchNode(){return this.$store.state.currentSearchNode},activeContext(){return this.$store.state.activeContext},activeTimelines(){let e=[...this.sketch.active_timelines];return e.sort(function(e,t){return e.name.localeCompare(t.name)})}},watch:{enabledTimelines:function(){this.updateEnabledTimelines(this.enabledTimelines)}},methods:{getQuickTag(e){return this.quickTags.find(t=>t.tag===e)},updateCountPerIndex:function(e){this.countPerIndex=e},updateCountPerTimeline:function(e){this.countPerTimeline=e},toggleSearchHistory:function(){this.showSearchHistory=!this.showSearchHistory,this.showSearchHistory&&this.triggerScrollTo()},setQueryAndFilter:function(e){if("Explore"!==this.$route.name&&this.$router.push({name:"Explore",params:{sketchId:this.sketch.id}}),e.queryString&&(this.currentQueryString=e.queryString),e.queryFilter||(e.queryFilter=this.currentQueryFilter),this.currentQueryFilter=e.queryFilter,e.chip){const t=this.currentQueryFilter.chips.find(t=>t.value===e.chip.value);t||this.currentQueryFilter.chips.push(e.chip)}this.currentQueryFilter.size=this.currentItemsPerPage,this.currentQueryFilter.terminate_after=this.currentItemsPerPage,e.doSearch&&(e.incognito?this.search(!0,!0):this.search())},search:function(e=!0,t=!1,s=!1){let i={};i["queryString"]=this.currentQueryString,i["queryFilter"]=this.currentQueryFilter,i["resetPagination"]=e,i["incognito"]=t,i["parent"]=s,this.activeQueryRequest=i,this.showSearchDropdown=!1},searchView:function(e){this.showSearchDropdown=!1,"Explore"!==this.$route.name&&this.$router.push({name:"Explore",params:{sketchId:this.sketch.id}}),e!==parseInt(e,10)&&"string"!==typeof e&&(e=e.id),_.getView(this.sketchId,e).then(e=>{let t=e.data.objects[0];this.currentQueryString=t.query_string,this.currentQueryFilter=JSON.parse(t.query_filter),this.currentQueryFilter.fields&&this.currentQueryFilter.fields.length||(this.currentQueryFilter.fields=[{field:"message",type:"text"}]),this.selectedFields=this.currentQueryFilter.fields;let s=this.currentQueryFilter.chips;if(s)for(let i=0;i<s.length;i++)"label"===s[i].type&&this.selectedLabels.push(s[i].value);this.contextEvent=!1,this.search()}).catch(e=>{})},searchContext:function(e){const t=300,s=500;if(this.contextEvent=e,!this.originalContext){let e=JSON.parse(JSON.stringify(this.currentQueryString)),t=JSON.parse(JSON.stringify(this.currentQueryFilter));this.originalContext={queryString:e,queryFilter:t}}const i="YYYY-MM-DDTHH:mm:ss";let a=this.$moment.utc(this.contextEvent._source.datetime),n=a.clone().subtract(t,"s").format(i),r=a.clone().add(t,"s").format(i),l={field:"",value:n+","+a.format(i),type:"datetime_range",operator:"must",active:!0},o={field:"",value:a.format(i)+","+r,type:"datetime_range",operator:"must",active:!0};this.currentQueryString="* OR _id:"+this.contextEvent._id,this.currentQueryFilter.chips=[l,o];let c=this.meta.indices_metadata[this.contextEvent._index].is_legacy;this.currentQueryFilter.indices=c?[this.contextEvent._index]:[this.contextEvent._source.__ts_timeline_id],this.currentQueryFilter.size=s,this.search()},removeContext:function(){this.contextEvent=!1,this.currentQueryString=JSON.parse(JSON.stringify(this.originalContext.queryString)),this.currentQueryFilter=JSON.parse(JSON.stringify(this.originalContext.queryFilter)),this.search()},updateEnabledTimelines:function(e){this.currentQueryFilter.indices=e,this.search()},toggleChip:function(e){void 0===e.active&&(e.active=!0),e.active=!e.active,this.search()},copyFilterChip(e){let t="";t=e.type.startsWith("datetime")?e.value:"must_not"===e.operator?`NOT ${e.field?`${e.field}:`:""}"${e.value}"`:`${e.field?`${e.field}:`:""}"${e.value}"`,navigator.clipboard.writeText(t).then(()=>{this.infoSnackBar("Copied to clipboard!")}).catch(e=>{this.errorSnackBar("Failed to copy to clipboard."),console.error(e)})},removeChip:function(e,t=!0){let s=this.currentQueryFilter.chips.findIndex(t=>t.value===e.value);this.currentQueryFilter.chips.splice(s,1),"label"===e.type&&(this.selectedLabels=this.selectedLabels.filter(t=>t!==e.value)),t&&this.search()},updateChip:function(e,t){let s=this.currentQueryFilter.chips.findIndex(e=>e.value===t.value&&e.type===t.type);this.currentQueryFilter.chips.splice(s,1,e),this.search()},addChip:function(e){this.currentQueryFilter.chips||(this.currentQueryFilter.chips=[]),this.currentQueryFilter.chips.push(e),this.search()},addChipFromHistogram:function(e){this.currentQueryFilter.chips||(this.currentQueryFilter.chips=[]),this.currentQueryFilter.chips.forEach(e=>{"datetime_range"===e.type&&this.removeChip(e,!1)}),this.addChip(e)},toggleLabelChip:function(e){let t={field:"",value:e,type:"label",operator:"must",active:!0},s=this.currentQueryFilter.chips;if(s)for(let i=0;i<s.length;i++)if(s[i].value===e)return void this.removeChip(i);this.addChip(t)},updateLabelChips:function(){this.currentQueryFilter.chips=this.currentQueryFilter.chips.filter(e=>"label"!==e.type),this.selectedLabels.forEach(e=>{let t={field:"",value:e,type:"label",operator:"must",active:!0};this.addChip(t),this.showSearchDropdown=!1})},updateLabelList:function(e){-1===this.meta.filter_labels.indexOf(e)&&this.meta.filter_labels.push(e)},jumpInHistory:function(e){if(this.currentQueryString=e.query_string,this.currentQueryFilter=JSON.parse(e.query_filter),this.currentQueryFilter.fields&&this.currentQueryFilter.fields.length||(this.currentQueryFilter.fields=[{field:"message",type:"text"}]),this.selectedFields=this.currentQueryFilter.fields,"_all"===this.currentQueryFilter.indices[0]||"_all"===this.currentQueryFilter.indices){let e=[];this.sketch.active_timelines.forEach(t=>{let s=this.meta.indices_metadata[t.searchindex.index_name].is_legacy;s?e.push(t.searchindex.index_name):e.push(t.id)}),this.currentQueryFilter.indices=e}let t=this.currentQueryFilter.chips;if(t)for(let s=0;s<t.length;s++)"label"===t[s].type&&this.selectedLabels.push(t[s].value);this.contextEvent=!1,this.search(!0,!0,e.id)},triggerScrollTo:function(){l.$emit("triggerScrollTo")},zoomWithMouse:function(e){this.zoomOrigin.x=e.pageX,this.zoomOrigin.y=e.pageY,e.deltaY<0?this.zoomLevel+=.07:e.deltaY>0&&(this.zoomLevel-=.07)},closeSearchDropdown:function(e){e!==this.$refs.searchInput&&null===e.getAttribute("data-explore-element")&&(this.showSearchDropdown=!1)},onClickOutside:function(e){"tsSearchInput"!==e.target.id&&(this.showSearchDropdown=!1)},enableAllTimelines(){this.$store.dispatch("updateEnabledTimelines",this.activeTimelines.map(e=>e.id))},disableAllTimelines(){this.$store.dispatch("updateEnabledTimelines",[])}},mounted(){this.$refs.searchInput.focus(),l.$on("setQueryAndFilter",this.setQueryAndFilter),l.$on("setActiveView",this.searchView)},beforeDestroy(){l.$off("setQueryAndFilter"),l.$off("setActiveView")},created:function(){let e=!1;if(this.params={viewId:this.$route.query.view,indexName:this.$route.query.timeline,resultLimit:this.$route.query.limit,queryString:this.$route.query.q},this.params.viewId)this.searchView(this.params.viewId);else{if(this.params.queryString&&(this.currentQueryString=this.params.queryString,e=!0),this.params.indexName){this.params.queryString||(this.currentQueryString="*");let t=this.sketch.active_timelines.find(e=>e.id===parseInt(this.params.indexName,10)),s=this.meta.indices_metadata[t.searchindex.index_name].is_legacy;this.currentQueryFilter.indices=s?[t.searchindex.index_name]:[t.id],e=!0}this.currentQueryString||(this.currentQueryFilter.indices=["_all"]),e&&(this.currentQueryFilter.indices.length||(this.currentQueryFilter.indices=["_all"]),this.search())}}},Ti=xi,Ci=(0,d.A)(Ti,Q,M,!1,null,null,null),Ai=Ci.exports,Di=function(){var e=this,t=e._self._c;return t("div",[t("ts-indicator-dialog",{attrs:{dialog:e.indicatorDialog,index:e.currentIndex,"tag-info":e.tagInfo,ioc:e.indicator},on:{"update:dialog":function(t){e.indicatorDialog=t},"open-dialog":function(t){e.indicatorDialog=!0},"close-dialog":function(t){e.indicatorDialog=!1,e.currentIndex=-1},save:function(t){e.saveIntelligence(t),e.indicatorDialog=!1}}}),t("v-container",{attrs:{fluid:""}},[t("v-btn",{staticClass:"mt-n1 ml-3",attrs:{text:"",color:"primary"},on:{click:e.addIndicator}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-plus")]),e._v(" Add Indicator ")],1),t("v-card",{staticClass:"mt-3 mx-3",attrs:{outlined:""}},[t("v-data-table",{attrs:{headers:e.headers,items:e.intelligenceData,"footer-props":{"items-per-page-options":[10,40,80,100,200,500],"show-current-page":!0},"items-per-page":40,selectable:""},scopedSlots:e._u([{key:"item.search",fn:function({item:s}){return[t("v-btn",{attrs:{icon:"",small:""},on:{click:function(t){return e.generateSearchQuery(s.ioc)}}},[t("v-icon",{attrs:{title:"Search this indicator",small:""}},[e._v("mdi-magnify")])],1)]}},{key:"item.externalURI",fn:function({item:s}){return[s.externalURI?t("v-icon",{attrs:{title:"Open link","x-small":""}},[e._v("mdi-open-in-new")]):e._e(),e.getValidUrl(s.externalURI)?t("a",{staticStyle:{"text-decoration":"none"},attrs:{href:e.getValidUrl(s.externalURI),target:"_blank"}},[e._v(" "+e._s(e.getValidUrl(s.externalURI).host))]):e._e()]}},{key:"item.type",fn:function({item:t}){return[e._v(" "+e._s(e.getIocTypeMetadata(t).humanReadable)+" ")]}},{key:"item.tags",fn:function({item:s}){return[t("v-chip-group",e._l(e.augmentedTags(s.tags).sort((e,t)=>t.weight-e.weight),function(s){return t("v-chip",{key:s.name,attrs:{small:"",color:s.color,"text-color":s.textColor,outlined:"outlined"===s.style},on:{click:function(t){return e.searchForIOC(s)}}},[e._v(" "+e._s(s.name)+" ")])}),1)]}},{key:"item.actions",fn:function({item:s}){return[t("v-btn",{attrs:{small:"",icon:""},on:{click:function(t){return e.editIndicator(s.index)}}},[t("v-icon",{attrs:{small:"",title:"Edit indicator"}},[e._v("mdi-pencil")])],1),t("v-btn",{attrs:{small:"",icon:""},on:{click:function(t){return e.deleteIndicator(s.index)}}},[t("v-icon",{attrs:{small:"",title:"Delete indicator"}},[e._v("mdi-trash-can-outline")])],1)]}}])})],1)],1)],1)},$i=[],Li=function(){var e=this,t=e._self._c;return t("v-dialog",{attrs:{value:e.dialog,"max-width":"600px"},on:{input:function(t){return e.$emit("input",t)},"click:outside":function(t){return e.closeDialog()}}},[t("v-card",{staticClass:"pa-4"},[t("h3",[e._v(e._s(e.title))]),t("br"),t("v-text-field",{attrs:{outlined:"",label:"Indicator data"},on:{input:function(t){return e.autoSelectIndicatorType(t)}},model:{value:e.newIndicator.ioc,callback:function(t){e.$set(e.newIndicator,"ioc",t)},expression:"newIndicator.ioc"}}),t("v-select",{attrs:{outlined:"",label:"Indicator type",items:e.indicatorTypes},model:{value:e.newIndicator.type,callback:function(t){e.$set(e.newIndicator,"type",t)},expression:"newIndicator.type"}}),t("v-combobox",{attrs:{items:Object.keys(this.tagInfo),label:"Add tags.. (optional)",outlined:"",chips:"","small-chips":"",multiple:""},model:{value:e.newIndicator.tags,callback:function(t){e.$set(e.newIndicator,"tags",t)},expression:"newIndicator.tags"}}),t("v-text-field",{attrs:{outlined:"",label:"External reference (optional)"},model:{value:e.newIndicator.externalURI,callback:function(t){e.$set(e.newIndicator,"externalURI",t)},expression:"newIndicator.externalURI"}}),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:""},on:{click:function(t){return e.closeDialog()}}},[e._v(" Cancel ")]),t("v-btn",{attrs:{text:"",color:"primary",disabled:!e.newIndicator.ioc},on:{click:e.saveIndicator}},[e._v(" Save ")])],1)],1)],1)},Ii=[];const Ei=[{regex:/^(\/[\S]+)+$/i,type:"fs_path",humanReadable:"Filesystem path"},{regex:/^([-\w]+\.)+[a-z]{2,}$/i,type:"hostname",humanReadable:"Hostname"},{regex:/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/g,type:"ipv4"},{regex:/^[0-9a-f]{64}$/i,type:"hash_sha256",humanReadable:"SHA256"},{regex:/^[0-9a-f]{40}$/i,type:"hash_sha1",humanReadable:"SHA1"},{regex:/^[0-9a-f]{32}$/i,type:"hash_md5",humanReadable:"MD5"},{regex:/./g,type:"other",humanReadable:"Other"}],Ni=()=>({ioc:"",type:"other",externalURI:"",tags:[]});var zi={props:["dialog","tagInfo","index","ioc"],data(){return{IOCTypes:Ei,newIndicator:Ni()}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},intelligenceAttribute(){return void 0===this.meta.attributes.intelligence?{ontology:"intelligence",value:{data:[]},name:"intelligence"}:this.meta.attributes.intelligence},indicatorTypes(){return this.IOCTypes.map(e=>e.type)},title(){return this.index<0?"Create new indicator":"Edit indicator"}},methods:{closeDialog:function(){this.index<0&&(this.newIndicator.ioc=""),this.$emit("close-dialog")},autoSelectIndicatorType:function(e){for(const t of this.IOCTypes)if(t.regex.test(e))return void(this.newIndicator.type=t.type)},saveIndicator:function(){this.$emit("save",this.newIndicator),this.newIndicator=Ni()}},watch:{index(){this.index<0?this.newIndicator=Ni():this.newIndicator=this.intelligenceAttribute.value.data[this.index]},ioc(){""!==this.ioc&&(this.newIndicator.ioc=this.ioc,this.autoSelectIndicatorType(this.ioc))}}},Fi=zi,Ri=(0,d.A)(Fi,Li,Ii,!1,null,"303f7a96",null),Pi=Ri.exports;const Oi=()=>({from:0,terminate_after:40,size:40,indices:"_all",order:"asc",chips:[]});var Qi={props:[],components:{TsIndicatorDialog:Pi},data:function(){return{headers:[{text:"",value:"search",align:"start"},{text:"Indicator data",value:"ioc"},{text:"Indicator type",value:"type"},{text:"Tags",value:"tags"},{text:"External reference",value:"externalURI"},{text:"",value:"actions"}],tagInfo:{},indicatorDialog:!1,currentIndex:-1,indicator:"",tagMetadata:{default:{weight:0,type:"default"}},tagColorDefinitions:{danger:{color:"red",textColor:"white"},warning:{color:"orange",textColor:"white"},legit:{color:"green",textColor:"white"},default:{color:"default",textColor:null},info:{color:"blue",textColor:null,style:"outlined"}}}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},intelligenceAttribute(){return void 0===this.meta.attributes.intelligence?{ontology:"intelligence",value:{data:[]},name:"intelligence"}:this.meta.attributes.intelligence},intelligenceData(){return this.intelligenceAttribute.value.data.map((e,t)=>({...e,index:t}))}},methods:{addIndicator(){this.indicatorDialog=!0},loadTagMetadata(){_.getTagMetadata().then(e=>{this.tagMetadata=e.data})},metadataForTag(e){let t=this.tagMetadata["default"];if(this.tagMetadata[e])t=this.tagMetadata[e];else for(var s in this.tagMetadata["regexes"])e.match(s)&&(t=this.tagMetadata["regexes"][s]);return{...this.tagColorDefinitions[t.type],name:e,weight:t.weight}},augmentedTags(e){return e.map(e=>this.metadataForTag(e))},getIocTypeMetadata(e){let t=Ei.find(t=>t.type===e.type);return void 0!==t?t:Ei.find(e=>"other"===e.type)},deleteIndicator(e){confirm("Delete indicator?")&&(this.intelligenceAttribute.value.data.splice(e,1),_.addSketchAttribute(this.sketch.id,"intelligence",this.intelligenceAttribute.value,"intelligence").then(()=>{this.successSnackBar("Indicator deleted"),this.buildTagInfo()}).catch(e=>{this.errorSnackBar("Failed to save indicator"),console.error(e)}))},editIndicator(e){this.currentIndex=e,this.indicatorDialog=!0},getValidUrl(e){return void 0!==e&&null!==e&&""!==e&&(e.startsWith("http")?new URL(e):!!e.includes("/")&&new URL("http://"+e))},buildTagInfo(){for(var e of(this.tagInfo={},this.intelligenceData))for(var t of e.tags){var s=null;s="object"===typeof t?t.name:t,this.tagInfo[s]||(this.tagInfo[s]={iocs:[]}),this.tagInfo[s].iocs.push(e.ioc)}},generateSearchQuery(e,t){let s=`"${e}"`;s=s.replace(/[\\\s]/g,"\\$&"),void 0!==t&&(s=`${t}:${s}`);let i={doSearch:!0};i.queryString=s,i.queryFilter=Oi(),l.$emit("setQueryAndFilter",i)},searchForIOC(e){let t=this.tagInfo[e]||{},s=t.iocs.map(e=>`"${e}"`).reduce((e,t)=>`${e} OR ${t}`),i={doSearch:!0};i.queryString=s,i.queryFilter=Oi(),l.$emit("setQueryAndFilter",i)},saveIntelligence(e){this.currentIndex<0&&this.intelligenceAttribute.value.data.push(e),_.addSketchAttribute(this.sketch.id,"intelligence",this.intelligenceAttribute.value,"intelligence").then(()=>{this.successSnackBar("Indicator saved"),this.buildTagInfo()}).catch(e=>{this.errorSnackBar("Failed to save indicator"),console.error(e)})},showIndicatorDialog(e){this.indicator=e,this.indicatorDialog=!0}},mounted(){l.$on("addIndicator",this.showIndicatorDialog),this.buildTagInfo(),this.loadTagMetadata()},beforeDestroy(){l.$off("addIndicator")}},Mi=Qi,qi=(0,d.A)(Mi,Di,$i,!1,null,null,null),Bi=qi.exports,Vi=function(){var e=this,t=e._self._c;return t("v-container",{attrs:{fluid:""}},[t("v-card",{staticClass:"mx-3",attrs:{flat:""}},[t("ts-sigma-editor",{attrs:{"rule-id":e.ruleId}})],1)],1)},Hi=[],Gi=function(){var e=this,t=e._self._c;return t("div",[t("v-toolbar",{staticClass:"mt-n3 ml-n4",attrs:{dense:"",flat:"",color:"transparent"}},[e.editingRule.title?t("v-toolbar-title",[e._v(" "+e._s(e.editingRule.title))]):t("v-toolbar-title",[e._v(" Create new rule")])],1),e.ruleId?e._e():t("v-autocomplete",{staticClass:"mb-4 mt-2",staticStyle:{width:"300px"},attrs:{align:"left",dense:"",outlined:"","hide-details":"",items:e.SigmaTemplates,"item-text":"title",label:"Choose template"},on:{change:e.selectTemplate}}),e.editingRule.search_query?t("div",[!e.isParsingSuccesful&&e.status_text?t("v-alert",{attrs:{type:"error",outlined:"",dense:""}},[e._v(" "+e._s(e.status_text)+" ")]):t("v-alert",{attrs:{type:"success",outlined:"",dense:""}},[e._v(" Preview: "),t("span",{staticStyle:{"font-family":"monospace"}},[e._v(e._s(e.editingRule.search_query))])])],1):e._e(),t("v-card",{attrs:{outlined:""}},[t("v-textarea",{staticClass:"editSigmaRule",attrs:{solo:"",flat:"","hide-details":"",rows:"25",autofocus:"",placeholder:"Get started by choosing a template above..",color:this.isParsingSuccesful?"success":"error"},on:{input:function(t){return e.parseSigma(e.ruleYamlTextArea)}},model:{value:e.ruleYamlTextArea,callback:function(t){e.ruleYamlTextArea=t},expression:"ruleYamlTextArea"}}),t("v-divider"),t("v-card-actions",[t("v-btn",{attrs:{disabled:!e.isParsingSuccesful,text:"",color:"primary"},on:{click:function(t){return e.saveRule()}}},[e._v(" Save ")]),t("v-btn",{staticStyle:{"margin-left":"10px"},attrs:{text:"",to:{name:"Explore"}}},[e._v(" Cancel ")])],1)],1)],1)},Ui=[];try{var Wi=crypto.randomUUID()}catch(du){console.log("crypto.randomUUID() not supported, using a fixed value instead"),Wi="10a4fb8c-29d5-4eb6-905f-13d6a553d470"}const ji=`title: SigmaRuleTemplateTitle\nid: ${Wi}\ndescription: Detects suspicious activity\nreferences:\n  - https://\nauthor: Timesketch\ndate: ${new Date(Date.now()).toLocaleString("en-ZA").split(",")[0]}\nmodified: ${new Date(Date.now()).toLocaleString("en-ZA").split(",")[0]}\nstatus: experimental\nfalsepositives: unknown\nlevel: informational\ntags:\n    - attack.defense_evasion`,Yi="falsepositives:\n    - Unknown\nstatus: experimental\nlevel: medium\ndetection:\n    keywords:\n        - '*foobar*'\n    condition: keywords",Xi=`${ji}\nlogsource:\n    product: aws\n    service: cloudtrail\n${Yi}\n`,Ji=`${ji}\nlogsource:\n    product: azure\n    service: activitylogs\n${Yi}\n`,Ki=`${ji}\nlogsource:\n    product: azure\n    service: signinlogs\n${Yi}\n`,Zi=`${ji}\nlogsource:\n    product: gcp\n    service: gcp.audit\n${Yi}\n`,ea=`${ji}\nlogsource:\n    product: google_workspace\n    service: google_workspace.admin\n${Yi}\n`,ta=`${ji}\nlogsource:\n    product: m365\n    service: threat_management\n${Yi}\n`,sa=`${ji}\nlogsource:\n    product: okta\n    service: okta\n${Yi}\n`,ia=`${ji}\nlogsource:\n    category: file_create\n    product: linux\n${Yi}\n`,aa=`${ji}\nlogsource:\n    category: network_connection\n    product: linux\n${Yi}\n`,na=`${ji}\nlogsource:\n    category: process_creation\n    product: linux\n${Yi}\n`,ra=`${ji}\nlogsource:\n    product: linux\n${Yi}\n`,la=`${ji}\nlogsource:\n    category: auditd\n    product: linux\n${Yi}\n`,oa=`${ji}\nlogsource:\n    category: clamav\n    product: linux\n${Yi}\n`,ca=`${ji}\nlogsource:\n    category: cron\n    product: linux\n${Yi}\n`,da=`${ji}\nlogsource:\n    category: guacamole\n    product: linux\n${Yi}\n`,ua=`${ji}\nlogsource:\n    category: modsecurity\n    product: linux\n${Yi}\n`,ha=`${ji}\nlogsource:\n    category: sudo\n    product: linux\n${Yi}\n`,ma=`${ji}\nlogsource:\n    category: sshd\n    product: linux\n${Yi}\n`,pa=`${ji}\nlogsource:\n    category: syslog\n    product: linux\n${Yi}\n`,va=`${ji}\nlogsource:\n    category: vsftpd\n    product: linux\n${Yi}\n`,ga=`${ji}\nlogsource:\n    category: file_event\n    product: macos\n${Yi}\n`,fa=`${ji}\nlogsource:\n    category: process_creation\n    product: macos\n${Yi}\n`,ya=`${ji}\nlogsource:\n    category: clipboard_capture\n    product: windows\n${Yi}\n`,_a=`${ji}\nlogsource:\n    category: create_remote_thread\n    product: windows\n${Yi}\n`,ba=`${ji}\nlogsource:\n    category: create_stream_hash\n    product: windows\n${Yi}\n`,Sa=`${ji}\nlogsource:\n    category: dns_query\n    product: windows\n${Yi}\n`,ka=`${ji}\nlogsource:\n    category: driver_load\n    product: windows\n${Yi}\n`,wa=`${ji}\nlogsource:\n    category: file_change\n    product: windows\n${Yi}\n`,xa=`${ji}\nlogsource:\n    category: file_delete\n    product: windows\n${Yi}\n`,Ta=`${ji}\nlogsource:\n    category: file_event\n    product: windows\n${Yi}\n`,Ca=`${ji}\nlogsource:\n    category: image_load\n    product: windows\n${Yi}\n`,Aa=`${ji}\nlogsource:\n    category: network_connection\n    product: windows\n${Yi}\n`,Da=`${ji}\nlogsource:\n    category: pipe_created\n    product: windows\n${Yi}\n`,$a=`${ji}\nlogsource:\n    category: process_access\n    product: windows\n${Yi}\n`,La=`${ji}\nlogsource:\n    category: process_creation\n    product: windows\n${Yi}\n`,Ia=`${ji}\nlogsource:\n    category: process_tampering\n    product: windows\n${Yi}\n`,Ea=`${ji}\nlogsource:\n    category: process_termination\n    product: windows\n${Yi}\n`,Na=`${ji}\nlogsource:\n    category: ps_classic_provider_start\n    product: windows\n${Yi}\n`,za=`${ji}\nlogsource:\n    category: ps_classic_script\n    product: windows\n${Yi}\n`,Fa=`${ji}\nlogsource:\n    category: ps_classic_start\n    product: windows\n${Yi}\n`,Ra=`${ji}\nlogsource:\n    category: ps_module\n    product: windows\n${Yi}\n`,Pa=`${ji}\nlogsource:\n    category: ps_script\n    product: windows\n${Yi}\n`,Oa=`${ji}\nlogsource:\n    category: raw_access_thread\n    product: windows\n${Yi}\n`,Qa=`${ji}\nlogsource:\n    category: registry_add\n    product: windows\n${Yi}\n`,Ma=`${ji}\nlogsource:\n    category: registry_delete\n    product: windows\n${Yi}\n`,qa=`${ji}\nlogsource:\n    category: registry_event\n    product: windows\n${Yi}\n`,Ba=`${ji}\nlogsource:\n    category: registry_rename\n    product: windows\n${Yi}\n`,Va=`${ji}\nlogsource:\n    category: registry_set\n    product: windows\n${Yi}\n`,Ha=`${ji}\nlogsource:\n    category: sysmon_error\n    product: windows\n${Yi}\n`,Ga=`${ji}\nlogsource:\n    category: sysmon_status\n    product: windows\n${Yi}\n`,Ua=`${ji}\nlogsource:\n    category: wmi_event\n    product: windows\n${Yi}\n`,Wa=`${ji}\nlogsource:\n    service: application\n    product: windows\n${Yi}\n`,ja=`${ji}\nlogsource:\n    service: applocker\n    product: windows\n${Yi}\n`,Ya=`${ji}\nlogsource:\n    service: bits-client\n    product: windows\n${Yi}\n`,Xa=`${ji}\nlogsource:\n    service: codeintegrity-operational\n    product: windows\n${Yi}\n`,Ja=`${ji}\nlogsource:\n    service: dhcp\n    product: windows\n${Yi}\n`,Ka=`${ji}\nlogsource:\n    service:  dns-server\n    product: windows\n${Yi}\n`,Za=`${ji}\nlogsource:\n    service: driver-framework\n    product: windows\n${Yi}\n`,en=`${ji}\nlogsource:\n    service: firewall-as\n    product: windows\n${Yi}\n`,tn=`${ji}\nlogsource:\n    service:  ldap_debug\n    product: windows\n${Yi}\n`,sn=`${ji}\nlogsource:\n    service: microsoft-servicebus-client\n    product: windows\n${Yi}\n`,an=`${ji}\nlogsource:\n    service: msexchange-management\n    product: windows\n${Yi}\n`,nn=`${ji}\nlogsource:\n    service: ntlm\n    product: windows\n${Yi}\n`,rn=`${ji}\nlogsource:\n    service: powershell\n    product: windows\n${Yi}\n`,ln=`${ji}\nlogsource:\n    service: powershell-classic\n    product: windows\n${Yi}\n`,on=`${ji}\nlogsource:\n    service: printservice-admin\n    product: windows\n${Yi}\n`,cn=`${ji}\nlogsource:\n    service: printservice-operational\n    product: windows\n${Yi}\n`,dn=`${ji}\nlogsource:\n    service: security\n    product: windows\n${Yi}\n`,un=`${ji}\nlogsource:\n    service: security-mitigations\n    product: windows\n${Yi}\n`,hn=`${ji}\nlogsource:\n    service: smbclient-security\n    product: windows\n${Yi}\n`,mn=`${ji}\nlogsource:\n    service: sysmon\n    product: windows\n${Yi}\n`,pn=`${ji}\nlogsource:\n    service: system\n    product: windows\n${Yi}\n`,vn=`${ji}\nlogsource:\n    service: taskscheduler\n    product: windows\n${Yi}\n`,gn=`${ji}\nlogsource:\n    service: terminalservices\n    product: windows\n${Yi}\n`,fn=`${ji}\nlogsource:\n    service: windefend\n    product: windows\n${Yi}\n`,yn=`${ji}\nlogsource:\n    service: wmi\n    product: windows\n${Yi}\n`,_n=`${ji}\n${Yi}\n`,bn=[{os:"General",title:"Default template",text:_n},{os:"Cloud",title:"Cloud: AWS",text:Xi},{os:"Cloud",title:"Cloud: Azure_activitylogs",text:Ji},{os:"Cloud",title:"Cloud: Azure_signinlogs",text:Ki},{os:"Cloud",title:"Cloud: GCP Audit logs",text:Zi},{os:"Cloud",title:"Cloud: GWorkspace",text:ea},{os:"Cloud",title:"Cloud: Microsoft 365",text:ta},{os:"Cloud",title:"Cloud: Okta",text:sa},{os:"Linux",title:"Linux: File create",text:ia},{os:"Linux",title:"Linux: Network connection",text:aa},{os:"Linux",title:"Linux: Process creation",text:na},{os:"Linux",title:"Linux: Any logs",text:ra},{os:"Linux",title:"Linux: AuditD",text:la},{os:"Linux",title:"Linux: ClamAV",text:oa},{os:"Linux",title:"Linux: CRON",text:ca},{os:"Linux",title:"Linux: Guacamole",text:da},{os:"Linux",title:"Linux: Modseurity",text:ua},{os:"Linux",title:"Linux: sudo",text:ha},{os:"Linux",title:"Linux: sshd",text:ma},{os:"Linux",title:"Linux: syslog",text:pa},{os:"Linux",title:"Linux: VSFTPD",text:va},{os:"MacOS",title:"MacOS: file_event",text:ga},{os:"MacOS",title:"MacOS: process_creation",text:fa},{os:"Windows",title:"Windows: clipboard_capture",text:ya},{os:"Windows",title:"Windows: create_remote_thread",text:_a},{os:"Windows",title:"Windows: create_stream_hash",text:ba},{os:"Windows",title:"Windows: dns_query",text:Sa},{os:"Windows",title:"Windows: driver_load",text:ka},{os:"Windows",title:"Windows: file_change",text:wa},{os:"Windows",title:"Windows: file_delete",text:xa},{os:"Windows",title:"Windows: file_event",text:Ta},{os:"Windows",title:"Windows: image_load",text:Ca},{os:"Windows",title:"Windows: network_connection",text:Aa},{os:"Windows",title:"Windows: pipe_created",text:Da},{os:"Windows",title:"Windows: process_access",text:$a},{os:"Windows",title:"Windows: process_creation",text:La},{os:"Windows",title:"Windows: process_tampering",text:Ia},{os:"Windows",title:"Windows: process_termination",text:Ea},{os:"Windows",title:"Windows: ps_classic_provider_start",text:Na},{os:"Windows",title:"Windows: ps_classic_script",text:za},{os:"Windows",title:"Windows: ps_classic_start",text:Fa},{os:"Windows",title:"Windows: ps_module",text:Ra},{os:"Windows",title:"Windows: ps_script",text:Pa},{os:"Windows",title:"Windows: raw_access_thread",text:Oa},{os:"Windows",title:"Windows: registry_add",text:Qa},{os:"Windows",title:"Windows: registry_delete",text:Ma},{os:"Windows",title:"Windows: registry_event",text:qa},{os:"Windows",title:"Windows: registry_rename",text:Ba},{os:"Windows",title:"Windows: registry_set",text:Va},{os:"Windows",title:"Windows: sysmon_error",text:Ha},{os:"Windows",title:"Windows: sysmon_status",text:Ga},{os:"Windows",title:"Windows: wmi_event",text:Ua},{os:"Windows",title:"Windows: application",text:Wa},{os:"Windows",title:"Windows: applocker",text:ja},{os:"Windows",title:"Windows: bits-client",text:Ya},{os:"Windows",title:"Windows: codeintegrity-operational",text:Xa},{os:"Windows",title:"Windows: dhcp",text:Ja},{os:"Windows",title:"Windows: dns-server",text:Ka},{os:"Windows",title:"Windows: driver-framework",text:Za},{os:"Windows",title:"Windows: firewall-as",text:en},{os:"Windows",title:"Windows: ldap_debug",text:tn},{os:"Windows",title:"Windows: microsoft-servicebus-client",text:sn},{os:"Windows",title:"Windows: msexchange-management",text:an},{os:"Windows",title:"Windows: ntlm",text:nn},{os:"Windows",title:"Windows: powershell",text:rn},{os:"Windows",title:"Windows: powershell-classic",text:ln},{os:"Windows",title:"Windows: printservice-admin",text:on},{os:"Windows",title:"Windows: printservice-operational",text:cn},{os:"Windows",title:"Windows: security",text:dn},{os:"Windows",title:"Windows: security-mitigations",text:un},{os:"Windows",title:"Windows: smbclient-security",text:hn},{os:"Windows",title:"Windows: sysmon",text:mn},{os:"Windows",title:"Windows: system",text:pn},{os:"Windows",title:"Windows: taskscheduler",text:vn},{os:"Windows",title:"Windows: terminalservices",text:gn},{os:"Windows",title:"Windows: windefend",text:fn},{os:"Windows",title:"Windows: wmi",text:yn}];var Sn={props:{ruleId:{type:String,default:null}},data(){return{editingRule:{},status_text:"",ruleYamlTextArea:"",SigmaTemplates:bn,search:"",isParsingSuccesful:!1}},methods:{selectTemplate(e){var t=this.SigmaTemplates.find(t=>t.title===e);this.ruleYamlTextArea=t.text,this.parseSigma(t.text)},parseSigma:Ce().debounce(function(e){e?_.getSigmaRuleByText(e).then(e=>{var t=e.data.objects[0];t.tags.length>0&&null==t.tags[0]?(this.status_text="Please specify at least one tag if you use the tags field",this.isParsingSuccesful=!1):t.author?(this.editingRule=t,this.isParsingSuccesful=!0,this.status_text=""):(this.status_text="No author specified",this.isParsingSuccesful=!1)}).catch(e=>{this.status_text=e.response.data.message,this.isParsingSuccesful=!1}):this.editingRule.search_query=""},300),getRuleByUUID(e){e&&_.getSigmaRuleResource(e).then(e=>{this.editingRule=e.data.objects[0],this.ruleYamlTextArea=this.editingRule.rule_yaml,this.isParsingSuccesful=!0}).catch(e=>{console.error(e),this.isParsingSuccesful=!1,this.ruleYamlTextArea=_n,this.parseSigma(this.ruleYamlTextArea)})},deleteRule(e){confirm("Delete Rule?")&&_.deleteSigmaRule(e).then(e=>{this.$store.dispatch("updateSigmaList"),this.successSnackBar("Rule deleted!")}).catch(t=>{this.errorSnackBar("Error deleting rule: "+e),console.error(t)})},saveRule:function(){this.ruleId?_.updateSigmaRule(this.editingRule.id,this.ruleYamlTextArea).then(()=>{this.$store.dispatch("updateSigmaList"),this.successSnackBar("Rule updated: "+this.editingRule.title)}).catch(e=>{this.errorSnackBar("Error updating rule: "+this.editingRule.title),console.error(e)}):_.createSigmaRule(this.ruleYamlTextArea).then(()=>{this.$store.dispatch("updateSigmaList"),this.successSnackBar("Rule created: "+this.editingRule.title)}).catch(e=>{this.errorSnackBar("Error creating rule: "+this.editingRule.title),console.error(e)})}},mounted(){this.ruleId&&this.getRuleByUUID(this.ruleId)},watch:{ruleId:function(e){e&&this.getRuleByUUID(e)}}},kn=Sn,wn=(0,d.A)(kn,Gi,Ui,!1,null,"9d5365e0",null),xn=wn.exports,Tn={props:["ruleId"],components:{TsSigmaEditor:xn}},Cn=Tn,An=(0,d.A)(Cn,Vi,Hi,!1,null,null,null),Dn=An.exports,$n=function(){var e=this,t=e._self._c;return t("v-container",{attrs:{fluid:""}},[t("div",{ref:"graphContainer"},[e.currentGraphPlugin||e.currentSavedGraph?t("ts-cytoscape",{attrs:{"graph-plugin-name":e.currentGraphPlugin,"saved-graph-id":e.currentSavedGraph,"canvas-height":"70vh"}}):e._e()],1)])},Ln=[],In=function(){var e=this,t=e._self._c;return t("v-container",{attrs:{fluid:""}},[t("v-card",{staticClass:"pt-0 mt-n6",attrs:{flat:"",color:"transparent"}},[t("v-card",{staticClass:"d-flex align-start mb-1",attrs:{outlined:""}},[t("v-text-field",{staticClass:"pa-2",attrs:{placeholder:"Filter nodes and edges",label:"Filter nodes and edges","append-icon":"mdi-magnify","hide-details":"","single-line":"",dense:"",flat:"",solo:""},on:{input:e.filterGraphByInput},model:{value:e.filterString,callback:function(t){e.filterString=t},expression:"filterString"}})],1),t("v-toolbar",{attrs:{dense:"",flat:"",color:"transparent"}},[t("div",[t("span",{staticClass:"mr-2"},[t("small",[e._v(e._s(e.nodes.length)+" nodes and "+e._s(e.edges.length)+" edges")])]),t("v-btn",{attrs:{icon:"",disabled:!e.edgeQuery},on:{click:function(t){e.saveGraphDialog=!0}}},[t("v-icon",{attrs:{title:"Save selected graph"}},[e._v("mdi-content-save-outline")])],1),t("v-dialog",{attrs:{width:"500"},model:{value:e.saveGraphDialog,callback:function(t){e.saveGraphDialog=t},expression:"saveGraphDialog"}},[t("v-card",{staticClass:"pa-4"},[t("h3",[e._v("Save selected elements")]),t("br"),t("v-text-field",{attrs:{required:"",placeholder:"Name your graph",outlined:"",dense:"",autofocus:""},on:{focus:function(e){return e.target.select()}},model:{value:e.saveAsName,callback:function(t){e.saveAsName=t},expression:"saveAsName"}}),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:""},on:{click:function(t){e.saveGraphDialog=!1}}},[e._v(" Cancel ")]),t("v-btn",{attrs:{color:"primary",depressed:"",disabled:!e.saveAsName},on:{click:e.saveGraph}},[e._v(" Save ")])],1)],1)],1),t("v-btn",{attrs:{icon:"",disabled:!e.currentGraph},on:{click:function(t){return e.resizeCanvas()}}},[t("v-icon",{attrs:{title:"Fit to canvas"}},[e._v("mdi-fit-to-page-outline")])],1),t("v-menu",{attrs:{"offset-y":"","close-on-content-click":!1,"close-on-click":!0,"content-class":"menu-with-gap"},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-btn",e._g(e._b({attrs:{icon:"",disabled:!e.currentGraph||!e.graphPluginName}},"v-btn",i,!1),s),[t("v-icon",{attrs:{title:"Graph settings"}},[e._v("mdi-cog-outline")])],1)]}}])},[t("v-card",{staticClass:"pa-4 pt-5",attrs:{width:"600"}},[t("h5",[e._v("Layout type")]),t("v-radio-group",{attrs:{row:""},model:{value:e.layoutName,callback:function(t){e.layoutName=t},expression:"layoutName"}},e._l(e.layouts,function(s){return t("v-radio",{key:s,attrs:{label:s,value:s},on:{click:function(t){return e.buildGraph(e.currentGraph)}}})}),1),t("h5",[e._v("Edge style")]),t("v-radio-group",{attrs:{row:""},model:{value:e.edgeStyle,callback:function(t){e.edgeStyle=t},expression:"edgeStyle"}},e._l(e.edgeStyles,function(s){return t("v-radio",{key:s,attrs:{label:s,value:s},on:{click:function(t){return e.buildGraph(e.currentGraph)}}})}),1),t("h5",[e._v("Transparency for unselected elements")]),t("v-slider",{attrs:{max:100,min:0,"thumb-label":""},on:{change:e.changeOpacity},scopedSlots:e._u([{key:"thumb-label",fn:function({value:t}){return[e._v(" "+e._s(t)+"% ")]}}]),model:{value:e.fadeOpacity,callback:function(t){e.fadeOpacity=t},expression:"fadeOpacity"}})],1)],1)],1),t("v-spacer"),Object.keys(e.currentGraphCache).length?t("div",[t("i",[t("small",[e._v("Generated "+e._s(e._f("timeSince")(e.currentGraphCache.updated_at)))])]),t("v-btn",{staticClass:"ml-1",attrs:{icon:"",title:"Refresh graph",disabled:!e.currentGraph},on:{click:function(t){return e.buildGraph({name:e.currentGraph},!0)}}},[t("v-icon",{attrs:{title:"Refresh graph"}},[e._v("mdi-refresh")])],1)],1):e._e()],1)],1),e.isLoading?t("div",{staticClass:"pa-4"},[t("v-progress-linear",{attrs:{indeterminate:"",color:"primary"}})],1):e._e(),e.elements.length||e.isLoading?e._e():t("v-card",{staticClass:"pa-4",attrs:{flat:""}},[e._v(" No data to generate graph ")]),t("div",{ref:"graphContainer",style:{height:e.canvasHeight}},[t("div",{ref:"cy",style:{"min-height":e.canvasHeight},attrs:{width:"100%"}})]),t("v-bottom-sheet",{attrs:{"hide-overlay":"",persistent:"","no-click-animation":"",scrollable:""},model:{value:e.showTimelineView,callback:function(t){e.showTimelineView=t},expression:"showTimelineView"}},[t("v-card",[t("v-toolbar",{attrs:{dense:"",flat:""}},[t("strong",[e._v("Timeline for "+e._s(e.selectedEdgesCount)+" selected edge(s)")]),t("v-spacer"),t("v-btn",{attrs:{icon:"",disabled:e.timelineViewHeight>40},on:{click:function(t){return e.increaseTimelineViewHeight()}}},[t("v-icon",{attrs:{title:"enlarge"}},[e._v("mdi-chevron-up")])],1),t("v-btn",{attrs:{icon:"",disabled:0===e.timelineViewHeight},on:{click:function(t){return e.decreaseTimelineViewHeight()}}},[t("v-icon",{attrs:{title:"condense"}},[e._v("mdi-chevron-down")])],1),t("v-btn",{attrs:{icon:""},on:{click:function(t){e.showTimelineView=!1}}},[t("v-icon",{attrs:{title:"close"}},[e._v("mdi-close")])],1)],1),t("v-divider"),t("v-expand-transition",[t("v-card-text",{directives:[{name:"show",rawName:"v-show",value:!e.minimizeTimelineView,expression:"!minimizeTimelineView"}],style:{height:e.timelineViewHeight+"vh"}},[t("ts-event-list",{attrs:{"query-request":e.queryRequest,"items-per-page":e.maxEvents,"disable-save-search":""}})],1)],1)],1)],1)],1)},En=[],Nn=s(7595),zn=s.n(Nn);Zt.A.use(zn()),Zt.A.use(ts());var Fn={props:{graphPluginName:{type:String,default:null},savedGraphId:{type:Number,default:null},canvasHeight:{type:String,default:"85vh"},disableZoom:{type:Boolean,default:!1}},components:{TsEventList:gi},data:function(){return{saveGraphDialog:!1,showTimelineView:!1,timelineViewHeight:40,minimizeTimelineView:!1,isLoading:!1,filterString:"",graphs:{},currentGraph:"",currentGraphCache:{},currentGraphCacheConfig:{},fadeOpacity:7,elements:[],selectedEdgesCount:0,edgeQuery:"",maxEvents:40,queryFilter:{from:0,terminate_after:40,size:this.maxEvents,indices:["_all"],order:"asc",chips:[]},saveAsName:"",layouts:["spread","dagre","circle","concentric","breadthfirst"],layoutName:"spread",edgeStyles:["bezier","taxi"],edgeStyle:"bezier",config:{style:[{selector:"node",style:{shape:"roundrectangle",width:"label",height:"label","compound-sizing-wrt-labels":"include","text-halign":"center","text-valign":"center",color:"#FFFFFF","font-size":"10","font-weight":"bold","text-outline-width":"0px",padding:"7px","background-color":"gray","text-outline-color":"gray","text-wrap":"wrap","text-max-width":"12em",label:"data(label)"}},{selector:"node:selected",style:{"overlay-color":"black","overlay-opacity":"0.3","overlay-padding":"7px"}},{selector:"node[type = 'user']",style:{"background-color":"#FF756E","text-outline-color":"#FF756E"}},{selector:"node[type = 'computer']",style:{"background-color":"#6992f3","text-outline-color":"#ffffff"}},{selector:"node[type = 'file']",style:{"background-color":"#82b578","text-outline-color":"#2b2b2b"}},{selector:"node[type = 'winservice']",style:{"background-color":"#9d8f35","text-outline-color":"#2b2b2b"}},{selector:"edge",style:{width:1,"curve-style":"bezier","control-point-step-size":70,"target-arrow-shape":"triangle","font-size":11,"text-rotation":"autorotate","text-outline-width":3,"text-outline-color":"#FFFFFF",label:"data(label)"}},{selector:"edge:selected",style:{width:2,"line-color":"#333333","source-arrow-color":"#333333","target-arrow-color":"#333333"}},{selector:".faded",style:{opacity:.07,color:"#333333"}}],layout:{name:"spread",animate:!1,prelayout:!1,spacingFactor:2},minZoom:.1,maxZoom:1.5,zoomingEnabled:!0,userZoomingEnabled:!this.disableZoom,panningEnabled:!0,userPanningEnabled:!0,boxSelectionEnabled:!0,selectionType:"single",touchTapThreshold:8,desktopTapThreshold:4,autolock:!1,autoungrabify:!1,autounselectify:!1,headless:!1,styleEnabled:!0,hideEdgesOnViewport:!1,hideLabelsOnViewport:!1,textureOnViewport:!1,motionBlur:!1,motionBlurOpacity:.2,pixelRatio:"auto"}}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},nodes(){return this.elements.filter(e=>"nodes"===e.group)},edges(){return this.elements.filter(e=>"edges"===e.group)},queryRequest(){if(this.edgeQuery)return{queryDsl:this.edgeQuery,queryFilter:this.queryFilter,incognito:!0}}},methods:{increaseTimelineViewHeight:function(){this.minimizeTimelineView=!1,this.timelineViewHeight>70||(this.timelineViewHeight+=30)},decreaseTimelineViewHeight:function(){if(this.minimizeTimelineView=!1,this.timelineViewHeight<50)return this.minimizeTimelineView=!0,void(this.timelineViewHeight=0);this.timelineViewHeight-=30},buildSavedGraph:function(e){this.cy.elements().remove(),this.isLoading=!0,this.config.layout.name="preset",this.currentGraph=e.name,this.currentGraphCache={},this.elements=[],this.edgeQuery="";let t="";t="object"===typeof e?e.id:e,_.getSavedGraph(this.sketch.id,t).then(e=>{this.currentGraph=e.data["objects"][0].name;let t=JSON.parse(e.data["objects"][0].graph_elements),s=t.filter(e=>"nodes"===e.group),i=t.filter(e=>"edges"===e.group),a=[];s.forEach(e=>{e.selected=!1,a.push(e)}),i.forEach(e=>{e.selected=!1,a.push(e)}),clearTimeout(this.loadingTimeout),this.elements=a,this.isLoading=!1,this.updateCytoscape(t),this.resizeCanvas()}).catch(e=>{console.error(e)})},buildGraph:function(e,t=!1){this.cy.elements().remove(),this.isLoading=!0,this.showTimelineView=!1,this.config.layout.name=this.layoutName;let s=this.config.style.filter(e=>"edge"===e.selector);s[0].style["curve-style"]=this.edgeStyle,this.currentGraph="object"===typeof e?e.name:e,this.elements=[],this.edgeQuery="";let i=[],a=[];this.$route.query.timeline?(a.push(parseInt(this.$route.query.timeline)),t=!0):this.sketch.timelines.forEach(e=>{i.push(e.searchindex.index_name)}),_.generateGraphFromPlugin(this.sketch.id,this.currentGraph,i,a,t).then(e=>{let t,s,i=e.data["objects"][0],a=JSON.parse(i.graph_elements),n=JSON.parse(i.graph_config),r=[];"elements"in a?(t=a["elements"]["nodes"],s=a["elements"]["edges"]):(t=a["nodes"],s=a["edges"]),t.forEach(e=>{r.push({data:e.data,group:"nodes"})}),s.forEach(e=>{r.push({data:e.data,group:"edges"})}),delete i.graph_elements,this.currentGraphCache=i,this.currentGraphCacheConfig=n,this.elements=r,clearTimeout(this.loadingTimeout),this.isLoading=!1,this.updateCytoscape(r),this.resizeCanvas()}).catch(e=>{console.error(e)})},updateCytoscape:function(e){this.cy.style(this.config.style),this.cy.elements().remove(),this.cy.add(e),this.cy.layout(this.config.layout).run(),this.setTheme()},saveGraph:function(){let e=this.cy.filter(":selected"),t=this.buildNeighborhood(e),s=t.jsons();this.elements=s,this.currentGraph=this.saveAsName,_.saveGraph(this.sketch.id,this.saveAsName,s).then(e=>{this.$store.dispatch("updateSavedGraphs",this.sketch.id),this.$router.push({name:"Graph",query:{graph:e.data.objects[0].id}})}).catch(e=>{this.errorSnackBar("Unable to save graph"),console.error(e)}),this.saveAsName="",this.saveGraphDialog=!1},filterGraphByInput:function(){this.cy.elements().unselect();let e=this.cy.elements().filter(e=>e.data("label").toLowerCase().includes(this.filterString.toLowerCase()));this.showNeighborhood(e,!1)},filterGraphBySelection:function(e){let t=this.cy.filter(":selected");this.showNeighborhood(t),this.showTimelineView=!0},unSelectAllElements:function(e){this.cy.elements().removeClass("faded"),this.edgeQuery=null,this.showTimelineView=!1,this.selectedEdgesCount=0},buildNeighborhood:function(e){let t=this.cy.collection();return t=t.add(e.filter("node").neighborhood()),t=t.add(e.filter("edge").connectedNodes()),t=t.add(e),t},showNeighborhood:function(e,t=!0){let s=this.buildNeighborhood(e);if(0===e.length)return void this.cy.elements().removeClass("faded");if(this.cy.elements().addClass("faded"),s.removeClass("faded"),!t)return;let i={query:{bool:{should:[]}}};s.forEach(e=>{"edges"===e.group()&&Object.keys(e.data().events).forEach(t=>{this.selectedEdgesCount++;let s={bool:{must:[{ids:{values:e.data().events[t]}},{term:{_index:{value:t}}}]}};i.query.bool.should.push(s)})}),this.edgeQuery=i},resizeCanvas:function(){if(!this.$refs.graphContainer)return;let e=this.$refs.graphContainer.clientHeight,t=this.$refs.graphContainer.clientWidth,s=this.$refs.cy;s.style.minHeight=e+"px",s.style.height=e+"px",s.style.minWidth=t+"px",s.style.width=t+"px",this.cy.resize(),this.cy.fit()},resizeCanvasWithDelay:function(){this.resizeTimeout=setTimeout(()=>{this.resizeCanvas()},250)},changeOpacity:function(){this.cy&&this.cy.style().selector(".faded").style({opacity:this.fadeOpacity/100}).update()},setTheme:function(){this.cy&&(this.$vuetify.theme.dark?this.cy.style().selector("edge").style({color:"#f5f5f5","text-outline-color":"#25272c"}).update():this.cy.style().selector("edge").style({color:"#333333","text-outline-color":"#FFFFFF"}).update())}},mounted(){window.addEventListener("resize",this.resizeCanvasWithDelay),l.$on("toggleLeftPanel",this.resizeCanvasWithDelay),this.cy=(0,Zt.A)({container:this.$refs.cy,...this.config}),this.cy.on("select",e=>{this.filterGraphBySelection(e)}),this.cy.on("unselect",e=>{this.unSelectAllElements(e)}),this.graphPluginName&&this.buildGraph(this.graphPluginName),this.savedGraphId&&this.buildSavedGraph(this.savedGraphId)},beforeDestroy(){l.$off("toggleLeftPanel")},watch:{"$vuetify.theme.dark"(){this.setTheme()},graphPluginName(){this.graphPluginName&&this.buildGraph(this.graphPluginName)},savedGraphId(){this.savedGraphId&&this.buildSavedGraph(this.savedGraphId)},$route(e,t){t!==e&&(this.showTimelineView=!1)}}},Rn=Fn,Pn=(0,d.A)(Rn,In,En,!1,null,null,null),On=Pn.exports,Qn={props:[],components:{TsCytoscape:On},data:function(){return{currentGraphPlugin:null,currentSavedGraph:null}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta}},methods:{setSavedGraph:function(e){"Graph"!==this.$route.name&&this.$router.push({name:"Graph",params:{graph:e}}),this.currentGraphPlugin=null,this.currentSavedGraph=e},setGraphPlugin:function(e){"Graph"!==this.$route.name&&this.$router.push({name:"Graph",params:{graphPlugin:e}}),this.currentSavedGraph=null,this.currentGraphPlugin=e}},mounted(){l.$on("setGraphPlugin",this.setGraphPlugin),l.$on("setSavedGraph",this.setSavedGraph),this.params={graphId:this.$route.query.graph,pluginName:this.$route.query.plugin,timelineId:this.$route.query.timeline},this.params.graphId&&this.setSavedGraph(Number(this.params.graphId)),this.params.pluginName&&this.setGraphPlugin(this.params.pluginName)},beforeDestroy(){l.$off("setGraphPlugin"),l.$off("setSavedGraph")}},Mn=Qn,qn=(0,d.A)(Mn,$n,Ln,!1,null,null,null),Bn=qn.exports,Vn=function(){var e=this,t=e._self._c;return t("v-container",{attrs:{fluid:""}},[t("v-dialog",{attrs:{width:"600"},model:{value:e.renameStoryDialog,callback:function(t){e.renameStoryDialog=t},expression:"renameStoryDialog"}},[t("v-card",{staticClass:"pa-4"},[t("h3",[e._v("Rename story")]),t("br"),t("v-form",{on:{submit:function(t){return t.preventDefault(),e.rename()}}},[t("v-text-field",{attrs:{outlined:"",dense:"",autofocus:""},on:{focus:function(e){return e.target.select()}},model:{value:e.titleDraft,callback:function(t){e.titleDraft=t},expression:"titleDraft"}}),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:""},on:{click:function(t){e.renameStoryDialog=!1}}},[e._v(" Cancel ")]),t("v-btn",{attrs:{color:"primary",text:""},on:{click:function(t){return e.rename()}}},[e._v(" Save ")])],1)],1)],1)],1),t("v-dialog",{attrs:{"max-width":"300"},model:{value:e.deleteStoryDialog,callback:function(t){e.deleteStoryDialog=t},expression:"deleteStoryDialog"}},[t("v-card",[t("v-card-title",{staticClass:"headline"},[e._v("Delete Story")]),t("v-card-text",[e._v(" Are you sure you want to delete this story? ")]),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:""},on:{click:function(t){e.deleteStoryDialog=!1}}},[e._v("Cancel")]),t("v-btn",{attrs:{color:"error",text:""},on:{click:e.deleteStory}},[e._v("Delete")])],1)],1)],1),t("v-hover",{scopedSlots:e._u([{key:"default",fn:function({hover:s}){return[t("v-toolbar",{staticClass:"mt-n3",attrs:{dense:"",flat:"",color:"transparent"}},[t("v-toolbar-title",{on:{dblclick:function(t){e.renameStoryDialog=!0}}},[e._v(" "+e._s(e.title))]),s?t("v-btn",{attrs:{icon:"",small:""},on:{click:function(t){e.renameStoryDialog=!0}}},[t("v-icon",{attrs:{small:""}},[e._v("mdi-pencil")])],1):e._e(),s?t("v-btn",{attrs:{icon:"",small:""},on:{click:function(t){e.deleteStoryDialog=!0}}},[t("v-icon",{attrs:{small:"",title:"Delete Story"}},[e._v("mdi-trash-can-outline")])],1):e._e()],1)]}}])}),t("div",{staticClass:"pa-4"},e._l(e.blocks,function(s,i){return t("div",{key:i},[s.componentName?e._e():t("div",[t("v-hover",{scopedSlots:e._u([{key:"default",fn:function({hover:a}){return[t("div",{staticStyle:{"min-height":"30px"},on:{dblclick:function(t){return e.editTextBlock(s)},keydown:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"]))return null;s.edit=!1}}},[a&&!s.edit?t("v-card",{staticClass:"float-right px-2",attrs:{outlined:""}},[t("v-btn",{attrs:{icon:"",small:""},on:{click:function(t){return e.editTextBlock(s)}}},[t("v-icon",{attrs:{small:""}},[e._v("mdi-pencil")])],1),t("v-btn",{attrs:{icon:"",small:""},on:{click:function(t){return e.deleteBlock(i)}}},[t("v-icon",{attrs:{small:""}},[e._v("mdi-trash-can-outline")])],1)],1):e._e(),s.edit?e._e():t("div",{staticClass:"markdown-body",domProps:{innerHTML:e._s(e.toHtml(s.content))}}),s.edit?t("v-card",{staticClass:"mb-2",attrs:{flat:"",outlined:""}},[t("v-toolbar",{attrs:{flat:"",dense:""}},[t("v-tabs",{model:{value:s.currentTab,callback:function(t){e.$set(s,"currentTab",t)},expression:"block.currentTab"}},[t("v-tab",[e._v("Edit")]),t("v-tab",[e._v("Preview")])],1),t("v-spacer"),e.hasContent?t("v-btn",{attrs:{icon:""},on:{click:function(t){return e.deleteBlock(i)}}},[t("v-icon",{attrs:{small:""}},[e._v("mdi-trash-can-outline")])],1):e._e()],1),t("v-divider"),t("v-tabs-items",{model:{value:s.currentTab,callback:function(t){e.$set(s,"currentTab",t)},expression:"block.currentTab"}},[t("v-tab-item",{attrs:{transition:!1}},[t("v-textarea",{attrs:{solo:"",flat:"",value:s.draft,placeholder:"Your story starts here..",rows:"5","auto-grow":"",autofocus:""},on:{input:function(t){return e.updateDraft(t,s)}}})],1),t("v-tab-item",{attrs:{transition:!1}},[t("div",{staticClass:"markdown-body pa-4",domProps:{innerHTML:e._s(e.toHtml(s.draft))}})])],1),s.edit?t("v-divider"):e._e(),s.edit?t("v-card-actions",[t("v-btn",{attrs:{text:"",color:"primary",disabled:!s.draft},on:{click:function(t){return e.save()}}},[e._v("Save")]),t("v-btn",{attrs:{text:"",disabled:!e.hasContent},on:{click:function(e){s.edit=!1}}},[e._v("Cancel")])],1):e._e()],1):e._e()],1)]}}],null,!0)})],1),s.componentName?t("div",[t("div",["TsEventList"===s.componentName?t("v-card",{staticClass:"mb-2",attrs:{outlined:""}},[t("v-toolbar",{attrs:{dense:"",flat:""}},[t("router-link",{staticStyle:{cursor:"pointer","text-decoration":"none"},attrs:{to:{name:"Explore",query:{view:s.componentProps.view.id}}}},[t("span",{on:{click:function(t){return e.setActiveView(s.componentProps.view)}}},[e._v(e._s(s.componentProps.view.name))])]),t("v-spacer"),t("v-btn",{attrs:{icon:""},on:{click:function(t){return e.deleteBlock(i)}}},[t("v-icon",{attrs:{small:""}},[e._v("mdi-trash-can-outline")])],1)],1),t("v-divider"),t("v-card-text",[t(s.componentName,e._b({tag:"component"},"component",e.formatComponentProps(s),!1))],1)],1):e._e(),"TsAggregationGroupCompact"===s.componentName?t("v-card",{staticClass:"mb-2",attrs:{outlined:""}},[t("v-toolbar",{attrs:{dense:"",flat:""}},[e._v(e._s(s.componentProps.aggregation_group.name)+" "),t("v-spacer"),t("v-btn",{attrs:{icon:""},on:{click:function(t){return e.deleteBlock(i)}}},[t("v-icon",{attrs:{small:""}},[e._v("mdi-trash-can-outline")])],1)],1),t("v-divider"),t("v-card-text",[e._v("Legacy group Aggregations are not supported. Please view this Story in the old UI or update your analyzer.")])],1):e._e(),"TsAggregationCompact"===s.componentName?t("v-card",{staticClass:"mb-2",attrs:{outlined:""}},[t("v-toolbar",{attrs:{dense:"",flat:""}},[e._v(e._s(s.componentProps.aggregation.name)+" "),t("v-spacer"),t("v-btn",{attrs:{icon:""},on:{click:function(t){return e.deleteBlock(i)}}},[t("v-icon",{attrs:{small:""}},[e._v("mdi-trash-can-outline")])],1)],1),t("v-divider"),t("v-card-text",[e._v("Legacy aggregations are not supported. Please view this Story in the old UI or update your analyzer.")])],1):e._e(),"TsCytoscapePlugin"===s.componentName?t("v-card",{staticClass:"mb-2",attrs:{outlined:""}},[t("v-toolbar",{attrs:{dense:"",flat:""}},[t("router-link",{staticStyle:{cursor:"pointer","text-decoration":"none"},attrs:{to:{name:"Graph",query:{plugin:s.componentProps.graphPluginName}}}},[t("span",{on:{click:function(t){return e.setActiveGraph(s.componentProps.graphPluginName)}}},[e._v(e._s(s.componentProps.graphPluginName))])]),t("v-spacer"),t("v-btn",{attrs:{icon:""},on:{click:function(t){return e.deleteBlock(i)}}},[t("v-icon",{attrs:{small:""}},[e._v("mdi-trash-can-outline")])],1)],1),t("v-divider"),t("v-card-text",[t("TsCytoscape",e._b({tag:"component"},"component",e.formatComponentProps(s),!1))],1)],1):e._e(),"TsCytoscapeSavedGraph"===s.componentName?t("v-card",{staticClass:"mb-2",attrs:{outlined:""}},[t("v-toolbar",{attrs:{dense:"",flat:""}},[t("router-link",{staticStyle:{cursor:"pointer","text-decoration":"none"},attrs:{to:{name:"Graph",query:{graph:s.componentProps.graph}}}},[t("span",{on:{click:function(t){return e.setActiveGraph(s.componentProps.savedGraphId)}}},[e._v(e._s(s.graphName))])]),t("v-spacer"),t("v-btn",{attrs:{icon:""},on:{click:function(t){return e.deleteBlock(i)}}},[t("v-icon",{attrs:{small:""}},[e._v("mdi-trash-can-outline")])],1)],1),t("v-divider"),t("v-card-text",[t("TsCytoscape",e._b({tag:"component"},"component",e.formatComponentProps(s),!1))],1)],1):e._e(),"TsSavedVisualization"===s.componentName?t("v-card",{staticClass:"mb-2",attrs:{outlined:""}},[t("v-toolbar",{attrs:{dense:"",flat:""}},[t("router-link",{staticStyle:{cursor:"pointer","text-decoration":"none"},attrs:{to:{name:"VisualizationView",params:{aggregationId:s.componentProps.savedVisualizationId}}}},[e._v(" "+e._s(s.componentProps.name)+" ")]),t("v-spacer"),t("v-btn",{attrs:{icon:""},on:{click:function(t){return e.deleteBlock(i)}}},[t("v-icon",{attrs:{small:""}},[e._v("mdi-trash-can-outline")])],1)],1),t("v-divider"),t("v-card-text",[t("TsSavedVisualization",{attrs:{aggregationId:s.componentProps.savedVisualizationId}})],1)],1):e._e(),"TsInvestigativeQuestion"===s.componentName?t("v-card",{staticClass:"mb-2",attrs:{outlined:""}},[t("v-toolbar",{attrs:{dense:"",flat:""}},[t("span",[e._v(e._s(s.componentProps.questionName))]),t("v-spacer"),t("v-btn",{attrs:{icon:""},on:{click:function(t){return e.deleteBlock(i)}}},[t("v-icon",{attrs:{small:""}},[e._v("mdi-trash-can-outline")])],1)],1),t("v-divider"),t("v-card-text",{staticClass:"pa-0"},[t("TsQuestionCard",{key:s.componentProps.questionId+"-"+s.componentProps.questionName,attrs:{questionId:s.componentProps.questionId,initialTab:2}})],1)],1):e._e()],1)]):e._e(),t("v-hover",{scopedSlots:e._u([{key:"default",fn:function({hover:a}){return[t("div",{staticClass:"mb-2 mt-2"},[t("div",{class:{hidden:!a&&!s.isActive&&!s.showGraphMenu&&!s.showSavedSearchMenu&&!s.showSavedVisualizationMenu&&!s.showQuestionMenu&&e.hasContent}},[e.hasContent?t("v-btn",{staticClass:"mr-2",attrs:{rounded:"",outlined:"",small:""},on:{click:function(t){return e.addTextBlock(i)}}},[t("v-icon",{attrs:{left:"",small:""}},[e._v("mdi-plus")]),e._v(" Text ")],1):e._e(),t("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-btn",e._g(e._b({staticClass:"mr-2",attrs:{rounded:"",outlined:"",small:"",disabled:!e.meta.views.length}},"v-btn",i,!1),s),[t("v-icon",{attrs:{left:"",small:""}},[e._v("mdi-plus")]),e._v(" Saved Search ")],1)]}}],null,!0),model:{value:s.showSavedSearchMenu,callback:function(t){e.$set(s,"showSavedSearchMenu",t)},expression:"block.showSavedSearchMenu"}},[t("v-card",{attrs:{width:"475"}},[t("v-list",[t("v-list-item-group",{attrs:{color:"primary"}},e._l(e.meta.views,function(s){return t("v-list-item",{key:s.id},[t("v-list-item-content",{on:{click:function(t){return e.addEventListBlock(s,i)}}},[e._v(" "+e._s(s.name)+" ")])],1)}),1)],1)],1)],1),t("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-btn",e._g(e._b({staticClass:"mr-2",attrs:{rounded:"",outlined:"",small:"",disabled:!e.graphPlugins.length}},"v-btn",i,!1),s),[t("v-icon",{attrs:{left:"",small:""}},[e._v("mdi-plus")]),e._v(" Graphs ")],1)]}}],null,!0),model:{value:s.showGraphMenu,callback:function(t){e.$set(s,"showGraphMenu",t)},expression:"block.showGraphMenu"}},[t("v-card",{attrs:{width:"475"}},[t("v-list",[t("v-list-item-group",{attrs:{color:"primary"}},[t("v-subheader",[e._v("Saved Graphs")]),e._l(e.savedGraphs,function(s){return t("v-list-item",{key:s.id},[t("v-list-item-content",{on:{click:function(t){return e.addSavedGraphBlock(s,i)}}},[e._v(" "+e._s(s.name)+" ")])],1)}),t("v-subheader",[e._v("Plugins")]),e._l(e.graphPlugins,function(s){return t("v-list-item",{key:s.name},[t("v-list-item-content",{on:{click:function(t){return e.addGraphPluginBlock(s,i)}}},[e._v(" "+e._s(s.name)+" ")])],1)})],2)],1)],1)],1),t("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-btn",e._g(e._b({staticClass:"mr-2",attrs:{rounded:"",outlined:"",small:"",disabled:!e.savedVisualizations.length}},"v-btn",i,!1),s),[t("v-icon",{attrs:{left:"",small:""}},[e._v("mdi-plus")]),e._v(" Visualizations ")],1)]}}],null,!0),model:{value:s.showSavedVisualizationMenu,callback:function(t){e.$set(s,"showSavedVisualizationMenu",t)},expression:"block.showSavedVisualizationMenu"}},[t("v-card",[t("v-list",[t("v-list-item-group",{attrs:{color:"primary"}},[t("v-subheader",[e._v("Saved Visualizations")]),e._l(e.savedVisualizations,function(s){return t("v-list-item",{key:s.id},[t("v-list-item-content",{on:{click:function(t){return e.addSavedVisualization(s,i)}}},[e._v(" "+e._s(s.name)+" ")])],1)})],2)],1)],1)],1),t("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-btn",e._g(e._b({attrs:{rounded:"",outlined:"",small:"",disabled:!e.availableSketchQuestions.length}},"v-btn",i,!1),s),[t("v-icon",{attrs:{left:"",small:""}},[e._v("mdi-plus")]),e._v(" Investigative Question ")],1)]}}],null,!0),model:{value:s.showQuestionMenu,callback:function(t){e.$set(s,"showQuestionMenu",t)},expression:"block.showQuestionMenu"}},[t("v-card",{attrs:{width:"475"}},[t("v-list",[t("v-list-item-group",{attrs:{color:"primary"}},e._l(e.availableSketchQuestions,function(s){return t("v-list-item",{key:s.id},[t("v-list-item-content",{on:{click:function(t){return e.addQuestionBlock(s,i)}}},[e._v(" "+e._s(s.name)+" ")])],1)}),1)],1)],1)],1)],1)])]}}],null,!0)})],1)}),0)],1)},Hn=[],Gn=function(){var e=this,t=e._self._c;return t("v-card",{staticClass:"mx-3",attrs:{outlined:""}},[e.aggregationId?t("ts-chart-card",{attrs:{chartSeries:e.chartSeries,chartLabels:e.chartLabels,chartTitle:e.chartTitle,chartType:e.chartType,fieldName:e.fieldName,height:e.height,isTimeSeries:e.isTimeSeries,metricName:e.metricName,showDataLabels:e.showDataLabels,showXLabels:e.showXLabels,showYLabels:e.showYLabels,width:e.width,xTitle:e.xTitle,yTitle:e.yTitle}}):e._e()],1)},Un=[],Wn=function(){var e=this,t=e._self._c;return t("v-card",{attrs:{flat:"","min-height":e.height,"min-width":e.width}},[t("v-card-text",[null!=e.chartSeries&&"bar"===e.chartType?t("TsBarChart",{attrs:{fieldName:e.fieldName,metricName:e.metricName,"is-time-series":e.isTimeSeries,chartSeries:e.chartSeries,chartLabels:e.chartLabels,chartTitle:e.chartTitle,height:e.height,width:e.width,xTitle:e.xTitle,showXLabels:e.showXLabels,yTitle:e.yTitle,showYLabels:e.showYLabels,showDataLabels:e.showDataLabels}}):e._e(),null!=e.chartSeries&&"column"===e.chartType?t("TsColumnChart",{attrs:{fieldName:e.fieldName,metricName:e.metricName,"is-time-series":e.isTimeSeries,chartSeries:e.chartSeries,chartLabels:e.chartLabels,chartTitle:e.chartTitle,height:e.height,width:e.width,xTitle:e.xTitle,showXLabels:e.showXLabels,yTitle:e.yTitle,showYLabels:e.showYLabels,showDataLabels:e.showDataLabels}}):e._e(),null!=e.chartSeries&&"donut"===e.chartType?t("TsDonutChart",{attrs:{fieldName:e.fieldName,metricName:e.metricName,"is-time-series":e.isTimeSeries,chartSeries:e.chartSeries,chartLabels:e.chartLabels,chartTitle:e.chartTitle,height:e.height,width:e.width,xTitle:e.xTitle,showXLabels:e.showXLabels,yTitle:e.yTitle,showYLabels:e.showYLabels,showDataLabels:e.showDataLabels}}):e._e(),null!=e.chartSeries&&"heatmap"===e.chartType?t("TsHeatmapChart",{attrs:{fieldName:e.fieldName,metricName:e.metricName,"is-time-series":e.isTimeSeries,chartSeries:e.chartSeries,chartLabels:e.chartLabels,chartTitle:e.chartTitle,height:e.height,width:e.width,xTitle:e.xTitle,showXLabels:e.showXLabels,yTitle:e.yTitle,showYLabels:e.showYLabels,showDataLabels:e.showDataLabels}}):e._e(),null!=e.chartSeries&&"line"===e.chartType?t("TsLineChart",{attrs:{fieldName:e.fieldName,metricName:e.metricName,"is-time-series":e.isTimeSeries,chartSeries:e.chartSeries,chartLabels:e.chartLabels,chartTitle:e.chartTitle,height:e.height,width:e.width,xTitle:e.xTitle,showXLabels:e.showXLabels,yTitle:e.yTitle,showYLabels:e.showYLabels,showDataLabels:e.showDataLabels}}):e._e(),null!=e.chartSeries&&"table"===e.chartType?t("TsTableChart",{attrs:{fieldName:e.fieldName,metricName:e.metricName,"is-time-series":e.isTimeSeries,chartSeries:e.chartSeries,chartLabels:e.chartLabels,chartTitle:e.chartTitle,height:e.height,width:e.width}}):e._e()],1)],1)},jn=[],Yn=function(){var e=this,t=e._self._c;return t("div",[t("apexchart",{attrs:{options:e.options,series:e.series,width:e.width,height:e.height}})],1)},Xn=[],Jn={props:{fieldName:{type:String,default:"Unknown field"},metricName:{type:String,default:"unknown metric"},chartSeries:{type:Object,default:function(){return{}}},chartLabels:{type:Array,default:function(){return[]}},chartType:{type:String,default:void 0},chartTitle:{type:String,default:void 0},height:{type:Number,default:640},isTimeSeries:{type:Boolean,default:!1},showDataLabels:{type:Boolean,default:!0},showTooltips:{type:Boolean,default:!0},showXLabels:{type:Boolean,default:!0},showYLabels:{type:Boolean,default:!0},width:{type:Number,default:800},xTitle:{type:String,default:void 0},xType:{type:String,default:"category"},yTitle:{type:String,default:void 0}},components:{Apexchart:_t()},computed:{options:{get(){return{chart:{animations:{enabled:!0,easing:"easeinout",speed:50,animateGradually:{enabled:!0,delay:50},dynamicAnimation:{enabled:!0,delay:50}},events:{dataPointSelection:(e,t,s)=>{this.filterDataPoint(s)}},type:"bar",zoom:{enabled:!1,type:"x",autoScaleYaxis:!0},height:this.height,width:this.width},labels:this.chartLabels,dataLabels:{enabled:this.showDataLabels},noData:{text:"Loading..."},plotOptions:{bar:{horizontal:!0,dataLabels:{position:"top"}}},title:{text:this.chartTitle},tooltip:{enabled:this.showTooltips,followCursor:!1},xaxis:{tickPlacement:"on",labels:{show:this.showXLabels,hideOverlappingLabels:!0},title:{text:this.xTitle},tooltip:{enabled:!0}},yaxis:{labels:{show:this.showYLabels},title:{text:this.yTitle}}}},set(e){}},series(){if(void 0===this.fieldName||void 0===this.metricName)return[];let e={name:this.fieldName,data:this.chartSeries[this.metricName]};return[e]}},methods:{setTheme(){localStorage.isDarkTheme?this.options={chart:{foreColor:"#fff"},tooltip:{theme:"dark"}}:this.options={chart:{foreColor:"#333"},tooltip:{theme:"light"}}},filterDataPoint(e){let t={doSearch:!0},s=e.dataPointIndex;if(this.isTimeSeries){let e=this.chartLabels[s],i=s+1<this.chartLabels.length?this.chartLabels[s+1]:"";if(""===i)return;t.doSearch=!0,t.queryString=this.fieldName+":*",t.chip={field:"",type:"datetime_range",value:e+","+i,operator:"must",active:!0},l.$emit("setQueryAndFilter",t)}else t.chip={field:this.fieldName,value:e.w.config.labels[s],type:"term",operator:"must",active:!0},l.$emit("setQueryAndFilter",t)}},created(){l.$on("isDarkTheme",this.setTheme)},mounted(){this.setTheme()}},Kn=Jn,Zn=(0,d.A)(Kn,Yn,Xn,!1,null,null,null),er=Zn.exports,tr=function(){var e=this,t=e._self._c;return t("div",[t("apexchart",{attrs:{options:e.options,series:e.series,width:e.width,height:e.height}})],1)},sr=[],ir={props:{fieldName:{type:String,default:"Unknown field"},metricName:{type:String,default:"unknown metric"},chartSeries:{type:Object,default:function(){return{}}},chartLabels:{type:Array,default:function(){return[]}},chartType:{type:String,default:void 0},chartTitle:{type:String,default:void 0},height:{type:Number,default:640},isTimeSeries:{type:Boolean,default:!1},showDataLabels:{type:Boolean,default:!0},showTooltips:{type:Boolean,default:!0},showXLabels:{type:Boolean,default:!0},showYLabels:{type:Boolean,default:!0},width:{type:Number,default:800},xTitle:{type:String,default:void 0},xType:{type:String,default:"category"},yTitle:{type:String,default:void 0}},components:{Apexchart:_t()},data:function(){return{}},computed:{options:{get(){return{chart:{animations:{enabled:!0,easing:"easeinout",speed:50,animateGradually:{enabled:!0,delay:50},dynamicAnimation:{enabled:!0,delay:50}},events:{dataPointSelection:(e,t,s)=>{this.filterDataPoint(s)}},type:"bar",zoom:{enabled:!1,type:"x",autoScaleYaxis:!0},height:this.height,width:this.width},labels:this.chartLabels,dataLabels:{enabled:this.showDataLabels},noData:{text:"Loading..."},plotOptions:{bar:{dataLabels:{position:"top"}}},title:{text:this.chartTitle},tooltip:{enabled:this.showTooltips,followCursor:!1},xaxis:{tickPlacement:"on",labels:{show:this.showXLabels,hideOverlappingLabels:!0},title:{text:this.xTitle},tooltip:{enabled:!0}},yaxis:{labels:{show:this.showYLabels},title:{text:this.yTitle}}}},set(e){}},series(){if(void 0===this.fieldName||void 0===this.metricName)return[];let e={name:this.fieldName,data:this.chartSeries[this.metricName]};return[e]}},methods:{setTheme(){localStorage.isDarkTheme?this.options={chart:{foreColor:"#fff"},tooltip:{theme:"dark"}}:this.options={chart:{foreColor:"#333"},tooltip:{theme:"light"}}},filterDataPoint(e){let t={doSearch:!0},s=e.dataPointIndex;if(this.isTimeSeries){let e=this.chartLabels[s],i=s+1<this.chartLabels.length?this.chartLabels[s+1]:"";if(""===i)return;t.doSearch=!0,t.queryString=this.fieldName+":*",t.chip={field:"",type:"datetime_range",value:e+","+i,operator:"must",active:!0},l.$emit("setQueryAndFilter",t)}else t.chip={field:this.fieldName,value:e.w.config.labels[s],type:"term",operator:"must",active:!0},l.$emit("setQueryAndFilter",t)}},created(){l.$on("isDarkTheme",this.setTheme)},mounted(){this.setTheme()}},ar=ir,nr=(0,d.A)(ar,tr,sr,!1,null,null,null),rr=nr.exports,lr=function(){var e=this,t=e._self._c;return t("div",[t("apexchart",{attrs:{options:e.options,series:e.series,width:e.width,height:e.height}})],1)},or=[],cr={props:{fieldName:{type:String,default:"Unknown field"},metricName:{type:String,default:"unknown metric"},chartSeries:{type:Object,default:function(){return{}}},chartLabels:{type:Array,default:function(){return[]}},chartType:{type:String,default:void 0},chartTitle:{type:String,default:void 0},height:{type:Number,default:640},isTimeSeries:{type:Boolean,default:!1},showDataLabels:{type:Boolean,default:!0},showTooltips:{type:Boolean,default:!0},showXLabels:{type:Boolean,default:!0},showYLabels:{type:Boolean,default:!0},width:{type:Number,default:800},xTitle:{type:String,default:void 0},xType:{type:String,default:"category"},yTitle:{type:String,default:void 0}},components:{Apexchart:_t()},computed:{options:{get(){return{chart:{animations:{enabled:!0,easing:"easeinout",speed:50,animateGradually:{enabled:!0,delay:50},dynamicAnimation:{enabled:!0,delay:50}},events:{dataPointSelection:(e,t,s)=>{this.filterDataPoint(s)}},type:"donut",zoom:{enabled:!1,type:"x",autoScaleYaxis:!0},height:this.height,width:this.width},labels:this.chartLabels,dataLabels:{enabled:this.showDataLabels},noData:{text:"Loading..."},plotOptions:{bar:{horizontal:!0,dataLabels:{position:"top"}}},title:{text:this.chartTitle},tooltip:{enabled:this.showTooltips,followCursor:!1},xaxis:{tickPlacement:"on",labels:{show:this.showXLabels,hideOverlappingLabels:!0},title:{text:this.xTitle},tooltip:{enabled:!0}},yaxis:{labels:{show:this.showYLabels},title:{text:this.yTitle}}}},set(e){}},series(){return void 0===this.fieldName||void 0===this.metricName?[]:this.chartSeries[this.metricName]}},methods:{setTheme(){localStorage.isDarkTheme?this.options={chart:{foreColor:"#fff"},tooltip:{theme:"dark"}}:this.options={chart:{foreColor:"#333"},tooltip:{theme:"light"}}},filterDataPoint(e){if(!this.isTimeSeries){const t=e.dataPointIndex;let s={doSearch:!0},i={field:this.fieldName,value:e.w.config.labels[t],type:"term",operator:"must",active:!0};s.chip=i,l.$emit("setQueryAndFilter",s)}}},created(){l.$on("isDarkTheme",this.setTheme)},mounted(){this.setTheme()}},dr=cr,ur=(0,d.A)(dr,lr,or,!1,null,null,null),hr=ur.exports,mr=function(){var e=this,t=e._self._c;return t("div",[t("apexchart",{attrs:{options:e.options,series:e.series,width:e.width,height:e.height}})],1)},pr=[],vr={props:{fieldName:{type:String,default:"Unknown field"},metricName:{type:String,default:"unknown metric"},chartSeries:{type:Object,default:function(){return{}}},chartLabels:{type:Array,default:function(){return[]}},chartType:{type:String,default:void 0},chartTitle:{type:String,default:void 0},isTimeSeries:{type:Boolean,default:!1},showDataLabels:{type:Boolean,default:!0},showTooltips:{type:Boolean,default:!0},showXLabels:{type:Boolean,default:!0},showYLabels:{type:Boolean,default:!0},xTitle:{type:String,default:void 0},xType:{type:String,default:"category"},yTitle:{type:String,default:void 0},height:{type:Number,default:250},width:{type:Number,default:400}},components:{Apexchart:_t()},data:function(){return{}},computed:{options:{get(){return{chart:{animations:{enabled:!0,easing:"easeinout",speed:50,animateGradually:{enabled:!0,delay:50},dynamicAnimation:{enabled:!0,delay:50}},events:{dataPointSelection:(e,t,s)=>{this.filterDataPoint(s)}},type:"heatmap",zoom:{enabled:!1,type:"x",autoScaleYaxis:!0},height:this.height,width:this.width},labels:this.chartLabels,dataLabels:{enabled:this.showDataLabels},noData:{text:"Loading..."},plotOptions:{bar:{horizontal:!1,dataLabels:{position:"top"}}},title:{text:this.chartTitle},tooltip:{enabled:this.showTooltips,followCursor:!1},xaxis:{tickPlacement:"on",labels:{show:this.showXLabels,hideOverlappingLabels:!0},title:{text:this.xTitle},tooltip:{enabled:!0}},yaxis:{labels:{show:this.showYLabels},title:{text:this.yTitle}}}},set(e){}},series(){if(void 0===this.fieldName||void 0===this.metricName)return[];let e={name:this.fieldName,data:this.chartSeries[this.metricName]};return[e]}},methods:{setTheme(){localStorage.isDarkTheme?this.options={chart:{foreColor:"#fff"},tooltip:{theme:"dark"}}:this.options={chart:{foreColor:"#333"},tooltip:{theme:"light"}}},filterDataPoint(e){let t={doSearch:!0},s=e.dataPointIndex;if(this.isTimeSeries){let e=this.chartLabels[s],i=s+1<this.chartLabels.length?this.chartLabels[s+1]:"";if(""===i)return;t.chip={field:"",type:"datetime_range",value:e+","+i,operator:"must",active:!0}}else t.chip={field:this.fieldName,value:e.w.config.labels[s],type:"term",operator:"must",active:!0};l.$emit("setQueryAndFilter",t)}},created(){l.$on("isDarkTheme",this.setTheme)},mounted(){this.setTheme()}},gr=vr,fr=(0,d.A)(gr,mr,pr,!1,null,null,null),yr=fr.exports,_r=function(){var e=this,t=e._self._c;return t("div",[t("apexchart",{attrs:{options:e.options,series:e.series,height:e.height,width:e.width}})],1)},br=[],Sr={props:{fieldName:{type:String,default:"Unknown field"},metricName:{type:String,default:"unknown metric"},chartSeries:{type:Object,default:function(){return{}}},chartLabels:{type:Array,default:function(){return[]}},chartType:{type:String,default:void 0},chartTitle:{type:String,default:void 0},height:{type:Number,default:640},isTimeSeries:{type:Boolean,default:!1},showDataLabels:{type:Boolean,default:!0},showTooltips:{type:Boolean,default:!0},showXLabels:{type:Boolean,default:!0},showYLabels:{type:Boolean,default:!0},width:{type:Number,default:800},xTitle:{type:String,default:void 0},xType:{type:String,default:"category"},yTitle:{type:String,default:void 0}},components:{Apexchart:_t()},computed:{options:{get(){return{chart:{animations:{enabled:!0,easing:"easeinout",speed:50,animateGradually:{enabled:!0,delay:50},dynamicAnimation:{enabled:!0,delay:50}},events:{dataPointSelection:(e,t,s)=>{this.filterDataPoint(s)}},type:"line",zoom:{enabled:!1,type:"x",autoScaleYaxis:!0},height:this.height,width:this.width},labels:this.chartLabels,dataLabels:{enabled:this.showDataLabels},noData:{text:"Loading..."},plotOptions:{bar:{dataLabels:{position:"top"}}},title:{text:this.chartTitle},tooltip:{enabled:this.showTooltips,followCursor:!1},xaxis:{tickPlacement:"on",labels:{show:this.showXLabels,hideOverlappingLabels:!0},title:{text:this.xTitle},tooltip:{enabled:!0}},yaxis:{labels:{show:this.showYLabels},title:{text:this.yTitle}}}},set(e){}},series(){if(void 0===this.fieldName||void 0===this.metricName)return[];let e={name:this.fieldName,data:this.chartSeries[this.metricName]};return[e]}},methods:{setTheme(){localStorage.isDarkTheme?this.options={chart:{foreColor:"#fff"},tooltip:{theme:"dark"}}:this.options={chart:{foreColor:"#333"},tooltip:{theme:"light"}}},filterDataPoint(e){let t={doSearch:!0},s=e.dataPointIndex;if(this.isTimeSeries){let e=this.chartLabels[s],i=s+1<this.chartLabels.length?this.chartLabels[s+1]:"";if(""===i)return;t.chip={field:"",type:"datetime_range",value:e+","+i,operator:"must",active:!0}}else t.chip={field:this.fieldName,value:e.w.config.labels[s],type:"term",operator:"must",active:!0};l.$emit("setQueryAndFilter",t)}},created(){l.$on("isDarkTheme",this.setTheme)},mounted(){this.setTheme()}},kr=Sr,wr=(0,d.A)(kr,_r,br,!1,null,null,null),xr=wr.exports,Tr=function(){var e=this,t=e._self._c;return t("v-card",{attrs:{flat:""}},[void 0!==e.chartTitle?t("v-card-title",[e._v(" "+e._s(e.chartTitle)+" ")]):e._e(),t("v-card-text",[t("v-data-table",{attrs:{headers:e.headers,items:e.items,dense:""},scopedSlots:e._u([{key:"header.field",fn:function({header:t}){return[e._v(" "+e._s(t.text)+" ")]}},{key:"item.field",fn:function({item:s}){return[t("v-container",{staticClass:"pl-0",on:{mouseover:function(t){e.c_key=s.field},mouseleave:function(t){e.c_key=-1}}},[e._v(" "+e._s(s.field)+" "),s.field!=e.c_key||e.isTimeSeries?e._e():t("v-btn",{staticClass:"mr-1",attrs:{icon:"","x-small":""},on:{click:function(t){return t.stopPropagation(),e.applyFilterChip(e.fieldName,s.field,"must")}}},[t("v-icon",{attrs:{title:"Filter for value "+s.field}},[e._v(" mdi-filter-plus-outline ")])],1),s.field!=e.c_key||e.isTimeSeries?e._e():t("v-btn",{staticClass:"mr-1",attrs:{icon:"","x-small":""},on:{click:function(t){return t.stopPropagation(),e.applyFilterChip(e.fieldName,s.field,"must_not")}}},[t("v-icon",{attrs:{title:"Filter out value "+s.field}},[e._v(" mdi-filter-minus-outline ")])],1),s.field==e.c_key?t("v-btn",{staticClass:"pr-1",staticStyle:{cursor:"pointer"},attrs:{icon:"","x-small":""},on:{click:function(t){return e.copyToClipboard(s.field)}}},[t("v-icon",{attrs:{title:"Copy value "+s.field,small:""}},[e._v(" mdi-content-copy ")])],1):e._e()],1)]}},{key:"item.metric",fn:function({item:s}){return[t("v-container",{staticClass:"pl-0",on:{mouseover:function(t){e.c_key=s.field},mouseleave:function(t){e.c_key=-1}}},[e._v(" "+e._s(s.metric)+" "),s.field==e.c_key?t("v-btn",{staticClass:"pr-1",staticStyle:{cursor:"pointer"},attrs:{icon:"","x-small":""},on:{click:function(t){return e.copyToClipboard(s.metric)}}},[t("v-icon",{attrs:{title:"Copy value "+s.metric,small:""}},[e._v(" mdi-content-copy ")])],1):e._e()],1)]}}])})],1)],1)},Cr=[],Ar={props:{chartSeries:{type:Object,default:function(){return{}}},chartLabels:{type:Array,default:function(){return[]}},chartTitle:{type:String,default:void 0},fieldName:{type:String,default:"Unknown field"},height:{type:Number,default:640},isTimeSeries:{type:Boolean,default:!1},metricName:{type:String,default:"unknown metric"},width:{type:Number,default:800}},data:function(){return{c_key:-1}},computed:{items(){let e=[];if(this.metricName in this.chartSeries)for(let t=0,s=this.chartLabels.length;t<s;t++){let s={field:this.chartLabels[t],metric:this.chartSeries[this.metricName][t]};e.push(s)}return e},headers(){return[{text:this.fieldName,value:"field",width:"80%"},{text:this.metricName,value:"metric"}]}},methods:{copyToClipboard(e){try{navigator.clipboard.writeText(e),this.infoSnackBar("Copied "+e+" to the clipboard")}catch(t){this.errorSnackBar("Failed copying to the clipboard!"),console.error(t)}},applyFilterChip(e,t,s){if(this.isTimeSeries)return;let i={doSearch:!0},a={field:e,value:t,type:"term",operator:s,active:!0};i.chip=a,l.$emit("setQueryAndFilter",i)}}},Dr=Ar,$r=(0,d.A)(Dr,Tr,Cr,!1,null,null,null),Lr=$r.exports,Ir={components:{TsBarChart:er,TsColumnChart:rr,TsDonutChart:hr,TsHeatmapChart:yr,TsLineChart:xr,TsTableChart:Lr},props:{chartLabels:{type:Array},chartSeries:{type:Object},chartTitle:{type:String,default:void 0},chartType:{type:String},fieldName:{type:String},height:{type:Number},isTimeSeries:{type:Boolean},metricName:{type:String},showDataLabels:{type:Boolean},showXLabels:{type:Boolean},showYLabels:{type:Boolean},width:{type:Number},xTitle:{type:String},yTitle:{type:String}}},Er=Ir,Nr=(0,d.A)(Er,Wn,jn,!1,null,null,null),zr=Nr.exports,Fr={components:{TsChartCard:zr},props:["aggregationId"],data:function(){return{response:null,parameters:null,aggregationType:"",chartSeries:{},chartLabels:[],chartTitle:"",chartType:"",fieldName:"",height:0,isTimeSeries:!1,metricName:"",showDataLabels:!1,showXLabels:!1,showYLabels:!1,width:0,xTitle:"",yTitle:""}},computed:{sketch(){return this.$store.state.sketch}},methods:{loadAggregationData(e){_.getAggregationById(this.sketch.id,this.aggregationId).then(e=>{const t=e.data.objects[0];this.aggregationType=t.agg_type,this.parameters=JSON.parse(t.parameters),_.runAggregator(this.sketch.id,this.parameters).then(e=>{const t=e.data.objects[0][this.aggregationType];this.chartSeries=t.buckets,this.chartLabels=t.labels,this.chartTitle=t.chart_options.chartTitle,this.chartType=t.chart_type,this.fieldName=this.parameters.aggregator_parameters.fields[0].field,this.height=t.chart_options.height,this.isTimeSeries=t.chart_options.isTimeSeries,this.metricName=this.parameters.aggregator_parameters.aggregator_options.metric,this.showDataLabels=t.chart_options.showDataLabels,this.showXLabels=t.chart_options.showXLabels,this.showYLabels=t.chart_options.showYLabels,this.width=t.chart_options.width,this.xTitle=t.chart_options.xTitle,this.yTitle=t.chart_options.yTitle}).catch(e=>{console.error("Error requesting aggregation data: "+e)})}).catch(e=>{console.error("Error requesting aggregation parameters: "+e)})}},watch:{aggregationId:function(e){e&&this.loadAggregationData()}},mounted(){this.aggregationId&&this.loadAggregationData()}},Rr=Fr,Pr=(0,d.A)(Rr,Gn,Un,!1,null,null,null),Or=Pr.exports,Qr=function(){var e=this,t=e._self._c;return t("v-container",{attrs:{fluid:""}},[t("v-card",{staticClass:"mx-3 mt-3 mb-3",class:e.$vuetify.theme.dark?"":"context-card-light-grey-background",attrs:{outlined:""}},[t("v-toolbar",{staticStyle:{"background-color":"transparent"},attrs:{flat:"",dense:""}},[e.isLoading?t("span",[t("v-progress-circular",{staticClass:"mr-3",attrs:{size:20,width:1,indeterminate:"",color:"primary"}})],1):e._e(),e.activeQuestion.display_name?t("span",{staticStyle:{cursor:"pointer","font-size":"1.1em"},attrs:{id:"questionDropdownButton"}},[t("span",{on:{click:function(t){e.expanded=!e.expanded}}},[e.expanded?t("v-icon",[e._v("mdi-chevron-down")]):t("v-icon",[e._v("mdi-chevron-right")]),t("strong",[t("span",{staticClass:"ml-2 mr-3"},[t("span",[e._v(e._s(e.activeQuestion.display_name)+" ")])])])],1),t("v-btn",{staticClass:"text-none",attrs:{small:"",depressed:"",color:"primary"},on:{click:function(t){e.showDropdown=!e.showDropdown}}},[e._v(" Change question "),t("v-icon",{attrs:{small:"",right:""}},[e._v("mdi-chevron-down")])],1)],1):e._e(),e.showEmptySelect&&!e.isLoading?t("span",[t("v-btn",{staticClass:"text-none ml-n2",attrs:{depressed:"",color:"primary"},on:{click:function(t){e.showDropdown=!e.showDropdown}}},[e._v(" Select or create an investigative question ")])],1):e._e()]),e.showDropdown&&!e.isLoading?t("v-card",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.onClickOutside,expression:"onClickOutside"}],staticStyle:{position:"absolute","z-index":"1000"},attrs:{elevation:"10",outlined:"",width:"50%"}},[t("v-row",[t("v-col",{attrs:{cols:"12"}},[t("v-card",{staticClass:"ma-2",attrs:{outlined:""}},[t("v-text-field",{staticClass:"mx-2 mb-1",attrs:{placeholder:"Find a question, or create a new one..",autofocus:"","hide-details":"",dense:"","single-line":"",flat:"",solo:""},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.createQuestion()}},scopedSlots:e._u([{key:"append",fn:function(){return[t("v-btn",{staticClass:"text-none mt-1 mr-n3",attrs:{depressed:"",small:"",disabled:!e.queryString,color:"primary"},on:{click:function(t){return e.createQuestion()}}},[t("v-icon",{attrs:{left:"",small:""}},[e._v("mdi-plus")]),e._v(" Create new question ")],1)]},proxy:!0}],null,!1,3746051682),model:{value:e.queryString,callback:function(t){e.queryString=t},expression:"queryString"}})],1)],1)],1),t("v-row",{attrs:{"no-gutters":""}},[e.matches.questions&&e.matches.questions.length?t("v-col",{attrs:{cols:"12"}},[t("v-toolbar",{attrs:{dense:"",flat:""}},[t("strong",[e._v("Assigned questions for this sketch "),t("span",{staticStyle:{"font-size":"0.7em"}},[e._v("("+e._s(e.matches.questions.length)+")")])])]),t("v-list",{staticClass:"overflow-y-auto",staticStyle:{"max-height":"300px"}},[t("v-list-item-group",e._l(e.matches.questions,function(s,i){return t("v-list-item",{key:i,on:{click:function(t){return e.setActiveQuestion(s)}}},[t("v-icon",{staticClass:"mr-2",attrs:{small:"",disabled:!s.conclusions.length,color:s.conclusions.length?"success":""}},[e._v("mdi-check-circle")]),t("v-list-item-title",[e._v(e._s(s.name))])],1)}),1)],1)],1):e._e()],1),t("v-row",{attrs:{"no-gutters":""}},[e.matches.templates.length?t("v-col",{attrs:{cols:"12"}},[t("v-toolbar",{attrs:{dense:"",flat:""}},[t("strong",[e._v("Add DFIQ question "),t("span",{staticStyle:{"font-size":"0.7em"}},[e._v("("+e._s(e.matches.templates.length)+")")])])]),t("v-list",{staticClass:"overflow-y-auto",staticStyle:{height:"300px"}},[t("v-list-item-group",e._l(e.matches.templates,function(s,i){return t("v-list-item",{key:i,on:{click:function(t){return e.createQuestion(s)}}},[t("v-icon",{staticClass:"mr-2",attrs:{small:""}},[e._v("mdi-plus")]),t("v-list-item-content",[t("v-list-item-title",[e._v(" "+e._s(s.name))])],1)],1)}),1)],1)],1):e._e()],1)],1):e._e(),t("v-expand-transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded&&e.activeQuestion,expression:"expanded && activeQuestion"}]},[t("v-divider"),t("v-row",{attrs:{"no-gutters":""}},[t("v-col",[t("v-tabs",{attrs:{"background-color":"transparent"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[t("v-tab",{staticClass:"text-none",attrs:{disabled:0===e.allSuggestedQueries.length&&!e.userSettings.generateQuery}},[e._v(" Suggested queries "),t("span",{staticClass:"ml-1"},[t("small",[t("strong",[e._v("("+e._s(e.allSuggestedQueries.length)+")")])])])]),t("v-tab",{staticClass:"text-none",attrs:{disabled:!e.activeQuestion.approaches.length}},[e._v(" Approaches "),t("span",{staticClass:"ml-1"},[t("small",[t("strong",[e._v("("+e._s(e.activeQuestion.approaches.length)+")")])])])]),t("v-tab",{staticClass:"text-none"},[e._v(" Conclusions "),e.activeQuestion.conclusions.length?t("span",{staticClass:"ml-1"},[t("small",[t("strong",[e._v("("+e._s(e.activeQuestion.conclusions.length)+")")])])]):e._e()])],1),t("v-tabs-items",{staticStyle:{"background-color":"transparent"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[t("v-tab-item",{staticClass:"mb-2",attrs:{transition:!1}},[e.allSuggestedQueries.length?t("div",[t("div",{staticClass:"mt-4",staticStyle:{"background-color":"transparent"}},e._l(e.allSuggestedQueries,function(e){return t("ts-search-chip",{key:e.value,attrs:{searchchip:e,icon:"mdi-magnify",type:"link"}})}),1)]):e._e(),e.isNl2qAvailable?t("div",{staticClass:"mt-1"},[e.suggestedQueryLoading?t("div",{staticClass:"pa-2 pl-4"},[t("v-skeleton-loader",{attrs:{type:"sentences",width:"200"}})],1):e._e(),Object.keys(e.suggestedQuery).length&&!e.suggestedQueryLoading?t("div",[t("ts-search-chip",{staticClass:"mb-1",attrs:{searchchip:e.suggestedQuery,type:"link",icon:"mdi-shimmer"}})],1):e._e(),Object.keys(e.suggestedQuery).length||e.suggestedQueryLoading?e._e():t("div",{staticClass:"pl-4"},[t("v-btn",{staticClass:"text-none mt-2 mb-4 btn-gradient",attrs:{small:"",depressed:"",light:""},on:{click:e.getSuggestedQuery}},[t("v-icon",{attrs:{small:"",left:""}},[e._v("mdi-shimmer")]),e._v(" Generate query")],1)],1)]):e._e()]),t("v-tab-item",{attrs:{transition:!1}},[e.activeQuestion.approaches&&e.activeQuestion.approaches.length?t("div",[t("div",{staticClass:"pa-4 markdown-body",staticStyle:{"background-color":"transparent","font-size":"0.9em"},domProps:{innerHTML:e._s(e.toHtml(e.activeQuestion.description))}}),t("v-expansion-panels",{attrs:{flat:"",accordion:"",hover:""}},e._l(e.activeQuestion.approaches,function(s,i){return t("v-expansion-panel",{key:i,staticStyle:{"background-color":"transparent"}},[t("v-expansion-panel-header",{attrs:{"expand-icon":""},scopedSlots:e._u([{key:"default",fn:function({open:i}){return[t("div",{staticClass:"ml-2"},[t("v-icon",{staticClass:"mr-2 ml-n4"},[i?[e._v("mdi-chevron-down")]:[e._v("mdi-chevron-right")]],2),t("strong",[e._v(e._s(s.display_name))])],1)]}}],null,!0)}),t("v-expansion-panel-content",[t("ts-question-approach",{attrs:{approachJSON:s}})],1)],1)}),1)],1):e._e()]),t("v-tab-item",{attrs:{transition:!1}},[t("div",{staticClass:"pa-4 markdown-body",staticStyle:{"background-color":"transparent"}},[e._l(e.activeQuestion.conclusions,function(s){return t("v-sheet",{key:s.id,staticClass:"pa-3",staticStyle:{"max-width":"500px"},attrs:{outlined:"",rounded:""}},[t("ts-question-conclusion",{attrs:{question:e.activeQuestion,conclusion:s},on:{delete:function(t){return e.deleteConclusion(s)},"save-conclusion":function(t){return e.refreshActiveQuestion()}}})],1)}),e.currentUserConclusion?e._e():t("div",{staticStyle:{"font-size":"0.9em","max-width":"500px"}},[t("v-textarea",{class:e.$vuetify.theme.dark?"":"textfield-light-background",staticStyle:{"font-size":"0.9em"},attrs:{outlined:"",flat:"","hide-details":"","auto-grow":"",rows:"3",clearable:"",placeholder:"Add your conclusion..."},model:{value:e.conclusionText,callback:function(t){e.conclusionText=t},expression:"conclusionText"}}),t("v-btn",{staticClass:"mt-2",attrs:{small:"",text:"",color:"primary",disabled:!e.conclusionText},on:{click:function(t){return e.createConclusion()}}},[e._v(" Save ")])],1)],2)])],1)],1)],1)],1)])],1)],1)},Mr=[],qr=function(){var e=this,t=e._self._c;return t("div",["chip"===e.type?t("v-chip",{attrs:{small:""},on:{click:function(t){return e.search(e.queryString)}}},[t("v-icon",{staticClass:"mr-1",attrs:{small:""}},[e._v("mdi-magnify")]),e._v(" "+e._s(e.displayName)+" ")],1):e._e(),"link"===e.type?t("div",{class:e.searchchip.error?"":"enabled",on:{click:function(t){return e.search(e.queryString)}}},[t("div",{staticClass:"pb-1 pl-1",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",staticStyle:{"font-size":"0.9em"}},[t("span",[t("v-icon",{staticClass:"mr-2 ml-2",attrs:{small:""}},[e._v(e._s(e.icon))]),t("strong",[e._v(e._s(e.displayName))]),t("br"),e.searchchip.error?t("small",{staticClass:"ml-8",staticStyle:{"font-size":"0.8em"}},[e._v(e._s(e.searchchip.error))]):t("div",{staticClass:"truncate-with-ellipsis",staticStyle:{width:"90%"}},[t("small",{staticClass:"ml-8",staticStyle:{"font-size":"0.8em"}},[e._v(e._s(e.queryString))])])],1)])]):e._e()],1)},Br=[];const Vr=()=>({from:0,terminate_after:40,size:40,indices:"_all",order:"asc",chips:[]});var Hr={props:["searchchip","type","icon"],computed:{displayName(){return this.searchchip.name||this.searchchip.description},queryString(){return this.searchchip.query_string||this.searchchip.value}},methods:{search(e){if(this.searchchip.error)return;let t={doSearch:!0};t.queryString=e,t.queryFilter=Vr(),l.$emit("setQueryAndFilter",t)}}},Gr=Hr,Ur=(0,d.A)(Gr,qr,Br,!1,null,"3453ec85",null),Wr=Ur.exports,jr=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{"font-size":"0.9em"}},[t("div",{staticClass:"pb-4 markdown-body",staticStyle:{"font-size":"1em","background-color":"transparent"},domProps:{innerHTML:e._s(e.toHtml(e.approach.description))}}),e.opensearchQueries.length?t("div",{staticClass:"pb-4"},[t("strong",[e._v("Suggested queries")]),e._l(e.opensearchQueries,function(e){return t("ts-search-chip",{key:e.value,staticClass:"mb-1 mt-2",attrs:{searchchip:e,type:"link"}})})],2):e._e(),t("span",{staticStyle:{cursor:"pointer"},on:{click:function(t){e.showDetails=!e.showDetails}}},[e.showDetails?t("v-icon",{attrs:{small:""}},[e._v("mdi-chevron-down")]):t("v-icon",{attrs:{color:"primary",small:""}},[e._v("mdi-chevron-right")]),t("small",{staticStyle:{color:"#1976d2"}},[e._v("More info..")])],1),t("v-expand-transition",[e.showDetails?t("div",{staticClass:"mt-3"},[e.approach.references&&e.approach.references.length?t("div",[t("v-icon",{staticClass:"mr-2"},[e._v("mdi-link-variant")]),t("strong",[e._v("References")]),t("ul",{staticClass:"mb-4 mt-2 markdown-body",staticStyle:{"line-height":"70%","background-color":"transparent"}},e._l(e.approach.references,function(s){return t("li",{key:s},[t("div",{staticStyle:{"font-size":"0.9em"},domProps:{innerHTML:e._s(e.toHtml(s))}})])}),0)],1):e._e(),t("v-sheet",{staticClass:"mb-3",staticStyle:{"max-width":"80%","background-color":"transparent"}},[t("v-icon",{staticClass:"mr-2",attrs:{color:"success"}},[e._v("mdi-check")]),t("strong",[e._v("Covered")]),t("ul",{staticClass:"mt-2"},e._l(e.approach.notes.covered,function(s){return t("li",{key:s},[e._v(e._s(s))])}),0)],1),t("v-sheet",{staticStyle:{"max-width":"80%","background-color":"transparent"}},[t("v-icon",{staticClass:"mr-2",attrs:{color:"error"}},[e._v("mdi-close")]),t("strong",[e._v("Not covered")]),t("ul",{staticClass:"mt-2"},e._l(e.approach.notes.not_covered,function(s){return t("li",{key:s},[e._v(e._s(s))])}),0)],1)],1):e._e()])],1)},Yr=[],Xr={props:["approachJSON"],components:{TsSearchChip:Wr},data:function(){return{showDetails:!1}},computed:{approach(){return JSON.parse(this.approachJSON.spec_json)},opensearchQueries(){let e=[];return this.approach.steps&&this.approach.steps.forEach(t=>{"opensearch-query"===t.type&&e.push(t)}),e}},methods:{toHtml(e){return Mt.A.sanitize((0,ss.xI)(e))}}},Jr=Xr,Kr=(0,d.A)(Jr,jr,Yr,!1,null,null,null),Zr=Kr.exports,el=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{position:"relative"},on:{mouseover:function(t){e.showControls=!0},mouseleave:function(t){e.showControls=!1}}},[t("div",{staticClass:"mb-4",staticStyle:{"font-size":"0.9em"}},[t("strong",[e._v(e._s(e.conclusion.user.username))]),t("small",{staticClass:"ml-3"},[e._v(e._s(e._f("shortDateTime")(e.conclusion.created_at))+" ("+e._s(e._f("timeSince")(e.conclusion.created_at))+")")])]),e.editable?t("div",[t("v-textarea",{staticStyle:{"font-size":"0.9em"},attrs:{outlined:"",flat:"","hide-details":"","auto-grow":"",rows:"3",clearable:"",value:e.conclusion.conclusion},model:{value:e.conclusionText,callback:function(t){e.conclusionText=t},expression:"conclusionText"}}),t("v-card-actions",[t("v-btn",{attrs:{small:"",text:"",color:"primary",disabled:!e.conclusionText},on:{click:function(t){return e.saveConclusion()}}},[e._v(" Save ")]),t("v-btn",{attrs:{small:"",text:""},on:{click:function(t){e.editable=!1}}},[e._v(" Cancel ")])],1)],1):t("div",{staticStyle:{"font-size":"0.9em"}},[e._v(e._s(e.conclusion.conclusion))]),e.showControls&&e.currentUser==e.conclusion.user.username?t("div",{staticStyle:{position:"absolute",top:"0",right:"0"}},[t("v-chip",{staticStyle:{"margin-right":"10px"},attrs:{outlined:""}},[t("v-btn",{attrs:{icon:"",small:""}},[t("v-icon",{attrs:{small:""},on:{click:function(t){return e.editConclusion()}}},[e._v("mdi-square-edit-outline")])],1),t("v-btn",{attrs:{icon:"",small:""}},[t("v-icon",{attrs:{small:""},on:{click:function(t){return e.deleteConclusion()}}},[e._v("mdi-trash-can-outline")])],1)],1)],1):e._e()])},tl=[],sl={props:["question","conclusion"],data:function(){return{conclusionText:"",editable:!1,showControls:!1}},computed:{sketch(){return this.$store.state.sketch},currentUser(){return this.$store.state.currentUser}},methods:{saveConclusion(){this.editable=!1,this.showControls=!1,_.editQuestionConclusion(this.sketch.id,this.question.id,this.conclusion.id,this.conclusionText).then(e=>{this.$emit("save-conclusion")}).catch(e=>{this.editable=!0,this.errorSnackBar(e),console.error(e)})},editConclusion(){this.conclusionText=this.conclusion.conclusion,this.editable=!0},deleteConclusion(){confirm("Are you sure?")&&this.$emit("delete")}}},il=sl,al=(0,d.A)(il,el,tl,!1,null,"0cd171b2",null),nl=al.exports,rl={components:{TsQuestionApproach:Zr,TsQuestionConclusion:nl,TsSearchChip:Wr},props:{questionId:{type:[String,Number],default:null},initialTab:{type:Number,default:0,validator:e=>e>=0&&e<=2}},data:function(){return{isLoading:!1,expanded:!1,questionTemplates:[],sketchQuestions:[],activeQuestion:{approaches:[],conclusions:[]},searchHistory:[],conclusionText:"",activeTab:0,currentTitle:"",queryString:"",showDropdown:!1,showEmptySelect:!1,suggestedQuery:{},suggestedQueryLoading:!1}},computed:{sketch(){return this.$store.state.sketch},currentUser(){return this.$store.state.currentUser},systemSettings(){return this.$store.state.systemSettings},userSettings(){return this.$store.state.settings},isNl2qAvailable(){return this.userSettings.generateQuery&&this.systemSettings.LLM_FEATURES_AVAILABLE&&this.systemSettings.LLM_FEATURES_AVAILABLE.nl2q},matches(){if(!this.queryString)return{questions:this.sketchQuestions,templates:this.questionTemplates};let e={};return this.sketchQuestions&&(e["questions"]=this.sketchQuestions.filter(e=>e.name.toLowerCase().includes(this.queryString.toLowerCase()))),this.questionTemplates&&(e["templates"]=this.questionTemplates.filter(e=>e.name.toLowerCase().includes(this.queryString.toLowerCase()))),e},allSuggestedQueries(){if(!this.activeQuestion.approaches.length)return[];let e=[],t=this.activeQuestion.approaches.map(e=>JSON.parse(e.spec_json));return t&&t.forEach(t=>{t.steps&&t.steps.forEach(t=>{"opensearch-query"===t.type&&e.push(t)})}),e},currentUserConclusion(){return!!this.activeQuestion.conclusions&&this.activeQuestion.conclusions.filter(e=>e.user.username===this.currentUser).length}},methods:{getSuggestedQuery(){this.suggestedQueryLoading=!0;let e={question:this.activeQuestion.display_name};_.llmRequest(this.sketch.id,"nl2q",e).then(e=>{this.suggestedQuery=e.data,this.suggestedQueryLoading=!1}).catch(e=>{console.error(e)})},getQuestionTemplates(){this.isLoading=!0,_.getQuestionTemplates().then(e=>{this.questionTemplates=e.data.objects,this.isLoading=!1}).catch(e=>{console.error(e)})},getSketchQuestions(){return this.isLoading=!0,_.getOrphanQuestions(this.sketch.id).then(e=>{this.sketchQuestions=e.data.objects[0],this.isLoading=!1}).catch(e=>{console.error(e)})},createQuestion(e=null){let t=this.queryString,s=null;null!==e&&(t=e.name,s=e.id),_.createQuestion(this.sketch.id,null,null,t,s).then(e=>{const t=e.data.objects[0];this.setActiveQuestion(t),this.$emit("new-question",t),this.getSketchQuestions()}).catch(e=>{console.error(e)})},getSearchHistory(){_.getSearchHistory(this.sketch.id,5,this.activeQuestion.id).then(e=>{e.data.objects.length?this.searchHistory=e.data.objects.reverse():this.searchHistory=[]}).catch(e=>{console.error(e)})},refreshActiveQuestion(){_.getQuestion(this.sketch.id,this.activeQuestion.id).then(e=>{this.activeQuestion=e.data.objects[0]}).catch(e=>{console.error(e)})},createConclusion(){_.createQuestionConclusion(this.sketch.id,this.activeQuestion.id,this.conclusionText).then(e=>{this.conclusionText="",this.refreshActiveQuestion(),this.getSketchQuestions()}).catch(e=>{console.error(e)})},deleteConclusion(e){_.deleteQuestionConclusion(this.sketch.id,this.activeQuestion.id,e.id).then(e=>{this.refreshActiveQuestion(),this.getSketchQuestions()}).catch(e=>{console.error(e)})},setActiveQuestion(e){this.activeQuestion=e,this.showDropdown=!1,this.showEmptySelect=!1,this.queryString="",this.currentTitle=e.name,this.expanded=!0,this.suggestedQuery={},this.isNl2qAvailable?this.activeQuestion.conclusions.length?this.activeTab=2:this.activeTab=0:this.activeQuestion.conclusions.length?this.activeTab=2:this.allSuggestedQueries.length?this.activeTab=0:this.activeQuestion.approaches.length?this.activeTab=1:this.activeTab=2;let t={scenarioId:null,facetId:null,questionId:e.id};this.$store.dispatch("setActiveContext",t)},toHtml(e){if(e)return Mt.A.sanitize((0,ss.xI)(e))},onClickOutside(e){"questionDropdownButton"!==e.target.id&&(this.showDropdown=!1)},search(e){let t={doSearch:!0};t.queryString=e.query_string,t.queryFilter=JSON.parse(e.query_filter),t.incognito=!0,l.$emit("setQueryAndFilter",t)},fetchQuestion(e){return this.isLoading=!0,new Promise((t,s)=>{_.getQuestion(this.sketch.id,e).then(e=>{let s=e.data.objects[0];t(s)}).catch(e=>{console.error("Error fetching question:",e),this.isLoading=!1,this.activeQuestion=null,this.$emit("error","Failed to load question."),s(e)}).finally(()=>{this.isLoading=!1})})}},beforeDestroy(){l.$off("createBranch")},mounted(){if(l.$on("createBranch",this.getSearchHistory),this.questionId)this.fetchQuestion(this.questionId).then(e=>{e?(this.activeQuestion=e,this.expanded=!0,this.initialTab?this.activeTab=this.initialTab:this.activeTab=2):console.error("No question found with ID: ",this.questionId)}).catch(e=>{console.error("Error in mounted:",e)});else{let e=this.$route.query.question_uuid;if(this.getQuestionTemplates(),this.getSketchQuestions().then(()=>{if(e){const t=this.sketchQuestions.find(t=>t.uuid===e);if(!t)return this.errorSnackBar("No question found with that UUID"),void(this.showEmptySelect=!0);this.setActiveQuestion(t)}}),!e){let e="sketchContext"+this.sketch.id.toString(),t=localStorage.getItem(e),s={};t&&(s=JSON.parse(t)),Object.keys(s).length?(this.isLoading=!0,_.getQuestion(this.sketch.id,s.questionId).then(e=>{this.setActiveQuestion(e.data.objects[0]),this.isLoading=!1}).catch(e=>{console.error(e)})):this.showEmptySelect=!0}}}},ll=rl,ol=(0,d.A)(ll,Qr,Mr,!1,null,null,null),cl=ol.exports;const dl=()=>({componentName:"",componentProps:{},content:"",draft:"",edit:!0,isActive:!1,showGraphMenu:!1,showSavedSearchMenu:!1,showSavedVisualizationMenu:!1,showQuestionMenu:!1}),ul=()=>({TsViewEventList:"TsEventList"});var hl={props:["sketchId","storyId"],components:{TsEventList:gi,TsCytoscape:On,TsSavedVisualization:Or,TsQuestionCard:cl,TsQuestionConclusion:nl},data:function(){return{title:"",titleDraft:"",blocks:[],renameStoryDialog:!1,deleteStoryDialog:!1,sketchQuestions:[]}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},hasContent(){return!!this.blocks.length&&!(this.blocks.length<2&&!this.blocks[0].componentName&&!this.blocks[0].content)},graphPlugins(){return this.$store.state.graphPlugins},savedGraphs(){return this.$store.state.savedGraphs},savedVisualizations(){return this.$store.state.savedVisualizations?this.$store.state.savedVisualizations.filter(e=>"apex"===JSON.parse(e.parameters)["aggregator_class"]):[]},availableSketchQuestions(){const e=this.blocks.filter(e=>"TsInvestigativeQuestion"===e.componentName).map(e=>e.componentProps.questionId),t=Array.isArray(this.sketchQuestions)?this.sketchQuestions:[];return t.filter(t=>!e.includes(t.id))}},methods:{updateDraft:Ce().debounce(function(e,t){t.draft=e},300),async fetchStory(){_.getStory(this.sketchId,this.storyId).then(e=>{this.title=e.data.objects[0].title,this.titleDraft=this.title;let t=e.data.objects[0].content;this.blocks="[]"===t?[dl()]:JSON.parse(t),this.formatBlocks(this.blocks),this.blocks.length<2&&!this.blocks[0].componentName&&!this.blocks[0].content&&(this.blocks[0].edit=!0)}).catch(e=>{console.error(e)})},formatBlocks(e){let t=ul();return e.forEach(e=>{e.componentName in t&&(e.componentName=t[e.componentName])}),e},formatComponentProps(e){if("TsEventList"===e.componentName||"TsViewEventList"===e.componentName){const t=10;let s=e.componentProps.view.query_string||e.componentProps.view.query,i=e.componentProps.view.query_filter||e.componentProps.view.filter,a={};return i=i&&void 0!==i?JSON.parse(i):{},i.size=t,i.terminate_after=t,a["queryString"]=s,a["queryFilter"]=i,a["incognito"]=!0,{queryRequest:a,disableSaveSearch:!0,itemsPerPage:t}}return e.componentProps},toHtml(e){return Mt.A.sanitize((0,ss.xI)(e))},addTextBlock(e){let t=e+1,s=dl();this.blocks.splice(t,0,s)},addEventListBlock(e,t){let s=t+1,i=dl();i.componentName="TsEventList",i.componentProps={view:e},this.blocks.splice(s,0,i),this.save()},addGraphPluginBlock(e,t){let s=t+1,i=dl();i.componentName="TsCytoscapePlugin",i.componentProps={graphPluginName:e.name,canvasHeight:"500px",disableZoom:!0},this.blocks.splice(s,0,i),this.save()},addSavedGraphBlock(e,t){let s=t+1,i=dl();i.componentName="TsCytoscapeSavedGraph",i.componentProps={savedGraphId:e.id,canvasHeight:"400px",disableZoom:!0},i.graphName=e.name,this.blocks.splice(s,0,i),this.save()},addSavedVisualization(e,t){let s=t+1,i=dl();i.componentName="TsSavedVisualization",i.componentProps={name:e.name,savedVisualizationId:e.id},this.blocks.splice(s,0,i),this.save()},async addQuestionBlock(e,t){let s=t+1,i=dl();i.componentName="TsInvestigativeQuestion",i.componentProps={questionName:e.name,questionId:e.id},this.blocks.splice(s,0,i),await this.save(),await this.fetchStory()},editTextBlock(e){e.edit||(e.edit=!0,e.draft=e.content)},deleteBlock(e){confirm("Delete block?")&&(this.blocks.splice(e,1),this.blocks.length||(this.blocks=[dl()]),this.save())},setActiveView:function(e){l.$emit("setActiveView",e)},setActiveGraph:function(e){"string"===typeof e?l.$emit("setGraphPlugin",e):"number"===typeof e&&l.$emit("setSavedGraph",e)},async save(){let e;this.blocks.forEach(function(e){e.isActive=!1,e.showGraphMenu=!1,e.showSavedSearchMenu=!1,e.showSavedVisualizationMenu=!1,e.showQuestionMenu=!1,e.edit=!1,e.draft&&(e.content=e.draft,e.draft="")}),this.hasContent?e=JSON.stringify(this.blocks):(e=JSON.stringify([]),this.blocks=[dl()]),_.updateStory(this.title,e,this.sketchId,this.storyId).then(e=>{this.$store.dispatch("updateSketch",this.sketchId)}).catch(e=>{})},rename(){this.renameStoryDialog=!1,this.title=this.titleDraft,this.save()},deleteStory(){this.deleteStoryDialog=!1,_.deleteStory(this.sketchId,this.storyId).then(e=>{this.blocks=[],_.getStoryList(this.sketchId).then(e=>{const t=e.data.objects[0];if(t&&t.length>0){const e=t[0].id;this.$router.push({name:"Story",params:{sketchId:this.sketchId,storyId:e}})}else this.$router.push({name:"Overview",params:{sketchId:this.sketchId}})}).catch(e=>{console.error("Error getStoryList",e),this.$router.push({name:"Sketches"})}),this.$store.dispatch("updateSketch",this.sketchId)}).catch(e=>{console.error("Error deleting story:",e),this.$router.push({name:"Sketches"})})},async getSketchQuestions(){try{const e=await _.getOrphanQuestions(this.sketch.id);this.sketchQuestions=e.data.objects[0]}catch(du){console.error(du)}}},mounted(){this.storyId&&this.fetchStory(),this.getSketchQuestions()},watch:{storyId:function(e){this.storyId&&this.fetchStory()}}},ml=hl,pl=(0,d.A)(ml,Vn,Hn,!1,null,null,null),vl=pl.exports,gl=function(){var e=this,t=e._self._c;return t("v-container",{attrs:{fluid:""}},[t("v-card",{staticClass:"pa-3 pt-0 mt-n3",attrs:{flat:"",color:"transparent"}},[t("div",{staticClass:"mt-2"},[t("ts-timeline-search",{attrs:{componentName:"analysis",includeProcessingTimelines:!1,"analyzer-timeline-id":e.analyzerTimelineId},on:{selectedTimelines:function(t){e.timelineSelection=t}}})],1),t("v-divider"),t("div",[t("ts-analyzer-list",{attrs:{timelineSelection:e.timelineSelection}})],1),t("v-divider")],1)],1)},fl=[],yl=function(){var e=this,t=e._self._c;return t("div",[t("v-btn",{staticClass:"mb-1",attrs:{small:"",text:"",color:"primary"},on:{click:function(t){return e.selectAll()}}},[t("v-icon",{attrs:{left:"",small:""}},[e._v("mdi-plus")]),t("span",[e._v("Select all")])],1),t("v-btn",{staticClass:"mb-1",attrs:{small:"",text:"",color:"primary"},on:{click:function(t){return e.unselectAll()}}},[t("v-icon",{attrs:{left:"",small:""}},[e._v("mdi-minus")]),t("span",[e._v("Unselect all")])],1),t("v-autocomplete",{staticClass:"center-label-height",attrs:{items:e.allReadyTimelines,outlined:"",label:`Select timelines for ${e.componentName}`,"item-text":"name","item-value":"id",multiple:""},scopedSlots:e._u([{key:"selection",fn:function(s){return[t("ts-analyzer-timeline-chip",{staticClass:"mr-1",attrs:{timeline:s.item,close:!0},on:{"click:close":function(t){return e.remove(s.item)}}})]}},{key:"item",fn:function(s){return[t("v-list-item-content",[t("div",[t("ts-analyzer-timeline-chip",{attrs:{timeline:s.item,close:e.selectedTimelines.includes(s.item.id)},on:{"click:close":function(t){return e.remove(s.item)}}})],1)])]}}]),model:{value:e.selectedTimelines,callback:function(t){e.selectedTimelines=t},expression:"selectedTimelines"}})],1)},_l=[],bl=function(){var e=this,t=e._self._c;return t("ts-timeline-component",{attrs:{timeline:e.timeline},scopedSlots:e._u([{key:"processed",fn:function(s){return[t("v-chip",{staticClass:"timeline-chip",style:e.timelineStyle,attrs:{ripple:!1,close:e.close},on:{"click:close":function(t){return e.$emit("click:close")}}},[t("div",{staticClass:"chip-content"},[t("v-icon",{staticClass:"ml-n2",attrs:{left:"",color:s.timelineChipColor,size:"26"}},[e._v(" mdi-circle ")]),t("v-tooltip",{attrs:{bottom:"",disabled:e.timeline.name.length<30,"open-delay":"200"},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("span",e._g(e._b({staticClass:"timeline-name-ellipsis"},"span",i,!1),s),[e._v(e._s(e.timeline.name))])]}}],null,!0)},[t("span",[e._v(e._s(e.timeline.name))])]),"processing"===e.timeline.status[0].status?t("span",{staticClass:"ml-3 mr-3"},[t("v-progress-circular",{attrs:{small:"",indeterminate:"",color:"grey",size:17,width:2}})],1):e._e()],1)])]}}])})},Sl=[],kl={props:{timeline:Object,close:{type:Boolean,default:!1}},components:{TsTimelineComponent:Ee},computed:{timelineStyle(){return{backgroundColor:this.$vuetify.theme.dark?"#4d4d4d":"#e6e6e6"}}}},wl=kl,xl=(0,d.A)(wl,bl,Sl,!1,null,"20923ce0",null),Tl=xl.exports,Cl={components:{TsAnalyzerTimelineChip:Tl},props:["analyzerTimelineId","componentName","includeProcessingTimelines"],data(){return{selectedTimelines:[]}},computed:{sketch(){return this.$store.state.sketch},allReadyTimelines(){const e=this.sketch.timelines.filter(e=>"ready"===e.status[0].status||this.includeProcessingTimelines&&"processing"===e.status[0].status);return e.sort((e,t)=>e.name.localeCompare(t.name)),e}},watch:{selectedTimelines:{handler:function(e){this.$emit("selectedTimelines",e)},deep:!0},analyzerTimelineId:{handler:function(e){Array.isArray(e)?this.selectedTimelines=e:e?this.selectedTimelines.push(e):this.selectedTimelines=[]}}},methods:{remove(e){this.selectedTimelines=this.selectedTimelines.filter(t=>t!==e.id)},selectAll(){this.selectedTimelines=[...this.allReadyTimelines.map(e=>e.id)]},unselectAll(){this.selectedTimelines=[]}}},Al=Cl,Dl=(0,d.A)(Al,yl,_l,!1,null,"c1388c6c",null),$l=Dl.exports,Ll=function(){var e=this,t=e._self._c;return t("v-simple-table",{scopedSlots:e._u([{key:"default",fn:function(){return[t("thead",[t("tr",[t("th"),t("th",{staticClass:"text-left"},[e._v(" Name ")]),t("th",{staticClass:"text-left"},[e._v(" Description ")])])]),t("tbody",e._l(e.sortedAnalyzerList,function(s){return t("tr",{key:s.analyzerName},[t("td",[t("v-tooltip",{attrs:{right:"","open-delay":"500"},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("div",e._g({staticClass:"d-inline-block d-flex justify-center pr-4"},i),[e.isLoading(s.analyzerName)?t("v-progress-circular",{attrs:{size:20,width:2,indeterminate:"",color:"primary"}}):e._e(),e.isLoading(s.analyzerName)?e._e():t("v-btn",{attrs:{icon:"",color:"primary",disabled:!(e.timelineSelection.length>0)},on:{click:function(t){e.showRerunIcon(s.analyzerName)?e.handleReRunDialog(s.analyzerName,s.info.display_name):e.runAnalyzer(s.analyzerName)}}},[e.showRerunIcon(s.analyzerName)?t("v-icon",[e._v("mdi-replay")]):t("v-icon",[e._v(" mdi-play-circle-outline ")])],1)],1)]}}],null,!0)},[0===e.timelineSelection.length?t("span",[e._v("Please select a timeline above first.")]):e.showRerunIcon(s.analyzerName)?t("span",[e._v('Re-run analyzer: "'+e._s(s.info.display_name)+'"')]):t("span",[e._v('Run analyzer: "'+e._s(s.info.display_name)+'"')])])],1),t("td",[e._v(e._s(s.info.display_name))]),t("td",[e._v(e._s(s.info.description))])])}),0),t("v-dialog",{attrs:{"max-width":"515","retain-focus":!1},model:{value:e.reRunDialog,callback:function(t){e.reRunDialog=t},expression:"reRunDialog"}},[t("v-card",[t("v-card-title",[t("v-icon",{attrs:{large:""}},[e._v("mdi-replay")]),t("span",{staticClass:"text-h6 ml-2"},[e._v('Run "'+e._s(e.reRunDialogAnalyzerDisplayName)+'" again?')])],1),t("v-card-text",[t("div",{staticClass:"mb-2"},[e._v(' The "'+e._s(e.reRunDialogAnalyzerDisplayName)+'" analyzer was already run on the selected timelines. Do you really want to run it again? ')])]),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{color:"primary",text:""},on:{click:function(t){e.reRunDialog=!1}}},[e._v(" cancel ")]),t("v-btn",{attrs:{color:"primary",text:""},on:{click:function(t){e.runAnalyzer(e.reRunDialogAnalyzerName,!0),e.reRunDialog=!1}}},[e._v(" continue ")])],1)],1)],1)]},proxy:!0}])})},Il=[];const El=3e3;var Nl={props:["timelineSelection"],data(){return{triggeredAnalyzers:[],loadingAnalyzers:[],reRunDialog:!1,reRunDialogAnalyzerName:"",reRunDialogAnalyzerDisplayName:""}},computed:{sketch(){return this.$store.state.sketch},analyzerList(){return this.$store.state.sketchAnalyzerList},analyzerResults(){return this.$store.state.analyzerResults},analyzersAlreadyRun(){const e=new Set(this.timelineSelection),t=this.analyzerResults.filter(t=>e.has(t.timeline.id)),s=new Map;for(const a of t)s.has(a.analyzer_name)||s.set(a.analyzer_name,new Set),s.get(a.analyzer_name).add(a.timeline.id);const i=new Set;for(const[a,n]of s)n.size===e.size&&i.add(a);return this.triggered.forEach(e=>i.has(e)?null:i.add(e)),this.resetTriggeredAnalyzers(),i},activeAnalyzerTimelinesMap(){const e=new Map;for(const t of this.$store.state.activeAnalyses)e.has(t.analyzer_name)||e.set(t.analyzer_name,new Set),e.get(t.analyzer_name).add(t.timeline.id);return e},sortedAnalyzerList(){let e=Object.entries(this.analyzerList).map(([e,t])=>({analyzerName:e,info:t})),t=[...e];return t.sort((e,t)=>e.info.display_name.localeCompare(t.info.display_name)),t},triggered(){return this.triggeredAnalyzers},loading(){return this.loadingAnalyzers}},methods:{handleReRunDialog(e,t){this.reRunDialogAnalyzerName=e,this.reRunDialogAnalyzerDisplayName=t,this.reRunDialog=!0},isLoading(e){return this.loading.includes(e)},showRerunIcon(e){return this.analyzersAlreadyRun.has(e)},activeTimelinesCount(e){const t=this.activeAnalyzerTimelinesMap.get(e);return t?t.size:0},runAnalyzer(e,t=!1){this.triggeredAnalyzers=[...this.triggeredAnalyzers,e],this.loadingAnalyzers=[...this.loadingAnalyzers,e],setTimeout(()=>{this.removeFromLoading(e)},El);const s=(new Date).getTime();_.runAnalyzers(this.sketch.id,this.timelineSelection,[e],t).then(t=>{let i=[],a=[];for(let e of t.data.objects[0])a.push(e.id),i=i.concat(e.analyses);this.$store.dispatch("addActiveAnalyses",i),(new Date).getTime()-s>=El&&this.removeFromLoading(e)}).catch(e=>{console.log(e)})},removeFromLoading(e){this.loadingAnalyzers=this.loadingAnalyzers.filter(t=>e!==t)},resetTriggeredAnalyzers(){this.triggeredAnalyzers=[]}}},zl=Nl,Fl=(0,d.A)(zl,Ll,Il,!1,null,null,null),Rl=Fl.exports,Pl={components:{TsTimelineSearch:$l,TsAnalyzerList:Rl},props:["sketchId","analyzerTimelineId"],data(){return{timelineSelection:[]}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta}}},Ol=Pl,Ql=(0,d.A)(Ol,gl,fl,!1,null,null,null),Ml=Ql.exports,ql=function(){var e=this,t=e._self._c;return t("v-container",{attrs:{fluid:""}},[e.aggregationId?e._e():t("ts-visualization-editor"),e.aggregationId?t("ts-saved-visualization",{attrs:{aggregationId:e.aggregationId}}):e._e()],1)},Bl=[],Vl=function(){var e=this,t=e._self._c;return t("div",[t("v-dialog",{attrs:{width:"600"},model:{value:e.renameVisualDialog,callback:function(t){e.renameVisualDialog=t},expression:"renameVisualDialog"}},[t("v-card",{staticClass:"pa-4"},[t("h3",[e._v("Rename Visualization")]),t("br"),t("v-form",{on:{submit:function(t){return t.preventDefault(),e.rename()}}},[t("v-text-field",{attrs:{outlined:"",dense:"",autofocus:""},on:{focus:function(e){return e.target.select()}},model:{value:e.selectedChartTitleDraft,callback:function(t){e.selectedChartTitleDraft=t},expression:"selectedChartTitleDraft"}}),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:""},on:{click:function(t){e.renameVisualDialog=!1}}},[e._v(" Cancel ")]),t("v-btn",{attrs:{color:"primary",text:""},on:{click:function(t){return e.rename()}}},[e._v(" Save ")])],1)],1)],1)],1),t("v-toolbar",{staticClass:"mt-n3",attrs:{dense:"",flat:"",color:"transparent"}},[t("v-toolbar-title",{on:{dblclick:function(t){e.renameVisualDialog=!0}}},[e._v(" "+e._s(e.selectedChartTitle))]),t("v-btn",{attrs:{icon:"",small:""},on:{click:function(t){e.renameVisualDialog=!0}}},[t("v-icon",{attrs:{small:""}},[e._v("mdi-pencil")])],1)],1),t("v-divider",{staticClass:"mx-3"}),t("v-row",{staticClass:"mt-3"},[t("v-col",[t("TsAggregationEventSelect",{attrs:{timelineIDs:e.selectedTimelineIDs,queryString:e.selectedQueryString,queryChips:e.selectedQueryChips},on:{updateTimelineIDs:function(t){e.selectedTimelineIDs=t},updateQueryString:function(t){e.selectedQueryString=t},updateQueryChips:function(t){e.selectedQueryChips=t}}}),t("TsAggregationConfig",{attrs:{field:e.selectedField,aggregator:e.selectedAggregator,metric:e.selectedMetric,maxItems:e.selectedMaxItems,interval:e.selectedInterval,intervalQuantity:e.selectedIntervalQuantity,splitByTimeline:e.selectedSplitByTimeline},on:{updateField:function(t){e.selectedField=t},updateAggregator:function(t){e.selectedAggregator=t},updateMetric:function(t){e.selectedMetric=t},updateMaxItems:function(t){e.selectedMaxItems=t},updateInterval:function(t){e.selectedInterval=t},updateIntervalQuantity:function(t){e.selectedIntervalQuantity=t},updateSplitByTimeline:function(t){e.selectedSplitByTimeline=t}}}),t("TsChartConfig",{attrs:{aggregatorType:e.selectedAggregator,chartType:e.selectedChartType,title:e.selectedChartTitle,height:e.selectedHeight,width:e.selectedWidth,xTitle:e.selectedXTitle,showXLabels:e.selectedShowXLabels,yTitle:e.selectedYTitle,showYLabels:e.selectedShowYLabels,showDataLabels:e.selectedShowDataLabels},on:{updateChartType:function(t){e.selectedChartType=t},updateTitle:function(t){e.selectedChartTitle=t},updateHeight:function(t){e.selectedHeight=t},updateWidth:function(t){e.selectedWidth=t},updateXTitle:function(t){e.selectedXTitle=t},updateShowXLabels:function(t){e.selectedShowXLabels=t},updateYTitle:function(t){e.selectedYTitle=t},updateShowYLabels:function(t){e.selectedShowYLabels=t},updateShowDataLabels:function(t){e.selectedShowDataLabels=t}}})],1),t("v-col",{class:null==e.chartSeries?"d-flex justify-center align-center":"",attrs:{cols:"8"}},[null==e.chartSeries?t("v-img",{attrs:{src:"/dist/vis_placeholder.png","max-width":"600","max-height":"500",contain:""}}):e._e(),e.chartSeries&&e.selectedChartType?t("TsChartCard",{attrs:{fieldName:e.selectedField.field,metricName:e.selectedMetric,"is-time-series":!!e.selectedAggregator&&e.selectedAggregator.endsWith("date_histogram"),chartSeries:e.chartSeries,chartLabels:e.chartLabels,chartType:e.selectedChartType,height:e.selectedHeight,width:e.selectedWidth,xTitle:e.selectedXTitle,showXLabels:e.selectedShowXLabels,yTitle:e.selectedYTitle,showYLabels:e.selectedShowYLabels,showDataLabels:e.selectedShowDataLabels}}):e._e()],1)],1),t("v-divider",{staticClass:"mx-3"}),t("div",{staticClass:"mt-4"},[t("v-btn",{staticClass:"ml-3",attrs:{color:"primary",disabled:0==e.selectedTimelineIDs.length||null==e.response||!e.selectedChartTitle},on:{click:e.saveVisualization}},[e._v(" Save ")]),t("v-btn",{attrs:{text:"",color:"primary",disabled:!e.validAggregation||!(e.selectedField&&e.selectedAggregator&&e.selectedChartType)},on:{click:e.loadAggregationData}},[e.chartSeries&&e.selectedChartType?t("span",[e._v("refresh data")]):t("span",[e._v("Load data")])]),t("v-btn",{attrs:{text:"",disabled:!e.validAggregation||!(e.selectedField&&e.selectedAggregator&&e.selectedChartType)},on:{click:e.clear}},[e._v(" Clear ")]),t("v-btn",{attrs:{text:"",to:{name:"Explore"}},on:{click:e.clear}},[e._v(" Cancel ")])],1)],1)},Hl=[],Gl=function(){var e=this,t=e._self._c;return t("v-container",{staticClass:"ma-0"},[t("v-row",[t("v-col",{attrs:{cols:"12",md:"12"}},[t("TsEventFieldSelect",{attrs:{field:e.selectedField,rules:[e.rules.required]},on:{selectedField:function(t){e.selectedField=t}}})],1)],1),t("v-row",[t("v-col",[t("v-autocomplete",{attrs:{outlined:"",disabled:e.disableAggregator,items:e.aggregators,label:"Aggregate events by",rules:[e.rules.required],"append-icon":"mdi-question"},scopedSlots:e._u([{key:"item",fn:function(s){return[t("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:a}){return[t("v-layout",e._g(e._b({attrs:{wrap:""}},"v-layout",a,!1),i),[t("v-list-item-content",[t("v-list-item-title",[e._v(e._s(s.item.text))])],1)],1)]}}],null,!0)},[t("span",[e._v(e._s(s.item.tooltip))])])]}}]),model:{value:e.selectedAggregator,callback:function(t){e.selectedAggregator=t},expression:"selectedAggregator"}})],1)],1),e.disableMetric?e._e():t("v-row",{staticClass:"mt-n10"},[t("v-col",[t("v-autocomplete",{attrs:{outlined:"",items:e.metrics,label:"Aggregation Metric"},model:{value:e.selectedMetric,callback:function(t){e.selectedMetric=t},expression:"selectedMetric"}})],1)],1),e.disableMaxItems?e._e():t("v-row",{staticClass:"mt-n10"},[t("v-col",[t("v-text-field",{attrs:{label:e.labelMaxItems,outlined:"",type:"number",oninput:"if(this.value < 1) this.value = 1;"},model:{value:e.selectedMaxItems,callback:function(t){e.selectedMaxItems=e._n(t)},expression:"selectedMaxItems"}})],1)],1),e.disableInterval?e._e():t("v-row",{staticClass:"mt-n10"},[t("v-col",[t("v-autocomplete",{attrs:{outlined:"",items:e.allCalendarIntervals,label:"Calendar interval"},model:{value:e.selectedInterval,callback:function(t){e.selectedInterval=t},expression:"selectedInterval"}})],1)],1)],1)},Ul=[],Wl=function(){var e=this,t=e._self._c;return t("v-autocomplete",{attrs:{outlined:"",items:e.allNonTimestampFields,label:"Field name to aggregate"},on:{input:function(t){return e.$emit("selectedField",t)}},scopedSlots:e._u([{key:"item",fn:function({item:s,on:i,attrs:a}){return[t("v-list-item",e._g(e._b({},"v-list-item",a,!1),i),[t("v-list-item-avatar",[t("v-icon",[e._v(" "+e._s("text"===s.value.type?"mdi-code-string":"mdi-pound-box")+" ")])],1),t("v-list-item-content",[e._v(" "+e._s(s.text)+" ")])],1)]}},{key:"selection",fn:function({item:s}){return[t("v-icon",[e._v(" "+e._s("text"===s.value.type?"mdi-code-string":"mdi-pound-box")+" ")]),e._v(" Â  Â  "+e._s(s.text)+" ")]}}]),model:{value:e.selectedField,callback:function(t){e.selectedField=t},expression:"selectedField"}})},jl=[],Yl={props:{field:{type:Object}},data(){return{selectedField:this.field}},computed:{allNonTimestampFields(){let e=this.$store.state.meta.mappings.filter(e=>"datetime"!==e["field"]&&"timestamp"!==e["field"]).map(e=>({text:e["field"],value:e}));return e}},watch:{field(){this.selectedField=this.field}}},Xl=Yl,Jl=(0,d.A)(Xl,Wl,jl,!1,null,null,null),Kl=Jl.exports,Zl={components:{TsEventFieldSelect:Kl},props:{aggregator:{type:String},field:{type:Object},interval:{type:Object},intervalQuantity:{type:Number},maxItems:{type:Number},metric:{type:String},splitByTimeline:{type:Boolean}},data(){return{enableCalendarInterval:!1,selectedAggregator:this.aggregator,selectedField:this.field,selectedInterval:this.interval,selectedIntervalQuantity:this.intervalQuantity,selectedMaxItems:this.maxItems,selectedMetric:this.metric,selectedSplitByTimeline:this.splitByTimeline,rules:{required:e=>!!e||"Required."},intMetrics:[{text:"Average",value:"avg"},{text:"Count",value:"value_count"},{text:"Minimum",value:"min"},{text:"Maximum",value:"max"},{text:"Sum",value:"sum"},{text:"Unique",value:"cardinality"}],stringAggregators:[{text:"Auto Date Histogram",value:"auto_date_histogram",tooltip:"Aggregates events into a set number of intervals by datetime."},{text:"Rare Terms",value:"rare_terms",tooltip:"Aggregates by unique and infrequent terms."},{text:"Date Histogram",value:"calendar_date_histogram",tooltip:"Aggregates events by calendar intervals."},{text:"Top Terms",value:"top_terms",tooltip:"Aggregates by the most common and unique terms."}],allAggregators:[{text:"Auto Date Histogram",value:"auto_date_histogram",tooltip:"Aggregates events into a set number of intervals by datetime."},{text:"Rare terms",value:"rare_terms",tooltip:"Aggregates by unique and infrequent terms."},{text:"Date Histogram",value:"calendar_date_histogram",tooltip:"Aggregates events by calendar intervals."},{text:"Top Terms",value:"top_terms",tooltip:"Aggregates by the most common and unique terms."}],stringMetrics:[{text:"Count",value:"value_count"},{text:"Unique",value:"cardinality"}],allCalendarIntervals:[{text:"Year",value:{interval:"year",max:10}},{text:"Quarter",value:{interval:"quarter",max:4}},{text:"Month",value:{interval:"month",max:12}},{text:"Week",value:{interval:"week",max:52}},{text:"Day",value:{interval:"day",max:31}},{text:"Hour",value:{interval:"hour",max:24}},{text:"Minute",value:{interval:"minute",max:60}}]}},computed:{labelMaxItems(){return"rare_terms"===this.selectedAggregator?"Maximum document count for rare items":"auto_date_histogram"===this.selectedAggregator?"Maximum number of intervals":"Maximum number of items (K)"},aggregators(){return null==this.selectedField?[]:"text"===this.selectedField.type?this.stringAggregators:this.allAggregators},disableAggregator(){return null==this.selectedField},disableInterval(){return!(this.selectedAggregator&&"calendar_date_histogram"===this.selectedAggregator)},disableTimelineSplit(){return!(this.selectedAggregator&&this.selectedAggregator.endsWith("date_histogram"))},disableMaxItems(){return!(this.selectedAggregator&&("top_terms"===this.selectedAggregator||"significant_terms"===this.selectedAggregator||"auto_date_histogram"===this.selectedAggregator||"rare_terms"===this.selectedAggregator))},disableMetric(){return!(this.selectedAggregator&&("auto_date_histogram"===this.selectedAggregator||"calendar_date_histogram"===this.selectedAggregator||"single_metric"===this.selectedAggregator))},metrics(){return null==this.selectedField?[]:"text"===this.selectedField.type?this.stringMetrics:this.intMetrics},intervalQuantities(){return null==this.selectedInterval?[]:[...Array(this.selectedInterval.max-1).keys()].map((e,t)=>t+1)}},watch:{aggregator(){this.selectedAggregator=this.aggregator,("top_terms"===this.selectedAggregator||"rare_terms"===this.selectedAggregator||null==this.selectedMetric)&&(this.selectedMetric="value_count")},field(){this.selectedField=this.field},interval(){this.selectedInterval=this.interval},intervalQuantity(){this.selectedIntervalQuantity=this.intervalQuantity},maxItems(){this.selectedMaxItems=this.maxItems},metric(){this.selectedMetric=this.metric},selectedAggregator(){this.$emit("updateAggregator",this.selectedAggregator)},selectedField(){this.$emit("updateField",this.selectedField)},selectedInterval(){this.$emit("updateInterval",this.selectedInterval)},selectedIntervalQuantity(){this.$emit("updateIntervalQuantity",this.selectedIntervalQuantity)},selectedMaxItems(){this.$emit("updateMaxItems",this.selectedMaxItems)},selectedMetric(){this.$emit("updateMetric",this.selectedMetric)},selectedSplitByTimeline(){this.$emit("updateSplitByTimeline",this.splitByTimeline)}}},eo=Zl,to=(0,d.A)(eo,Gl,Ul,!1,null,null,null),so=to.exports,io=function(){var e=this,t=e._self._c;return t("v-container",{staticClass:"ma-0"},[t("v-row",[t("v-col",[t("TsChartTypeSelect",{attrs:{aggregator:e.aggregatorType,chart:e.selectedChartType,required:"",rules:[e.rules.required]},on:{selectedChartType:function(t){e.selectedChartType=t}}})],1)],1),t("v-row",{staticClass:"my-4"},[t("v-btn",{staticClass:"ml-2",attrs:{small:"",icon:""},on:{click:function(t){e.selectedShowOptions=!e.selectedShowOptions}}},[e.selectedShowOptions?t("v-icon",{attrs:{title:"Hide Chart Options"}},[e._v("mdi-chevron-up")]):t("v-icon",{attrs:{title:"Show Chart Options"}},[e._v("mdi-chevron-down")])],1),e.selectedShowOptions?t("span",{staticClass:"chart-options-trigger",on:{click:function(t){e.selectedShowOptions=!e.selectedShowOptions}}},[e._v("Hide Chart Options")]):t("span",{staticClass:"chart-options-trigger",on:{click:function(t){e.selectedShowOptions=!e.selectedShowOptions}}},[e._v("Show Chart Options")])],1),t("v-expand-transition",[e.selectedShowOptions?t("div",[t("v-row",[t("v-col",[t("v-text-field",{attrs:{outlined:"",label:"Height",type:"number"},model:{value:e.selectedHeight,callback:function(t){e.selectedHeight=e._n(t)},expression:"selectedHeight"}})],1),t("v-col",[t("v-text-field",{attrs:{outlined:"",label:"Width",type:"number"},model:{value:e.selectedWidth,callback:function(t){e.selectedWidth=e._n(t)},expression:"selectedWidth"}})],1)],1),t("v-row",{staticClass:"mt-n10"},[t("v-col",[t("v-text-field",{attrs:{outlined:"",label:"Y-axis title"},model:{value:e.selectedYTitle,callback:function(t){e.selectedYTitle=t},expression:"selectedYTitle"}})],1),t("v-col",[t("v-text-field",{attrs:{outlined:"",label:"X-axis title"},model:{value:e.selectedXTitle,callback:function(t){e.selectedXTitle=t},expression:"selectedXTitle"}})],1)],1),t("v-row",{staticClass:"mt-n14"},[t("v-col",[t("v-checkbox",{attrs:{label:"Show data labels"},model:{value:e.selectedDataLabels,callback:function(t){e.selectedDataLabels=t},expression:"selectedDataLabels"}})],1),t("v-col",[t("v-checkbox",{attrs:{label:"Show y-axis labels"},model:{value:e.selectedShowYLabels,callback:function(t){e.selectedShowYLabels=t},expression:"selectedShowYLabels"}})],1),t("v-col",[t("v-checkbox",{attrs:{label:"Show x-axis labels"},model:{value:e.selectedShowXLabels,callback:function(t){e.selectedShowXLabels=t},expression:"selectedShowXLabels"}})],1)],1)],1):e._e()])],1)},ao=[],no=function(){var e=this,t=e._self._c;return t("v-btn-toggle",{attrs:{mandatory:""},model:{value:e.chartSelector,callback:function(t){e.chartSelector=t},expression:"chartSelector"}},e._l(e.chartByAggregator,function(s,i){return t("v-btn",{key:i,attrs:{title:s.text,disabled:e.chartSelectorDisabled},on:{click:function(t){return e.$emit("selectedChartType",s.text)}}},[t("v-icon",[e._v(e._s(s.icon))])],1)}),1)},ro=[],lo={props:{aggregator:{type:String},chart:{type:String}},data(){return{chartSelector:0,selectedChartType:this.chart,chartTypes:[{text:"bar",icon:"mdi-poll mdi-rotate-90"},{text:"column",icon:"mdi-chart-bar"},{text:"line",icon:"mdi-chart-line"},{text:"table",icon:"mdi-table"},{text:"heatmap",icon:"mdi-blur-linear"},{text:"donut",icon:"mdi-chart-donut"}],seriesChartTypes:[{text:"bar",icon:"mdi-poll mdi-rotate-90"},{text:"column",icon:"mdi-chart-bar"},{text:"line",icon:"mdi-chart-line"},{text:"table",icon:"mdi-table"},{text:"heatmap",icon:"mdi-blur-linear"}],singleMetricChartTypes:[]}},computed:{allChartTypes(){const e=new Set,t=[];for(const s of[...this.chartTypes,...this.seriesChartTypes,...this.singleMetricChartTypes])e.has(s.text)||(e.add(s.text),t.push(s));return t},chartByAggregator(){return"top_terms"===this.aggregator?this.chartTypes:"rare_terms"===this.aggregator||"auto_date_histogram"===this.aggregator||"calendar_date_histogram"===this.aggregator?this.seriesChartTypes:"single_metric"===this.aggregator?this.singleMetricChartTypes:this.allChartTypes},chartSelectorDisabled(){return!this.aggregator}},watch:{aggregator(){this.chartByAggregator&&(this.selectedChartType=this.chartByAggregator[0].text,this.$emit("selectedChartType",this.selectedChartType))},chart(){this.selectedChartType=this.chart}}},oo=lo,co=(0,d.A)(oo,no,ro,!1,null,null,null),uo=co.exports,ho={components:{TsChartTypeSelect:uo},props:{aggregatorType:{type:String},chartType:{type:String},height:{type:Number,default:640},showDataLabels:{type:Boolean,default:!0},showOptions:{type:Boolean,default:!1},showXLabels:{type:Boolean,default:!0},showYLabels:{type:Boolean,default:!0},title:{type:String},width:{type:Number,default:800},xTitle:{type:String},yTitle:{type:String}},data(){return{rules:{required:e=>!!e||"Required."},selectedChartType:this.chartType,selectedChartTitle:this.title,selectedDataLabels:this.showDataLabels,selectedHeight:this.height,selectedShowOptions:this.showOptions,selectedShowXLabels:this.showXLabels,selectedShowYLabels:this.showYLabels,selectedWidth:this.width,selectedXTitle:this.xTitle,selectedYTitle:this.yTitle}},watch:{aggregatorType(){this.selectedAggregator=this.aggregatorType},chartType(){this.selectedChartType=this.chartType},height(){this.selectedHeight=this.height},selectedChartType(){this.$emit("updateChartType",this.selectedChartType)},selectedChartTitle(){this.$emit("updateTitle",this.selectedChartTitle)},selectedDataLabels(){this.$emit("updateShowDataLabels",this.selectedDataLabels)},selectedHeight(){this.$emit("updateHeight",this.selectedHeight)},selectedShowXLabels(){this.$emit("updateShowXLabels",this.selectedShowXLabels)},selectedShowYLabels(){this.$emit("updateShowYLabels",this.selectedShowYLabels)},selectedWidth(){this.$emit("updateWidth",this.selectedWidth)},selectedXTitle(){this.$emit("updateXTitle",this.selectedXTitle)},selectedYTitle(){this.$emit("updateYTitle",this.selectedYTitle)},showDataLabels(){this.selectedDataLabels=this.showDataLabels},showXLabels(){this.selectedShowXLabels=this.showXLabels},showYLabels(){this.selectedShowYLabels=this.showYLabels},title(){this.selectedChartTitle=this.title},width(){this.selectedWidth=this.width},xTitle(){this.selectedXTitle=this.xTitle},yTitle(){this.selectedYTitle=this.yTitle}}},mo=ho,po=(0,d.A)(mo,io,ao,!1,null,null,null),vo=po.exports,go=function(){var e=this,t=e._self._c;return t("v-container",{staticClass:"ma-0"},[t("v-row",{staticClass:"mt-3"},[t("v-col",[t("ts-timeline-search",{attrs:{componentName:"visualization",includeProcessingTimelines:this.settings.showProcessingTimelineEvents,"analyzer-timeline-id":e.timelineIDs},on:{selectedTimelines:function(t){e.selectedTimelineIDs=t}}})],1)],1),t("v-row",{staticClass:"mt-n10"},[t("v-col",[t("v-text-field",{attrs:{outlined:"",autofocus:"",label:"Event query"},model:{value:e.selectedQueryString,callback:function(t){e.selectedQueryString=t},expression:"selectedQueryString"}})],1)],1),t("v-row",{staticClass:"mt-n10"},[t("v-col",[t("v-select",e._b({attrs:{items:e.allRecentSearches,clearable:"",solo:"",dense:"",label:"Recent search",disabled:!!e.selectedSavedSearch},model:{value:e.selectedRecentSearch,callback:function(t){e.selectedRecentSearch=t},expression:"selectedRecentSearch"}},"v-select",e.$attrs,!1))],1),t("v-col",[t("v-select",e._b({attrs:{items:e.allSavedSearches,clearable:"",solo:"",dense:"",label:"Saved search",disabled:!!e.selectedRecentSearch},model:{value:e.selectedSavedSearch,callback:function(t){e.selectedSavedSearch=t},expression:"selectedSavedSearch"}},"v-select",e.$attrs,!1))],1)],1)],1)},fo=[],yo={components:{TsTimelineSearch:$l},props:{queryString:{type:String},queryChips:{type:Array},recentSearch:{type:Object},timelineIDs:{type:Array,default:function(){return[]}}},data(){return{selectedFilter:"",selectedRecentSearch:null,selectedSavedSearch:null,selectedTimelineIDs:this.timelineIDs,selectedQueryString:this.queryString,selectedQueryChips:this.queryChips}},computed:{settings(){return this.$store.state.settings},sketch(){return this.$store.state.sketch},allReadyTimelines(){const e=this.sketch.timelines.filter(e=>"ready"===e.status[0].status);return e.sort((e,t)=>e.name.localeCompare(t.name)),e},allRecentSearches(){let e=this.$store.state.searchHistory;if(Array.isArray(e)){let e=this.$store.state.searchHistory.map(e=>({text:`${e["query_string"]} (${e["query_result_count"]})`,value:e}));return e}return[]},allSavedSearches(){let e=this.$store.state.meta.views.map(e=>({text:e["name"],value:e}));return e}},watch:{queryString(){console.log(this.queryString),this.queryString||(this.selectedRecentSearch=null,this.selectedSavedSearch=null)},selectedSavedSearch(){if(this.selectedSavedSearch){this.selectedQueryString=this.selectedSavedSearch.query;let e=JSON.parse(this.selectedSavedSearch.filter),t=e.indices;this.selectedTimelineIDs="_all"===t?this.allReadyTimelines.map(e=>e.id):t,this.selectedQueryChips=e.chips.filter(e=>"label"===e.type||"term"===e.type||"datetime_range"===e.type)}else this.selectedQueryString="",this.selectedTimelineIDs=[],this.selectedQueryChips=null},selectedRecentSearch(){if(this.selectedRecentSearch){this.selectedQueryString=this.selectedRecentSearch.query_string;let e=JSON.parse(this.selectedRecentSearch.query_filter),t=e.indices;this.selectedTimelineIDs="_all"===t?this.allReadyTimelines.map(e=>e.id):t,this.selectedQueryChips=e.chips.filter(e=>"label"===e.type||"term"===e.type||"datetime_range"===e.type)}else this.selectedQueryString="",this.selectedTimelineIDs=[],this.selectedQueryChips=null},selectedTimelineIDs(){this.$emit("updateTimelineIDs",this.selectedTimelineIDs)},selectedQueryString(){this.$emit("updateQueryString",this.selectedQueryString)},selectedQueryChips(){this.$emit("updateQueryChips",this.selectedQueryChips)}}},_o=yo,bo=(0,d.A)(_o,go,fo,!1,null,null,null),So=bo.exports,ko={components:{TsAggregationConfig:so,TsChartConfig:vo,TsChartCard:zr,TsAggregationEventSelect:So},props:{aggregator:{type:String},bucket:{type:Number},chartTitle:{type:String,default:"New Visualization"},chartType:{type:String,default:"bar"},field:{type:String},height:{type:Number,default:600},interval:{type:Object,default:function(){return{interval:"year",max:10}}},intervalQuantity:{type:Number},metric:{type:String},queryChips:{type:Array},queryString:{type:String,default:"*"},range:{type:Object,default:function(){return{start:"",end:""}}},savedSearch:{type:Boolean,default:!0},searchHistory:{type:Boolean,default:!0},showDataLabels:{type:Boolean,default:!0},showXLabels:{type:Boolean,default:!0},showYLabels:{type:Boolean,default:!0},timelineIDs:{type:Array,default:function(){return[]}},width:{type:Number,default:800},xTitle:{type:String},yTitle:{type:String}},data(){return{currentStep:1,responseMeta:null,response:null,selectedAggregator:this.aggregator,selectedChartTitle:this.chartTitle,selectedChartType:this.chartType,selectedMaxItems:10,selectedField:this.field,selectedHeight:this.height,selectedInterval:this.interval,selectedIntervalQuantity:this.intervalQuantity,selectedMetric:this.metric,selectedQueryString:this.queryString,selectedQueryChips:this.queryChips,selectedRange:this.range,selectedSavedSearch:this.savedSearch,selectedSearchHistory:this.searchHistory,selectedShowDataLabels:this.showDataLabels,selectedShowXLabels:this.showXLabels,selectedShowYLabels:this.showYLabels,selectedSplitByTimeline:this.splitByTimeline,selectedTimelineIDs:this.timelineIDs,selectedWidth:this.width,selectedXTitle:this.xTitle,selectedYTitle:this.yTitle,renameVisualDialog:!1,selectedChartTitleDraft:this.selectedChartTitleDraft}},computed:{validAggregation(){return this.selectedTimelineIDs.length>0&&this.selectedQueryString},sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},chartSeries(){if(null!==this.response&&null!==this.response.buckets)return this.response.buckets},chartLabels(){if(null!==this.response&&null!==this.response.labels)return this.response.labels},settings(){return this.$store.state.settings}},methods:{rename(){this.renameVisualDialog=!1,this.selectedChartTitle=this.selectedChartTitleDraft},loadCurrentSearch(){const e=this.$store.state.currentSearchNode;if(!e)return void console.log("no current search...");const t=JSON.parse(e["query_filter"]);this.selectedQueryString=e["query_string"],this.selectedTimelineIDs=t.indices,this.selectedQueryChips=t.chips.filter(e=>"label"===e.type||"term"===e.type||"datetime_range"===e.type)},loadRecentSearch(){if(!this.selectedRecentSearch)return void console.log("no search history");const e=JSON.parse(this.selectedRecentSearch["query_filter"]);this.selectedQueryString=this.selectedRecentSearch["query_string"],this.selectedTimelineIDs=e.indices,this.selectedQueryChips=e.chips.filter(e=>"label"===e.type||"term"===e.type||"datetime_range"===e.type)},loadSavedSearch(){if(!this.selectedSavedSearch)return void console.log("no saved search");this.selectedQueryString=this.selectedSavedSearch.query;const e=JSON.parse(this.selectedSavedSearch.filter);this.selectedTimelineIDs=e.indices,this.selectedQueryChips=e.chips.filter(e=>"label"===e.type||"term"===e.type||"datetime_range"===e.type)},clear(){this.currentStep=1,this.responseMeta=null,this.response=null,this.selectedAggregator=this.aggregator,this.selectedChartTitle=this.chartTitle,this.selectedChartType=this.chartType,this.selectedMaxItems=10,this.selectedField=this.field,this.selectedHeight=this.height,this.selectedInterval=this.interval,this.selectedIntervalQuantity=this.intervalQuantity,this.selectedMetric=this.metric,this.selectedQueryString=this.queryString,this.selectedQueryChips=this.queryChips,this.selectedRange=this.range,this.selectedSavedSearch=this.savedSearch,this.selectedSearchHistory=this.searchHistory,this.selectedShowDataLabels=this.showDataLabels,this.selectedShowXLabels=this.showXLabels,this.selectedShowYLabels=this.showYLabels,this.selectedSplitByTimeline=this.splitByTimeline,this.selectedTimelineIDs=this.timelineIDs,this.selectedWidth=this.width,this.selectedXTitle=this.xTitle,this.selectedYTitle=this.yTitle},saveVisualization(){if(!this.selectedChartTitle||"New Visualization"===this.selectedChartTitle){var e=prompt("Please enter a name for the visualization:");if(!e)return void this.errorSnackBar("New visualization name is empty.");this.selectedChartTitle=e}null!=this.response&&_.saveAggregation(this.sketch.id,this.responseMeta,this.selectedChartTitle,this.getAggregatorParameters()).then(()=>{this.$store.dispatch("updateSavedVisualizationList",this.sketch.id),this.successSnackBar("Visualization added: "+this.selectedChartTitle)}).catch(e=>{this.errorSnackBar("Error adding visualization: "+this.selectedChartTitle)})},getAggregatorParameters(){return{aggregator_name:this.selectedAggregator,aggregator_class:"apex",aggregator_parameters:{fields:[this.selectedField],aggregator_options:{query_string:this.selectedQueryString,start_time:this.selectedRange.start,end_time:this.selectedRange.end,query_chips:this.selectedQueryChips,timeline_ids:this.selectedTimelineIDs,metric:this.selectedMetric,max_items:this.selectedMaxItems,calendar_interval:this.selectedInterval.interval},chart_type:this.selectedChartType,chart_options:{chartTitle:this.selectedChartTitle,height:this.selectedHeight,isTimeSeries:this.selectedAggregator.endsWith("date_histogram"),showDataLabels:this.selectedShowDataLabels,showXLabels:this.selectedShowXLabels,showYLabels:this.selectedShowYLabels,width:this.selectedWidth,xTitle:this.selectedXTitle,yTitle:this.selectedYTitle}},include_processing_timelines:!!this.settings.showProcessingTimelineEvents}},loadAggregationData(){let e=this.getAggregatorParameters();_.runAggregator(this.sketch.id,e).then(e=>{this.responseMeta=e.data.meta,this.response=e.data.objects[0][this.selectedAggregator]}).catch(e=>{console.error("Error running aggregator: "+e)})}}},wo=ko,xo=(0,d.A)(wo,Vl,Hl,!1,null,"4143b998",null),To=xo.exports,Co={props:["aggregationId"],components:{TsVisualizationEditor:To,TsSavedVisualization:Or}},Ao=Co,Do=(0,d.A)(Ao,ql,Bl,!1,null,null,null),$o=Do.exports,Lo={props:["sketchId","storyId","ruleId","analyzerTimelineId","aggregationId"],components:{Explore:Ai,ThreatIntel:Bi,Sigma:Dn,Graph:Bn,Story:vl,Analyze:Ml,Visualization:$o},computed:{currentRouteName(){return this.$route.name}}},Io=Lo,Eo=(0,d.A)(Io,P,O,!1,null,null,null),No=Eo.exports,zo=function(){var e=this,t=e._self._c;return t("div",[e.loadingSketch?t("v-progress-linear",{attrs:{indeterminate:"",color:"primary"}}):e._e(),e.sketchAccessDenied&&!e.loadingSketch?t("ts-access-denied"):e._e(),!e.sketch.id||e.loadingSketch||e.sketchAccessDenied?e._e():t("div",{staticStyle:{height:"70vh"}},[e.hasTimelines||e.loadingSketch||e.isArchived||e.sketchAccessDenied?e._e():t("v-container",{attrs:{"fill-height":"",fluid:""}},[t("v-row",{attrs:{align:"center",justify:"center"}},[t("v-sheet",{staticClass:"pa-4",staticStyle:{background:"transparent"}},[t("center",[t("v-img",{attrs:{src:"/dist/empty-state.png","max-height":"100","max-width":"300"}}),t("div",{staticClass:"mb-3 mt-3",staticStyle:{"font-size":"2em"}},[e._v("It's empty around here")]),t("ts-upload-timeline-form-button",{attrs:{"btn-size":"normal","btn-type":"rounded"}})],1)],1)],1)],1),e.isArchived&&!e.loadingSketch?t("v-container",{attrs:{"fill-height":"",fluid:""}},[t("v-row",{attrs:{align:"center",justify:"center"}},[t("v-sheet",{staticClass:"pa-4"},[t("center",[t("v-img",{attrs:{src:"/dist/empty-state.png","max-height":"100","max-width":"300"}}),t("div",{staticClass:"mb-3 mt-3",staticStyle:{"font-size":"2em"}},[e._v("This sketch is archived")]),t("v-btn",{attrs:{rounded:"",depressed:"",color:"primary"},on:{click:function(t){return e.unArchiveSketch()}}},[e._v(" Bring it back ")])],1)],1)],1)],1):e._e(),t("v-dialog",{attrs:{width:"600"},model:{value:e.renameSketchDialog,callback:function(t){e.renameSketchDialog=t},expression:"renameSketchDialog"}},[t("v-card",{staticClass:"pa-4"},[t("ts-rename-sketch",{on:{close:function(t){e.renameSketchDialog=!1}}})],1)],1),t("v-dialog",{attrs:{width:"700px"},model:{value:e.showSettingsDialog,callback:function(t){e.showSettingsDialog=t},expression:"showSettingsDialog"}},[t("ts-settings-dialog")],1),e.loadingSketch?e._e():t("v-app-bar",{style:[e.$vuetify.theme.dark?{"border-bottom":"1px solid hsla(0,0%,100%,.12) !important"}:{"border-bottom":"1px solid rgba(0,0,0,.12) !important"}],attrs:{app:"","clipped-left":"",flat:"",color:e.$vuetify.theme.dark?"#121212":"white"}},[!e.hasTimelines||e.loadingSketch||e.isArchived?e._e():t("v-btn",{attrs:{icon:""},on:{click:function(t){return t.stopPropagation(),e.toggleDrawer()}}},[t("v-icon",{attrs:{title:"Toggle left panel"}},[e._v("mdi-menu")])],1),t("v-avatar",{staticClass:"ml-n2 mt-1"},[t("router-link",{attrs:{to:"/"}},[t("v-img",{attrs:{src:"/dist/timesketch-color.png","max-height":"25","max-width":"25",contain:""}})],1)],1),t("v-hover",{scopedSlots:e._u([{key:"default",fn:function({hover:s}){return[t("div",{staticClass:"d-flex flex-wrap"},[t("div",{staticClass:"flex-1-0",staticStyle:{"font-size":"1.1em",cursor:"pointer","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","max-width":"900px"},attrs:{title:e.sketch.name},on:{dblclick:function(t){e.renameSketchDialog=!0}}},[e._v(" "+e._s(e.sketch.name)+" ")]),t("div",[s?t("v-icon",{staticClass:"ml-1",attrs:{title:"Rename sketch",small:""},on:{click:function(t){e.renameSketchDialog=!0}}},[e._v("mdi-pencil")]):e._e()],1)])]}}],null,!1,4267224485)}),t("v-spacer"),t("v-dialog",{attrs:{width:"500"},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-btn",e._g(e._b({staticClass:"mr -2",attrs:{small:"",rounded:"",depressed:"",color:"primary"}},"v-btn",i,!1),s),[t("v-icon",{attrs:{small:"",left:""}},[e._v("mdi-account-multiple-plus")]),e._v(" Share ")],1)]}}],null,!1,4220674446),model:{value:e.shareDialog,callback:function(t){e.shareDialog=t},expression:"shareDialog"}},[t("ts-share-card",{on:{"close-dialog":function(t){e.shareDialog=!1}}})],1),t("v-avatar",{staticClass:"ml-2",attrs:{color:"grey lighten-1",size:"25"}},[t("span",{staticClass:"white--text"},[e._v(e._s(e._f("initialLetter")(e.currentUser)))])]),t("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-avatar",[t("v-btn",e._g(e._b({attrs:{small:"",icon:""}},"v-btn",i,!1),s),[t("v-icon",{attrs:{title:"Sketch Options"}},[e._v("mdi-dots-vertical")])],1)],1)]}}],null,!1,2415256737)},[t("v-card",[t("v-list",{attrs:{"two-line":""}},[e.sketch.user?t("v-list-item",[t("v-list-item-content",[t("v-list-item-title",[t("strong",[e._v("Created:")]),e._v(" "+e._s(e._f("shortDateTime")(e.sketch.created_at))+" ")]),t("v-list-item-subtitle",[t("small",[e._v(e._s(e._f("timeSince")(e.sketch.created_at))+" by "+e._s(e.sketch.user.username))])])],1)],1):e._e(),t("v-list-item",[t("v-list-item-content",[t("v-list-item-title",[t("strong",[e._v("Access: ")]),e.meta.permissions&&e.meta.permissions.public?t("span",[e._v("Public")]):t("span",[e._v("Restricted")])]),t("v-list-item-subtitle",[e.meta.permissions&&e.meta.permissions.public?t("small",[e._v("Visible to all users on this server")]):t("small",[e._v("Only people with access can open")])])],1)],1)],1),t("v-list",[t("v-list-item-group",{attrs:{color:"primary"}},[t("v-list-item",{on:{click:e.toggleTheme}},[t("v-list-item-icon",[t("v-icon",[e._v("mdi-brightness-6")])],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Toggle theme")])],1)],1),t("v-list-item",{on:{click:function(t){e.renameSketchDialog=!0}}},[t("v-list-item-icon",[t("v-icon",[e._v("mdi-pencil")])],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Rename sketch")])],1)],1),t("v-list-item",{attrs:{disabled:e.isArchived},on:{click:function(t){return e.archiveSketch()}}},[t("v-list-item-icon",[t("v-icon",[e._v("mdi-archive")])],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Archive sketch")])],1)],1),e.meta.permissions&&e.meta.permissions.delete?t("v-list-item",{on:{click:function(t){return e.deleteSketch()}}},[t("v-list-item-icon",[t("v-icon",[e._v("mdi-trash-can-outline")])],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Delete sketch")])],1)],1):e._e(),t("v-list-item",{on:{click:e.switchUI}},[t("v-list-item-icon",[t("v-icon",[e._v("mdi-view-dashboard-outline")])],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Use the old UI")])],1)],1),t("v-list-item",{on:{click:function(t){e.showSettingsDialog=!0}}},[t("v-list-item-icon",[t("v-icon",[e._v("mdi-cog-outline")])],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Settings")])],1)],1),t("a",{staticStyle:{"text-decoration":"none",color:"inherit"},attrs:{href:"/logout/"}},[t("v-list-item",[t("v-list-item-icon",[t("v-icon",[e._v("mdi-logout")])],1),t("v-list-item-content",[t("v-list-item-title",[e._v("Logout")])],1)],1)],1)],1)],1)],1)],1)],1),t("v-navigation-drawer",{attrs:{app:"",clipped:"","disable-resize-watcher":"",stateless:"","hide-overlay":"",width:e.navigationDrawer.width},model:{value:e.showLeftPanel,callback:function(t){e.showLeftPanel=t},expression:"showLeftPanel"}},[e.systemSettings.ENABLE_V3_INVESTIGATION_VIEW&&(e.systemSettings.DFIQ_ENABLED||e.systemSettings.LLM_FEATURES_AVAILABLE&&e.systemSettings.LLM_FEATURES_AVAILABLE.log_analyzer)?t("ts-investigation",{attrs:{"icon-only":e.isMiniDrawer},on:{toggleDrawer:function(t){return e.toggleDrawer()}}}):e._e(),t("ts-search",{attrs:{"icon-only":e.isMiniDrawer},on:{toggleDrawer:function(t){return e.toggleDrawer()}}}),t("ts-timelines-table",{attrs:{"icon-only":e.isMiniDrawer},on:{toggleDrawer:function(t){return e.toggleDrawer()}}}),e.meta.views?t("ts-saved-searches",{attrs:{"icon-only":e.isMiniDrawer},on:{toggleDrawer:function(t){return e.toggleDrawer()}}}):e._e(),t("ts-data-types",{attrs:{"icon-only":e.isMiniDrawer},on:{toggleDrawer:function(t){return e.toggleDrawer()}}}),t("ts-tags",{attrs:{"icon-only":e.isMiniDrawer},on:{toggleDrawer:function(t){return e.toggleDrawer()}}}),t("ts-graphs",{attrs:{"icon-only":e.isMiniDrawer},on:{toggleDrawer:function(t){return e.toggleDrawer()}}}),t("ts-stories",{attrs:{"icon-only":e.isMiniDrawer},on:{toggleDrawer:function(t){return e.toggleDrawer()}}}),t("ts-search-templates",{attrs:{"icon-only":e.isMiniDrawer},on:{toggleDrawer:function(t){return e.toggleDrawer()}}}),t("ts-sigma-rules",{attrs:{"icon-only":e.isMiniDrawer},on:{toggleDrawer:function(t){return e.toggleDrawer()}}}),t("ts-intelligence",{attrs:{"icon-only":e.isMiniDrawer},on:{toggleDrawer:function(t){return e.toggleDrawer()}}}),t("ts-analyzer-results",{attrs:{"icon-only":e.isMiniDrawer},on:{toggleDrawer:function(t){return e.toggleDrawer()}}}),t("ts-visualizations",{attrs:{"icon-only":e.isMiniDrawer},on:{toggleDrawer:function(t){return e.toggleDrawer()}}})],1),e.showRightSidePanel?t("v-navigation-drawer",{staticStyle:{"box-shadow":"0 10px 15px -3px #888"},attrs:{fixed:"",right:"",width:"600"},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("v-toolbar",{attrs:{flat:""}},[t("v-toolbar-title",[e._v("Right Side Panel")]),t("v-spacer"),t("v-btn",{attrs:{icon:""},on:{click:function(t){e.showRightSidePanel=!1}}},[t("v-icon",{attrs:{title:"Close sidepanel"}},[e._v("mdi-close")])],1)],1)]},proxy:!0}],null,!1,3158214288)},[t("v-container",[e._v(" TODO: Add content here ")])],1):e._e(),t("v-main",{staticClass:"notransition"},[e.sketch.status&&e.hasTimelines&&!e.isArchived&&e.systemSettings.DFIQ_ENABLED&&!e.questionCardExclusionRoutes.includes(e.currentRouteName)?t("ts-question-card"):e._e(),e.sketch.status&&e.hasTimelines&&!e.isArchived?t("router-view",{staticClass:"mt-4",on:{setTitle:e=>this.title=e}}):e._e()],1),t("v-bottom-sheet",{attrs:{"hide-overlay":"",persistent:"","no-click-animation":"",scrollable:""},on:{"click:outside":function(t){e.showTimelineView=!1}},model:{value:e.showTimelineView,callback:function(t){e.showTimelineView=t},expression:"showTimelineView"}},[t("v-card",[t("v-toolbar",{attrs:{dense:"",flat:""}},[t("strong",[e._v("Context search")]),t("v-btn-toggle",{staticClass:"ml-10",attrs:{rounded:""},model:{value:e.contextTimeWindowSeconds,callback:function(t){e.contextTimeWindowSeconds=t},expression:"contextTimeWindowSeconds"}},e._l([1,5,10,60,300,600,1800,3600],function(s){return t("v-btn",{key:s,attrs:{value:s,small:"",outlined:""},on:{click:function(t){return e.updateContextQuery(s)}}},[e._v(" "+e._s(e._f("formatSeconds")(s))+" ")])}),1),t("v-btn",{staticClass:"ml-5",attrs:{small:"",text:""},on:{click:function(t){return e.contextToSearch()}}},[e._v("Replace search")]),t("v-spacer"),t("v-btn",{attrs:{icon:"",disabled:e.timelineViewHeight>40},on:{click:function(t){return e.increaseTimelineViewHeight()}}},[t("v-icon",[e._v("mdi-chevron-up")])],1),t("v-btn",{attrs:{icon:"",disabled:0===e.timelineViewHeight},on:{click:function(t){return e.decreaseTimelineViewHeight()}}},[t("v-icon",[e._v("mdi-chevron-down")])],1),t("v-btn",{attrs:{icon:""},on:{click:function(t){e.showTimelineView=!1}}},[t("v-icon",[e._v("mdi-close")])],1)],1),t("v-divider"),t("v-expand-transition",[t("v-card-text",{directives:[{name:"show",rawName:"v-show",value:!e.minimizeTimelineView,expression:"!minimizeTimelineView"}],style:{height:e.timelineViewHeight+"vh"}},[e.showTimelineView?t("ts-event-list",{attrs:{"query-request":e.queryRequest,"highlight-event":e.currentContextEvent}}):e._e()],1)],1)],1)],1)],1)],1)},Fo=[],Ro=function(){var e=this,t=e._self._c;return e.iconOnly?t("div",{staticClass:"pa-4",staticStyle:{cursor:"pointer"},on:{click:function(t){e.$emit("toggleDrawer"),e.expanded=!0}}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-content-save-outline")]),t("div",{staticStyle:{height:"1px"}})],1):t("div",[t("div",{staticClass:"pa-4",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",style:e.meta.views&&e.meta.views.length?"cursor: pointer":"",on:{click:function(t){e.expanded=!e.expanded}}},[t("span",[t("v-icon",{attrs:{left:""}},[e._v("mdi-content-save-outline")]),e._v(" Saved Searches ")],1),t("span",{staticClass:"float-right",staticStyle:{"margin-right":"10px"}},[t("small",[t("strong",[e._v(e._s(e.meta.views.length))])])])]),t("v-expand-transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded&&e.meta.views.length,expression:"expanded && meta.views.length"}]},[t("ts-saved-searches-list")],1)]),t("v-divider")],1)},Po=[],Oo={props:{iconOnly:Boolean},components:{TsSavedSearchesList:Xs},data:function(){return{expanded:!1}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta}},methods:{}},Qo=Oo,Mo=(0,d.A)(Qo,Ro,Po,!1,null,null,null),qo=Mo.exports,Bo=function(){var e=this,t=e._self._c;return e.iconOnly?t("div",{staticClass:"pa-4",staticStyle:{cursor:"pointer"},on:{click:function(t){e.$emit("toggleDrawer"),e.expanded=!0}}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-database-outline")]),t("div",{staticStyle:{height:"1px"}})],1):t("div",[t("div",{staticClass:"pa-4",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",style:e.dataTypes&&e.dataTypes.length?"cursor: pointer":"",on:{click:function(t){e.expanded=!e.expanded}}},[t("span",[t("v-icon",{attrs:{left:""}},[e._v("mdi-database-outline")]),e._v(" Data Types ")],1),t("span",{staticClass:"float-right",staticStyle:{"margin-right":"10px"}},[e.dataTypes?t("small",[t("strong",[e._v(e._s(e.dataTypes.length))])]):e._e()])]),t("v-expand-transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded&&e.dataTypes.length,expression:"expanded && dataTypes.length"}]},[t("ts-data-types-list")],1)]),t("v-divider")],1)},Vo=[],Ho={props:{iconOnly:Boolean},components:{TsDataTypesList:Hs},data:function(){return{expanded:!1}},computed:{sketch(){return this.$store.state.sketch},dataTypes(){return this.$store.state.dataTypes}},methods:{}},Go=Ho,Uo=(0,d.A)(Go,Bo,Vo,!1,null,"7cfc7831",null),Wo=Uo.exports,jo=function(){var e=this,t=e._self._c;return e.iconOnly?t("div",{staticClass:"pa-4",staticStyle:{cursor:"pointer"},on:{click:function(t){e.$emit("toggleDrawer"),e.expanded=!0}}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-tag-multiple-outline")]),t("div",{staticStyle:{height:"1px"}})],1):t("div",[t("div",{staticClass:"pa-4",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",style:e.tags&&e.tags.length||e.filteredLabels&&e.filteredLabels.length?"cursor: pointer":"",on:{click:function(t){e.expanded=!e.expanded}}},[t("span",[t("v-icon",{attrs:{left:""}},[e._v("mdi-tag-multiple-outline")]),e._v(" Tags ")],1),t("span",{staticClass:"float-right",staticStyle:{"margin-right":"10px"}},[t("small",[e.tags&&e.filteredLabels?t("strong",[e._v(e._s(e.tags.length+e.filteredLabels.length))]):e._e()])])]),t("v-expand-transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded&&(e.tags.length||e.filteredLabels.length),expression:"expanded && (tags.length || filteredLabels.length)"}]},[t("ts-tags-list")],1)]),t("v-divider")],1)},Yo=[],Xo={props:{iconOnly:Boolean},components:{TsTagsList:pe},data:function(){return{expanded:!1}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},tags(){return this.$store.state.tags},filteredLabels(){return this.meta.filter_labels?this.meta.filter_labels.filter(e=>!e.label.startsWith("__ts_fact")):[]}}},Jo=Xo,Ko=(0,d.A)(Jo,jo,Yo,!1,null,null,null),Zo=Ko.exports,ec=function(){var e=this,t=e._self._c;return e.iconOnly?t("div",{staticClass:"pa-4",staticStyle:{cursor:"pointer"},on:{click:function(t){e.$emit("toggleDrawer"),e.expanded=!0}}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-text-box-search-outline")]),t("div",{staticStyle:{height:"1px"}})],1):t("div",[t("div",{staticClass:"pa-4",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",style:e.searchtemplates&&e.searchtemplates.length?"cursor: pointer":"",on:{click:function(t){e.expanded=!e.expanded}}},[t("span",[t("v-icon",{attrs:{left:""}},[e._v("mdi-text-box-search-outline")]),e._v(" Search Templates ")],1),t("span",{staticClass:"float-right",staticStyle:{"margin-right":"10px"}},[t("small",[t("strong",[e._v(e._s(e.searchtemplates.length))])])])]),t("v-expand-transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded&&e.searchtemplates.length,expression:"expanded && searchtemplates.length"}]},[t("v-data-iterator",{attrs:{items:e.searchtemplates,"items-per-page":e.itemsPerPage,search:e.search},on:{"update:itemsPerPage":function(t){e.itemsPerPage=t},"update:items-per-page":function(t){e.itemsPerPage=t}},scopedSlots:e._u([{key:"header",fn:function(){return[t("v-toolbar",{attrs:{flat:""}},[t("v-text-field",{attrs:{clearable:"","hide-details":"",outlined:"",dense:"","prepend-inner-icon":"mdi-magnify",label:"Search for a template.."},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)]},proxy:!0},{key:"default",fn:function(s){return e._l(s.items,function(e){return t("ts-search-template",{key:e.id,attrs:{searchtemplate:e}})})}}])})],1)]),t("v-divider")],1)},tc=[],sc=function(){var e=this,t=e._self._c;return t("div",[e.parameters.length?t("v-row",{staticClass:"pa-2 pl-5",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",staticStyle:{cursor:"pointer","font-size":"0.9em"},attrs:{"no-gutters":""},on:{click:function(t){e.expanded=!e.expanded}}},[e._v(" "+e._s(e.searchtemplate.name)+" ")]):t("v-row",{staticClass:"pa-2 pl-5",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",staticStyle:{cursor:"pointer","font-size":"0.9em"},attrs:{"no-gutters":""},on:{click:function(t){return e.search(e.searchtemplate.query_string)}}},[e._v(" "+e._s(e.searchtemplate.name)+" ")]),t("v-expand-transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded,expression:"expanded"}],staticClass:"px-4"},[e._l(e.parameters,function(s){return t("div",{key:s.name,staticClass:"mt-2"},[t("v-text-field",{attrs:{hint:s.description,label:s.description,outlined:"",dense:"","hide-details":""},model:{value:e.params[s.name],callback:function(t){e.$set(e.params,s.name,t)},expression:"params[parameter.name]"}})],1)}),t("v-card-actions",{staticClass:"pl-0"},[t("v-btn",{attrs:{small:"",depressed:"",color:"primary",disabled:!e.filledOut},on:{click:function(t){return e.parseQueryAndSearch()}}},[e._v(" Search ")])],1)],2)])],1)},ic=[],ac={props:["searchtemplate"],data:function(){return{expanded:!1,params:{}}},computed:{sketch(){return this.$store.state.sketch},parameters(){return JSON.parse(this.searchtemplate.template_json).parameters},filledOut(){return Object.keys(this.params).length===this.parameters.length},searchTemplateSpec(){return JSON.parse(this.searchtemplate.template_json)}},methods:{search(e){let t={doSearch:!0};t.queryString=e,l.$emit("setQueryAndFilter",t)},parseQueryAndSearch(){let e;_.parseSearchTemplate(this.searchtemplate.id,this.params).then(t=>{e=t.data.objects[0].query_string,this.search(e)}).catch(e=>{})}}},nc=ac,rc=(0,d.A)(nc,sc,ic,!1,null,"2b44f333",null),lc=rc.exports,oc={props:{iconOnly:Boolean},components:{TsSearchTemplate:lc},data:function(){return{searchtemplates:[],expanded:!1,itemsPerPage:10,search:""}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta}},created(){_.getSearchTemplates().then(e=>{this.searchtemplates=e.data.objects[0],"undefined"===typeof this.searchtemplates&&(this.searchtemplates=[])}).catch(e=>{})}},cc=oc,dc=(0,d.A)(cc,ec,tc,!1,null,"d76a8c36",null),uc=dc.exports,hc=function(){var e=this,t=e._self._c;return e.iconOnly?t("div",{staticClass:"pa-4",staticStyle:{cursor:"pointer"},on:{click:function(t){e.$emit("toggleDrawer"),e.expanded=!0}}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-sigma-lower")]),t("div",{staticStyle:{height:"1px"}})],1):t("div",[t("div",{staticClass:"pa-4",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",style:e.sigmaRules&&e.sigmaRules.length?"cursor: pointer":"",on:{click:function(t){e.expanded=!e.expanded}}},[t("span",[t("v-icon",{attrs:{left:""}},[e._v("mdi-sigma-lower")]),e._v(" Sigma Rules ")],1),e.expanded||e.sigmaRules&&!e.sigmaRules.length?t("v-btn",{staticClass:"float-right mt-n1 mr-n1",attrs:{icon:"",text:"",to:{name:"SigmaNewRule",params:{sketchId:e.sketch.id}}},on:{click:function(e){e.stopPropagation()}}},[t("v-icon",{attrs:{title:"Add Sigma rules"}},[e._v("mdi-plus")])],1):e._e(),e.expanded?e._e():t("span",{staticClass:"float-right",staticStyle:{"margin-right":"3px"}},[e.isLoading?t("v-progress-circular",{attrs:{size:24,width:1,indeterminate:""}}):e._e()],1),e.expanded?e._e():t("span",{staticClass:"float-right",staticStyle:{"margin-right":"10px"}},[e.sigmaRules&&e.sigmaRules.length?t("small",[t("strong",[e._v(e._s(e.ruleCount))])]):e._e()])],1),t("v-expand-transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded,expression:"expanded"}]},[e.sigmaRules&&e.sigmaRules.length?t("div",[e.ruleCount<=e.itemsPerPage?t("v-data-iterator",{attrs:{items:e.sigmaRules,"hide-default-footer":""},scopedSlots:e._u([{key:"default",fn:function(s){return e._l(s.items,function(e){return t("ts-sigma-rule",{key:e.rule_uuid,attrs:{"sigma-rule":e}})})}}],null,!1,2506010555)}):t("v-data-iterator",{attrs:{items:e.sigmaRules,"items-per-page":e.itemsPerPage,search:e.search},on:{"update:itemsPerPage":function(t){e.itemsPerPage=t},"update:items-per-page":function(t){e.itemsPerPage=t}},scopedSlots:e._u([{key:"header",fn:function(){return[t("v-toolbar",{attrs:{flat:""}},[t("v-text-field",{attrs:{clearable:"","hide-details":"",outlined:"",dense:"","prepend-inner-icon":"mdi-magnify",label:"Search for a rule.."},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)]},proxy:!0},{key:"default",fn:function(s){return e._l(s.items,function(e){return t("ts-sigma-rule",{key:e.rule_uuid,attrs:{"sigma-rule":e}})})}}],null,!1,1881113905)})],1):e._e()])]),t("v-divider")],1)},mc=[],pc=function(){var e=this,t=e._self._c;return t("div",[t("v-row",{staticClass:"pa-3 pl-1",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",staticStyle:{cursor:"pointer","font-size":"0.9em"},attrs:{"no-gutters":""},on:{click:function(t){return e.getSigmaRuleResource(e.sigmaRule.rule_uuid)}}},[t("v-col",{staticClass:"pl-1",attrs:{cols:"1"}},[e.expanded?t("v-icon",{attrs:{title:"Close details"}},[e._v("mdi-chevron-down")]):t("v-icon",{attrs:{title:"Show details"}},[e._v("mdi-chevron-right")])],1),t("v-col",{attrs:{cols:"10"}},[e._v(" "+e._s(e.sigmaRule.title)+" ")]),t("v-col",{attrs:{cols:"1"}},[t("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-btn",e._g(e._b({attrs:{small:"",icon:""}},"v-btn",i,!1),s),[t("v-icon",{attrs:{title:"Manage Sigma rule",small:""}},[e._v("mdi-dots-vertical")])],1)]}}])},[t("v-card",[t("v-list",{attrs:{dense:""}},[t("v-list-item-group",[t("v-list-item",{attrs:{to:{name:"SigmaEditRule",params:{ruleId:e.sigmaRule.rule_uuid}}}},[t("v-list-item-icon",[t("v-icon",{attrs:{small:""}},[e._v("mdi-pencil")])],1),t("v-list-item-title",[e._v("Edit Rule")])],1),t("v-list-item",{on:{click:function(t){return e.downloadSigmaRule(e.sigmaRule.rule_uuid)}}},[t("v-list-item-icon",[t("v-icon",{attrs:{small:""}},[e._v("mdi-download")])],1),t("v-list-item-title",[e._v("Download Rule")])],1),t("v-list-item",{on:{click:function(t){return e.deprecateSigmaRule(e.sigmaRule.rule_uuid)}}},[t("v-list-item-icon",[t("v-icon",{attrs:{small:""}},[e._v("mdi-flash-off-outline")])],1),t("v-list-item-title",[e._v("Disable from analyzer")])],1),t("v-list-item",{on:{click:function(t){return e.deleteRule(e.sigmaRule.rule_uuid)}}},[t("v-list-item-icon",[t("v-icon",{attrs:{small:""}},[e._v("mdi-delete")])],1),t("v-list-item-title",[e._v("Delete Rule")])],1)],1)],1)],1)],1)],1)],1),t("v-expand-transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded,expression:"expanded"}],staticClass:"pa-4 pt-0"},[t("div",{staticClass:"mt-2"},[t("v-simple-table",{attrs:{dense:""},scopedSlots:e._u([{key:"default",fn:function(){return[t("tbody",e._l(e.sigmaRuleSummary,function(s,i){return t("tr",{key:i},[t("td",[t("strong",[e._v(e._s(i))])]),t("td",["references"===i?t("span",e._l(s,function(s){return t("ul",{key:s},[t("li",[t("a",{attrs:{href:s,target:"new"}},[e._v(e._s(s))])])])}),0):"falsepositives"===i?t("span",e._l(s,function(s){return t("ul",{key:s},[t("li",[e._v(e._s(s))])])}),0):"tags"===i&&s?t("span",e._l(s,function(s){return t("v-chip",{key:s,staticClass:"mr-2",attrs:{rounded:"","x-small":""},on:{click:function(t){return e.applyFilterChip(s)}}},[e._v(" "+e._s(s)+" ")])}),1):t("span",[e._v(" "+e._s(s)+" ")])])])}),0)]},proxy:!0}])})],1),t("div",{staticClass:"mt-3"},[void 0!==e.sketch.id?t("v-btn",{attrs:{small:"",depressed:"",color:"primary"},on:{click:function(t){return e.search(e.detailedSigmaRule.search_query)}}},[e._v("Search")]):e._e()],1)])]),t("v-divider")],1)},vc=[],gc={components:{},props:["sigmaRule"],data:function(){return{expanded:!1,detailedSigmaRule:[]}},computed:{sketch(){return this.$store.state.sketch},sigmaRuleSummary(){const e=["author","description","references","status","date","modified","falsepositives","level","tags","rule_uuid","search_query"];return Object.fromEntries(Object.entries(this.detailedSigmaRule).filter(([t])=>e.includes(t)))}},methods:{search(e){let t={doSearch:!0};t.queryString=e,l.$emit("setQueryAndFilter",t)},deleteRule(e){confirm("Delete Rule?")&&_.deleteSigmaRule(e).then(e=>{this.$store.dispatch("updateSigmaList"),this.$router.push({name:"Studio",params:{id:"new",type:"sigma"}})}).catch(e=>{console.error(e)})},getSigmaRuleResource(e){_.getSigmaRuleResource(e).then(e=>{this.detailedSigmaRule=e.data.objects[0],this.expanded=!this.expanded}).catch(e=>{console.error(e)})},deprecateSigmaRule(e){confirm("Deprecate Rule?")&&_.getSigmaRuleResource(e).then(t=>{var s=t.data.objects[0];const i=/status:\s*(experimental|testing|stable)/g;var a=s.rule_yaml.replace(i,"status: deprecated");_.updateSigmaRule(e,a).then(()=>{this.$store.dispatch("updateSigmaList"),l.$emit("errorSnackBar","Rule deprecated: "+e)}).catch(e=>{console.error(e)})}).catch(e=>{console.error(e)})},downloadSigmaRule(e){_.getSigmaRuleResource(e).then(e=>{var t=e.data.objects[0],s=new Blob([t.rule_yaml],{type:"text/plain"}),i=document.createElement("a");i.href=window.URL.createObjectURL(s),i.download=t.title+".yml",i.click()}).catch(e=>{console.error(e)})},applyFilterChip(e){let t={doSearch:!0,queryString:"*"},s={field:"tag",value:e,type:"term",operator:"must",active:!0};t.chip=s,l.$emit("setQueryAndFilter",t)}}},fc=gc,yc=(0,d.A)(fc,pc,vc,!1,null,"1c6cc184",null),_c=yc.exports,bc={props:{startExpanded:Boolean,iconOnly:Boolean},components:{TsSigmaRule:_c},data:function(){return{expanded:this.startExpanded,itemsPerPage:10,search:""}},methods:{},computed:{sigmaRules(){return this.$store.state.sigmaRuleList},ruleCount(){return this.$store.state.sigmaRuleList?this.$store.state.sigmaRuleList.length:0},sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},isLoading(){return!this.sigmaRules}},mounted(){this.$store.dispatch("updateSigmaList")}},Sc=bc,kc=(0,d.A)(Sc,hc,mc,!1,null,"16a86a92",null),wc=kc.exports,xc=function(){var e=this,t=e._self._c;return e.iconOnly?t("div",{staticClass:"pa-4",staticStyle:{cursor:"pointer"},on:{click:function(t){e.$emit("toggleDrawer"),e.expanded=!0}}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-shield-search")]),t("div",{staticStyle:{height:"1px"}})],1):t("div",[t("div",{staticClass:"pa-4",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",style:e.intelligenceData&&e.intelligenceData.length?"cursor: pointer":"",on:{click:function(t){e.expanded=!e.expanded}}},[t("span",[t("v-icon",{attrs:{left:""}},[e._v("mdi-shield-search")]),e._v(" Threat Intelligence ")],1),e.intelligenceData&&!e.intelligenceData.length?t("v-btn",{staticClass:"float-right mt-n1 mr-n1",attrs:{icon:""},on:{click:function(t){return e.addIndicator()}}},[t("v-icon",{attrs:{title:"Add new indicator"}},[e._v("mdi-plus")])],1):e._e(),e.expanded&&e.intelligenceData&&e.intelligenceData.length?t("v-btn",{staticClass:"float-right mt-n1 mr-n1",attrs:{icon:""},on:{click:[function(t){return e.addIndicator()},function(e){e.stopPropagation()}]}},[t("v-icon",{attrs:{title:"Add new indicator"}},[e._v("mdi-plus")])],1):e._e(),e.expanded&&e.intelligenceData&&e.intelligenceData.length?t("v-btn",{staticClass:"float-right mt-n1",attrs:{icon:"",to:{name:"Intelligence",params:{sketchId:e.sketch.id}}},on:{click:function(e){e.stopPropagation()}}},[t("v-icon",{attrs:{small:"",title:"Manage indicators"}},[e._v("mdi-open-in-new")])],1):e._e(),e.expanded?e._e():t("span",{staticClass:"float-right",staticStyle:{"margin-right":"10px"}},[e.intelligenceData&&e.intelligenceData.length?t("small",[t("strong",[e._v(e._s(e.intelligenceData.length))])]):e._e()])],1),t("v-expand-transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded,expression:"expanded"}]},[e.intelligenceData&&e.intelligenceData.length?t("div",[t("v-divider"),t("v-tabs",{attrs:{grow:""},model:{value:e.tabs,callback:function(t){e.tabs=t},expression:"tabs"}},[t("v-tab",[e._v(" Indicators ("),t("small",[e._v(" "+e._s(e.intelligenceData.length)+" ")]),e._v(") ")]),t("v-tab",[e._v(" Tags ("),t("small",[e._v(e._s(Object.keys(e.tagInfo).length)+" ")]),e._v(") ")])],1),t("v-tabs-items",{model:{value:e.tabs,callback:function(t){e.tabs=t},expression:"tabs"}},[t("v-tab-item",{attrs:{transition:!1}},[e.intelligenceData.length>=10?t("v-data-table",{attrs:{dense:"",headers:e.indicatorHeaders,items:e.intelligenceData,"items-per-page":10},scopedSlots:e._u([{key:"item.ioc",fn:function({item:s}){return[t("span",{attrs:{title:s.ioc}},[t("div",{staticStyle:{"max-width":"200px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},[e._v(" "+e._s(s.ioc)+" ")])])]}},{key:"item.type",fn:function({item:s}){return[t("small",[e._v(e._s(s.type))])]}},{key:"item.actions",fn:function({item:s}){return[t("v-btn",{attrs:{icon:"",small:""},on:{click:function(t){return e.generateSearchQuery(s.ioc)}}},[t("v-icon",{attrs:{small:"",title:"Search this indicator"}},[e._v("mdi-magnify")])],1)]}}],null,!1,1932107037)}):t("v-data-table",{attrs:{dense:"",headers:e.indicatorHeaders,items:e.intelligenceData,"hide-default-footer":""},scopedSlots:e._u([{key:"item.ioc",fn:function({item:s}){return[t("span",{attrs:{title:s.ioc}},[t("div",{staticStyle:{"max-width":"200px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},[e._v(" "+e._s(s.ioc)+" ")])])]}},{key:"item.type",fn:function({item:s}){return[t("small",[e._v(e._s(s.type))])]}},{key:"item.actions",fn:function({item:s}){return[t("v-btn",{attrs:{icon:"",small:""},on:{click:function(t){return e.generateSearchQuery(s.ioc)}}},[t("v-icon",{attrs:{small:"",title:"Search this indicator"}},[e._v("mdi-magnify")])],1)]}}],null,!1,1932107037)})],1),t("v-tab-item",{attrs:{transition:!1}},[t("v-data-table",{attrs:{dense:"",headers:e.tagHeaders,items:Object.values(e.tagInfo),"items-per-page":10},scopedSlots:e._u([{key:"item.tag",fn:function({item:s}){return[t("v-chip",{attrs:{"x-small":""},on:{click:function(t){return e.searchForIOC(s)}}},[e._v(e._s(s.tag.name))])]}},{key:"item.iocs",fn:function({item:s}){return[t("small",{attrs:{title:s.iocs}},[e._v(e._s(s.iocs.length))])]}},{key:"item.weight",fn:function({item:s}){return[t("small",[e._v(e._s(s.tag.weight))])]}},{key:"item.actions",fn:function({item:s}){return[t("v-btn",{attrs:{icon:"",small:""},on:{click:function(t){return e.searchForIOC(s)}}},[t("v-icon",{attrs:{small:"",title:"Search this indicator"}},[e._v("mdi-magnify")])],1)]}}],null,!1,1326170206)})],1)],1)],1):e._e()])]),t("v-divider")],1)},Tc=[];const Cc=()=>({from:0,terminate_after:40,size:40,indices:"_all",order:"asc",chips:[]});var Ac={props:{iconOnly:Boolean},data:function(){return{expanded:!1,tagInfo:{},tagMetadata:{},tabs:null,indicatorHeaders:[{text:"Indicator",value:"ioc",align:"start"},{text:"Type",value:"type"},{value:"actions"}],tagHeaders:[{text:"Tag",value:"tag",align:"start"},{text:"Indicators",value:"iocs"},{text:"Weight",value:"weight"},{value:"actions"}]}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},intelligenceAttribute(){return this.meta.attributes&&void 0!==this.meta.attributes.intelligence?this.meta.attributes.intelligence:{ontology:"intelligence",value:{data:[]},name:"intelligence"}},intelligenceData(){return this.intelligenceAttribute.value.data}},methods:{loadSketchAttributes(){_.getTagMetadata().then(e=>{this.tagMetadata=e.data,this.buildTagInfo()})},buildTagInfo(){for(var e of(this.tagInfo={},this.intelligenceData))for(var t of e.tags){var s=null;s="object"===typeof t?t.name:t,this.tagInfo[s]||(this.tagInfo[s]={count:0,iocs:[],tag:this.enrichTag(t)}),this.tagInfo[s].count++,this.tagInfo[s].iocs.push(e.ioc)}},enrichTag(e){if("object"===typeof e)return e;{let s={name:e};if(this.tagMetadata[e])return Ce().extend(s,this.tagMetadata[e]);for(var t in this.tagMetadata["regexes"])if(e.match(t))return Ce().extend(s,this.tagMetadata["regexes"][t]);return Ce().extend(s,this.tagMetadata.default)}},generateSearchQuery(e,t){let s=`"${e}"`;s=s.replace(/[\\\s]/g,"\\$&"),void 0!==t&&(s=`${t}:${s}`);let i={doSearch:!0};i.queryString=s,i.queryFilter=Cc(),l.$emit("setQueryAndFilter",i)},searchForIOC(e){let t=e.iocs.map(e=>`"${e}"`).reduce((e,t)=>`${e} OR ${t}`),s={doSearch:!0};s.queryString=t,s.queryFilter=Cc(),l.$emit("setQueryAndFilter",s)},addIndicator(){l.$emit("addIndicator")}},mounted(){this.loadSketchAttributes()}},Dc=Ac,$c=(0,d.A)(Dc,xc,Tc,!1,null,null,null),Lc=$c.exports,Ic=function(){var e=this,t=e._self._c;return e.iconOnly?t("div",{staticClass:"pa-4",staticStyle:{cursor:"pointer"},on:{click:function(t){e.$emit("toggleDrawer"),e.expanded=!0}}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-source-branch")]),t("div",{staticStyle:{height:"1px"}})],1):t("div",[t("div",{staticClass:"pa-4",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",staticStyle:{cursor:"pointer"},on:{click:function(t){e.expanded=!e.expanded}}},[t("span",[t("v-icon",{attrs:{left:""}},[e._v("mdi-source-branch")]),e._v(" Graphs ")],1),t("span",{staticClass:"float-right",staticStyle:{"margin-right":"10px"}},[t("small",[t("strong",[e._v(e._s(e.graphs.length+e.savedGraphs.length))])])])]),t("v-expand-transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded,expression:"expanded"}]},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.savedGraphs.length,expression:"savedGraphs.length"}]},[t("v-subheader",[e._v("Saved Graphs")]),e._l(e.savedGraphs,function(s){return t("router-link",{key:s.id,staticStyle:{cursor:"pointer","font-size":"0.9em","text-decoration":"none"},attrs:{to:{name:"Graph",query:{graph:s.id}}}},[t("v-row",{staticClass:"pa-2 pl-5",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",attrs:{"no-gutters":""},on:{click:function(t){return e.setSavedGraph(s.id)}}},[t("span",{class:e.$vuetify.theme.dark?"dark-font":"light-font"},[e._v(e._s(s.name))])])],1)})],2),t("div",{directives:[{name:"show",rawName:"v-show",value:e.graphs.length,expression:"graphs.length"}]},[t("v-subheader",[e._v("Plugins")]),e._l(e.graphs,function(s){return t("router-link",{key:s.name,staticStyle:{cursor:"pointer","font-size":"0.9em","text-decoration":"none"},attrs:{to:{name:"Graph",query:{plugin:s.name}}}},[t("v-row",{staticClass:"pa-2 pl-5",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",attrs:{"no-gutters":""},on:{click:function(t){return e.setGraphPlugin(s.name)}}},[t("span",{class:e.$vuetify.theme.dark?"dark-font":"light-font"},[e._v(e._s(s.display_name))])])],1)})],2)])]),t("v-divider")],1)},Ec=[],Nc={props:{iconOnly:Boolean},data:function(){return{expanded:!1}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},graphs(){return this.$store.state.graphPlugins},savedGraphs(){return this.$store.state.savedGraphs}},methods:{setGraphPlugin(e){l.$emit("setGraphPlugin",e)},setSavedGraph(e){l.$emit("setSavedGraph",e)}}},zc=Nc,Fc=(0,d.A)(zc,Ic,Ec,!1,null,null,null),Rc=Fc.exports,Pc=function(){var e=this,t=e._self._c;return e.iconOnly?t("div",{staticClass:"pa-4",staticStyle:{cursor:"pointer"},on:{click:function(t){e.$emit("toggleDrawer"),e.expanded=!0}}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-book-open-outline")]),t("div",{staticStyle:{height:"1px"}})],1):t("div",[t("div",{staticClass:"pa-4",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",style:e.filteredStories&&e.filteredStories.length?"cursor: pointer":"",attrs:{"no-gutters":"",flat:""},on:{click:function(t){e.expanded=!e.expanded}}},[t("span",[t("v-icon",{attrs:{left:""}},[e._v("mdi-book-open-outline")]),e._v(" Stories ")],1),!e.expanded&&e.filteredStories&&e.filteredStories.length?e._e():t("v-btn",{staticClass:"float-right mt-n1 mr-n1",attrs:{icon:"",text:""},on:{click:[function(t){return e.createStory()},function(e){e.stopPropagation()}]}},[t("v-icon",{attrs:{title:"Create New Story"}},[e._v("mdi-plus")])],1),!e.expanded&&e.filteredStories&&e.filteredStories.length?t("span",{staticClass:"float-right",staticStyle:{"margin-right":"10px"}},[e.filteredStories?t("small",[t("strong",[e._v(e._s(e.filteredStories.length))])]):e._e()]):e._e()],1),t("v-expand-transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded&&e.filteredStories.length,expression:"expanded && filteredStories.length"}]},e._l(e.filteredStories,function(s){return t("router-link",{key:s.id,staticStyle:{cursor:"pointer","font-size":"0.9em","text-decoration":"none"},attrs:{to:{name:"Story",params:{storyId:s.id}}}},[t("v-row",{staticClass:"pa-2 pl-5",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",attrs:{"no-gutters":""}},[t("span",{class:e.$vuetify.theme.dark?"dark-font":"light-font"},[e._v(e._s(s.title))])])],1)}),1)]),t("v-divider")],1)},Oc=[],Qc={props:{iconOnly:Boolean},data:function(){return{expanded:!1}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},filteredStories(){return this.meta.stories?this.meta.stories.filter(e=>!e.title.startsWith("__ts_")):[]}},methods:{createStory(){let e="Untitled story",t="";_.createStory(e,t,this.sketch.id).then(e=>{let t=e.data.objects[0].id;this.$router.push({name:"Story",params:{storyId:t}}),this.$store.dispatch("updateSketch",this.sketch.id)}).catch(e=>{})}}},Mc=Qc,qc=(0,d.A)(Mc,Pc,Oc,!1,null,null,null),Bc=qc.exports,Vc=function(){var e=this,t=e._self._c;return e.iconOnly?t("div",{staticClass:"pa-4",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.$emit("toggleDrawer")}}},[t("router-link",{attrs:{to:{name:"Explore",params:{sketchId:e.sketch.id}}}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-magnify")]),t("div",{staticStyle:{height:"1px"}})],1)],1):t("div",[t("router-link",{staticClass:"pa-4",class:e.$vuetify.theme.dark?e.isExploreRoute?"dark-highlight":"dark-hover":e.isExploreRoute?"light-highlight":"light-hover",staticStyle:{cursor:"pointer"},attrs:{to:{name:"Explore",params:{sketchId:e.sketch.id}},custom:""},scopedSlots:e._u([{key:"default",fn:function({navigate:s}){return[t("div",{attrs:{role:"link"},on:{click:s,keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:s.apply(null,arguments)}}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-magnify")]),e._v("Search")],1)]}}])}),t("v-divider")],1)},Hc=[],Gc={props:{iconOnly:Boolean},computed:{sketch(){return this.$store.state.sketch},isExploreRoute(){return"Explore"===this.$route.name},sketchId(){return this.$store.state.sketch.id}}},Uc=Gc,Wc=(0,d.A)(Uc,Vc,Hc,!1,null,null,null),jc=Wc.exports,Yc=function(){var e=this,t=e._self._c;return t("v-card",{attrs:{loading:e.isLoading}},[t("div",{staticClass:"pa-4"},[t("h3",[e._v('Share "'+e._s(e.sketch.name)+'"')]),t("br"),t("v-autocomplete",{attrs:{items:e.usersAndGroups,outlined:"","single-line":"",chips:"","small-chips":"","hide-details":"",multiple:"","return-object":"","deletable-chips":"",label:"Add people and groups"},scopedSlots:e._u([{key:"item",fn:function({item:s,on:i,attrs:a}){return[t("v-list-item",e._g(e._b({},"v-list-item",a,!1),i),[t("v-list-item-icon",{staticClass:"mr-3"},[t("v-icon",[e._v(e._s("user"===s.type?"mdi-account":"mdi-account-group-outline"))])],1),t("v-list-item-content",[t("v-list-item-title",{domProps:{textContent:e._s(s.text)}})],1)],1)]}}]),model:{value:e.usersAndGroupsToAdd,callback:function(t){e.usersAndGroupsToAdd=t},expression:"usersAndGroupsToAdd"}}),t("br"),e._v(" People with access "),t("v-list",[t("v-list-item",[t("v-list-item-avatar",[t("v-avatar",{attrs:{color:"grey lighten-1",size:"32"}},[t("span",{staticClass:"white--text"},[e._v(e._s(e._f("initialLetter")(e.sketch.user.username)))])])],1),t("v-list-item-content",[t("v-list-item-title",{domProps:{textContent:e._s(e.sketch.user.username)}})],1),t("v-spacer"),t("small",[e._v("Owner")])],1),e._l(e.meta.collaborators.users,function(s){return t("v-list-item",{key:s},[t("v-list-item-avatar",[t("v-avatar",{attrs:{color:"grey lighten-1",size:"32"}},[t("span",{staticClass:"white--text"},[e._v(e._s(e._f("initialLetter")(s)))])])],1),t("v-list-item-content",[t("v-list-item-title",{domProps:{textContent:e._s(s)}})],1),t("v-spacer"),t("v-icon",{on:{click:function(t){return e.revokeAccess(s,"")}}},[e._v("mdi-trash-can-outline")])],1)}),e._l(e.meta.collaborators.groups,function(s){return t("v-list-item",{key:s},[t("v-list-item-avatar",[t("v-icon",[e._v("mdi-account-group-outline")])],1),t("v-list-item-content",[t("v-list-item-title",{domProps:{textContent:e._s(s)}})],1),t("v-spacer"),t("v-icon",{on:{click:function(t){return e.revokeAccess("",s)}}},[e._v("mdi-trash-can-outline")])],1)})],2),t("br"),e._v(" General access "),t("v-select",{staticStyle:{width:"150px"},attrs:{"hide-details":"","single-line":"",items:e.items,label:e.generalAccess,"prepend-icon":e.accessIcon},on:{change:function(t){return e.setPublicAccess()}},model:{value:e.isPublic,callback:function(t){e.isPublic=t},expression:"isPublic"}}),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:""},on:{click:function(t){return e.$emit("close-dialog")}}},[e._v("Cancel")]),t("v-btn",{attrs:{color:"primary",depressed:""},on:{click:function(t){return e.grantAccess()}}},[e._v("Done")])],1)],1)])},Xc=[],Jc={data(){return{items:[{text:"Public",value:!0},{text:"Restricted",value:!1}],usersAndGroupsToAdd:[],usersToRemove:[],groupsToRemove:[],systemUsers:[],systemGroups:[],isPublic:!1,isLoading:!1}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},generalAccess(){return this.isPublic?"Public":"Restricted"},accessIcon(){return this.isPublic?"mdi-earth":"mdi-lock-outline"},usersAndGroups(){return this.systemUsers.concat(this.systemGroups)}},methods:{grantAccess:function(){if(!this.usersAndGroupsToAdd.length)return void this.$emit("close-dialog");this.isLoading=!0;let e=this.usersAndGroupsToAdd.filter(e=>"user"===e.type).map(e=>e.value),t=this.usersAndGroupsToAdd.filter(e=>"group"===e.type).map(e=>e.value);_.grantSketchAccess(this.sketch.id,e,t).then(e=>{this.$store.dispatch("updateSketch",this.sketch.id).then(()=>{this.isLoading=!1,this.usersAndGroupsToAdd=[],this.$emit("close-dialog"),this.successSnackBar("Updated sharing")})}).catch(e=>{this.errorSnackBar("Failed to share sketch "+e)})},revokeAccess:function(e,t){this.isLoading=!0;let s=[e],i=[t];_.revokeSketchAccess(this.sketch.id,s,i).then(e=>{this.$store.dispatch("updateSketch",this.sketch.id).then(()=>{this.isLoading=!1})}).catch(e=>{this.errorSnackBar("Failed to remove access "+e)})},setPublicAccess:function(){this.isLoading=!0,_.setSketchPublicAccess(this.sketch.id,this.isPublic).then(e=>{this.$store.dispatch("updateSketch",this.sketch.id).then(()=>{this.isLoading=!1})}).catch(e=>{this.errorSnackBar("Failed to share sketch "+e)})}},mounted(){this.isPublic=this.meta.permissions.public,_.getUsers().then(e=>{e.data.objects[0].forEach(e=>{let t={text:e.username,value:e.username,type:"user",disabled:!1};this.systemUsers.push(t)})}).catch(e=>{}),_.getGroups().then(e=>{e.data.objects[0].forEach(e=>{let t={text:e.name,value:e.name,type:"group",disabled:!1};this.systemGroups.push(t)})}).catch(e=>{})}},Kc=Jc,Zc=(0,d.A)(Kc,Yc,Xc,!1,null,null,null),ed=Zc.exports,td=function(){var e=this,t=e._self._c;return t("div",[t("h3",[e._v("Rename sketch")]),t("br"),t("v-form",{on:{submit:function(t){return t.preventDefault(),e.renameSketch()}}},[t("v-text-field",{attrs:{outlined:"",dense:"",autofocus:"",clearable:"",rules:e.sketchNameRules},on:{focus:function(e){return e.target.select()}},model:{value:e.newSketchName,callback:function(t){e.newSketchName=t},expression:"newSketchName"}}),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{text:""},on:{click:function(t){return e.closeDialog()}}},[e._v(" Cancel ")]),t("v-btn",{attrs:{disabled:!e.newSketchName||e.newSketchName.length>255,text:"",color:"primary"},on:{click:function(t){return e.renameSketch()}}},[e._v(" Save ")])],1)],1)],1)},sd=[],id={data(){return{newSketchName:"",sketchNameRules:[e=>!!e||"Sketch name is required.",e=>e&&e.length<=255||"Sketch name is too long."]}},computed:{sketch(){return this.$store.state.sketch}},methods:{renameSketch(){_.saveSketchSummary(this.sketch.id,this.newSketchName,"").then(e=>{this.$store.dispatch("updateSketch",this.sketch.id).then(()=>{})}).catch(e=>{console.error(e)}),this.$emit("close")},closeDialog:function(){this.newSketchName=this.sketch.name,this.$emit("close")}},created(){this.newSketchName=this.sketch.name}},ad=id,nd=(0,d.A)(ad,td,sd,!1,null,"6bdfe814",null),rd=nd.exports,ld=function(){var e=this,t=e._self._c;return e.iconOnly?t("div",{staticClass:"pa-4",staticStyle:{cursor:"pointer"},on:{click:function(t){e.$emit("toggleDrawer"),e.expanded=!0}}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-auto-fix")]),t("div",{staticStyle:{height:"1px"}})],1):t("div",[t("div",{staticClass:"pa-4",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",style:e.sortedAnalyzerResults.length?"cursor: pointer":"",on:{click:function(t){e.expanded=!e.expanded}}},[t("span",[t("v-icon",{attrs:{left:""}},[e._v("mdi-auto-fix")]),e._v(" Analyzer Results ")],1),e.expanded||e.sortedAnalyzerResults&&!e.sortedAnalyzerResults.length&&e.analyzerResultsReady?t("v-btn",{staticClass:"float-right mt-n1 mr-n1",attrs:{icon:"",text:"",to:{name:"Analyze",params:{sketchId:e.sketch.id,analyzerTimelineId:void 0}}},on:{click:function(e){e.stopPropagation()}}},[t("v-icon",{attrs:{title:"Select analyzers for execution"}},[e._v("mdi-plus")])],1):e._e(),t("span",{staticClass:"float-right",staticStyle:{"margin-right":"3px"}},[!e.analyzerResultsReady||e.activeAnalyzerSessionIds.length>0&&!e.activeAnalyzerTimeoutTriggered?t("v-progress-circular",{attrs:{size:24,width:1,indeterminate:"",value:e.activeAnalyzerDisplayCount}},[e._v(e._s(e.activeAnalyzerDisplayCount))]):e._e(),e.activeAnalyzerTimeoutTriggered?t("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t("v-btn",e._g({attrs:{small:"",icon:""},on:{click:[function(e){e.stopPropagation()},function(t){return e.startPolling()}]}},s),[t("v-icon",{attrs:{small:""}},[e._v("mdi-reload-alert")])],1)]}}],null,!1,2751229302)},[t("span",[e._v("Analyzer status check timeout, click to reload")])]):e._e()],1),t("span",{staticClass:"float-right",staticStyle:{"margin-right":"10px"}},[!e.expanded&&e.sortedAnalyzerResults&&e.sortedAnalyzerResults.length&&e.analyzerResultsReady?t("small",{staticClass:"ml-3"},[t("strong",[e._v(e._s(e.resultCounter))])]):e._e()])],1),t("v-expand-transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded,expression:"expanded"}]},[e.sortedAnalyzerResults.length>0?t("div",[e.sortedAnalyzerResults.length<=10?t("v-data-iterator",{attrs:{items:e.sortedAnalyzerResults,"hide-default-footer":"","disable-pagination":""},scopedSlots:e._u([{key:"default",fn:function(s){return e._l(s.items,function(s){return t("ts-analyzer-result",{key:s.analyzerName,attrs:{analyzer:s,isActive:e.activeAnalyzers.has(s.analyzerName)}})})}}],null,!1,3139649614)}):t("v-data-iterator",{attrs:{items:e.sortedAnalyzerResults,"hide-default-footer":"","disable-pagination":"",search:e.search,"custom-filter":e.filterAnalyzers},scopedSlots:e._u([{key:"header",fn:function(){return[t("v-toolbar",{attrs:{flat:"",height:"45"}},[t("v-text-field",{attrs:{"prepend-inner-icon":"mdi-filter-variant",clearable:"","hide-details":"",outlined:"",dense:"",label:"Filter analyzers"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)]},proxy:!0},{key:"default",fn:function(s){return e._l(s.items,function(s){return t("ts-analyzer-result",{key:s.analyzerName,attrs:{analyzer:s,isActive:e.activeAnalyzers.has(s.analyzerName)}})})}}],null,!1,3674083930)})],1):e._e()])]),t("v-divider")],1)},od=[],cd=function(){var e=this,t=e._self._c;return t("div",[t("v-row",{staticClass:"pa-3 pl-1",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",staticStyle:{cursor:"pointer"},attrs:{"no-gutters":""},on:{click:function(t){e.expanded=!e.expanded}}},[t("v-col",{staticClass:"pl-1",attrs:{cols:"1"}},[e.expanded?t("v-icon",{attrs:{title:"Close results"}},[e._v("mdi-chevron-down")]):t("v-icon",{attrs:{title:"Open results"}},[e._v("mdi-chevron-right")])],1),t("v-col",{attrs:{cols:"10"}},[t("span",{staticStyle:{"font-size":"0.9em"}},[e._v(" "+e._s(e.analyzer.data.analyzerInfo.display_name)+" ")])]),t("v-col",{attrs:{cols:"1"}},[e.isActive?t("div",{staticClass:"ml-1"},[t("v-progress-circular",{attrs:{size:20,width:1,indeterminate:""}},[t("small",[e._v(e._s(Object.keys(e.analyzer.data.timelines).length))])])],1):t("div",{staticClass:"ml-3"},[t("small",[e._v(e._s(Object.keys(e.analyzer.data.timelines).length))])])])],1),t("v-expand-transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded,expression:"expanded"}]},e._l(e.analyzer.data.timelines,function(s){return t("span",{key:s.id,staticStyle:{"font-size":"0.9em"}},[t("ts-analyzer-result-timeline",{attrs:{timeline:s,isMultiAnalyzer:e.analyzer.data.analyzerInfo.is_multi}})],1)}),0)]),t("v-divider")],1)},dd=[],ud=function(){var e=this,t=e._self._c;return t("div",{class:e.getHoverTheme},[t("v-divider"),"PENDING"===e.timeline.analysis_status||"STARTED"===e.timeline.analysis_status?t("div",{staticClass:"pa-2 pl-3",class:e.getHoverTheme,staticStyle:{display:"flex","align-items":"center"}},[t("v-icon",{staticClass:"mr-2",attrs:{title:"Toggle results for this timeline",color:"#"+e.timeline.color}},[e._v("mdi-circle")]),t("span",{staticClass:"mr-2 timeline-name-ellipsis",staticStyle:{color:"grey",width:"82% !important"}},[e._v(e._s(e.timeline.name))]),t("v-progress-circular",{attrs:{size:20,width:1,indeterminate:"",color:"primary"}})],1):t("div",{staticClass:"pa-2 pl-3",class:e.getHoverTheme,staticStyle:{cursor:"pointer",display:"flex","align-items":"center"},on:{click:function(t){e.expanded=!e.expanded}}},[t("v-icon",{staticClass:"mr-2",attrs:{title:"Toggle results for this timeline",color:"#"+e.timeline.color}},[e._v("mdi-circle")]),t("span",{staticClass:"timeline-name-ellipsis",staticStyle:{width:"82% !important"}},[e._v(e._s(e.timeline.name))]),"ERROR"===e.timeline.analysis_status?t("div",[t("v-btn",e._g({staticClass:"ml-1",staticStyle:{cursor:"default"},attrs:{text:"","x-small":"",icon:"",ripple:!1}},e.on),[t("v-icon",{staticClass:"ml-1",attrs:{title:"The analyzer ran into an error",small:""}},[e._v("mdi-alert")])],1)],1):e.checkAnalyzerOutput&&!e.isMultiAnalyzer?t("div",[t("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t("v-btn",e._g({directives:[{name:"show",rawName:"v-show",value:!e.isMultiAnalyzer,expression:"!isMultiAnalyzer"}],staticClass:"ml-1",staticStyle:{cursor:"default"},attrs:{text:"","x-small":"",icon:"",ripple:!1}},s),[t("v-icon",{attrs:{small:"",color:e.getPriorityColor}},[e._v("mdi-information-outline")])],1)]}}])},[t("span",[e._v("Result Priority: "+e._s(e.resultPriority))])])],1):t("div",[e.isMultiAnalyzer?e._e():t("v-tooltip",{attrs:{top:""},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t("v-btn",e._g({directives:[{name:"show",rawName:"v-show",value:!e.isMultiAnalyzer,expression:"!isMultiAnalyzer"}],staticClass:"ml-1",staticStyle:{cursor:"default"},attrs:{text:"","x-small":"",icon:"",ripple:!1}},s),[t("v-icon",{attrs:{small:"",color:e.getPriorityColor}},[e._v("mdi-information-outline")])],1)]}}],null,!1,3109249993)},[t("span",[e._v("Result Priority: Note")])])],1)],1),t("v-expand-transition",[e.isMultiAnalyzer?t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded,expression:"expanded"}],class:e.getHoverTheme},[t("v-simple-table",{staticClass:"ml-2 borderless",attrs:{dense:""}},[t("tbody",{class:e.getHoverTheme},[t("tr",[t("td",[t("strong",[e._v("Type:")])]),t("td",[t("span",[e._v(" Multi analyzer")])])]),t("tr",[t("td",[t("strong",[e._v("Last run:")])]),t("td",[t("span",[e._v(" "+e._s(e.timelineCreated)+" UTC ")])])]),t("tr",[t("td",{staticStyle:{border:"none"},attrs:{width:"80"}},[t("strong",[e._v("Status:")])]),t("td",[t("span",[e._v(" "+e._s(e.timeline.analysis_status)+" ")])])]),0!==e.timeline.results.length?t("tr",[t("td",{staticStyle:{border:"none"},attrs:{colspan:"2"}},[t("strong",[e._v("Results:")])])]):e._e()])]),t("v-data-iterator",{attrs:{items:e.timeline.results,"items-per-page":10,"hide-default-footer":e.timeline.results.length<10},scopedSlots:e._u([{key:"default",fn:function(s){return e._l(s.items,function(s,i){return t("div",{key:i},[t("v-divider"),t("v-row",{staticClass:"pa-1 pl-5",attrs:{"no-gutters":""}},[t("span",[e._v(e._s(s.verdict))])])],1)})}}])})],1):t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded,expression:"expanded"}],class:e.getHoverTheme},[e.checkAnalyzerOutput?t("v-simple-table",{staticClass:"ml-2 borderless",attrs:{dense:""}},[t("tbody",{class:e.getHoverTheme},[t("tr",{staticClass:"pr-3"},[t("td",{attrs:{width:"105"}},[t("strong",[e._v("Summary:")])]),t("td",[t("span",[e._v(" "+e._s(e.resultSummary||"loading...")+" ")])])]),t("tr",[t("td",[t("strong",[e._v("Priority:")])]),t("td",[t("span",[e._v(" "+e._s(e.resultPriority||"loading...")+" ")])])]),void 0!==e.references?t("tr",[t("td",{staticStyle:{border:"none"},attrs:{colspan:"2"}},[t("strong",[e._v("References:")]),t("ul",e._l(e.references,function(s,i){return t("li",{key:i},[t("a",{on:{click:function(t){return e.contextLinkRedirect(s)}}},[e._v(e._s(s))]),t("v-dialog",{attrs:{"max-width":"515","retain-focus":!1},model:{value:e.redirectWarnDialog,callback:function(t){e.redirectWarnDialog=t},expression:"redirectWarnDialog"}},[t("ts-link-redirect-warning",{attrs:{app:"","context-url":e.contextUrl},on:{cancel:function(t){e.redirectWarnDialog=!1}}})],1)],1)}),0)])]):e._e(),t("tr",[t("td",[t("strong",[e._v("Last run:")])]),t("td",[t("span",[e._v(" "+e._s(e.timelineCreated)+" UTC ")])])]),t("tr",[t("td",{staticStyle:{border:"none"},attrs:{width:"80"}},[t("strong",[e._v("Status:")])]),t("td",[t("span",[e._v(" "+e._s(e.resultStatus||"loading...")+" ")])])]),0!==Object.keys(e.getAnalyzerOutputMetaData).length?t("tr",[t("td",{staticStyle:{border:"none"},attrs:{colspan:"2"}},[t("strong",[e._v("Result artifacts")])])]):e._e(),e._l(e.getAnalyzerOutputMetaData,function(s,i){return t("tr",{key:i},[t("td",[t("strong",[e._v(e._s(i)+":")])]),"Searches"===i?t("td",{staticStyle:{border:"none"}},e._l(s,function(s,i){return t("v-chip",{key:i,staticClass:"mr-1",attrs:{outlined:"",small:""},on:{click:function(t){return e.setView(s)}}},[e._v(" "+e._s(s.name)+" ")])}),1):e._e(),"Story"===i?t("td",{staticStyle:{border:"none"}},e._l(s,function(s){return t("router-link",{key:s.id,attrs:{to:{name:"Story",params:{storyId:s.id}}}},[t("v-chip",{staticClass:"mr-1",attrs:{outlined:"",small:"",link:""}},[e._v(e._s(s.title))])],1)}),1):e._e(),"Graphs"===i?t("td",{staticStyle:{border:"none"}},e._l(s,function(s,i){return t("router-link",{key:i,attrs:{to:{name:"Graph",params:{graph:void 0===s.id?s.name:s.id}}}},[t("v-chip",{staticClass:"mr-1",attrs:{outlined:"",small:"",link:""},on:{click:function(t){void 0===s.id?e.setGraphPlugin(s.name):e.setSavedGraph(s.id)}}},[e._v(" "+e._s(void 0===s.id?s.display_name:s.name)+" ")])],1)}),1):e._e(),"Aggregations"===i?t("td",{staticStyle:{border:"none"}},[t("span",[e._v("Linking aggregations is not supported in the new UI yet.")])]):e._e(),"Tags"===i?t("td",{staticStyle:{border:"none"}},e._l(s,function(s,i){return t("v-chip",{key:i,staticClass:"mr-1 mb-1",attrs:{color:"lightgrey",small:""},on:{click:function(t){return e.applyFilterChip(s,"tag","term",e.timeline.id)}}},[e._v(" "+e._s(s)+" ")])}),1):e._e(),"Attributes"===i?t("td",{staticStyle:{border:"none"}},e._l(s,function(s,i){return t("v-chip",{key:i,staticClass:"mr-1 mb-1",attrs:{color:"lightgrey",small:""},on:{click:function(t){return e.applySearch(`_exists_:${s}`,e.timeline.id)}}},[e._v(" "+e._s(s)+" ")])}),1):e._e()])})],2)]):t("v-simple-table",{staticClass:"ml-2 borderless",attrs:{dense:""}},[t("tbody",{class:e.getHoverTheme},[t("tr",{staticClass:"pr-3"},[t("td",{staticStyle:{border:"none"},attrs:{width:"80"}},["ERROR"===e.timeline.analysis_status?t("strong",[e._v("Error:")]):t("strong",[e._v("Summary:")])]),t("td",[t("span",[e._v(" "+e._s(e.timelineResult.verdict)+" ")])])]),t("tr",[t("td",[t("strong",[e._v("Last run:")])]),t("td",[t("span",[e._v(" "+e._s(e.timelineCreated)+" UTC ")])])]),t("tr",[t("td",{staticStyle:{border:"none"},attrs:{width:"80"}},[t("strong",[e._v("Status:")])]),t("td",[t("span",[e._v(" "+e._s(e.timeline.analysis_status)+" ")])])])])])],1)])],1)},hd=[],md={props:["timeline","isMultiAnalyzer"],components:{TsLinkRedirectWarning:Ht},data:function(){return{expanded:!1,redirectWarnDialog:!1,contextUrl:""}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},graphs(){return this.$store.state.graphPlugins},savedGraphs(){return this.$store.state.savedGraphs},verboseAnalyzerOutput:function(){if(this.checkAnalyzerOutput){const e=JSON.parse(this.timelineResult.verdict);return null==e?void 0:e}},resultSummary:function(){return this.verboseAnalyzerOutput&&this.verboseAnalyzerOutput.result_summary},resultPriority:function(){return this.verboseAnalyzerOutput&&this.verboseAnalyzerOutput.result_priority},references:function(){return this.verboseAnalyzerOutput&&this.verboseAnalyzerOutput.references},resultStatus:function(){return this.verboseAnalyzerOutput&&this.verboseAnalyzerOutput.result_status},getAnalyzerOutputMetaData:function(){let e={};if(void 0!==this.verboseAnalyzerOutput&&void 0!==this.verboseAnalyzerOutput.platform_meta_data){if(void 0!==this.verboseAnalyzerOutput.platform_meta_data.saved_views){e["Searches"]=[];for(const t of this.verboseAnalyzerOutput.platform_meta_data.saved_views){let s=this.meta.views.find(e=>e.id===t);void 0!==s&&e["Searches"].push(s)}}if(void 0!==this.verboseAnalyzerOutput.platform_meta_data.saved_stories){e["Story"]=[];for(const t of this.verboseAnalyzerOutput.platform_meta_data.saved_stories){let s=this.meta.stories.find(e=>e.id===t);void 0!==s&&e["Story"].push(s)}}if(void 0!==this.verboseAnalyzerOutput.platform_meta_data.saved_graphs){e["Graphs"]=[];for(const t of this.verboseAnalyzerOutput.platform_meta_data.saved_graphs)if("number"===typeof t){let s=this.savedGraphs.find(e=>e.id===t);void 0!==s&&e["Graphs"].push(s)}else if("string"===typeof t){let s=this.graphs.find(e=>e.name===t);void 0!==s&&e["Graphs"].push(s)}else console.error("Saved Graph reference is neither Integer nor String.",typeof t,t)}return void 0!==this.verboseAnalyzerOutput.platform_meta_data.saved_aggregations&&(e["Aggregations"]=this.verboseAnalyzerOutput.platform_meta_data.saved_aggregations),void 0!==this.verboseAnalyzerOutput.platform_meta_data.created_tags&&(e["Tags"]=this.verboseAnalyzerOutput.platform_meta_data.created_tags),void 0!==this.verboseAnalyzerOutput.platform_meta_data.created_attributes&&(e["Attributes"]=this.verboseAnalyzerOutput.platform_meta_data.created_attributes),e}return e},getPriorityColor:function(){if(void 0!==this.verboseAnalyzerOutput&&void 0!==this.verboseAnalyzerOutput.result_priority){if("HIGH"===this.verboseAnalyzerOutput.result_priority)return"#DD2003";if("MEDIUM"===this.verboseAnalyzerOutput.result_priority)return"#F89412";if("LOW"===this.verboseAnalyzerOutput.result_priority)return"#0E72ED";if("NOTE"===this.verboseAnalyzerOutput.result_priority)return"#7F7C7C"}return"#7F7C7C"},checkAnalyzerOutput:function(){try{return JSON.parse(this.timelineResult.verdict),!0}catch(du){return!1}},timelineFirstResult:function(){return this.timeline&&this.timeline.results.length>0&&this.timeline.results[0]?this.timeline.results[0]:void 0},timelineCreated:function(){const e=this.timelineFirstResult;if(!e)return"... invalid date";const t=(e.created_at&&e.created_at.split(".").length)>0?e.created_at.split(".")[0]:"... invalid date";return t},timelineResult:function(){return this.timelineFirstResult?this.timelineFirstResult:"... no results found"},getHoverTheme:function(){return this.$vuetify.theme.dark?this.expanded?"dark-hover dark-bg":"dark-hover":this.expanded?"light-hover light-bg":"light-hover"}},methods:{setView:function(e){l.$emit("setActiveView",e)},setGraphPlugin(e){l.$emit("setGraphPlugin",e)},setSavedGraph(e){l.$emit("setSavedGraph",e)},applySearch(e="",t="_all"){let s={doSearch:!0};s.queryString=e,s.queryFilter={from:0,terminate_after:40,size:40,indices:[t],order:"asc",chips:[]},l.$emit("setQueryAndFilter",s)},applyFilterChip(e,t="",s="label",i="_all"){let a={doSearch:!0,queryString:"*"};a.queryFilter={from:0,terminate_after:40,size:40,indices:[i],order:"asc",chips:[]};let n={field:t,value:e,type:s,operator:"must",active:!0};a.chip=n,l.$emit("setQueryAndFilter",a)},contextLinkRedirect(e){this.contextUrl=e,this.redirectWarnDialog=!0}}},pd=md,vd=(0,d.A)(pd,ud,hd,!1,null,"595e8247",null),gd=vd.exports,fd={props:["analyzer","isActive"],components:{TsAnalyzerResultTimeline:gd},data:function(){return{expanded:!1}}},yd=fd,_d=(0,d.A)(yd,cd,dd,!1,null,null,null),bd=_d.exports,Sd={props:{iconOnly:Boolean},components:{TsAnalyzerResult:bd},data:function(){return{expanded:!1,search:"",analyzerResultsReady:!1,activeAnalyzerInterval:15e3,activeAnalyzerTimeout:3e5,activeAnalyzerTimeoutTriggered:!1,activeAnalyzerTimerStart:null}},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},analyzerList(){return this.$store.state.sketchAnalyzerList},activeAnalyses(){return this.$store.state.activeAnalyses},analyzerResults(){return this.$store.state.analyzerResults},sortedAnalyzerResults(){const e=this.groupByAnalyzer([...this.analyzerResults,...this.activeAnalyses]);let t=[...Object.entries(e).map(([e,t])=>({analyzerName:e,data:t}))];return t.sort((e,t)=>e.data.analyzerInfo.display_name.localeCompare(t.data.analyzerInfo.display_name)),t},resultCounter(){let e=0;for(const t of this.sortedAnalyzerResults)for(const s in t.data.timelines)"DONE"!==t.data.timelines[s].analysis_status&&"ERROR"!==t.data.timelines[s].analysis_status||(e+=1);return e},activeAnalyzers(){return new Set(this.activeAnalyses.map(e=>e.analyzer_name))},activeAnalyzerSessionIds(){return Array.from(new Set(this.activeAnalyses.map(e=>e.analysissession_id)))},activeAnalyzerDisplayCount(){return this.activeAnalyzerSessionIds.length>0?this.activeAnalyzerSessionIds.length:""}},methods:{async initializeAnalyzerResults(){let e=[];for(const t of this.sketch.timelines){const s=await _.getSketchTimelineAnalysis(this.sketch.id,t.id);let i=s.data.objects[0];i&&(e=e.concat(i))}this.$store.dispatch("updateAnalyzerResults",e),this.updateActiveAnalyses(this.$store,e),this.analyzerResultsReady=!0},groupByAnalyzer(e){let t={},s={};for(const i of e){if(t[i.analyzer_name]||(this.analyzerList[i.analyzer_name]?t[i.analyzer_name]={timelines:{},analyzerInfo:{name:i.analyzer_name,description:this.analyzerList[i.analyzer_name].description,is_multi:this.analyzerList[i.analyzer_name].is_multi,display_name:this.analyzerList[i.analyzer_name].display_name}}:t[i.analyzer_name]={timelines:{},analyzerInfo:{name:i.analyzer_name,description:"No description available.",is_multi:!1,display_name:i.analyzer_name}}),!t[i.analyzer_name].timelines[i.timeline.name]){const a={id:i.timeline.id,name:i.timeline.name,color:i.timeline.color,last_analysissession_id:i.analysissession_id};t[i.analyzer_name].analyzerInfo.is_multi?(s=this.getAnalyzerMultiResults(e,i.analyzer_name,i.analysissession_id,i.timeline.id),t[i.analyzer_name].timelines[i.timeline.name]={...a,analysis_status:s.analysis_status,results:s.results}):t[i.analyzer_name].timelines[i.timeline.name]={...a,analysis_status:i.status[0].status,results:[{verdict:i.result,created_at:i.created_at,analysis_status:i.status[0].status}]}}t[i.analyzer_name].timelines[i.timeline.name].last_analysissession_id<i.analysissession_id&&(t[i.analyzer_name].timelines[i.timeline.name].last_analysissession_id=i.analysissession_id,t[i.analyzer_name].analyzerInfo.is_multi?(s=this.getAnalyzerMultiResults(e,i.analyzer_name,i.analysissession_id,i.timeline.id),t[i.analyzer_name].timelines[i.timeline.name].results[0].analysis_status=s.analysis_status,t[i.analyzer_name].timelines[i.timeline.name].results=s.results):(t[i.analyzer_name].timelines[i.timeline.name].results[0].created_at=i.created_at,t[i.analyzer_name].timelines[i.timeline.name].results[0].verdict=i.result,t[i.analyzer_name].timelines[i.timeline.name].analysis_status=i.status[0].status,t[i.analyzer_name].timelines[i.timeline.name].results[0].analysis_status=i.status[0].status))}return t},getAnalyzerMultiResults(e,t,s,i){let a=[],n=new Set;for(const r of e)r.analyzer_name===t&&r.analysissession_id===s&&r.timeline.id===i&&(a.push({verdict:r.result,created_at:r.created_at,analysis_status:r.status[0].status}),n.add(r.status[0].status));return{results:a,analysis_status:this.getMultiStatus(n)}},getMultiStatus(e){return 1===e.size&&(e.has("DONE")||e.has("ERROR"))?[...e][0]:2===e.size&&e.has("DONE")&&e.has("ERROR")?"ERROR":"PENDING"},filterAnalyzers(e,t){const s=(t||"").toLowerCase();return e&&e.filter(e=>{const t=-1!==e.data.analyzerInfo.display_name.toLowerCase().indexOf(s),i=Object.keys(e.data.timelines).find(e=>-1!==e.indexOf(s));return t||i})},startPolling(){this.activeAnalyzerSessionIds.length>0&&!this.interval&&(this.activeAnalyzerTimerStart=Date.now(),this.interval=setInterval(async function(){if(0===this.activeAnalyzerSessionIds.length)return this.stopPolling(),void this.initializeAnalyzerResults();if(null!==this.activeAnalyzerTimerStart&&Date.now()-this.activeAnalyzerTimerStart>this.activeAnalyzerTimeout)return this.stopPolling(),void(this.activeAnalyzerTimeoutTriggered=!0);const e=this.activeAnalyses.length,t=await this.fetchActiveAnalyses(this.sketch.id);e!==t.length?this.initializeAnalyzerResults():this.updateActiveAnalyses(t)}.bind(this),this.activeAnalyzerInterval))},stopPolling(){clearInterval(this.interval),this.activeAnalyzerTimerStart=null,this.interval=!1},async fetchActiveAnalyses(e){try{const t=[],s=await _.getActiveAnalyzerSessions(e);if(s&&s.data&&s.data.objects&&s.data.objects[0]){const e=s.data.objects[0].detailed_sessions;if(e.length>0)for(const s of e)t.push(...s.objects[0]["analyses"])}return t}catch(t){console.error(t)}},updateActiveAnalyses(e,t){const s=t.filter(e=>"PENDING"===e.status[0].status||"STARTED"===e.status[0].status);e.dispatch("updateActiveAnalyses",s)}},mounted(){this.initializeAnalyzerResults(),this.activeAnalyzerTimerStart=Date.now()},beforeDestroy(){clearInterval(this.interval),this.interval=!1},watch:{activeAnalyzerSessionIds:function(){this.startPolling()}}},kd=Sd,wd=(0,d.A)(kd,ld,od,!1,null,"69ba5af1",null),xd=wd.exports,Td=function(){var e=this,t=e._self._c;return e.iconOnly?t("div",{key:"iconOnly",staticClass:"pa-4",staticStyle:{cursor:"pointer"},on:{click:function(t){e.$emit("toggleDrawer"),e.expanded=!0}}},[t("v-icon",{attrs:{left:""}},[e._v(" mdi-chart-bar ")]),t("div",{staticStyle:{height:"1px"}})],1):t("div",{key:"iconOnly"},[t("div",{staticClass:"pa-4",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",style:e.savedVisualizations&&e.savedVisualizations.length?"cursor: pointer":"",on:{click:function(t){e.expanded=!e.expanded}}},[t("span",[t("v-icon",{attrs:{left:""}},[e._v(" mdi-chart-bar ")]),e._v(" Visualizations ")],1),!e.expanded&&e.savedVisualizations&&e.savedVisualizations.length?e._e():t("v-btn",{staticClass:"float-right mt-n1 mr-n1",attrs:{icon:"",text:"",to:{name:"VisualizationNew"}},on:{click:function(e){e.stopPropagation()}}},[t("v-icon",{attrs:{title:"Create a new visualization"}},[e._v(" mdi-plus ")])],1),e.expanded?e._e():t("span",{staticClass:"float-right",staticStyle:{"margin-right":"10px"}},[e.savedVisualizations&&e.savedVisualizations.length?t("small",[t("strong",[e._v(" "+e._s(e.visualizationCount)+" ")])]):e._e()])],1),t("v-expand-transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded&&e.savedVisualizations.length,expression:"expanded && savedVisualizations.length"}]},e._l(e.savedVisualizations,function(s,i){return t("div",{key:i,staticStyle:{cursor:"pointer","font-size":"0.9em","text-decoration":"none"}},[t("v-row",{staticClass:"pa-2 pl-5",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",attrs:{"no-gutters":""}},[t("v-col",{class:e.$vuetify.theme.dark?"dark-font":"light-font",on:{click:function(t){return e.navigateToSavedVisualization(s.id)}}},[t("span",{staticClass:"d-inline-block text-truncate",staticStyle:{"max-width":"250px"}},[t("v-icon",{attrs:{left:"",small:""}},[e._v(" "+e._s(e.getIcon(s.chart_type))+" ")]),t("v-tooltip",{attrs:{bottom:"",disabled:s.name&&s.name.length<34},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:a}){return[t("span",e._g(e._b({},"span",a,!1),i),[e._v(e._s(s.name))])]}}],null,!0)},[t("span",[e._v(e._s(s.name))])])],1)]),t("v-col",{attrs:{cols:"auto"}},[t("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-btn",e._g(e._b({staticClass:"mr-1",attrs:{small:"",icon:""}},"v-btn",i,!1),s),[t("v-icon",{attrs:{title:"Actions",small:""}},[e._v(" mdi-dots-vertical ")])],1)]}}],null,!0)},[t("v-list",{staticClass:"mx-auto",attrs:{dense:""}},[t("v-list-item",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.copyVisualizationIdToClipboard(s.id)}}},[t("v-list-item-icon",[t("v-icon",{attrs:{small:""}},[e._v("mdi-identifier")])],1),t("v-list-item-title",[e._v("Copy visualization ID")])],1),t("v-list-item",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.copyVisualizationUrlToClipboard(s.id)}}},[t("v-list-item-icon",[t("v-icon",{attrs:{small:""}},[e._v("mdi-link-variant")])],1),t("v-list-item-title",[e._v("Copy link to this visualization")])],1),t("v-list-item",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.deleteVisualization(s.id)}}},[t("v-list-item-icon",[t("v-icon",{attrs:{small:""}},[e._v("mdi-trash-can")])],1),t("v-list-item-title",[e._v("Delete")])],1)],1)],1)],1)],1)],1)}),0)]),t("v-divider")],1)},Cd=[],Ad={props:{iconOnly:{type:Boolean}},data:function(){return{expanded:!1}},methods:{copyVisualizationIdToClipboard(e){try{navigator.clipboard.writeText(e),this.infoSnackBar("Saved Visualization ID copied to clipboard")}catch(t){this.errorSnackBar("Failed to load Saved Visualization ID into the clipboard!"),console.error(t)}},copyVisualizationUrlToClipboard(e){try{let t=window.location.origin+"/sketch/"+this.sketch.id+"/visualization/view/"+e;navigator.clipboard.writeText(t),this.infoSnackBar("Saved Visualization URL copied to clipboard")}catch(t){this.errorSnackBar("Failed to load Saved Visualization URL into the clipboard!"),console.error(t)}},deleteVisualization(e){confirm("Delete Saved Visualization?")&&_.deleteAggregationById(this.sketch.id,e).then(t=>{this.$store.dispatch("updateSavedVisualizationList",this.sketch.id),this.infoSnackBar("Saved Visualization has been deleted");let s={name:"VisualizationView",params:{aggregationId:e}},i=this.$route.fullPath,a=this.$router.resolve(s).route.fullPath;i===a&&this.$router.push({name:"VisualizationNew"})}).catch(e=>{this.errorSnackBar("Failed to delete Saved Visualization!"),console.error(e)})},getIcon(e){return{bar:"mdi-poll mdi-rotate-90",column:"mdi-chart-bar",line:"mdi-chart-line",table:"mdi-table",heatmap:"mdi-blur-linear",donut:"mdi-chart-donut"}[e]},navigateToSavedVisualization(e){let t={name:"VisualizationView",params:{aggregationId:e}},s=this.$router.resolve(t).route.fullPath,i=this.$route.fullPath;s!==i&&this.$router.push(t)}},computed:{savedVisualizations(){return this.$store.state.savedVisualizations?this.$store.state.savedVisualizations.filter(e=>"apex"===JSON.parse(e.parameters)["aggregator_class"]):[]},visualizationCount(){return this.$store.state.savedVisualizations?this.$store.state.savedVisualizations.filter(e=>"apex"===JSON.parse(e.parameters)["aggregator_class"]).length:0},sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta}},mounted(){this.$store.dispatch("updateSavedVisualizationList",this.sketch.id)}},Dd=Ad,$d=(0,d.A)(Dd,Td,Cd,!1,null,null,null),Ld=$d.exports,Id=function(){var e=this,t=e._self._c;return e.iconOnly?t("div",{staticClass:"pa-4",staticStyle:{cursor:"pointer"},on:{click:function(t){e.$emit("toggleDrawer"),e.expanded=!0}}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-clock-outline")]),t("div",{staticStyle:{height:"1px"}})],1):t("div",[t("div",{staticClass:"pa-4",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",staticStyle:{cursor:"pointer"},on:{click:function(t){e.expanded=!e.expanded}}},[t("span",[t("v-icon",{attrs:{left:""}},[e._v("mdi-clock-outline")]),e._v(" Timelines ")],1),e.expanded?t("ts-upload-timeline-form",{scopedSlots:e._u([{key:"default",fn:function(s){return[e.expanded||0===e.allTimelines.length?t("v-btn",e._g(e._b({staticClass:"float-right mt-n1 mr-n1",attrs:{icon:"",text:""},on:{click:function(e){e.stopPropagation()}}},"v-btn",s.attrs,!1),s.on),[t("v-icon",{attrs:{title:"Add timeline"}},[e._v("mdi-plus")])],1):e._e()]}}],null,!1,662016214)}):t("span",{staticClass:"float-right",staticStyle:{"margin-right":"10px"}},[t("small",{staticClass:"ml-3"},[t("strong",[e._v(e._s(e.allTimelines.length))])])])],1),t("v-expand-transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded,expression:"expanded"}]},[e.allTimelines.length>=e.paginationThreshold?t("v-text-field",{staticClass:"ma-3",attrs:{label:"Filter timelines","single-line":"",clearable:"","hide-details":"",outlined:"",dense:"","prepend-inner-icon":"mdi-magnify"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}):e._e(),t("v-data-table",{staticClass:"data-table",attrs:{"hide-default-footer":e.allTimelines.length<=e.paginationThreshold,"hide-default-header":!0,items:e.allTimelines,headers:e.headers,"item-key":"id",dense:"","disable-sort":"",search:e.search},scopedSlots:e._u([{key:"item.name",fn:function({item:s}){return[t("ts-timeline-component",{key:s.id+s.name,staticClass:"mb-1 mt-1",attrs:{"is-selected":e.isEnabled(s),timeline:s},on:{toggle:e.toggleTimeline,save:e.save,disableAllOtherTimelines:e.disableAllOtherTimelines},scopedSlots:e._u([{key:"processing",fn:function(i){return[t("div",{staticClass:"chip-content",style:e.timelineStyle(i.timelineStatus,e.isEnabled(s))},[t("span",{staticClass:"timeline-name-ellipsis"},[e._v(e._s(s.name))]),t("span",{staticClass:"right"},["processing"===i.timelineStatus?t("span",{staticClass:"ml-3 mr-3"},[t("v-progress-circular",{attrs:{small:"",indeterminate:"",color:"grey",size:17,width:2}})],1):e._e()])])]}},{key:"processed",fn:function(i){return[t("div",{staticClass:"chip-content",style:e.timelineStyle(i.timelineStatus,e.isEnabled(s))},[i.timelineFailed?t("v-icon",{staticClass:"ml-n2",attrs:{title:"Import failed; click for details",left:"",color:"red",size:"x-large"},on:{click:i.events.openDialog}},[e._v(" mdi-alert-circle-outline ")]):e._e(),i.timelineFailed?e._e():t("v-icon",{staticClass:"ml-n2",attrs:{left:"",color:i.timelineChipColor,size:"26"}},[e._v(" mdi-circle ")]),t("v-tooltip",{attrs:{bottom:"",disabled:s.name.length<40,"open-delay":"200"},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("span",e._g({staticClass:"timeline-name-ellipsis",staticStyle:{cursor:"default"}},i),[e._v(e._s(s.name))])]}}],null,!0)},[t("span",[e._v(e._s(s.name))])]),t("span",{staticClass:"right"},["processing"===i.timelineStatus?t("span",{staticClass:"ml-3 mr-3"},[t("v-progress-circular",{attrs:{small:"",indeterminate:"",color:"grey",size:17,width:2}})],1):e._e(),i.timelineFailed?e._e():t("span",{staticClass:"events-count mr-1",attrs:{"x-small":""}},[e._v(" "+e._s(e._f("compactNumber")(e.getCount(s)))+" ")]),i.timelineFailed?e._e():t("v-btn",{staticClass:"ma-1",attrs:{"x-small":"",icon:""},on:{click:i.events.toggleTimeline}},[e.isEnabled(s)?t("v-icon",[e._v(" mdi-eye ")]):t("v-icon",[e._v(" mdi-eye-off ")])],1),t("v-btn",e._g({staticClass:"ma-1",attrs:{"x-small":"",icon:""}},i.events.menuOn),[t("v-icon",[e._v(" mdi-dots-vertical ")])],1)],1)],1)]}}],null,!0)})]}}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1)]),t("v-divider")],1)},Ed=[],Nd={props:{iconOnly:Boolean},components:{TsUploadTimelineForm:st,TsTimelineComponent:Ee},computed:{sketch(){return this.$store.state.sketch},allTimelines(){let e=[...this.sketch.timelines];return e.sort(function(e,t){return e.name.localeCompare(t.name)}),e},activeTimelines(){let e=[...this.sketch.active_timelines];return e.sort(function(e,t){return e.name.localeCompare(t.name)})},settings(){return this.$store.state.settings}},watch:{"settings.showProcessingTimelineEvents":function(e,t){this.updateEnabledTimelines(void 0===t)}},methods:{isEnabled(e){return this.$store.state.enabledTimelines.includes(e.id)},toggleTimeline(e){this.$store.dispatch("toggleEnabledTimeline",e.id)},disableAllOtherTimelines(e){this.$store.dispatch("updateEnabledTimelines",[e.id])},updateEnabledTimelines(e){let t=this.activeTimelines;e?this.settings.showProcessingTimelineEvents||(t=t.filter(e=>"processing"!==e.status[0].status)):(t=t.filter(e=>this.$store.state.enabledTimelines.includes(e.id)),this.settings.showProcessingTimelineEvents&&(this.activeTimelines.forEach(e=>{t.includes(e)||"processing"!==e.status[0].status||t.push(e)}),t.sort((e,t)=>e.id-t.id)));let s=t.map(e=>e.id);this.$store.dispatch("updateEnabledTimelines",s)},timelineStyle(e,t){let s=["ready"];this.settings.showProcessingTimelineEvents&&s.push("processing");const i=s.includes(e)&&!t;return{opacity:i?"50%":"100%"}},updateCountPerTimeline(e){this.countPerTimeline=e},getCount(e){let t=0;return this.countPerTimeline&&(t=this.countPerTimeline[e.id]),t},save(e,t=!1){_.saveSketchTimeline(this.sketch.id,e.id,t||e.name,e.description,e.color).then(()=>this.$store.dispatch("updateSketch",this.sketch.id)).catch(e=>{console.error(e)})}},data:function(){return{countPerTimeline:{},expanded:!1,selected:[],search:"",headers:[{value:"name"}],paginationThreshold:10}},created(){this.updateEnabledTimelines(!0)},mounted(){l.$on("updateCountPerTimeline",this.updateCountPerTimeline)},beforeDestroy(){l.$off("updateCountPerTimeline")}},zd=Nd,Fd=(0,d.A)(zd,Id,Ed,!1,null,"3fb0c4da",null),Rd=Fd.exports,Pd=function(){var e=this,t=e._self._c;return e.iconOnly?t("div",{staticClass:"pa-4",staticStyle:{cursor:"pointer"}},[t("a",{staticStyle:{color:"inherit","text-decoration":"none"},attrs:{href:e.destinationUrl}},[t("v-icon",{attrs:{left:""}},[e._v(e._s(e.menuTitle.icon))]),t("div",{staticStyle:{height:"1px"}})],1)]):t("div",[t("a",{staticStyle:{"text-decoration":"none",color:"inherit",display:"block"},attrs:{href:e.destinationUrl}},[t("div",{staticClass:"pa-4",class:e.$vuetify.theme.dark?"dark-hover":"light-hover",staticStyle:{cursor:"pointer"}},[t("v-icon",{attrs:{left:""}},[e._v(e._s(e.menuTitle.icon))]),e._v(e._s(e.menuTitle.title)+" ")],1)]),t("v-divider")],1)},Od=[],Qd={props:{iconOnly:Boolean},computed:{sketch(){return this.$store.state.sketch},systemSettings(){return this.$store.state.systemSettings},menuTitle(){return this.systemSettings.LLM_FEATURES_AVAILABLE&&this.systemSettings.LLM_FEATURES_AVAILABLE.log_analyzer?{title:"AI Investigation",icon:"mdi-creation"}:!!this.systemSettings.DFIQ_ENABLED&&{title:"Investigation",icon:"mdi-text-box-search-outline"}},destinationUrl(){return this.sketch.id?`/v3/sketch/${this.sketch.id}/investigation`:"#"}}},Md=Qd,qd=(0,d.A)(Md,Pd,Od,!1,null,null,null),Bd=qd.exports,Vd=function(){var e=this,t=e._self._c;return t("v-container",{staticStyle:{height:"70vh"},attrs:{"fill-height":"",fluid:""}},[t("v-row",{attrs:{align:"center",justify:"center"}},[t("v-sheet",{staticClass:"pa-4",attrs:{color:"transparent"}},[t("div",{staticClass:"text-center"},[t("v-icon",{staticClass:"mb-3",attrs:{size:"100",color:"grey lighten-1"}},[e._v("mdi-lock")]),t("div",{staticClass:"text-h4 mb-3 mt-3"},[e._v("Access Denied")]),t("div",{staticClass:"mb-5 text--secondary"},[e._v(" You don't have permission to access this sketch."),t("br"),e._v(" Contact the sketch owner to request access. ")]),t("v-btn",{attrs:{rounded:"",depressed:"",color:"primary",to:"/"}},[t("v-icon",{attrs:{left:""}},[e._v("mdi-home")]),e._v(" Go to Home ")],1)],1)])],1)],1)},Hd=[],Gd={name:"TsAccessDenied"},Ud=Gd,Wd=(0,d.A)(Ud,Vd,Hd,!1,null,null,null),jd=Wd.exports,Yd={props:["sketchId"],components:{TsSavedSearches:qo,TsDataTypes:Wo,TsTags:Zo,TsSearchTemplates:uc,TsSigmaRules:wc,TsUploadTimelineFormButton:rt,TsShareCard:ed,TsRenameSketch:rd,TsIntelligence:Lc,TsGraphs:Rc,TsStories:Bc,TsSearch:jc,TsAnalyzerResults:xd,TsTimelinesTable:Rd,TsEventList:gi,TsVisualizations:Ld,TsQuestionCard:cl,TsSettingsDialog:E,TsInvestigation:Bd,TsAccessDenied:jd},data(){return{showSketchMetadata:!1,navigationDrawer:{width:56},isMiniDrawer:!0,selectedScenario:null,scenarioDialog:!1,showLeftPanel:!1,leftPanelTab:0,leftPanelTabItems:["EXPLORE","INVESTIGATE"],renameSketchDialog:!1,showHidden:!1,shareDialog:!1,loadingSketch:!1,timelineViewHeight:60,showTimelineView:!1,currentContextEvent:{},minimizeTimelineView:!1,queryRequest:{},contextStartTime:null,contextEndTime:null,contextTimeWindowSeconds:300,showFacetMenu:!1,showQuestionMenu:!1,showRightSidePanel:!1,showSettingsDialog:!1,questionCardExclusionRoutes:["VisualizationNew","SigmaNewRule","Analyze","Story"]}},mounted(){this.loadingSketch=!0,this.showLeftPanel=!1,this.$store.dispatch("updateUserSettings").then(()=>this.$store.dispatch("updateSketch",this.sketchId)).then(()=>{this.$store.dispatch("updateSearchHistory",this.sketchId),this.$store.dispatch("updateScenarioTemplates",this.sketchId),this.$store.dispatch("updateSavedGraphs",this.sketchId),this.$store.dispatch("updateGraphPlugins"),this.$store.dispatch("updateContextLinks"),this.$store.dispatch("updateAnalyzerList",this.sketchId),this.$store.dispatch("updateSystemSettings").then(()=>{this.userSettings.showLeftPanel&&this.toggleDrawer()}),this.hasTimelines&&!this.isArchived&&(this.showLeftPanel=!0),this.updateDocumentTitle(),this.loadingSketch=!1}),l.$on("showContextWindow",this.showContextWindow)},beforeDestroy(){l.$off("showContextWindow")},computed:{sketch(){return this.$store.state.sketch},meta(){return this.$store.state.meta},userSettings(){return this.$store.state.settings},isArchived(){return!(!this.sketch.status||!this.sketch.status.length)&&"archived"===this.sketch.status[0].status},currentUser(){return this.$store.state.currentUser},hasTimelines(){return this.sketch.timelines&&this.sketch.timelines.length},currentRouteName(){return this.$route.name},systemSettings(){return this.$store.state.systemSettings},sketchAccessDenied(){return this.$store.state.sketchAccessDenied}},methods:{archiveSketch:function(){this.loadingSketch=!0,_.archiveSketch(this.sketch.id).then(e=>{this.$store.dispatch("updateSketch",this.sketch.id).then(()=>{this.showLeftPanel=!1,this.loadingSketch=!1})}).catch(e=>{console.error(e)})},unArchiveSketch:function(){this.loadingSketch=!0,_.unArchiveSketch(this.sketch.id).then(e=>{this.$store.dispatch("updateSketch",this.sketch.id).then(()=>{this.loadingSketch=!1,this.showLeftPanel=!0})}).catch(e=>{console.error(e)})},deleteSketch:function(){confirm("Are you sure you want to delete the sketch?")&&_.deleteSketch(this.sketch.id).then(e=>{this.$router.push({name:"Home"})}).catch(e=>{console.error(e)})},generateContextQuery(e){let t=this.$options.filters.formatTimestamp(e._source.timestamp);this.contextStartTime=Ae.A.utc(t).subtract(this.contextTimeWindowSeconds,"second"),this.contextEndTime=Ae.A.utc(t).add(this.contextTimeWindowSeconds,"second");let s={field:"",value:this.contextStartTime.toISOString()+","+this.contextEndTime.toISOString(),type:"datetime_range",operator:"must",active:!0},i={from:0,terminate_after:40,size:40,indices:["_all"],order:"asc",chips:[s]},a={queryString:"*",queryFilter:i};return a},updateContextQuery(e){this.contextTimeWindowSeconds=e,this.queryRequest=this.generateContextQuery(this.currentContextEvent)},contextToSearch(){let e=this.generateContextQuery(this.currentContextEvent);e.doSearch=!0,l.$emit("setQueryAndFilter",e),this.showTimelineView=!1},showContextWindow(e){this.currentContextEvent=e,this.queryRequest=this.generateContextQuery(e),this.showTimelineView=!0},increaseTimelineViewHeight:function(){this.minimizeTimelineView=!1,this.timelineViewHeight>70||(this.timelineViewHeight+=30)},decreaseTimelineViewHeight:function(){if(this.minimizeTimelineView=!1,this.timelineViewHeight<50)return this.minimizeTimelineView=!0,void(this.timelineViewHeight=0);this.timelineViewHeight-=30},closeTimelineView:function(){this.minimizeTimelineView=!0,this.timelineViewHeight=0},toggleTheme:function(){this.$vuetify.theme.dark=!this.$vuetify.theme.dark,localStorage.setItem("isDarkTheme",this.$vuetify.theme.dark.toString());let e=document.body;e.dataset.theme=this.$vuetify.theme.dark?"dark":"light"},switchUI:function(){window.location.href=window.location.href.replace("/sketch/","/legacy/sketch/")},toggleDrawer:function(){this.navigationDrawer.width>56?(this.navigationDrawer.width=56,this.isMiniDrawer=!0):(this.navigationDrawer.width=350,setTimeout(()=>{this.isMiniDrawer=!1},100))},updateDocumentTitle:function(){this.sketch&&this.sketch.name&&this.sketch.id?document.title=`[${this.sketch.id}] ${this.sketch.name}`:document.title="Timesketch"}},watch:{sketch(e){e&&this.updateDocumentTitle()},hasTimelines(e,t){0===t&&e>0&&(this.showLeftPanel=!0),t>0&&0===e&&(this.showLeftPanel=!1)}}},Xd=Yd,Jd=(0,d.A)(Xd,zo,Fo,!1,null,null,null),Kd=Jd.exports;i["default"].use(m.Ay);const Zd=[{name:"Home",path:"/",component:R},{path:"/sketch/:sketchId",component:Kd,props:!0,children:[{path:"",name:"Overview",redirect:{name:"Explore"}},{path:"explore",name:"Explore",component:No,props:!0},{path:"intelligence",name:"Intelligence",component:No,props:!0},{path:"sigma",component:No,props:!0,children:[{path:"new",name:"SigmaNewRule",component:No,props:!0},{path:"edit/:ruleId",name:"SigmaEditRule",component:No,props:!0}]},{path:"visualization",component:No,props:!0,children:[{path:"new",name:"VisualizationNew",component:No,props:!0},{path:"view/:aggregationId",name:"VisualizationView",component:No,props:!0}]},{path:"graph",name:"Graph",component:No,props:!0},{path:"story/:storyId",name:"Story",component:No,props:!0},{path:"analyzers",name:"Analyze",component:No,props:!0}]}];var eu=new m.Ay({mode:"history",routes:Zd}),tu=s(5353);i["default"].use(tu.Ay);const su=e=>({sketch:{},meta:{},searchHistory:{},timeFilters:{},scenarios:[],hiddenScenarios:[],scenarioTemplates:[],graphPlugins:[],savedGraphs:[],tags:[],dataTypes:[],count:0,currentSearchNode:null,currentUser:e,settings:{},systemSettings:{},activeContext:{scenario:{},facet:{},question:{}},snackbar:{active:!1,color:"",message:"",timeout:-1},contextLinkConf:{},sketchAnalyzerList:{},savedVisualizations:[],activeAnalyses:[],analyzerResults:[],enabledTimelines:[],sketchAccessDenied:!1}),iu=su();var au=new tu.Ay.Store({state:iu,mutations:{SET_SKETCH(e,t){i["default"].set(e,"sketch",t.objects[0]),i["default"].set(e,"meta",t.meta)},SET_SEARCH_HISTORY(e,t){i["default"].set(e,"searchHistory",t.objects)},SET_SCENARIOS(e,t){i["default"].set(e,"scenarios",t.objects[0])},SET_SCENARIO_TEMPLATES(e,t){i["default"].set(e,"scenarioTemplates",t.objects)},SET_TIMELINE_TAGS(e,t){i["default"].set(e,"tags",t)},SET_EVENT_LABELS(e,t){i["default"].set(e.meta,"filter_labels",t)},SET_DATA_TYPES(e,t){let s=t.objects[0]["field_bucket"]["buckets"];i["default"].set(e,"dataTypes",s)},SET_COUNT(e,t){i["default"].set(e,"count",t)},SET_SEARCH_NODE(e,t){i["default"].set(e,"currentSearchNode",t)},SET_SIGMA_LIST(e,t){i["default"].set(e,"sigmaRuleList",t["objects"]),i["default"].set(e,"sigmaRuleList_count",t["meta"]["rules_count"])},SET_VISUALIZATION_LIST(e,t){i["default"].set(e,"savedVisualizations",t)},SET_ACTIVE_USER(e,t){_.getLoggedInUser().then(t=>{let s=t.data.objects[0].username;i["default"].set(e,"currentUser",s)})},SET_ACTIVE_CONTEXT(e,t){localStorage.setItem("sketchContext"+e.sketch.id.toString(),JSON.stringify({scenarioId:t.scenarioId,facetId:t.facetId,questionId:t.questionId})),i["default"].set(e,"activeContext",t)},CLEAR_ACTIVE_CONTEXT(e){let t={scenario:e.activeContext.scenario,facet:e.activeContext.facet,question:{}};i["default"].set(e,"activeContext",t)},SET_GRAPH_PLUGINS(e,t){i["default"].set(e,"graphPlugins",t)},SET_SAVED_GRAPHS(e,t){i["default"].set(e,"savedGraphs",t.objects[0]||[])},SET_SNACKBAR(e,t){i["default"].set(e,"snackbar",t)},RESET_STATE(e,t){_.getLoggedInUser().then(t=>{let s=t.data.objects[0].username;Object.assign(e,su(s))})},SET_CONTEXT_LINKS(e,t){i["default"].set(e,"contextLinkConf",t)},SET_ANALYZER_LIST(e,t){i["default"].set(e,"sketchAnalyzerList",t)},SET_SAVED_VISUALIZATIONS(e,t){i["default"].set(e,"savedVisualizations",t)},SET_ACTIVE_ANALYSES(e,t){i["default"].set(e,"activeAnalyses",t)},ADD_ACTIVE_ANALYSES(e,t){const s=[...e.activeAnalyses,...t];i["default"].set(e,"activeAnalyses",s)},SET_ANALYZER_RESULTS(e,t){i["default"].set(e,"analyzerResults",t)},SET_ENABLED_TIMELINES(e,t){i["default"].set(e,"enabledTimelines",t)},SET_TIME_FILTERS(e,t){i["default"].set(e,"timeFilters",t)},ADD_ENABLED_TIMELINES(e,t){const s=[...e.enabledTimelines,...t];i["default"].set(e,"enabledTimelines",s)},REMOVE_ENABLED_TIMELINES(e,t){i["default"].set(e,"enabledTimelines",e.enabledTimelines.filter(e=>!t.includes(e)))},TOGGLE_ENABLED_TIMELINE(e,t){if(e.enabledTimelines.includes(t))i["default"].set(e,"enabledTimelines",e.enabledTimelines.filter(e=>t!==e));else{const s=[...e.enabledTimelines,t];i["default"].set(e,"enabledTimelines",s)}},SET_SYSTEM_SETTINGS(e,t){i["default"].set(e,"systemSettings",t||{})},SET_USER_SETTINGS(e,t){i["default"].set(e,"settings",t.objects[0]||{})},SET_SKETCH_ACCESS_DENIED(e,t){i["default"].set(e,"sketchAccessDenied",t)}},actions:{updateSketch(e,t){return e.commit("SET_SKETCH_ACCESS_DENIED",!1),_.getSketch(t).then(s=>{e.commit("SET_SKETCH",s.data),e.commit("SET_ACTIVE_USER",s.data),e.dispatch("updateTimelineTags",{sketchId:t}),e.dispatch("updateDataTypes",t)}).catch(t=>{t.response&&403===t.response.status?e.commit("SET_SKETCH_ACCESS_DENIED",!0):console.error(t)})},updateCount(e,t){return _.countSketchEvents(t).then(t=>{e.commit("SET_COUNT",t.data.meta.count)}).catch(e=>{console.error(e)})},resetState(e){e.commit("RESET_STATE")},updateSearchNode(e,t){e.commit("SET_SEARCH_NODE",t)},updateSearchHistory(e,t){return t||(t=e.state.sketch.id),_.getSearchHistory(t).then(t=>{e.commit("SET_SEARCH_HISTORY",t.data)}).catch(e=>{console.error(e)})},updateTimeFilters(e,t){t||(t=e.state.sketch.id),_.getSearchHistoryTree(t).then(t=>{const s=t.data.objects[0],i=[];function a(e){if(!e||!e.query_filter)return;const t=JSON.parse(e.query_filter);t.chips.length>0&&i.push(...t.chips.filter(e=>"datetime_range"===e.type));for(let s of e.children)a(s)}s&&a(s);const n=[],r=new Set;for(let e of i)r.has(e.value)||(r.add(e.value),n.push(e));n.reverse(),e.commit("SET_TIME_FILTERS",n)}).catch(console.error)},updateScenarios(e,t){return t||(t=e.state.sketch.id),_.getSketchScenarios(t).then(t=>{e.commit("SET_SCENARIOS",t.data)}).catch(e=>{console.error(e)})},updateScenarioTemplates(e,t){return _.getScenarioTemplates(t).then(t=>{e.commit("SET_SCENARIO_TEMPLATES",t.data)}).catch(e=>{console.error(e)})},updateEventLabels(e,{label:t,num:s}){if(!t||!s)return;let i=e.state.meta.filter_labels,a=i.find(e=>e.label===t);void 0!==a?a.count+=s:i.push({label:t,count:s}),e.commit("SET_EVENT_LABELS",i)},updateTimelineTags(e,t){if("archived"===e.state.sketch.status[0].status)return void e.commit("SET_TIMELINE_TAGS",[]);const s=e.state.sketch.active_timelines;if(!s||!s.length)return;const i=s.every(e=>!(!e||!e.status||0===e.status.length)&&"processing"===e.status[0].status);if(i&&!e.state.settings.showProcessingTimelineEvents)return;let a={aggregator_name:"field_bucket",aggregator_parameters:{field:"tag",limit:"1000"},include_processing_timelines:!!e.state.settings.showProcessingTimelineEvents};return _.runAggregator(t.sketchId,a).then(s=>{let i=s.data.objects[0]["field_bucket"]["buckets"];if(t.tag&&t.num){let e=void 0===i.find(e=>e.tag===t.tag);if(e)i.push({tag:t.tag,count:t.num});else{let e=i.findIndex(e=>e.tag===t.tag);i[e].count+=t.num}}e.commit("SET_TIMELINE_TAGS",i)}).catch(e=>{console.error(e)})},updateDataTypes(e,t){if("archived"===e.state.sketch.status[0].status)return void e.commit("SET_DATA_TYPES",{objects:[{field_bucket:{buckets:[]}}]});const s=e.state.sketch.active_timelines;if(!s||!s.length)return;const i=s.every(e=>!(!e||!e.status||0===e.status.length)&&"processing"===e.status[0].status);if(i&&!e.state.settings.showProcessingTimelineEvents)return;let a={aggregator_name:"field_bucket",aggregator_parameters:{field:"data_type",limit:"1000"},include_processing_timelines:!!e.state.settings.showProcessingTimelineEvents};return _.runAggregator(t,a).then(t=>{e.commit("SET_DATA_TYPES",t.data)}).catch(e=>{console.error(e)})},updateSigmaList(e){_.getSigmaRuleList().then(t=>{e.commit("SET_SIGMA_LIST",t.data)}).catch(e=>{console.error(e)})},updateSavedVisualizationList(e,t){_.getAggregations(t).then(t=>{e.commit("SET_VISUALIZATION_LIST",t.data.objects[0]||[])}).catch(e=>{console.error(e)})},setActiveContext(e,t){e.commit("SET_ACTIVE_CONTEXT",t)},clearActiveContext(e){e.commit("CLEAR_ACTIVE_CONTEXT")},setSnackBar(e,t){e.commit("SET_SNACKBAR",{active:!0,color:t.color,message:t.message,timeout:t.timeout})},updateContextLinks(e){_.getContextLinkConfig().then(t=>{e.commit("SET_CONTEXT_LINKS",t.data)}).catch(e=>{console.error(e)})},updateGraphPlugins(e){_.getGraphPluginList().then(t=>{e.commit("SET_GRAPH_PLUGINS",t.data)}).catch(e=>{console.error(e)})},updateSavedGraphs(e,t){t||(t=e.state.sketch.id),_.getSavedGraphList(t).then(t=>{e.commit("SET_SAVED_GRAPHS",t.data)}).catch(e=>{console.error(e)})},updateAnalyzerList(e,t){t||(t=e.state.sketch.id),_.getAnalyzers(t).then(t=>{let s={};void 0!==t.data&&t.data.forEach(e=>{s[e.name]=e}),e.commit("SET_ANALYZER_LIST",s)}).catch(e=>{console.error(e)})},updateActiveAnalyses(e,t){e.commit("SET_ACTIVE_ANALYSES",t)},addActiveAnalyses(e,t){e.commit("ADD_ACTIVE_ANALYSES",t)},updateAnalyzerResults(e,t){e.commit("SET_ANALYZER_RESULTS",t)},enableTimeline(e,t){e.commit("ADD_ENABLED_TIMELINES",[t])},disableTimeline(e,t){e.commit("REMOVE_ENABLED_TIMELINES",[t])},updateEnabledTimelines(e,t){e.commit("SET_ENABLED_TIMELINES",t)},toggleEnabledTimeline(e,t){e.commit("TOGGLE_ENABLED_TIMELINE",t)},updateSystemSettings(e){return _.getSystemSettings().then(t=>{e.commit("SET_SYSTEM_SETTINGS",t.data)}).catch(e=>{console.error(e)})},updateUserSettings(e){return _.getUserSettings().then(t=>{e.commit("SET_USER_SETTINGS",t.data)}).catch(e=>{console.error(e)})}}});const nu=5e3;i["default"].mixin({methods:{successSnackBar(e,t=nu){const s={message:e,color:"success",timeout:t};this.$store.dispatch("setSnackBar",s)},errorSnackBar(e,t=nu){const s={message:e,color:"error",timeout:t};this.$store.dispatch("setSnackBar",s)},warningSnackBar(e,t=nu){const s={message:e,color:"warning",timeout:t};this.$store.dispatch("setSnackBar",s)},infoSnackBar(e,t=2e3){const s={message:e,color:"info",timeout:t};this.$store.dispatch("setSnackBar",s)}}});var ru=s(4600),lu=s.n(ru);s(4301);i["default"].use(lu(),{options:{customProperties:!0}});const ou={theme:{dark:!1},icons:{iconfont:"mdi"}};var cu=new(lu())(ou);s(8540),s(3240),s(3105),s(4590),i["default"].use(s(5624)),i["default"].config.productionTip=!1,new i["default"]({router:eu,store:au,vuetify:cu,render:e=>e(h)}).$mount("#app")},1101:function(e,t,s){"use strict";var i=s(4353),a=s.n(i),n=s(3826),r=s.n(n),l=s(8660),o=s.n(l);a().extend(r()),a().extend(o()),t.A=a()},1649:function(e,t,s){"use strict";s.r(t),t["default"]={name:"initialLetter",filter:function(e){return e?(e=e.toString(),e.charAt(0).toUpperCase()):""}}},1761:function(e,t,s){"use strict";s.r(t),t["default"]={name:"capitalize",filter:function(e){return e?(e=e.toString(),e.charAt(0).toUpperCase()+e.slice(1)):""}}},2259:function(e,t,s){"use strict";s.r(t),t["default"]={name:"formatSeconds",filter:function(e){return e>60?e/60+"m":e+"s"}}},2975:function(e,t,s){"use strict";s.r(t),t["default"]={name:"formatLabelText",filter:function(e){return"__ts_star"===e||"label : __ts_star"===e?"All starred events":"__ts_comment"===e||"label : __ts_comment"===e?"All commented events":e.replace("__ts_","")}}},3105:function(e,t,s){"use strict";s.r(t);s(8111),s(7588);var i=s(5471);const a=s(3583);a.keys().forEach(e=>{const t=a(e),s=t.default.name;i["default"].component(s,t.default||t)})},3176:function(e,t,s){"use strict";s.r(t);var i=s(1101);t["default"]={name:"shortDateTime",filter:function(e){return i.A.utc(e).format("YYYY-MM-DD HH:mm")}}},3240:function(e,t,s){"use strict";s.r(t)},3340:function(e,t,s){"use strict";s.r(t);var i=s(1101);t["default"]={name:"toISO8601",filter:function(e){return e<0?"No timestamp":(0,i.A)(e).toISOString()}}},3583:function(e){function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=3583,e.exports=t},3710:function(e,t,s){"use strict";s.r(t);var i=s(1101);t["default"]={name:"timeSince",filter:function(e){return e?i.A.utc(e).fromNow():""}}},4311:function(e,t,s){"use strict";s.r(t),t["default"]={name:"compactBytes",filter:function(e){e||(e=0);let t=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],s=Math.min(Math.floor(Math.log(e)/Math.log(1e3)),t.length-1),i=1*(e/Math.pow(1e3,s)).toFixed(2);return i+t[s]}}},4590:function(e,t,s){"use strict";s.r(t);s(8111),s(2489),s(7588);var i=s(5471);const a=s(9724);a.keys().forEach(e=>{const t=a(e);i["default"].filter(t.default.name,t.default.filter)})},7843:function(e,t,s){"use strict";s.r(t),t["default"]={name:"filterChip",filter:function(e){return"label"===e.type?"__ts_star"===e.value?"Starred":"__ts_comment"===e.value?"Commented":e.value:e.field+":"+e.value}}},8540:function(e,t,s){"use strict";s.r(t)},9595:function(e,t,s){"use strict";s.r(t),t["default"]={name:"compactNumber",filter:function(e){e||(e=0);let t="";if(e>999999999)e=Math.round(e/1e9*10)/10,t="B";else if(e>999999)e=Math.round(e/1e6*10)/10,t="M";else{if(!(e>999))return e;e=Math.round(e/1e3*10)/10,t="K"}return e+t}}},9724:function(e,t,s){var i={"./Capitalize.js":1761,"./CompactBytes.js":4311,"./CompactNumber.js":9595,"./FilterChip.js":7843,"./FormatLabelText.js":2975,"./FormatSeconds.js":2259,"./FormatTimestamp.js":550,"./Initital.js":1649,"./ToISO8601.js":3340,"./shortDateTime.js":3176,"./timeSince.js":3710};function a(e){var t=n(e);return s(t)}function n(e){if(!s.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=n,e.exports=a,a.id=9724}},t={};function s(i){var a=t[i];if(void 0!==a)return a.exports;var n=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}s.m=e,function(){var e=[];s.O=function(t,i,a,n){if(!i){var r=1/0;for(d=0;d<e.length;d++){i=e[d][0],a=e[d][1],n=e[d][2];for(var l=!0,o=0;o<i.length;o++)(!1&n||r>=n)&&Object.keys(s.O).every(function(e){return s.O[e](i[o])})?i.splice(o--,1):(l=!1,n<r&&(r=n));if(l){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[i,a,n]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={57:0};s.O.j=function(t){return 0===e[t]};var t=function(t,i){var a,n,r=i[0],l=i[1],o=i[2],c=0;if(r.some(function(t){return 0!==e[t]})){for(a in l)s.o(l,a)&&(s.m[a]=l[a]);if(o)var d=o(s)}for(t&&t(i);c<r.length;c++)n=r[c],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(d)},i=self["webpackChunktimesketch"]=self["webpackChunktimesketch"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=s.O(void 0,[504],function(){return s(712)});i=s.O(i)})();
//# sourceMappingURL=index.aa177cdc.js.map