
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../analyzer-development/">
      
      
        <link rel="next" href="../../changelog/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>AI Log Analyzer Deep Dive - timesketch</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#developer-deep-dive-the-hybrid-ai-log-analyzer-architecture" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="timesketch" class="md-header__button md-logo" aria-label="timesketch" data-md-component="logo">
      
  <img src="../../assets/images/timesketch-color.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            timesketch
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              AI Log Analyzer Deep Dive
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/google/timesketch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../guides/getting-started/" class="md-tabs__link">
        
  
  
    
  
  Quickstart

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/user/upload-data/" class="md-tabs__link">
          
  
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/admin/install/" class="md-tabs__link">
          
  
  
  Admin Guide

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../getting-started/" class="md-tabs__link">
          
  
  
  Developers

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../changelog/" class="md-tabs__link">
          
  
  
  Changelog

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../community/resources/" class="md-tabs__link">
          
  
  
  Community

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://osdfir.blogspot.com/search/label/timesketch" class="md-tabs__link">
        
  
  
    
  
  Blog

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../community/2025-blackhat/" class="md-tabs__link">
          
  
  
  Black Hat & defcon 2025

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="timesketch" class="md-nav__button md-logo" aria-label="timesketch" data-md-component="logo">
      
  <img src="../../assets/images/timesketch-color.svg" alt="logo">

    </a>
    timesketch
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/google/timesketch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/upload-data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Uploading timelines
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/basic-concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basic concepts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/sketch-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sketch overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/search-query-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Search query guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/cli-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Command line client
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/notebook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Interactive notebook
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/import-from-json-csv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Import from JSON or CSV
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/sigma/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Use Sigma
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/intelligence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Intelligence
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_10" >
        
          
          <label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Analyzers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Analyzers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/analyzers/tagger/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tagger analyzer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/analyzers/feature_extraction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feature extraction analyzer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/analyzers/sigma_analyzer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sigma analyzer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/analyzers/hashR_lookup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HashR analyzer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/llm-features-user/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Admin Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Admin Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Upgrade
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/scaling-and-limits/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scaling and limits
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/admin-cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Admin CLI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/context-links/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Context Links
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/llm-features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/investigation-view-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Investigation View
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/load-dfiq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DFIQ Templates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/performance-monitoring.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Performance Monitoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Developers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Developers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting started
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../frontend-development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Frontend development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Writing and running tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Interactive notebook
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API client
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    API client
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-upload-data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Upload data via API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI client
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Analyzers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Analyzers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../analyzer-development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Create an analyzer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    AI Log Analyzer Deep Dive
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Log Analyzer Deep Dive
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#developer-deep-dive-the-hybrid-ai-log-analyzer-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Developer Deep Dive: The Hybrid AI Log Analyzer Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Developer Deep Dive: The Hybrid AI Log Analyzer Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architectural-overview-a-hybrid-approach" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architectural Overview: A Hybrid Approach
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component-breakdown" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component Breakdown
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experiment-with-your-own-log-reasoning-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Experiment With Your Own Log Reasoning Agent
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Experiment With Your Own Log Reasoning Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        Endpoint
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        Request Format
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        Response Format
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-in-timesketch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration in Timesketch
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integrating-custom-tools-and-ai-scripts-with-the-investigation-view" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integrating Custom Tools and AI Scripts with the Investigation View
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integrating Custom Tools and AI Scripts with the Investigation View">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-add-an-investigative-question" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Add an Investigative Question
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-add-a-conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Add a Conclusion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-link-events-to-the-conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Link Events to the Conclusion
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Changelog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/202305-202403/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    202305 202403
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/2023-05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2023-05
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/2023-03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2023-03
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/2023-02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2023-02
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/2023-01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2023-01
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/2022-12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2022-12
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/2022-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2022-10
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/2022-09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2022-09
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Community
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Community
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../community/resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Resources
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../community/roadmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Roadmap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Events
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Events
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../community/2025-blackhat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Black Hat & defcon 2025
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../community/2021-timesketch-summit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2021 Summit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://osdfir.blogspot.com/search/label/timesketch" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Black Hat & defcon 2025
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Black Hat & defcon 2025
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../community/2025-blackhat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Black Hat & defcon 2025
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#developer-deep-dive-the-hybrid-ai-log-analyzer-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Developer Deep Dive: The Hybrid AI Log Analyzer Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Developer Deep Dive: The Hybrid AI Log Analyzer Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architectural-overview-a-hybrid-approach" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architectural Overview: A Hybrid Approach
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component-breakdown" class="md-nav__link">
    <span class="md-ellipsis">
      
        Component Breakdown
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experiment-with-your-own-log-reasoning-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Experiment With Your Own Log Reasoning Agent
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Experiment With Your Own Log Reasoning Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        Endpoint
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        Request Format
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        Response Format
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-in-timesketch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration in Timesketch
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integrating-custom-tools-and-ai-scripts-with-the-investigation-view" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integrating Custom Tools and AI Scripts with the Investigation View
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integrating Custom Tools and AI Scripts with the Investigation View">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-add-an-investigative-question" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Add an Investigative Question
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-add-a-conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Add a Conclusion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-link-events-to-the-conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Link Events to the Conclusion
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  
  



  
  


  <h1>AI Log Analyzer Deep Dive</h1>

<h3 id="developer-deep-dive-the-hybrid-ai-log-analyzer-architecture">Developer Deep Dive: The Hybrid AI Log Analyzer Architecture</h3>
<p>The AI-powered Investigation View introduces a powerful capability for automated,
large-scale log analysis. Unlike other LLM features that operate on-demand on a
small selection of events, the Log Analyzer is designed to process
<strong>all active timelines</strong> in a sketch, which can involve millions of events.
This requirement necessitates a robust, asynchronous, and streaming-native architecture.</p>
<p>This guide provides a technical deep dive into the components that power this
feature and outlines the API contract required to connect your own compatible log
analysis capability.</p>
<h4 id="architectural-overview-a-hybrid-approach">Architectural Overview: A Hybrid Approach</h4>
<p>To handle potentially long-running analysis tasks without timing out web requests,
we've implemented a hybrid architecture that combines Timesketch's existing
<strong>Analyzer Framework</strong> with the new <strong>LLM Feature and Provider</strong> system.</p>
<p>This approach gives us the best of both worlds:</p>
<ul>
<li><strong>Asynchronous Execution:</strong> The analysis is triggered as a Celery background
    task, preventing API timeouts and allowing the user to continue working while
    the analysis runs.</li>
<li><strong>Decoupling and Reusability:</strong> The core logic is encapsulated in the LLM
    Feature and Provider, separating it from the task queue system.</li>
<li><strong>Scalability:</strong> The architecture is built on streaming data (NDJSON),
    ensuring that memory usage remains low on both the Timesketch server and the
    AI agent, regardless of the number of events.</li>
</ul>
<p>The three key components are:</p>
<ol>
<li><strong>The Analyzer (<code>llm_log_analyzer</code>):</strong> The trigger and Celery task wrapper.</li>
<li><strong>The Feature (<code>LogAnalyzer</code>):</strong> The orchestrator of the entire workflow.</li>
<li><strong>The Provider (<code>SecGeminiLogAnalyzer</code>):</strong> The communicator that handles the
    streaming connection to the external AI agent.</li>
</ol>
<h4 id="component-breakdown">Component Breakdown</h4>
<p><strong>1. The Analyzer: Triggering the Workflow</strong></p>
<p>The <code>LLMLogAnalyzer</code> is a lightweight <code>BaseAnalyzer</code> plugin. Its sole
responsibility is to initiate the analysis process on a Celery worker.</p>
<ul>
<li><strong>File:</strong> <code>timesketch/lib/analyzers/llm_log_analyzer.py</code></li>
</ul>
<pre><code class="language-python"># A simplified view of the analyzer's run method
class LLMLogAnalyzer(interface.BaseAnalyzer):
    NAME = &quot;llm_log_analyzer&quot;
    # ...

    def run(self):
        # 1. Get the feature instance
        feature_instance = feature_manager.FeatureManager.get_feature_instance(
            &quot;log_analyzer&quot;
        )

        # 2. Get the LLM provider instance
        llm_provider = llm_provider_manager.LLMManager.create_provider(
            feature_name=feature_instance.NAME
        )

        # 3. Call the feature's execute method to start the real work
        result = feature_instance.execute(
            sketch=self.sketch.sql_sketch,
            form={},
            llm_provider=llm_provider,
        )

        # 4. Summarize the result and update the analyzer status in the UI
        self.output.result_summary = f&quot;Log Analyzer finished. Processed {result.get('total_findings_processed', 0)} findings.&quot;
        return str(self.output)
</code></pre>
<p>When a user clicks "Generate Initial Report", this analyzer is queued. It runs
in the background, instantiates the necessary LLM feature and provider, and then
calls the <code>execute</code> method to kick off the main logic.</p>
<p><strong>2. The Feature: Orchestrating the Data Flow</strong></p>
<p>The <code>LogAnalyzer</code> feature is the heart of the operation. It manages the entire
process from data extraction to result processing.</p>
<ul>
<li><strong>File:</strong> <code>timesketch/lib/llms/features/log_analyzer.py</code></li>
</ul>
<p>Its <code>execute</code> method orchestrates the following steps:</p>
<ol>
<li><strong>Prepare Log Stream:</strong> It calls <code>prepare_log_stream_for_analysis</code>, which
    creates a Python generator that yields events one by one from all active
    timelines in the sketch using the OpenSearch <code>sliced_scroll</code> API. This ensures
    data is streamed efficiently from the datastore.</li>
<li><strong>Invoke Provider:</strong> It passes this log generator to the LLM provider's
    <code>generate_stream_from_logs</code> method.</li>
<li><strong>Process Findings Stream:</strong> It receives a generator of "findings" back from
    the provider. It iterates through each finding as it arrives.</li>
<li><strong>Commit to Database:</strong> For each finding, it calls its own <code>process_response</code>
    method, which creates and commits the necessary <code>InvestigativeQuestion</code> and
    <code>InvestigativeQuestionConclusion</code> objects to the PostgreSQL database.</li>
</ol>
<p><strong>3. The Provider: Communicating with the AI Agent</strong></p>
<p>The <code>SecGeminiLogAnalyzer</code> provider acts as the client for the external AI agent.
It is responsible for the network communication.</p>
<ul>
<li><strong>File:</strong> <code>timesketch/lib/llms/providers/secgemini_log_analyzer_agent.py</code></li>
</ul>
<p>Key methods:</p>
<ul>
<li><code>_stream_log_data_as_ndjson_gen</code>: This helper method takes the Python
    generator of log events from the feature and converts each event into a
    line of a <strong>Newline Delimited JSON (NDJSON)</strong> stream.</li>
<li><code>generate_stream_from_logs</code>: This is the main communication method.<ul>
<li>It initiates a streaming <code>requests.post</code> call to the AI agent's API endpoint.</li>
<li>The <code>data</code> parameter of the request is the NDJSON generator, which streams
    the log data to the agent.</li>
<li>It then listens to the response stream from the agent, using
    <code>response.iter_lines()</code> to read the incoming NDJSON findings one by one.</li>
<li>It <code>yields</code> each finding back to the feature layer for processing.</li>
</ul>
</li>
</ul>
<hr />
<h3 id="experiment-with-your-own-log-reasoning-agent">Experiment With Your Own Log Reasoning Agent</h3>
<p>To integrate your own custom log analysis service, you need to build an HTTP
service that adheres to the API contract expected by the <code>SecGeminiLogAnalyzer</code>
provider or create your own custom provider file similar to the <code>SecGeminiLogAnalyzer</code>
that works with the <code>log_analyzer</code> feature.</p>
<p><strong>API Contract:</strong></p>
<h4 id="endpoint"><strong>Endpoint</strong></h4>
<p>Your service must expose an endpoint to receive the log data. The default is <code>/analyze_logs</code>.</p>
<h4 id="request-format"><strong>Request Format</strong></h4>
<p>The provider will send a streaming <code>POST</code> request with the following characteristics:</p>
<ul>
<li><strong>Method:</strong> <code>POST</code></li>
<li><strong>Headers:</strong><ul>
<li><code>Content-Type: application/x-ndjson</code></li>
<li><code>Accept: application/x-ndjson</code></li>
</ul>
</li>
<li><strong>Body:</strong> A stream of newline-delimited JSON objects. Each object is a complete
              Timesketch event.</li>
</ul>
<p><strong>Example Request Body (NDJSON stream):</strong></p>
<pre><code class="language-json">{&quot;_index&quot;: &quot;a1b2c3d4...&quot;, &quot;_id&quot;: &quot;event_id_1&quot;, &quot;_source&quot;: {&quot;message&quot;: &quot;User 'admin' logged in from 192.168.1.100&quot;, &quot;timestamp&quot;: 1672531200000000, ...}}
{&quot;_index&quot;: &quot;a1b2c3d4...&quot;, &quot;_id&quot;: &quot;event_id_2&quot;, &quot;_source&quot;: {&quot;message&quot;: &quot;Process 'evil.exe' created by pid 1234&quot;, &quot;timestamp&quot;: 1672531201000000, ...}}
</code></pre>
<h4 id="response-format"><strong>Response Format</strong></h4>
<p>Your agent should return a complete response as a single block of text. This
response must contain a markdown-formatted section that includes a JSON object
with the analysis findings.</p>
<ul>
<li><strong>Headers:</strong> <code>Content-Type: application/x-ndjson</code></li>
<li><strong>Body:</strong> A text response that includes a <code>**JSON Summary of Findings**</code> marker,
              followed by a JSON code block. Timesketch will parse the entire response
              to find and extract this specific JSON block.</li>
</ul>
<p><strong>Finding List Schema:</strong></p>
<p>The Timesketch backend will parse the JSON block from the response. This block
should be a list of "finding" objects. The following table details the schema
for a single object within that list.</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>log_records</code></td>
<td>List of Objects</td>
<td><strong>Yes</strong></td>
<td>A list of log record objects, each identifying a Timesketch event.</td>
</tr>
<tr>
<td><code>annotations</code></td>
<td>List of Objects</td>
<td><strong>Yes</strong></td>
<td>A list of annotation objects. Each annotation will generate DFIQ objects in Timesketch.</td>
</tr>
</tbody>
</table>
<p>Each object inside the <code>log_records</code> list must have the following structure:</p>
<p><strong>Annotation Object Schema:</strong></p>
<p>Each object inside the <code>annotations</code> list must have the following structure:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>investigative_question</code></td>
<td>String</td>
<td><strong>Yes</strong></td>
<td>The DFIQ question that was generated. This will become an <code>InvestigativeQuestion</code>.</td>
</tr>
<tr>
<td><code>conclusions</code></td>
<td>List of Strings</td>
<td><strong>Yes</strong></td>
<td>A list of answers or findings for the question. Each will become an <code>InvestigativeQuestionConclusion</code>.</td>
</tr>
<tr>
<td><code>priority</code></td>
<td>String</td>
<td>No</td>
<td>The priority for the question. Can be <code>low</code>, <code>medium</code>, or <code>high</code>.</td>
</tr>
<tr>
<td><code>attack_stage</code></td>
<td>String</td>
<td>No</td>
<td>A suggested attack stage (e.g., MITRE ATT&amp;CK Tactic). This is stored as a question attribute.</td>
</tr>
</tbody>
</table>
<p><strong>Example of a Single Finding Object (from the list in the JSON block):</strong></p>
<pre><code class="language-json">{
  &quot;log_records&quot;: [
    { &quot;record_id&quot;: &quot;8XdJUJgB092O9Z5p3KNH&quot; },
    { &quot;record_id&quot;: &quot;another_event_id&quot; }
  ],
  &quot;annotations&quot;: [
    {
      &quot;attack_stage&quot;: &quot;Initial access&quot;,
      &quot;priority&quot;: &quot;high&quot;,
      &quot;investigative_question&quot;: &quot;What is the initial access vector?&quot;,
      &quot;conclusions&quot;: [
        &quot;Successful password-based root login from a known Tor exit node.&quot;
      ]
    },
    {
      &quot;attack_stage&quot;: &quot;Persistence&quot;,
      &quot;investigative_question&quot;: &quot;What is the persistence mechanism?&quot;,
      &quot;conclusions&quot;: [&quot;Creation of a malicious cron job.&quot;]
    }
  ]
}
</code></pre>
<p><strong>A Note on API Flexibility:</strong></p>
<p>The Timesketch <code>log_analyzer</code> feature will only parse the fields specified as
"Required" in the schemas above. Any other fields in your finding or annotation
objects will be safely ignored. This allows you to include additional metadata
in your agent's output for your own logging or debugging purposes without
breaking the integration. If you want to utilize any additional fields, you need
to create your own LLM feature file.</p>
<h4 id="configuration-in-timesketch"><strong>Configuration in Timesketch</strong></h4>
<p>Once your agent is deployed, update your <code>timesketch.conf</code> to point to it:</p>
<pre><code class="language-python">LLM_PROVIDER_CONFIGS = {
    'log_analyzer': {
        '&lt;PROVIDER&gt;_log_analyzer_agent': {
            'server_url': 'http://YOUR_AGENT_HOST:PORT',
            'api_key': '&lt;YOUR_API_KEY_IF_ANY&gt;',
        }
    }
}
</code></pre>
<p>By following this architecture and API contract, you can seamlessly integrate
custom, large-scale log analysis capabilities into the Timesketch Investigation View.</p>
<hr />
<h3 id="integrating-custom-tools-and-ai-scripts-with-the-investigation-view">Integrating Custom Tools and AI Scripts with the Investigation View</h3>
<p>While the Hybrid AI Log Analyzer provides a powerful streaming interface, you
can also programmatically interact with the Investigation View using the
Timesketch API client. This is ideal for integrating your own external tools,
AI scripts, or workflows that generate investigative questions, conclusions,
and link them to specific events.</p>
<p>This approach allows you to populate the Investigation View with findings from
your custom analytics, making them immediately available to analysts within the
Timesketch UI.</p>
<p>Heres how you can use the
<a href="https://github.com/google/timesketch/blob/master/api_client/python/timesketch_api_client/scenario.py">scenario.py</a>
and <a href="https://github.com/google/timesketch/blob/master/api_client/python/timesketch_api_client/sketch.py">sketch.py</a>
API client methods to achieve this.</p>
<h4 id="step-1-add-an-investigative-question">Step 1: Add an Investigative Question</h4>
<p>First, you need to add a question to your sketch. You can do this by using the
<code>add_question</code> method on a <code>Sketch</code> object. You can add a question that is
already part of your DFIQ library of questions or a free text question. This
will create a new <code>InvestigativeQuestion</code> in the Investigation View.</p>
<pre><code class="language-python">from timesketch_api_client import config
from timesketch_api_client import sketch

# Authenticate and get a sketch object
my_sketch = config.get_client().get_sketch(1)

# Add a new question to the sketch
question_text = &quot;What is the source of the anomalous network traffic?&quot;
question = my_sketch.add_question(question_text=question_text)

print(f&quot;Successfully added question '{question.name}' with ID: {question.id}&quot;)
</code></pre>
<h4 id="step-2-add-a-conclusion">Step 2: Add a Conclusion</h4>
<p>Once you have a question object, you can add conclusions to it. A conclusion is
the answer or finding that your tool or script has generated for that specific
question. Use the <code>add_conclusion</code> method on the <code>Question</code> object.</p>
<p>The API response from adding a conclusion will contain the <code>id</code> of the newly
created conclusion, which you will need to link events to it.</p>
<pre><code class="language-python"># Assume 'question' is the Question object from the previous step
conclusion_text = &quot;The anomalous traffic originates from a compromised user's workstation (IP: 192.168.1.101).&quot;
conclusion_response = question.add_conclusion(conclusion_text)

# Extract the conclusion ID from the API response
conclusion_objects = conclusion_response.get(&quot;objects&quot;, [])
if conclusion_objects:
    conclusion_id = conclusion_objects[0].get(&quot;id&quot;)
    print(f&quot;Successfully added conclusion with ID: {conclusion_id}&quot;)
else:
    print(&quot;Failed to add conclusion.&quot;)
    conclusion_id = None
</code></pre>
<h4 id="step-3-link-events-to-the-conclusion">Step 3: Link Events to the Conclusion</h4>
<p>The final and most crucial step is to link the events from your timeline that
support your conclusion. This provides the evidence for your findings. Use the
<code>link_event_to_conclusion</code> method on the <code>Sketch</code> object.</p>
<p>You need to provide the <code>conclusion_id</code> and a list of event dictionaries. Each
dictionary must contain the <code>_id</code> and <code>_index</code> of the event you want to link.
You would typically get these event details from a search query using
<code>sketch.explore()</code> or <code>sketch.search()</code>.</p>
<pre><code class="language-python"># Assume 'my_sketch' is your Sketch object and 'conclusion_id' is from the previous step

# First, find the events you want to link.
# For example, search for events from the compromised IP.
search_results = my_sketch.explore(query_string='ip:&quot;192.168.1.101&quot;')
events_to_link = search_results.get(&quot;objects&quot;, [])

if events_to_link and conclusion_id:
    # Format the events for the linking method
    formatted_events = [
        {
            &quot;_id&quot;: event.get(&quot;_id&quot;),
            &quot;_index&quot;: event.get(&quot;_index&quot;),
        }
        for event in events_to_link
    ]

    # Link the events to the conclusion
    my_sketch.link_event_to_conclusion(
        events=formatted_events,
        conclusion_id=conclusion_id
    )
    print(f&quot;Successfully linked {len(formatted_events)} events to conclusion ID: {conclusion_id}&quot;)
</code></pre>
<p>By following these steps, you can build powerful integrations that leverage your
own analytics and AI models to automatically populate the Timesketch
Investigation View, providing analysts with structured, evidence-backed findings
to accelerate their investigations.</p>







  
  




  



                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "header.autohide"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>