
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../cli-client/">
      
      
        <link rel="next" href="../../changelog/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.8">
    
    
      
        <title>Create an analyzer - timesketch</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#write-analyzers-for-timesketch" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="timesketch" class="md-header__button md-logo" aria-label="timesketch" data-md-component="logo">
      
  <img src="../../assets/images/timesketch-color.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            timesketch
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Create an analyzer
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/google/timesketch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../guides/getting-started/" class="md-tabs__link">
        
  
    
  
  Quickstart

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/user/upload-data/" class="md-tabs__link">
          
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/admin/install/" class="md-tabs__link">
          
  
  Admin Guide

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../getting-started/" class="md-tabs__link">
          
  
  Developers

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../changelog/" class="md-tabs__link">
          
  
  Changelog

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../community/resources/" class="md-tabs__link">
          
  
  Community

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://osdfir.blogspot.com/search/label/timesketch" class="md-tabs__link">
        
  
    
  
  Blog

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="timesketch" class="md-nav__button md-logo" aria-label="timesketch" data-md-component="logo">
      
  <img src="../../assets/images/timesketch-color.svg" alt="logo">

    </a>
    timesketch
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/google/timesketch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/upload-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Uploading timelines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/basic-concepts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic concepts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/sketch-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sketch overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/search-query-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Search query guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/cli-client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command line client
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/notebook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interactive notebook
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/import-from-json-csv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Import from JSON or CSV
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/sigma/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use Sigma
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/intelligence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intelligence
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_10" >
        
          
          <label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Analyzers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_10">
            <span class="md-nav__icon md-icon"></span>
            Analyzers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/analyzers/tagger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tagger analyzer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/analyzers/feature_extraction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Feature extraction analyzer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/analyzers/sigma_analyzer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sigma analyzer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/analyzers/hashR_lookup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HashR analyzer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/user/llm-features-user/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LLM Features
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Admin Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Admin Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/upgrade/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrade
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/scaling-and-limits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scaling and limits
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/admin-cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Admin CLI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/context-links/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Context Links
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/llm-features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LLM Features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/admin/load-dfiq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DFIQ Templates
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Developers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Developers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../frontend-development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Frontend development
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Writing and running tests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interactive notebook
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API client
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            API client
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-upload-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upload data via API
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli-client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI client
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" checked>
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Analyzers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            Analyzers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Create an analyzer
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Create an analyzer
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#background" class="md-nav__link">
    <span class="md-ellipsis">
      Background
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyzers" class="md-nav__link">
    <span class="md-ellipsis">
      Analyzers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#before-you-start" class="md-nav__link">
    <span class="md-ellipsis">
      Before you start
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Before you start">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#feature-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      Feature Extraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sigma-analyzer" class="md-nav__link">
    <span class="md-ellipsis">
      Sigma Analyzer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tagger-analyzer" class="md-nav__link">
    <span class="md-ellipsis">
      Tagger Analyzer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-the-analyzer" class="md-nav__link">
    <span class="md-ellipsis">
      Build the analyzer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Build the analyzer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-set-up-your-development-environment" class="md-nav__link">
    <span class="md-ellipsis">
      1) Set Up your development environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-generate-the-necessary-analyzer-templates" class="md-nav__link">
    <span class="md-ellipsis">
      2) Generate the necessary analyzer templates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-addressing-the-todos" class="md-nav__link">
    <span class="md-ellipsis">
      3) Addressing the TODOs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-search-query" class="md-nav__link">
    <span class="md-ellipsis">
      The search query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#return-field" class="md-nav__link">
    <span class="md-ellipsis">
      Return field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analyzer-logic" class="md-nav__link">
    <span class="md-ellipsis">
      Analyzer logic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#return-message" class="md-nav__link">
    <span class="md-ellipsis">
      Return message
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Return message">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#required-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Required fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Optional fields
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-analyzer" class="md-nav__link">
    <span class="md-ellipsis">
      Multi Analyzer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#community-contributed-analyzers" class="md-nav__link">
    <span class="md-ellipsis">
      Community contributed analyzers
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Changelog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/2023-05/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-05
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/2023-03/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-03
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/2023-02/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-02
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/2023-01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-01
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/2022-12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022-12
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/2022-10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022-10
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/2022-09/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022-09
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Community
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Community
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../community/resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../community/roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roadmap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Events
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Events
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../community/2021-timesketch-summit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2021 Summit
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://osdfir.blogspot.com/search/label/timesketch" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#background" class="md-nav__link">
    <span class="md-ellipsis">
      Background
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyzers" class="md-nav__link">
    <span class="md-ellipsis">
      Analyzers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#before-you-start" class="md-nav__link">
    <span class="md-ellipsis">
      Before you start
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Before you start">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#feature-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      Feature Extraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sigma-analyzer" class="md-nav__link">
    <span class="md-ellipsis">
      Sigma Analyzer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tagger-analyzer" class="md-nav__link">
    <span class="md-ellipsis">
      Tagger Analyzer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-the-analyzer" class="md-nav__link">
    <span class="md-ellipsis">
      Build the analyzer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Build the analyzer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-set-up-your-development-environment" class="md-nav__link">
    <span class="md-ellipsis">
      1) Set Up your development environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-generate-the-necessary-analyzer-templates" class="md-nav__link">
    <span class="md-ellipsis">
      2) Generate the necessary analyzer templates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-addressing-the-todos" class="md-nav__link">
    <span class="md-ellipsis">
      3) Addressing the TODOs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-search-query" class="md-nav__link">
    <span class="md-ellipsis">
      The search query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#return-field" class="md-nav__link">
    <span class="md-ellipsis">
      Return field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analyzer-logic" class="md-nav__link">
    <span class="md-ellipsis">
      Analyzer logic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#return-message" class="md-nav__link">
    <span class="md-ellipsis">
      Return message
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Return message">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#required-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Required fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Optional fields
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-analyzer" class="md-nav__link">
    <span class="md-ellipsis">
      Multi Analyzer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#community-contributed-analyzers" class="md-nav__link">
    <span class="md-ellipsis">
      Community contributed analyzers
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  



  
  


<h1 id="write-analyzers-for-timesketch">Write analyzers for Timesketch</h1>
<h2 id="overview">Overview</h2>
<p>This guide provides all steps to get you started with building a new Timesketch
analyzer.</p>
<h2 id="background">Background</h2>
<p>Timesketch analyzers are programs that run when new data is indexed, e.g. when
you upload a new plaso storage file or when adding an existing index to a
sketch. They can also be triggered manually for a specific timeline from the
Analyzer tab in the UI after the index is finished.
You have access to a simple API that makes searching, commenting, tagging etc
easy. Everything you can do in the UI you can do programmatically.</p>
<h2 id="analyzers">Analyzers</h2>
<p>An analyzer can be auto-run on every new timeline that is added to a sketch or
manually triggered by the analyst. If you read somewhere about "sketch" and
"index" analyzers, this info is deprecated. There is now only one type of
analyzer.</p>
<p>An analyzer can search, correlate and enrich data in each given timeline. The
following methods to interact with an event in a timeline are available to the
analyzer:</p>
<ul>
<li>Tag events.</li>
<li>Star events.</li>
<li>Comment on events.</li>
<li>Create saved views.</li>
<li>Add attributes to events.</li>
<li>Tag events with emojis.</li>
<li>Create/Add a story based on the analyzer output.</li>
<li>(soon) Build a graph.</li>
<li>(soon) Build aggregated views.</li>
</ul>
<h2 id="before-you-start">Before you start</h2>
<p>We have identified three tasks, that came up frequently as individual analyzer
ideas and made them easier. So please check if your analyzer idea matches any
of the following.</p>
<h3 id="feature-extraction">Feature Extraction</h3>
<p>If you just want to extract a simple feature, e.g. want to extract a hostname or
IP that is somewhere in the message field, or inside another attribute you don't
have to write a new analyzer, you can take advantage of the feature_extraction
analyzer. All you need to do is to edit the <code>regex_features.yaml</code> file found here:
https://github.com/google/timesketch/blob/master/data/regex_features.yaml</p>
<p>An example extraction entry looks like this:</p>
<pre><code>name:
      query_string: 'my_secret_attribute:&quot;look here&quot;'
      # Mandatory fields.
      attribute: 'message'
      Store_as: 'secret'
      re: 'not a secret:([^\.]+).'
      # Optional fields.
      emojis: ['camera']
      tags: ['secret-entry']
      create_view: True
      aggregate: False
</code></pre>
<h3 id="sigma-analyzer">Sigma Analyzer</h3>
<p>The Sigma analyzer uses sigma rules from the community
<a href="https://github.com/SigmaHQ/sigma">sigma project</a> and internally
developed/adjusted rules to detect and tag events in a timeline. It allows for
easy management of rules by modifying an existing rule or creating a new rule
from scratch directly in the Timesketch web UI. Write a sigma rule instead of a
new analyzer if you have a specific search query or an existing community rule
and want to tag all those events.</p>
<p>Check the
<a href="https://github.com/google/timesketch/blob/master/docs/guides/analyzers/sigma_analyzer.md">sigma analyzer docs</a>
for more information.</p>
<h3 id="tagger-analyzer">Tagger Analyzer</h3>
<p>If your query requires a more advanced search query like dynamically tagging
based on values derived from event attributes, you should make use of the tagger
analyzer. This also allows you to tag all events based on a generic search query
and regex searches. See the
<a href="https://github.com/google/timesketch/blob/master/docs/guides/analyzers/tagger.md">tagger doc</a>
for more information.</p>
<p>TIP: If your detection idea can be implemented with a Sigma rule use that
instead of the tagger analyzer!</p>
<p>To use it, just add a new tagger entry in the <code>tags.yaml</code> file:
https://github.com/google/timesketch/blob/master/data/tags.yaml</p>
<p>An example tagger entry looks like this:</p>
<pre><code>test_tagger:
    query_string: 'test'
    tags: ['test-tag']
    emojis: ['FISHING_POLE']
    save_search: true
    search_name: 'TEST the tag'
</code></pre>
<h2 id="build-the-analyzer">Build the analyzer</h2>
<p>Ok, let’s get started!</p>
<h3 id="1-set-up-your-development-environment">1) Set Up your development environment</h3>
<p>Follow the instructions in
<a href="https://timesketch.org/developers/getting-started/">Timesketch development - Getting started</a>
to get everything up and running.</p>
<h3 id="2-generate-the-necessary-analyzer-templates">2) Generate the necessary analyzer templates</h3>
<p>The first thing we are going to do is installing and running the l2t scaffolder
to generate the necessary files.</p>
<p><strong>Install the scaffolder</strong></p>
<p>Follow these instructions to install <code>l2tscaffolder</code> from source in a
virtualenv:
https://l2tscaffolder.readthedocs.io/en/latest/sources/user/Installation.html#install-from-sources</p>
<p><strong>Run the scaffolder to generate a sketch analyzer</strong></p>
<pre><code class="language-shell">$ cd ~/timesketch/
$ l2t_scaffolder.py
</code></pre>
<p>TIP: If running <code>l2t_scaffolder.py</code> does not work, use
<code>$HOME/.local/bin/l2t_scaffolder.py</code></p>
<ol>
<li>When you run the tool it will first ask you what system you want to generate
    templates for. Choose <code>timesketch</code>.</li>
<li>Next you need to enter the path to the local Timesketch source repository.</li>
<li>Name your new analyzer <code>best_analyzer</code>.</li>
<li>Select <code>sketch_analyzer</code> to continue.</li>
</ol>
<p>This should look like this:</p>
<pre><code class="language-shell">$ cd ~/timesketch/
$ l2t_scaffolder.py
   == Starting the scaffolder ==
Gathering required information.

Available definitions:
  [0] plaso
  [1] timesketch
  [2] turbinia
Definition choice: 1
timesketch chosen.

Path to the project root: .
Path [.] set as the project path.

Name of the module to be generated. This can be something like &quot;foobar sqlite&quot;
or &quot;event analytics&quot;.

This will be used for class name generation and file name prefixes.
Module Name: best_analyzer
About to create a new feature branch to store newly generated code.
Creating feature branch: best_analyzer inside .
Switching to feature branch best_analyzer

Available scaffolders for timesketch:
  [0] index_analyzer
  [1] sketch_analyzer
Scaffolder choice: 1
Ready to generate files? [Y/n]: Y
File: ./timesketch/lib/analyzers/best_analyzer.py written to disk.
File: ./timesketch/lib/analyzers/BEST_ANALYZER_test.py written to disk.
File: ./timesketch/lib/analyzers/__init__.py written to disk.
</code></pre>
<p>The scaffolder will create a new branch for you as well, so don't worry about
messing with the master branch.</p>
<pre><code class="language-shell">$ git branch
  master
* best_analyzer
</code></pre>
<p>Three files will be edited/created.</p>
<pre><code class="language-shell">$ git diff master --stat
 timesketch/lib/analyzers/__init__.py        |  1 +
 timesketch/lib/analyzers/best_analyzer.py      | 55 +++++++++++++++++++++
 timesketch/lib/analyzers/BEST_ANALYZER_test.py | 24 ++++++++++++++
 3 files changed, 80 insertions(+)
</code></pre>
<p><em>__init__.py</em></p>
<p>In this file the scaffolder has added the importing of the new analyzer here in
order to register it. You do not need to edit anything in this file as it is
automatically edited by the scaffolder.</p>
<pre><code class="language-shell"># Register all analyzers here by importing them.
from timesketch.lib.analyzers import best_analyzer
from timesketch.lib.analyzers import similarity_scorer
</code></pre>
<p><em>best_analyzer_test.py</em></p>
<p>Test for the analyzer. This is out of scope for this guide and remains as an
exercise for the reader. To be able to run your tests you'll need to setup few
extra packages:</p>
<pre><code class="language-shell">$ sudo apt-get install pylint python3.9-venv
</code></pre>
<p>And then to setup your virtualenv</p>
<pre><code class="language-shell">$ python3 -m venv timesketch_dev
$ source timesketch_dev/bin/activate
$ cd ~/timesketch
$ pip install -r requirements.txt
$ pip install -r test_requirements.txt
</code></pre>
<p>Now you can run the tests: <code>$ ~/timesketch/run_tests.py</code></p>
<p><em>best_analyzer.py</em></p>
<p>This is your new analyzer and it is here where all the logic goes. The entry
point for the analyzer is the <code>run()</code> method. You can choose to add all logic
here or create new methods etc.</p>
<p>There are six TODOs in the file and we are going to walk through all of them to
get a working analyzer. Out of the box the run() method looks like this:</p>
<pre><code class="language-python">  NAME = 'best_analyzer'
  DISPLAY_NAME = 'best_analyzer'
  DESCRIPTION = '# TODO: best_analyzer description'

  [...]

def run(self):
   &quot;&quot;&quot;Entry point for the analyzer.

   Returns:
       String with summary of the analyzer result
   &quot;&quot;&quot;
   # TODO: Add Opensearch query to get the events you need.
   query = ''

   # TODO: Specify what returned fields you need for your analyzer.
   return_fields = ['message']

   # Generator of events based on your query.
   events = self.event_stream(
       query_string=query, return_fields=return_fields)

   # TODO: Add analyzer logic below.
   # Methods available to use for sketch analyzers:
   # sketch.get_all_indices()
   # (If you add a view, please make sure the analyzer has results before
   # adding the view.)
   # view = self.sketch.add_view(
   #     view_name=name, analyzer_name=self.NAME,
   #     query_string=query_string, query_filter={})
   # event.add_attributes({'foo': 'bar'})
   # event.add_tags(['tag_name'])
   # event.add_label('label')
   # event.add_star()
   # event.add_comment('comment')
   # event.add_emojis([my_emoji])
   # event.add_human_readable('human readable text', self.NAME)
   # Remember you'll need to add event.commit() once all changes to the
   # event have been completed.
   # You can also add a story.
   # story = self.sketch.add_story(title='Story from analyzer')
   # story.add_text('## This is a markdown title')
   # story.add_view(view)
   # story.add_text('This is another paragraph')

   for event in events:
       pass

   # TODO: Return a summary from the analyzer.
   return 'String to be returned'
</code></pre>
<h3 id="3-addressing-the-todos">3) Addressing the TODOs</h3>
<p>It’s time to address the TODOs in the analyzer file.</p>
<h3 id="metadata">Metadata</h3>
<p>Add a <code>DISPLAY_NAME</code> and <code>DESCRIPTION</code> for your analyzer in the top of the
class. This information will be used to list the analyzer on the "Analyzer"
tab in Timesketch. Make sure it describes what the analyzer does and should be
used for, since this is the information that analysts have at hand to decide
which analyzer to run on their timeline.</p>
<h3 id="the-search-query">The search query</h3>
<p>The analyzer works on the results of a query that needs to be defined in
the <code>best_analyzer.py</code> file.</p>
<pre><code class="language-python">   # TODO: Add Opensearch query to get the events you need.
   query = ''
</code></pre>
<p>The more specific a query is the faster can the analyzer iterate through the
results. So it is recommended to upload some test data in a new sketch and tweak
 the search query to find an optimal result that will be used in the analyzer.</p>
<h3 id="return-field">Return field</h3>
<p>When you get results from Opensearch you can control what fields you need
returned. The fewer fields returned means less data in the response and less
overhead so a tip is to specify exactly the fields you will need for your
analyzer.</p>
<h3 id="analyzer-logic">Analyzer logic</h3>
<p>The analyzer template provides a list with available functions to interact with
the sketch. Per default it will run the search query and get all resulting
events that can be iterated.</p>
<pre><code class="language-python">   for event in events:
       # Analyzer logic starts here
</code></pre>
<p>At this point you can use everything that python offers to work with the
event data.</p>
<h3 id="return-message">Return message</h3>
<p>The <code>BaseAnalyzer</code> class provides an <code>output</code> object that should be used to
define what the analyzer will display as a result in the UI.
The template provides an overview of output fields that are available.</p>
<h4 id="required-fields">Required fields</h4>
<p>The following three fields need to be set by the analyzer author.</p>
<ul>
<li><code>self.output.result_status (str): [SUCCESS, ERROR]</code><ul>
<li>Analyzer result status. Use <code>SUCCESS</code> when your analyzer ran without problems.
Use <code>ERROR</code> when there are problems that prevent the analyzer from running,
but not worth raising an exception. In the case of <code>ERROR</code> provide actionable
feedback in the <code>result_summary</code> attribute!</li>
</ul>
</li>
<li><code>self.output.result_priority (str): [NOTE, LOW, MEDIUM, HIGH]</code><ul>
<li>Priority of the result based on your analysis findings. <code>NOTE</code> is the default
value and should be used for everything that is not actionable (e.g. enhancing
data). The priority will be used to sort the analyzer results in the UI to
highlight the most actionable (e.g. <code>HIGH</code>) at the top.</li>
</ul>
</li>
<li><code>self.output.result_summary (str)</code><ul>
<li>A summary statement of the analyzer finding. A result summary must exist
even if there is no finding. Use this field to explain the user what your
analyzer found or did.</li>
</ul>
</li>
<li>All other required fields are set by the Analyzer framework automatically.</li>
</ul>
<h4 id="optional-fields">Optional fields</h4>
<p>There are also some optional fields that can be set to further enhance the results
of your analyzer.</p>
<ul>
<li><code>self.output.result_markdown (str)</code><ul>
<li>A detailed information about the analyzer results in a markdown format. Use
this field if the result is not enough for its own story, but too much for
the normal <code>result_summary</code>.</li>
</ul>
</li>
<li><code>self.output.references (List[str])</code><ul>
<li>A list of references (URLs) about the analyzer or the issue the analyzer
attempts to address. Use this to tell users where they can read more about
how to interpret your analyzer results.</li>
</ul>
</li>
<li>Other optional fields like <code>saved_views</code>, <code>saved_stories</code> or <code>created_tags</code> are
set automatically when you use the BaseAnalyzer functions like <code>event.add_view()</code>
or <code>event.add_tags()</code>.</li>
</ul>
<p>The analyzer <code>run()</code> method will then return <code>str(self.output)</code> which will verify
the output format and if everything is fine it will store a json string in the
database that will be interpreted by the new Timesketch UI.</p>
<h2 id="multi-analyzer">Multi Analyzer</h2>
<p>When you develop an analyzer that would benefit from creating smaller sub-jobs,
you should use a Multi Analyzer.</p>
<p>For example The Sigma analyzer is such a Multi Analyzer. That means, the Sigma
analyzer is calling <code>get_kwargs()</code> from <a href="https://github.com/google/timesketch/blob/master/timesketch/lib/analyzers/sigma_tagger.py">sigma_tagger.py</a>.
That will return a list of all Sigma rules installed on the instance. The Main
celery job then spawns one celery job per Sigma rule that can run in parallel
or serial depending on the celery config and sizing of the Timesketch instance.</p>
<h2 id="community-contributed-analyzers">Community contributed analyzers</h2>
<p>This is currently an experiment and subject to rapid change!</p>
<p><code>timesketch/lib/analyzers/contrib</code> hosts community contributed analyzers.
They are not maintained
by the core Timesketch development team.</p>
<p>Please read <code>timesketch/lib/analyzers/contrib/README.md</code> for more information.</p>







  
  




  



                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "header.autohide"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>